/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e,t,n={551:(e,t,n)=>{"use strict";var r=n(540),i=n(982);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,r,i,a,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function v(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),C=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),k=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function N(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=L&&e[L]||e["@@iterator"])?e:null}var O,F=Object.assign;function U(e){if(void 0===O)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var B=!1;function z(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),a=r.stack.split("\n"),s=i.length-1,o=a.length-1;1<=s&&0<=o&&i[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(i[s]!==a[o]){if(1!==s||1!==o)do{if(s--,0>--o||i[s]!==a[o]){var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function V(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return z(e.type,!1);case 11:return z(e.type.render,!1);case 1:return z(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case M:return"Profiler";case A:return"StrictMode";case P:return"Suspense";case I:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:H(e.type)||"Memo";case k:t=e._payload,e=e._init;try{return H(e(t))}catch(e){}}return null}function $(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(t);case 8:return t===A?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function j(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=j(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=j(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=G(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Q(e,t){Z(e,t);var n=G(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function J(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+G(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function ae(e,t){var n=G(t.value),r=G(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var _e=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(a(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Ae=null;function Me(e){if(e=gi(e)){if("function"!=typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=yi(t),we(e.stateNode,e.type,t))}}function Ee(e){Se?Ae?Ae.push(e):Ae=[e]:Se=e}function Ce(){if(Se){var e=Se,t=Ae;if(Ae=Se=null,Me(e),t)for(e=0;e<t.length;e++)Me(t[e])}}function Te(e,t){return e(t)}function Pe(){}var Ie=!1;function Re(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return Te(e,t,n)}finally{Ie=!1,(null!==Se||null!==Ae)&&(Pe(),Ce())}}function ke(e,t){var n=e.stateNode;if(null===n)return null;var r=yi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var De=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){De=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){De=!1}function Ne(e,t,n,r,i,a,s,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Oe=!1,Fe=null,Ue=!1,Be=null,ze={onError:function(e){Oe=!0,Fe=e}};function Ve(e,t,n,r,i,a,s,o,l){Oe=!1,Fe=null,Ne.apply(ze,arguments)}function He(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function $e(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Ge(e){if(He(e)!==e)throw Error(a(188))}function je(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=He(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Ge(i),e;if(s===r)return Ge(i),t;s=s.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var qe=i.unstable_scheduleCallback,Xe=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,Ke=i.unstable_requestPaint,Ze=i.unstable_now,Qe=i.unstable_getCurrentPriorityLevel,Je=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null,st=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2,ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,s=268435455&n;if(0!==s){var o=s&~i;0!==o?r=dt(o):0!=(a&=s)&&(r=dt(a))}else 0!=(s=n&~i)?r=dt(s):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&!(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&4194240&a))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return!(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _t(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var vt=0;function bt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var xt,wt,St,At,Mt,Et=!1,Ct=[],Tt=null,Pt=null,It=null,Rt=new Map,kt=new Map,Dt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":kt.delete(t.pointerId)}}function Ot(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&null!==(t=gi(t))&&wt(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ft(e){var t=mi(e.target);if(null!==t){var n=He(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=$e(n)))return e.blockedOn=t,void Mt(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=gi(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Bt(e,t,n){Ut(e)&&n.delete(t)}function zt(){Et=!1,null!==Tt&&Ut(Tt)&&(Tt=null),null!==Pt&&Ut(Pt)&&(Pt=null),null!==It&&Ut(It)&&(It=null),Rt.forEach(Bt),kt.forEach(Bt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,zt)))}function Ht(e){function t(t){return Vt(t,e)}if(0<Ct.length){Vt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Tt&&Vt(Tt,e),null!==Pt&&Vt(Pt,e),null!==It&&Vt(It,e),Rt.forEach(t),kt.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Dt.shift()}var $t=b.ReactCurrentBatchConfig,Gt=!0;function jt(e,t,n,r){var i=vt,a=$t.transition;$t.transition=null;try{vt=1,qt(e,t,n,r)}finally{vt=i,$t.transition=a}}function Wt(e,t,n,r){var i=vt,a=$t.transition;$t.transition=null;try{vt=4,qt(e,t,n,r)}finally{vt=i,$t.transition=a}}function qt(e,t,n,r){if(Gt){var i=Yt(e,t,n,r);if(null===i)Vr(e,t,r,Xt,n),Nt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Tt=Ot(Tt,e,t,n,r,i),!0;case"dragenter":return Pt=Ot(Pt,e,t,n,r,i),!0;case"mouseover":return It=Ot(It,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Rt.set(a,Ot(Rt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,kt.set(a,Ot(kt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Nt(e,r),4&t&&-1<Lt.indexOf(e)){for(;null!==i;){var a=gi(i);if(null!==a&&xt(a),null===(a=Yt(e,t,n,r))&&Vr(e,t,r,Xt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Xt=null;function Yt(e,t,n,r){if(Xt=null,null!==(e=mi(e=xe(r))))if(null===(t=He(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=$e(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Je:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Zt=null,Qt=null,Jt=null;function en(){if(Jt)return Jt;var e,t,n=Qt,r=n.length,i="value"in Zt?Zt.value:Zt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[a-t];t++);return Jt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),dn=F({},cn,{view:0,detail:0}),hn=an(dn),fn=F({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=an(fn),mn=an(F({},fn,{dataTransfer:0})),gn=an(F({},dn,{relatedTarget:0})),_n=an(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=an(F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),vn=an(F({},cn,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wn[e])&&!!t[e]}function An(){return Sn}var Mn=an(F({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),En=an(F({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Cn=an(F({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An})),Tn=an(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pn=an(F({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),In=[9,13,27,32],Rn=u&&"CompositionEvent"in window,kn=null;u&&"documentMode"in document&&(kn=document.documentMode);var Dn=u&&"TextEvent"in window&&!kn,Ln=u&&(!Rn||kn&&8<kn&&11>=kn),Nn=String.fromCharCode(32),On=!1;function Fn(e,t){switch(e){case"keyup":return-1!==In.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Bn=!1,zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zn[e.type]:"textarea"===t}function Hn(e,t,n,r){Ee(r),0<(t=$r(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var $n=null,Gn=null;function jn(e){Nr(e,0)}function Wn(e){if(q(_i(e)))return e}function qn(e,t){if("change"===e)return t}var Xn=!1;if(u){var Yn;if(u){var Kn="oninput"in document;if(!Kn){var Zn=document.createElement("div");Zn.setAttribute("oninput","return;"),Kn="function"==typeof Zn.oninput}Yn=Kn}else Yn=!1;Xn=Yn&&(!document.documentMode||9<document.documentMode)}function Qn(){$n&&($n.detachEvent("onpropertychange",Jn),Gn=$n=null)}function Jn(e){if("value"===e.propertyName&&Wn(Gn)){var t=[];Hn(t,Gn,e,xe(e)),Re(jn,t)}}function er(e,t,n){"focusin"===e?(Qn(),Gn=n,($n=t).attachEvent("onpropertychange",Jn)):"focusout"===e&&Qn()}function tr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Wn(Gn)}function nr(e,t){if("click"===e)return Wn(t)}function rr(e,t){if("input"===e||"change"===e)return Wn(t)}var ir="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ar(e,t){if(ir(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!ir(e[i],t[i]))return!1}return!0}function sr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function or(e,t){var n,r=sr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=sr(r)}}function lr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?lr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function cr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function ur(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function dr(e){var t=cr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&lr(n.ownerDocument.documentElement,n)){if(null!==r&&ur(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=or(n,a);var s=or(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hr=u&&"documentMode"in document&&11>=document.documentMode,fr=null,pr=null,mr=null,gr=!1;function _r(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;gr||null==fr||fr!==X(r)||(r="selectionStart"in(r=fr)&&ur(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&ar(mr,r)||(mr=r,0<(r=$r(pr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=fr)))}function yr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var vr={animationend:yr("Animation","AnimationEnd"),animationiteration:yr("Animation","AnimationIteration"),animationstart:yr("Animation","AnimationStart"),transitionend:yr("Transition","TransitionEnd")},br={},xr={};function wr(e){if(br[e])return br[e];if(!vr[e])return e;var t,n=vr[e];for(t in n)if(n.hasOwnProperty(t)&&t in xr)return br[e]=n[t];return e}u&&(xr=document.createElement("div").style,"AnimationEvent"in window||(delete vr.animationend.animation,delete vr.animationiteration.animation,delete vr.animationstart.animation),"TransitionEvent"in window||delete vr.transitionend.transition);var Sr=wr("animationend"),Ar=wr("animationiteration"),Mr=wr("animationstart"),Er=wr("transitionend"),Cr=new Map,Tr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Cr.set(e,t),l(t,[e])}for(var Ir=0;Ir<Tr.length;Ir++){var Rr=Tr[Ir];Pr(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}Pr(Sr,"onAnimationEnd"),Pr(Ar,"onAnimationIteration"),Pr(Mr,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Er,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dr=new Set("cancel close invalid load scroll toggle".split(" ").concat(kr));function Lr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,o,l,c){if(Ve.apply(this,arguments),Oe){if(!Oe)throw Error(a(198));var u=Fe;Oe=!1,Fe=null,Ue||(Ue=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function Nr(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var s=r.length-1;0<=s;s--){var o=r[s],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==a&&i.isPropagationStopped())break e;Lr(i,o,c),a=l}else for(s=0;s<r.length;s++){if(l=(o=r[s]).instance,c=o.currentTarget,o=o.listener,l!==a&&i.isPropagationStopped())break e;Lr(i,o,c),a=l}}}if(Ue)throw e=Be,Ue=!1,Be=null,e}function Or(e,t){var n=t[hi];void 0===n&&(n=t[hi]=new Set);var r=e+"__bubble";n.has(r)||(zr(t,e,2,!1),n.add(r))}function Fr(e,t,n){var r=0;t&&(r|=4),zr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Br(e){if(!e[Ur]){e[Ur]=!0,s.forEach((function(t){"selectionchange"!==t&&(Dr.has(t)||Fr(t,!1,e),Fr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,Fr("selectionchange",!1,t))}}function zr(e,t,n,r){switch(Kt(t)){case 1:var i=jt;break;case 4:i=Wt;break;default:i=qt}n=i.bind(null,t,n,e),i=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,i){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var o=r.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==o;){if(null===(s=mi(o)))return;if(5===(l=s.tag)||6===l){r=a=s;continue e}o=o.parentNode}}r=r.return}Re((function(){var r=a,i=xe(n),s=[];e:{var o=Cr.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Mn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Cn;break;case Sr:case Ar:case Mr:l=_n;break;case Er:l=Tn;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=En}var u=!!(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&null!=(m=ke(p,h))&&u.push(Hr(p,m,f))),d)break;p=p.return}0<u.length&&(o=new l(o,c,null,n,i),s.push({event:o,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!mi(c)&&!c[di])&&(l||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?mi(c):null)&&(c!==(d=He(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=pn,m="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=En,m="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==l?o:_i(l),f=null==c?o:_i(c),(o=new u(m,p+"leave",l,n,i)).target=d,o.relatedTarget=f,m=null,mi(i)===r&&((u=new u(h,p+"enter",c,n,i)).target=f,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,p=0,f=u=l;f;f=Gr(f))p++;for(f=0,m=h;m;m=Gr(m))f++;for(;0<p-f;)u=Gr(u),p--;for(;0<f-p;)h=Gr(h),f--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Gr(u),h=Gr(h)}u=null}else u=null;null!==l&&jr(s,o,l,u,!1),null!==c&&null!==d&&jr(s,d,c,u,!0)}if("select"===(l=(o=r?_i(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=qn;else if(Vn(o))if(Xn)g=rr;else{g=tr;var _=er}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=nr);switch(g&&(g=g(e,r))?Hn(s,g,n,i):(_&&_(e,o,r),"focusout"===e&&(_=o._wrapperState)&&_.controlled&&"number"===o.type&&ee(o,"number",o.value)),_=r?_i(r):window,e){case"focusin":(Vn(_)||"true"===_.contentEditable)&&(fr=_,pr=r,mr=null);break;case"focusout":mr=pr=fr=null;break;case"mousedown":gr=!0;break;case"contextmenu":case"mouseup":case"dragend":gr=!1,_r(s,n,i);break;case"selectionchange":if(hr)break;case"keydown":case"keyup":_r(s,n,i)}var y;if(Rn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Bn?Fn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Ln&&"ko"!==n.locale&&(Bn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Bn&&(y=en()):(Qt="value"in(Zt=i)?Zt.value:Zt.textContent,Bn=!0)),0<(_=$r(r,v)).length&&(v=new vn(v,e,null,n,i),s.push({event:v,listeners:_}),(y||null!==(y=Un(n)))&&(v.data=y))),(y=Dn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(On=!0,Nn);case"textInput":return(e=t.data)===Nn&&On?null:e;default:return null}}(e,n):function(e,t){if(Bn)return"compositionend"===e||!Rn&&Fn(e,t)?(e=en(),Jt=Qt=Zt=null,Bn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(r=$r(r,"onBeforeInput")).length&&(i=new vn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=y)}Nr(s,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function $r(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=ke(e,n))&&r.unshift(Hr(e,a,i)),null!=(a=ke(e,t))&&r.push(Hr(e,a,i))),e=e.return}return r}function Gr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function jr(e,t,n,r,i){for(var a=t._reactName,s=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,i?null!=(l=ke(n,a))&&s.unshift(Hr(n,l,o)):i||null!=(l=ke(n,a))&&s.push(Hr(n,l,o))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Wr=/\r\n?/g,qr=/\u0000|\uFFFD/g;function Xr(e){return("string"==typeof e?e:""+e).replace(Wr,"\n").replace(qr,"")}function Yr(e,t,n){if(t=Xr(t),Xr(e)!==t&&n)throw Error(a(425))}function Kr(){}var Zr=null,Qr=null;function Jr(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ei="function"==typeof setTimeout?setTimeout:void 0,ti="function"==typeof clearTimeout?clearTimeout:void 0,ni="function"==typeof Promise?Promise:void 0,ri="function"==typeof queueMicrotask?queueMicrotask:void 0!==ni?function(e){return ni.resolve(null).then(e).catch(ii)}:ei;function ii(e){setTimeout((function(){throw e}))}function ai(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Ht(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ht(t)}function si(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function oi(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var li=Math.random().toString(36).slice(2),ci="__reactFiber$"+li,ui="__reactProps$"+li,di="__reactContainer$"+li,hi="__reactEvents$"+li,fi="__reactListeners$"+li,pi="__reactHandles$"+li;function mi(e){var t=e[ci];if(t)return t;for(var n=e.parentNode;n;){if(t=n[di]||n[ci]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=oi(e);null!==e;){if(n=e[ci])return n;e=oi(e)}return t}n=(e=n).parentNode}return null}function gi(e){return!(e=e[ci]||e[di])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function _i(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function yi(e){return e[ui]||null}var vi=[],bi=-1;function xi(e){return{current:e}}function wi(e){0>bi||(e.current=vi[bi],vi[bi]=null,bi--)}function Si(e,t){bi++,vi[bi]=e.current,e.current=t}var Ai={},Mi=xi(Ai),Ei=xi(!1),Ci=Ai;function Ti(e,t){var n=e.type.contextTypes;if(!n)return Ai;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Pi(e){return null!=e.childContextTypes}function Ii(){wi(Ei),wi(Mi)}function Ri(e,t,n){if(Mi.current!==Ai)throw Error(a(168));Si(Mi,t),Si(Ei,n)}function ki(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,$(e)||"Unknown",i));return F({},n,r)}function Di(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ai,Ci=Mi.current,Si(Mi,e),Si(Ei,Ei.current),!0}function Li(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=ki(e,t,Ci),r.__reactInternalMemoizedMergedChildContext=e,wi(Ei),wi(Mi),Si(Mi,e)):wi(Ei),Si(Ei,n)}var Ni=null,Oi=!1,Fi=!1;function Ui(e){null===Ni?Ni=[e]:Ni.push(e)}function Bi(){if(!Fi&&null!==Ni){Fi=!0;var e=0,t=vt;try{var n=Ni;for(vt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ni=null,Oi=!1}catch(t){throw null!==Ni&&(Ni=Ni.slice(e+1)),qe(Je,Bi),t}finally{vt=t,Fi=!1}}return null}var zi=[],Vi=0,Hi=null,$i=0,Gi=[],ji=0,Wi=null,qi=1,Xi="";function Yi(e,t){zi[Vi++]=$i,zi[Vi++]=Hi,Hi=e,$i=t}function Ki(e,t,n){Gi[ji++]=qi,Gi[ji++]=Xi,Gi[ji++]=Wi,Wi=e;var r=qi;e=Xi;var i=32-st(r)-1;r&=~(1<<i),n+=1;var a=32-st(t)+i;if(30<a){var s=i-i%5;a=(r&(1<<s)-1).toString(32),r>>=s,i-=s,qi=1<<32-st(t)+i|n<<i|r,Xi=a+e}else qi=1<<a|n<<i|r,Xi=e}function Zi(e){null!==e.return&&(Yi(e,1),Ki(e,1,0))}function Qi(e){for(;e===Hi;)Hi=zi[--Vi],zi[Vi]=null,$i=zi[--Vi],zi[Vi]=null;for(;e===Wi;)Wi=Gi[--ji],Gi[ji]=null,Xi=Gi[--ji],Gi[ji]=null,qi=Gi[--ji],Gi[ji]=null}var Ji=null,ea=null,ta=!1,na=null;function ra(e,t){var n=Tc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ia(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,Ji=e,ea=si(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,Ji=e,ea=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Wi?{id:qi,overflow:Xi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Tc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Ji=e,ea=null,!0);default:return!1}}function aa(e){return!(!(1&e.mode)||128&e.flags)}function sa(e){if(ta){var t=ea;if(t){var n=t;if(!ia(e,t)){if(aa(e))throw Error(a(418));t=si(n.nextSibling);var r=Ji;t&&ia(e,t)?ra(r,n):(e.flags=-4097&e.flags|2,ta=!1,Ji=e)}}else{if(aa(e))throw Error(a(418));e.flags=-4097&e.flags|2,ta=!1,Ji=e}}}function oa(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Ji=e}function la(e){if(e!==Ji)return!1;if(!ta)return oa(e),ta=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!Jr(e.type,e.memoizedProps)),t&&(t=ea)){if(aa(e))throw ca(),Error(a(418));for(;t;)ra(e,t),t=si(t.nextSibling)}if(oa(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ea=si(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ea=null}}else ea=Ji?si(e.stateNode.nextSibling):null;return!0}function ca(){for(var e=ea;e;)e=si(e.nextSibling)}function ua(){ea=Ji=null,ta=!1}function da(e){null===na?na=[e]:na.push(e)}var ha=b.ReactCurrentBatchConfig;function fa(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!=typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function pa(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ma(e){return(0,e._init)(e._payload)}function ga(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Ic(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Lc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===S?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===k&&ma(a)===t.type)?((r=i(t,n.props)).ref=fa(e,t,n),r.return=e,r):((r=Rc(n.type,n.key,n.props,null,e.mode,r)).ref=fa(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Nc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=kc(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Lc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Rc(t.type,t.key,t.props,null,e.mode,n)).ref=fa(e,null,t),n.return=e,n;case w:return(t=Nc(t,e.mode,n)).return=e,t;case k:return h(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=kc(t,e.mode,n,null)).return=e,t;pa(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?c(e,t,n,r):null;case w:return n.key===i?u(e,t,n,r):null;case k:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||N(n))return null!==i?null:d(e,t,n,r,null);pa(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case k:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||N(r))return d(t,e=e.get(n)||null,r,i,null);pa(t,r)}return null}function m(i,a,o,l){for(var c=null,u=null,d=a,m=a=0,g=null;null!==d&&m<o.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var _=f(i,d,o[m],l);if(null===_){null===d&&(d=g);break}e&&d&&null===_.alternate&&t(i,d),a=s(_,a,m),null===u?c=_:u.sibling=_,u=_,d=g}if(m===o.length)return n(i,d),ta&&Yi(i,m),c;if(null===d){for(;m<o.length;m++)null!==(d=h(i,o[m],l))&&(a=s(d,a,m),null===u?c=d:u.sibling=d,u=d);return ta&&Yi(i,m),c}for(d=r(i,d);m<o.length;m++)null!==(g=p(d,i,m,o[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),a=s(g,a,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(i,e)})),ta&&Yi(i,m),c}function g(i,o,l,c){var u=N(l);if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var d=u=null,m=o,g=o=0,_=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var v=f(i,m,y.value,c);if(null===v){null===m&&(m=_);break}e&&m&&null===v.alternate&&t(i,m),o=s(v,o,g),null===d?u=v:d.sibling=v,d=v,m=_}if(y.done)return n(i,m),ta&&Yi(i,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=h(i,y.value,c))&&(o=s(y,o,g),null===d?u=y:d.sibling=y,d=y);return ta&&Yi(i,g),u}for(m=r(i,m);!y.done;g++,y=l.next())null!==(y=p(m,i,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),o=s(y,o,g),null===d?u=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(i,e)})),ta&&Yi(i,g),u}return function e(r,a,s,l){if("object"==typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"==typeof s&&null!==s){switch(s.$$typeof){case x:e:{for(var c=s.key,u=a;null!==u;){if(u.key===c){if((c=s.type)===S){if(7===u.tag){n(r,u.sibling),(a=i(u,s.props.children)).return=r,r=a;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===k&&ma(c)===u.type){n(r,u.sibling),(a=i(u,s.props)).ref=fa(r,u,s),a.return=r,r=a;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===S?((a=kc(s.props.children,r.mode,l,s.key)).return=r,r=a):((l=Rc(s.type,s.key,s.props,null,r.mode,l)).ref=fa(r,a,s),l.return=r,r=l)}return o(r);case w:e:{for(u=s.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===s.containerInfo&&a.stateNode.implementation===s.implementation){n(r,a.sibling),(a=i(a,s.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Nc(s,r.mode,l)).return=r,r=a}return o(r);case k:return e(r,a,(u=s._init)(s._payload),l)}if(te(s))return m(r,a,s,l);if(N(s))return g(r,a,s,l);pa(r,s)}return"string"==typeof s&&""!==s||"number"==typeof s?(s=""+s,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,s)).return=r,r=a):(n(r,a),(a=Lc(s,r.mode,l)).return=r,r=a),o(r)):n(r,a)}}var _a=ga(!0),ya=ga(!1),va=xi(null),ba=null,xa=null,wa=null;function Sa(){wa=xa=ba=null}function Aa(e){var t=va.current;wi(va),e._currentValue=t}function Ma(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ea(e,t){ba=e,wa=xa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(go=!0),e.firstContext=null)}function Ca(e){var t=e._currentValue;if(wa!==e)if(e={context:e,memoizedValue:t,next:null},null===xa){if(null===ba)throw Error(a(308));xa=e,ba.dependencies={lanes:0,firstContext:e}}else xa=xa.next=e;return t}var Ta=null;function Pa(e){null===Ta?Ta=[e]:Ta.push(e)}function Ia(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Pa(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ra(e,r)}function Ra(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ka=!1;function Da(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function La(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Na(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Oa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Ml){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Ra(e,n)}return null===(i=r.interleaved)?(t.next=t,Pa(r)):(t.next=i.next,i.next=t),r.interleaved=t,Ra(e,n)}function Fa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Ua(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ba(e,t,n,r){var i=e.updateQueue;ka=!1;var a=i.firstBaseUpdate,s=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var u=e.alternate;null!==u&&(o=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l)}if(null!==a){var d=i.baseState;for(s=0,u=c=l=null,o=a;;){var h=o.lane,f=o.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,m=o;switch(h=t,f=n,m.tag){case 1:if("function"==typeof(p=m.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null==(h="function"==typeof(p=m.payload)?p.call(f,d,h):p))break e;d=F({},d,h);break e;case 2:ka=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,s|=h;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(h=o).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Dl|=s,e.lanes=s,e.memoizedState=d}}function za(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(a(191,i));i.call(r)}}}var Va={},Ha=xi(Va),$a=xi(Va),Ga=xi(Va);function ja(e){if(e===Va)throw Error(a(174));return e}function Wa(e,t){switch(Si(Ga,t),Si($a,e),Si(Ha,Va),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}wi(Ha),Si(Ha,t)}function qa(){wi(Ha),wi($a),wi(Ga)}function Xa(e){ja(Ga.current);var t=ja(Ha.current),n=le(t,e.type);t!==n&&(Si($a,e),Si(Ha,n))}function Ya(e){$a.current===e&&(wi(Ha),wi($a))}var Ka=xi(0);function Za(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Qa=[];function Ja(){for(var e=0;e<Qa.length;e++)Qa[e]._workInProgressVersionPrimary=null;Qa.length=0}var es=b.ReactCurrentDispatcher,ts=b.ReactCurrentBatchConfig,ns=0,rs=null,is=null,as=null,ss=!1,os=!1,ls=0,cs=0;function us(){throw Error(a(321))}function ds(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ir(e[n],t[n]))return!1;return!0}function hs(e,t,n,r,i,s){if(ns=s,rs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,es.current=null===e||null===e.memoizedState?Ys:Ks,e=n(r,i),os){s=0;do{if(os=!1,ls=0,25<=s)throw Error(a(301));s+=1,as=is=null,t.updateQueue=null,es.current=Zs,e=n(r,i)}while(os)}if(es.current=Xs,t=null!==is&&null!==is.next,ns=0,as=is=rs=null,ss=!1,t)throw Error(a(300));return e}function fs(){var e=0!==ls;return ls=0,e}function ps(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===as?rs.memoizedState=as=e:as=as.next=e,as}function ms(){if(null===is){var e=rs.alternate;e=null!==e?e.memoizedState:null}else e=is.next;var t=null===as?rs.memoizedState:as.next;if(null!==t)as=t,is=e;else{if(null===e)throw Error(a(310));e={memoizedState:(is=e).memoizedState,baseState:is.baseState,baseQueue:is.baseQueue,queue:is.queue,next:null},null===as?rs.memoizedState=as=e:as=as.next=e}return as}function gs(e,t){return"function"==typeof t?t(e):t}function _s(e){var t=ms(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=is,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var l=o=null,c=null,u=s;do{var d=u.lane;if((ns&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,o=r):c=c.next=h,rs.lanes|=d,Dl|=d}u=u.next}while(null!==u&&u!==s);null===c?o=r:c.next=l,ir(r,t.memoizedState)||(go=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,rs.lanes|=s,Dl|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ys(e){var t=ms(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{s=e(s,o.action),o=o.next}while(o!==i);ir(s,t.memoizedState)||(go=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function vs(){}function bs(e,t){var n=rs,r=ms(),i=t(),s=!ir(r.memoizedState,i);if(s&&(r.memoizedState=i,go=!0),r=r.queue,ks(Ss.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==as&&1&as.memoizedState.tag){if(n.flags|=2048,Cs(9,ws.bind(null,n,r,i,t),void 0,null),null===El)throw Error(a(349));30&ns||xs(n,t,i)}return i}function xs(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=rs.updateQueue)?(t={lastEffect:null,stores:null},rs.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ws(e,t,n,r){t.value=n,t.getSnapshot=r,As(t)&&Ms(e)}function Ss(e,t,n){return n((function(){As(t)&&Ms(e)}))}function As(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ir(e,n)}catch(e){return!0}}function Ms(e){var t=Ra(e,1);null!==t&&Jl(t,e,1,-1)}function Es(e){var t=ps();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:e},t.queue=e,e=e.dispatch=Gs.bind(null,rs,e),[t.memoizedState,e]}function Cs(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=rs.updateQueue)?(t={lastEffect:null,stores:null},rs.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ts(){return ms().memoizedState}function Ps(e,t,n,r){var i=ps();rs.flags|=e,i.memoizedState=Cs(1|t,n,void 0,void 0===r?null:r)}function Is(e,t,n,r){var i=ms();r=void 0===r?null:r;var a=void 0;if(null!==is){var s=is.memoizedState;if(a=s.destroy,null!==r&&ds(r,s.deps))return void(i.memoizedState=Cs(t,n,a,r))}rs.flags|=e,i.memoizedState=Cs(1|t,n,a,r)}function Rs(e,t){return Ps(8390656,8,e,t)}function ks(e,t){return Is(2048,8,e,t)}function Ds(e,t){return Is(4,2,e,t)}function Ls(e,t){return Is(4,4,e,t)}function Ns(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Os(e,t,n){return n=null!=n?n.concat([e]):null,Is(4,4,Ns.bind(null,t,e),n)}function Fs(){}function Us(e,t){var n=ms();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ds(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Bs(e,t){var n=ms();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ds(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function zs(e,t,n){return 21&ns?(ir(n,t)||(n=mt(),rs.lanes|=n,Dl|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,go=!0),e.memoizedState=n)}function Vs(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var r=ts.transition;ts.transition={};try{e(!1),t()}finally{vt=n,ts.transition=r}}function Hs(){return ms().memoizedState}function $s(e,t,n){var r=Ql(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},js(e)?Ws(t,n):null!==(n=Ia(e,t,n,r))&&(Jl(n,e,r,Zl()),qs(n,t,r))}function Gs(e,t,n){var r=Ql(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(js(e))Ws(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,n);if(i.hasEagerState=!0,i.eagerState=o,ir(o,s)){var l=t.interleaved;return null===l?(i.next=i,Pa(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(e){}null!==(n=Ia(e,t,i,r))&&(Jl(n,e,r,i=Zl()),qs(n,t,r))}}function js(e){var t=e.alternate;return e===rs||null!==t&&t===rs}function Ws(e,t){os=ss=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function qs(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Xs={readContext:Ca,useCallback:us,useContext:us,useEffect:us,useImperativeHandle:us,useInsertionEffect:us,useLayoutEffect:us,useMemo:us,useReducer:us,useRef:us,useState:us,useDebugValue:us,useDeferredValue:us,useTransition:us,useMutableSource:us,useSyncExternalStore:us,useId:us,unstable_isNewReconciler:!1},Ys={readContext:Ca,useCallback:function(e,t){return ps().memoizedState=[e,void 0===t?null:t],e},useContext:Ca,useEffect:Rs,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Ps(4194308,4,Ns.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ps(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ps(4,2,e,t)},useMemo:function(e,t){var n=ps();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ps();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=$s.bind(null,rs,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ps().memoizedState=e},useState:Es,useDebugValue:Fs,useDeferredValue:function(e){return ps().memoizedState=e},useTransition:function(){var e=Es(!1),t=e[0];return e=Vs.bind(null,e[1]),ps().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=rs,i=ps();if(ta){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===El)throw Error(a(349));30&ns||xs(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Rs(Ss.bind(null,r,s,e),[e]),r.flags|=2048,Cs(9,ws.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=ps(),t=El.identifierPrefix;if(ta){var n=Xi;t=":"+t+"R"+(n=(qi&~(1<<32-st(qi)-1)).toString(32)+n),0<(n=ls++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=cs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Ks={readContext:Ca,useCallback:Us,useContext:Ca,useEffect:ks,useImperativeHandle:Os,useInsertionEffect:Ds,useLayoutEffect:Ls,useMemo:Bs,useReducer:_s,useRef:Ts,useState:function(){return _s(gs)},useDebugValue:Fs,useDeferredValue:function(e){return zs(ms(),is.memoizedState,e)},useTransition:function(){return[_s(gs)[0],ms().memoizedState]},useMutableSource:vs,useSyncExternalStore:bs,useId:Hs,unstable_isNewReconciler:!1},Zs={readContext:Ca,useCallback:Us,useContext:Ca,useEffect:ks,useImperativeHandle:Os,useInsertionEffect:Ds,useLayoutEffect:Ls,useMemo:Bs,useReducer:ys,useRef:Ts,useState:function(){return ys(gs)},useDebugValue:Fs,useDeferredValue:function(e){var t=ms();return null===is?t.memoizedState=e:zs(t,is.memoizedState,e)},useTransition:function(){return[ys(gs)[0],ms().memoizedState]},useMutableSource:vs,useSyncExternalStore:bs,useId:Hs,unstable_isNewReconciler:!1};function Qs(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function Js(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var eo={isMounted:function(e){return!!(e=e._reactInternals)&&He(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Zl(),i=Ql(e),a=Na(r,i);a.payload=t,null!=n&&(a.callback=n),null!==(t=Oa(e,a,i))&&(Jl(t,e,i,r),Fa(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Zl(),i=Ql(e),a=Na(r,i);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Oa(e,a,i))&&(Jl(t,e,i,r),Fa(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zl(),r=Ql(e),i=Na(n,r);i.tag=2,null!=t&&(i.callback=t),null!==(t=Oa(e,i,r))&&(Jl(t,e,r,n),Fa(t,e,r))}};function to(e,t,n,r,i,a,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!(t.prototype&&t.prototype.isPureReactComponent&&ar(n,r)&&ar(i,a))}function no(e,t,n){var r=!1,i=Ai,a=t.contextType;return"object"==typeof a&&null!==a?a=Ca(a):(i=Pi(t)?Ci:Mi.current,a=(r=null!=(r=t.contextTypes))?Ti(e,i):Ai),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=eo,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ro(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&eo.enqueueReplaceState(t,t.state,null)}function io(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Da(e);var a=t.contextType;"object"==typeof a&&null!==a?i.context=Ca(a):(a=Pi(t)?Ci:Mi.current,i.context=Ti(e,a)),i.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(Js(e,t,a,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&eo.enqueueReplaceState(i,i.state,null),Ba(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function ao(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i,digest:null}}function so(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function oo(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var lo="function"==typeof WeakMap?WeakMap:Map;function co(e,t,n){(n=Na(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vl||(Vl=!0,Hl=r),oo(0,t)},n}function uo(e,t,n){(n=Na(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){oo(0,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){oo(0,t),"function"!=typeof r&&(null===$l?$l=new Set([this]):$l.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ho(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new lo;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=wc.bind(null,e,t,n),t.then(e,e))}function fo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function po(e,t,n,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Na(-1,1)).tag=2,Oa(n,t,1))),n.lanes|=1),e)}var mo=b.ReactCurrentOwner,go=!1;function _o(e,t,n,r){t.child=null===e?ya(t,null,n,r):_a(t,e.child,n,r)}function yo(e,t,n,r,i){n=n.render;var a=t.ref;return Ea(t,i),r=hs(e,t,n,r,a,i),n=fs(),null===e||go?(ta&&n&&Zi(t),t.flags|=1,_o(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vo(e,t,i))}function vo(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||Pc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Rc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,bo(e,t,a,r,i))}if(a=e.child,!(e.lanes&i)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:ar)(s,r)&&e.ref===t.ref)return Vo(e,t,i)}return t.flags|=1,(e=Ic(a,r)).ref=t.ref,e.return=t,t.child=e}function bo(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(ar(a,r)&&e.ref===t.ref){if(go=!1,t.pendingProps=r=a,!(e.lanes&i))return t.lanes=e.lanes,Vo(e,t,i);131072&e.flags&&(go=!0)}}return So(e,t,n,r,i)}function xo(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Si(Il,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Si(Il,Pl),Pl|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Si(Il,Pl),Pl|=n;else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Si(Il,Pl),Pl|=r;return _o(e,t,i,n),t.child}function wo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function So(e,t,n,r,i){var a=Pi(n)?Ci:Mi.current;return a=Ti(t,a),Ea(t,i),n=hs(e,t,n,r,a,i),r=fs(),null===e||go?(ta&&r&&Zi(t),t.flags|=1,_o(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vo(e,t,i))}function Ao(e,t,n,r,i){if(Pi(n)){var a=!0;Di(t)}else a=!1;if(Ea(t,i),null===t.stateNode)zo(e,t),no(t,n,r),io(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,c=n.contextType;c="object"==typeof c&&null!==c?Ca(c):Ti(t,c=Pi(n)?Ci:Mi.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==r||l!==c)&&ro(t,s,r,c),ka=!1;var h=t.memoizedState;s.state=h,Ba(t,r,s,i),l=t.memoizedState,o!==r||h!==l||Ei.current||ka?("function"==typeof u&&(Js(t,n,u,r),l=t.memoizedState),(o=ka||to(t,n,o,r,h,l,c))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=o):("function"==typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,La(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:Qs(t.type,o),s.props=c,d=t.pendingProps,h=s.context,l="object"==typeof(l=n.contextType)&&null!==l?Ca(l):Ti(t,l=Pi(n)?Ci:Mi.current);var f=n.getDerivedStateFromProps;(u="function"==typeof f||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==d||h!==l)&&ro(t,s,r,l),ka=!1,h=t.memoizedState,s.state=h,Ba(t,r,s,i);var p=t.memoizedState;o!==d||h!==p||Ei.current||ka?("function"==typeof f&&(Js(t,n,f,r),p=t.memoizedState),(c=ka||to(t,n,c,r,h,p,l)||!1)?(u||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=l,r=c):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Mo(e,t,n,r,a,i)}function Mo(e,t,n,r,i,a){wo(e,t);var s=!!(128&t.flags);if(!r&&!s)return i&&Li(t,n,!1),Vo(e,t,a);r=t.stateNode,mo.current=t;var o=s&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=_a(t,e.child,null,a),t.child=_a(t,null,o,a)):_o(e,t,o,a),t.memoizedState=r.state,i&&Li(t,n,!0),t.child}function Eo(e){var t=e.stateNode;t.pendingContext?Ri(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ri(0,t.context,!1),Wa(e,t.containerInfo)}function Co(e,t,n,r,i){return ua(),da(i),t.flags|=256,_o(e,t,n,r),t.child}var To,Po,Io,Ro,ko={dehydrated:null,treeContext:null,retryLane:0};function Do(e){return{baseLanes:e,cachePool:null,transitions:null}}function Lo(e,t,n){var r,i=t.pendingProps,s=Ka.current,o=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&s)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Si(Ka,1&s),null===e)return sa(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=i.children,e=i.fallback,o?(i=t.mode,o=t.child,l={mode:"hidden",children:l},1&i||null===o?o=Dc(l,i,0,null):(o.childLanes=0,o.pendingProps=l),e=kc(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Do(n),t.memoizedState=ko,e):No(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,o){if(n)return 256&t.flags?(t.flags&=-257,Oo(e,t,o,r=so(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=Dc({mode:"visible",children:r.children},i,0,null),(s=kc(s,i,o,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,1&t.mode&&_a(t,e.child,null,o),t.child.memoizedState=Do(o),t.memoizedState=ko,s);if(!(1&t.mode))return Oo(e,t,o,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Oo(e,t,o,r=so(s=Error(a(419)),r,void 0))}if(l=!!(o&e.childLanes),go||l){if(null!==(r=El)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=i&(r.suspendedLanes|o)?0:i)&&i!==s.retryLane&&(s.retryLane=i,Ra(e,i),Jl(r,e,i,-1))}return hc(),Oo(e,t,o,r=so(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ac.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ea=si(i.nextSibling),Ji=t,ta=!0,na=null,null!==e&&(Gi[ji++]=qi,Gi[ji++]=Xi,Gi[ji++]=Wi,qi=e.id,Xi=e.overflow,Wi=t),(t=No(t,r.children)).flags|=4096,t)}(e,t,l,i,r,s,n);if(o){o=i.fallback,l=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:i.children};return 1&l||t.child===s?(i=Ic(s,c)).subtreeFlags=14680064&s.subtreeFlags:((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null),null!==r?o=Ic(r,o):(o=kc(o,l,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,l=null===(l=e.child.memoizedState)?Do(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=ko,i}return e=(o=e.child).sibling,i=Ic(o,{mode:"visible",children:i.children}),!(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function No(e,t){return(t=Dc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Oo(e,t,n,r){return null!==r&&da(r),_a(t,e.child,null,n),(e=No(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Fo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ma(e.return,t,n)}function Uo(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Bo(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(_o(e,t,r.children,n),2&(r=Ka.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Fo(e,n,t);else if(19===e.tag)Fo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Si(Ka,r),1&t.mode)switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Za(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Uo(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Za(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Uo(t,!0,n,null,a);break;case"together":Uo(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function zo(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Dl|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Ic(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ic(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ho(e,t){if(!ta)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function $o(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Go(e,t,n){var r=t.pendingProps;switch(Qi(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $o(t),null;case 1:case 17:return Pi(t.type)&&Ii(),$o(t),null;case 3:return r=t.stateNode,qa(),wi(Ei),wi(Mi),Ja(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(la(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==na&&(rc(na),na=null))),Po(e,t),$o(t),null;case 5:Ya(t);var i=ja(Ga.current);if(n=t.type,null!==e&&null!=t.stateNode)Io(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return $o(t),null}if(e=ja(Ha.current),la(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[ci]=t,r[ui]=s,e=!!(1&t.mode),n){case"dialog":Or("cancel",r),Or("close",r);break;case"iframe":case"object":case"embed":Or("load",r);break;case"video":case"audio":for(i=0;i<kr.length;i++)Or(kr[i],r);break;case"source":Or("error",r);break;case"img":case"image":case"link":Or("error",r),Or("load",r);break;case"details":Or("toggle",r);break;case"input":K(r,s),Or("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Or("invalid",r);break;case"textarea":ie(r,s),Or("invalid",r)}for(var l in ye(n,s),i=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"==typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Yr(r.textContent,c,e),i=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Yr(r.textContent,c,e),i=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Or("scroll",r)}switch(n){case"input":W(r),J(r,s,!0);break;case"textarea":W(r),se(r);break;case"select":case"option":break;default:"function"==typeof s.onClick&&(r.onclick=Kr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[ci]=t,e[ui]=r,To(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(n,r),n){case"dialog":Or("cancel",e),Or("close",e),i=r;break;case"iframe":case"object":case"embed":Or("load",e),i=r;break;case"video":case"audio":for(i=0;i<kr.length;i++)Or(kr[i],e);i=r;break;case"source":Or("error",e),i=r;break;case"img":case"image":case"link":Or("error",e),Or("load",e),i=r;break;case"details":Or("toggle",e),i=r;break;case"input":K(e,r),i=Y(e,r),Or("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=F({},r,{value:void 0}),Or("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Or("invalid",e)}for(s in ye(n,i),c=i)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===s?"string"==typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"==typeof u&&he(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(o.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Or("scroll",e):null!=u&&v(e,s,u,l))}switch(n){case"input":W(e),J(e,r,!1);break;case"textarea":W(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+G(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Kr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return $o(t),null;case 6:if(e&&null!=t.stateNode)Ro(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166));if(n=ja(Ga.current),ja(Ha.current),la(t)){if(r=t.stateNode,n=t.memoizedProps,r[ci]=t,(s=r.nodeValue!==n)&&null!==(e=Ji))switch(e.tag){case 3:Yr(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Yr(r.nodeValue,n,!!(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ci]=t,t.stateNode=r}return $o(t),null;case 13:if(wi(Ka),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ta&&null!==ea&&1&t.mode&&!(128&t.flags))ca(),ua(),t.flags|=98560,s=!1;else if(s=la(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(a(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(a(317));s[ci]=t}else ua(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;$o(t),s=!1}else null!==na&&(rc(na),na=null),s=!0;if(!s)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!=(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&Ka.current?0===Rl&&(Rl=3):hc())),null!==t.updateQueue&&(t.flags|=4),$o(t),null);case 4:return qa(),Po(e,t),null===e&&Br(t.stateNode.containerInfo),$o(t),null;case 10:return Aa(t.type._context),$o(t),null;case 19:if(wi(Ka),null===(s=t.memoizedState))return $o(t),null;if(r=!!(128&t.flags),null===(l=s.rendering))if(r)Ho(s,!1);else{if(0!==Rl||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=Za(e))){for(t.flags|=128,Ho(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Si(Ka,1&Ka.current|2),t.child}e=e.sibling}null!==s.tail&&Ze()>Bl&&(t.flags|=128,r=!0,Ho(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Za(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ho(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!ta)return $o(t),null}else 2*Ze()-s.renderingStartTime>Bl&&1073741824!==n&&(t.flags|=128,r=!0,Ho(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ze(),t.sibling=null,n=Ka.current,Si(Ka,r?1&n|2:1&n),t):($o(t),null);case 22:case 23:return lc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Pl)&&($o(t),6&t.subtreeFlags&&(t.flags|=8192)):$o(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function jo(e,t){switch(Qi(t),t.tag){case 1:return Pi(t.type)&&Ii(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return qa(),wi(Ei),wi(Mi),Ja(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Ya(t),null;case 13:if(wi(Ka),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ua()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return wi(Ka),null;case 4:return qa(),null;case 10:return Aa(t.type._context),null;case 22:case 23:return lc(),null;default:return null}}To=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(){},Io=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,ja(Ha.current);var a,s=null;switch(n){case"input":i=Y(e,i),r=Y(e,r),s=[];break;case"select":i=F({},i,{value:void 0}),r=F({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Kr)}for(u in ye(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Or("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Ro=function(e,t,n,r){n!==r&&(t.flags|=4)};var Wo=!1,qo=!1,Xo="function"==typeof WeakSet?WeakSet:Set,Yo=null;function Ko(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){xc(e,t,n)}else n.current=null}function Zo(e,t,n){try{n()}catch(n){xc(e,t,n)}}var Qo=!1;function Jo(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&Zo(t,n,a)}i=i.next}while(i!==r)}}function el(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function tl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function nl(e){var t=e.alternate;null!==t&&(e.alternate=null,nl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[ci],delete t[ui],delete t[hi],delete t[fi],delete t[pi]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function rl(e){return 5===e.tag||3===e.tag||4===e.tag}function il(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||rl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function al(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Kr));else if(4!==r&&null!==(e=e.child))for(al(e,t,n),e=e.sibling;null!==e;)al(e,t,n),e=e.sibling}function sl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(sl(e,t,n),e=e.sibling;null!==e;)sl(e,t,n),e=e.sibling}var ol=null,ll=!1;function cl(e,t,n){for(n=n.child;null!==n;)ul(e,t,n),n=n.sibling}function ul(e,t,n){if(at&&"function"==typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(e){}switch(n.tag){case 5:qo||Ko(n,t);case 6:var r=ol,i=ll;ol=null,cl(e,t,n),ll=i,null!==(ol=r)&&(ll?(e=ol,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ol.removeChild(n.stateNode));break;case 18:null!==ol&&(ll?(e=ol,n=n.stateNode,8===e.nodeType?ai(e.parentNode,n):1===e.nodeType&&ai(e,n),Ht(e)):ai(ol,n.stateNode));break;case 4:r=ol,i=ll,ol=n.stateNode.containerInfo,ll=!0,cl(e,t,n),ol=r,ll=i;break;case 0:case 11:case 14:case 15:if(!qo&&null!==(r=n.updateQueue)&&null!==(r=r.lastEffect)){i=r=r.next;do{var a=i,s=a.destroy;a=a.tag,void 0!==s&&(2&a||4&a)&&Zo(n,t,s),i=i.next}while(i!==r)}cl(e,t,n);break;case 1:if(!qo&&(Ko(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){xc(n,t,e)}cl(e,t,n);break;case 21:cl(e,t,n);break;case 22:1&n.mode?(qo=(r=qo)||null!==n.memoizedState,cl(e,t,n),qo=r):cl(e,t,n);break;default:cl(e,t,n)}}function dl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xo),t.forEach((function(t){var r=Mc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function hl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ol=l.stateNode,ll=!1;break e;case 3:case 4:ol=l.stateNode.containerInfo,ll=!0;break e}l=l.return}if(null===ol)throw Error(a(160));ul(s,o,i),ol=null,ll=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(e){xc(i,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)fl(t,e),t=t.sibling}function fl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(hl(t,e),pl(e),4&r){try{Jo(3,e,e.return),el(3,e)}catch(t){xc(e,e.return,t)}try{Jo(5,e,e.return)}catch(t){xc(e,e.return,t)}}break;case 1:hl(t,e),pl(e),512&r&&null!==n&&Ko(n,n.return);break;case 5:if(hl(t,e),pl(e),512&r&&null!==n&&Ko(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(t){xc(e,e.return,t)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,o=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&Z(i,s),ve(l,o);var u=ve(l,s);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];"style"===d?ge(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):v(i,d,h,u)}switch(l){case"input":Q(i,s);break;case"textarea":ae(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;null!=p?ne(i,!!s.multiple,p,!1):f!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[ui]=s}catch(t){xc(e,e.return,t)}}break;case 6:if(hl(t,e),pl(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(t){xc(e,e.return,t)}}break;case 3:if(hl(t,e),pl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ht(t.containerInfo)}catch(t){xc(e,e.return,t)}break;case 4:default:hl(t,e),pl(e);break;case 13:hl(t,e),pl(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Ul=Ze())),4&r&&dl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(qo=(u=qo)||d,hl(t,e),qo=u):hl(t,e),pl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Yo=e,d=e.child;null!==d;){for(h=Yo=d;null!==Yo;){switch(p=(f=Yo).child,f.tag){case 0:case 11:case 14:case 15:Jo(4,f,f.return);break;case 1:Ko(f,f.return);var m=f.stateNode;if("function"==typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(e){xc(r,n,e)}}break;case 5:Ko(f,f.return);break;case 22:if(null!==f.memoizedState){yl(h);continue}}null!==p?(p.return=f,Yo=p):yl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"==typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=h.stateNode,o=null!=(c=h.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",o))}catch(t){xc(e,e.return,t)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(t){xc(e,e.return,t)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:hl(t,e),pl(e),4&r&&dl(e);case 21:}}function pl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(rl(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),sl(e,il(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;al(e,il(e),s);break;default:throw Error(a(161))}}catch(t){xc(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function ml(e,t,n){Yo=e,gl(e,t,n)}function gl(e,t,n){for(var r=!!(1&e.mode);null!==Yo;){var i=Yo,a=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Wo;if(!s){var o=i.alternate,l=null!==o&&null!==o.memoizedState||qo;o=Wo;var c=qo;if(Wo=s,(qo=l)&&!c)for(Yo=i;null!==Yo;)l=(s=Yo).child,22===s.tag&&null!==s.memoizedState?vl(i):null!==l?(l.return=s,Yo=l):vl(i);for(;null!==a;)Yo=a,gl(a,t,n),a=a.sibling;Yo=i,Wo=o,qo=c}_l(e)}else 8772&i.subtreeFlags&&null!==a?(a.return=i,Yo=a):_l(e)}}function _l(e){for(;null!==Yo;){var t=Yo;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:qo||el(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!qo)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:Qs(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&za(t,s,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}za(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Ht(h)}}}break;default:throw Error(a(163))}qo||512&t.flags&&tl(t)}catch(e){xc(t,t.return,e)}}if(t===e){Yo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Yo=n;break}Yo=t.return}}function yl(e){for(;null!==Yo;){var t=Yo;if(t===e){Yo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Yo=n;break}Yo=t.return}}function vl(e){for(;null!==Yo;){var t=Yo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{el(4,t)}catch(e){xc(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(e){xc(t,i,e)}}var a=t.return;try{tl(t)}catch(e){xc(t,a,e)}break;case 5:var s=t.return;try{tl(t)}catch(e){xc(t,s,e)}}}catch(e){xc(t,t.return,e)}if(t===e){Yo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Yo=o;break}Yo=t.return}}var bl,xl=Math.ceil,wl=b.ReactCurrentDispatcher,Sl=b.ReactCurrentOwner,Al=b.ReactCurrentBatchConfig,Ml=0,El=null,Cl=null,Tl=0,Pl=0,Il=xi(0),Rl=0,kl=null,Dl=0,Ll=0,Nl=0,Ol=null,Fl=null,Ul=0,Bl=1/0,zl=null,Vl=!1,Hl=null,$l=null,Gl=!1,jl=null,Wl=0,ql=0,Xl=null,Yl=-1,Kl=0;function Zl(){return 6&Ml?Ze():-1!==Yl?Yl:Yl=Ze()}function Ql(e){return 1&e.mode?2&Ml&&0!==Tl?Tl&-Tl:null!==ha.transition?(0===Kl&&(Kl=mt()),Kl):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Kt(e.type):1}function Jl(e,t,n,r){if(50<ql)throw ql=0,Xl=null,Error(a(185));_t(e,n,r),2&Ml&&e===El||(e===El&&(!(2&Ml)&&(Ll|=n),4===Rl&&ic(e,Tl)),ec(e,r),1===n&&0===Ml&&!(1&t.mode)&&(Bl=Ze()+500,Oi&&Bi()))}function ec(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-st(a),o=1<<s,l=i[s];-1===l?o&n&&!(o&r)||(i[s]=ft(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var r=ht(e,e===El?Tl:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Oi=!0,Ui(e)}(ac.bind(null,e)):Ui(ac.bind(null,e)),ri((function(){!(6&Ml)&&Bi()})),n=null;else{switch(bt(r)){case 1:n=Je;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ec(n,tc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function tc(e,t){if(Yl=-1,Kl=0,6&Ml)throw Error(a(327));var n=e.callbackNode;if(vc()&&e.callbackNode!==n)return null;var r=ht(e,e===El?Tl:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=fc(e,r);else{t=r;var i=Ml;Ml|=2;var s=dc();for(El===e&&Tl===t||(zl=null,Bl=Ze()+500,cc(e,t));;)try{mc();break}catch(t){uc(e,t)}Sa(),wl.current=s,Ml=i,null!==Cl?t=0:(El=null,Tl=0,t=Rl)}if(0!==t){if(2===t&&0!==(i=pt(e))&&(r=i,t=nc(e,i)),1===t)throw n=kl,cc(e,0),ic(e,r),ec(e,Ze()),n;if(6===t)ic(e,r);else{if(i=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!ir(a(),i))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)||(t=fc(e,r),2===t&&(s=pt(e),0!==s&&(r=s,t=nc(e,s))),1!==t)))throw n=kl,cc(e,0),ic(e,r),ec(e,Ze()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:yc(e,Fl,zl);break;case 3:if(ic(e,r),(130023424&r)===r&&10<(t=Ul+500-Ze())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){Zl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ei(yc.bind(null,e,Fl,zl),t);break}yc(e,Fl,zl);break;case 4:if(ic(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-st(r);s=1<<o,(o=t[o])>i&&(i=o),r&=~s}if(r=i,10<(r=(120>(r=Ze()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*xl(r/1960))-r)){e.timeoutHandle=ei(yc.bind(null,e,Fl,zl),r);break}yc(e,Fl,zl);break;default:throw Error(a(329))}}}return ec(e,Ze()),e.callbackNode===n?tc.bind(null,e):null}function nc(e,t){var n=Ol;return e.current.memoizedState.isDehydrated&&(cc(e,t).flags|=256),2!==(e=fc(e,t))&&(t=Fl,Fl=n,null!==t&&rc(t)),e}function rc(e){null===Fl?Fl=e:Fl.push.apply(Fl,e)}function ic(e,t){for(t&=~Nl,t&=~Ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function ac(e){if(6&Ml)throw Error(a(327));vc();var t=ht(e,0);if(!(1&t))return ec(e,Ze()),null;var n=fc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=nc(e,r))}if(1===n)throw n=kl,cc(e,0),ic(e,t),ec(e,Ze()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,yc(e,Fl,zl),ec(e,Ze()),null}function sc(e,t){var n=Ml;Ml|=1;try{return e(t)}finally{0===(Ml=n)&&(Bl=Ze()+500,Oi&&Bi())}}function oc(e){null!==jl&&0===jl.tag&&!(6&Ml)&&vc();var t=Ml;Ml|=1;var n=Al.transition,r=vt;try{if(Al.transition=null,vt=1,e)return e()}finally{vt=r,Al.transition=n,!(6&(Ml=t))&&Bi()}}function lc(){Pl=Il.current,wi(Il)}function cc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ti(n)),null!==Cl)for(n=Cl.return;null!==n;){var r=n;switch(Qi(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Ii();break;case 3:qa(),wi(Ei),wi(Mi),Ja();break;case 5:Ya(r);break;case 4:qa();break;case 13:case 19:wi(Ka);break;case 10:Aa(r.type._context);break;case 22:case 23:lc()}n=n.return}if(El=e,Cl=e=Ic(e.current,null),Tl=Pl=t,Rl=0,kl=null,Nl=Ll=Dl=0,Fl=Ol=null,null!==Ta){for(t=0;t<Ta.length;t++)if(null!==(r=(n=Ta[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var s=a.next;a.next=i,r.next=s}n.pending=r}Ta=null}return e}function uc(e,t){for(;;){var n=Cl;try{if(Sa(),es.current=Xs,ss){for(var r=rs.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ss=!1}if(ns=0,as=is=rs=null,os=!1,ls=0,Sl.current=null,null===n||null===n.return){Rl=1,kl=t,Cl=null;break}e:{var s=e,o=n.return,l=n,c=t;if(t=Tl,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,h=d.tag;if(!(1&d.mode||0!==h&&11!==h&&15!==h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=fo(o);if(null!==p){p.flags&=-257,po(p,o,l,0,t),1&p.mode&&ho(s,u,t),c=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(!(1&t)){ho(s,u,t),hc();break e}c=Error(a(426))}else if(ta&&1&l.mode){var _=fo(o);if(null!==_){!(65536&_.flags)&&(_.flags|=256),po(_,o,l,0,t),da(ao(c,l));break e}}s=c=ao(c,l),4!==Rl&&(Rl=2),null===Ol?Ol=[s]:Ol.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Ua(s,co(0,c,t));break e;case 1:l=c;var y=s.type,v=s.stateNode;if(!(128&s.flags||"function"!=typeof y.getDerivedStateFromError&&(null===v||"function"!=typeof v.componentDidCatch||null!==$l&&$l.has(v)))){s.flags|=65536,t&=-t,s.lanes|=t,Ua(s,uo(s,l,t));break e}}s=s.return}while(null!==s)}_c(n)}catch(e){t=e,Cl===n&&null!==n&&(Cl=n=n.return);continue}break}}function dc(){var e=wl.current;return wl.current=Xs,null===e?Xs:e}function hc(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===El||!(268435455&Dl)&&!(268435455&Ll)||ic(El,Tl)}function fc(e,t){var n=Ml;Ml|=2;var r=dc();for(El===e&&Tl===t||(zl=null,cc(e,t));;)try{pc();break}catch(t){uc(e,t)}if(Sa(),Ml=n,wl.current=r,null!==Cl)throw Error(a(261));return El=null,Tl=0,Rl}function pc(){for(;null!==Cl;)gc(Cl)}function mc(){for(;null!==Cl&&!Ye();)gc(Cl)}function gc(e){var t=bl(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?_c(e):Cl=t,Sl.current=null}function _c(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=jo(n,t)))return n.flags&=32767,void(Cl=n);if(null===e)return Rl=6,void(Cl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Go(n,t,Pl)))return void(Cl=n);if(null!==(t=t.sibling))return void(Cl=t);Cl=t=e}while(null!==t);0===Rl&&(Rl=5)}function yc(e,t,n){var r=vt,i=Al.transition;try{Al.transition=null,vt=1,function(e,t,n,r){do{vc()}while(null!==jl);if(6&Ml)throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,s),e===El&&(Cl=El=null,Tl=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Gl||(Gl=!0,Ec(tt,(function(){return vc(),null}))),s=!!(15990&n.flags),15990&n.subtreeFlags||s){s=Al.transition,Al.transition=null;var o=vt;vt=1;var l=Ml;Ml|=4,Sl.current=null,function(e,t){if(Zr=Gt,ur(e=cr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(e){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==i&&3!==h.nodeType||(l=o+i),h!==s||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===i&&(l=o),f===s&&++d===r&&(c=o),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Qr={focusedElem:e,selectionRange:n},Gt=!1,Yo=t;null!==Yo;)if(e=(t=Yo).child,1028&t.subtreeFlags&&null!==e)e.return=t,Yo=e;else for(;null!==Yo;){t=Yo;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,_=m.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:Qs(t.type,g),_);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(e){xc(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Yo=e;break}Yo=t.return}m=Qo,Qo=!1}(e,n),fl(n,e),dr(Qr),Gt=!!Zr,Qr=Zr=null,e.current=n,ml(n,e,i),Ke(),Ml=l,vt=o,Al.transition=s}else e.current=n;if(Gl&&(Gl=!1,jl=e,Wl=i),0===(s=e.pendingLanes)&&($l=null),function(e){if(at&&"function"==typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,!(128&~e.current.flags))}catch(e){}}(n.stateNode),ec(e,Ze()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((i=t[n]).value,{componentStack:i.stack,digest:i.digest});if(Vl)throw Vl=!1,e=Hl,Hl=null,e;!!(1&Wl)&&0!==e.tag&&vc(),1&(s=e.pendingLanes)?e===Xl?ql++:(ql=0,Xl=e):ql=0,Bi()}(e,t,n,r)}finally{Al.transition=i,vt=r}return null}function vc(){if(null!==jl){var e=bt(Wl),t=Al.transition,n=vt;try{if(Al.transition=null,vt=16>e?16:e,null===jl)var r=!1;else{if(e=jl,jl=null,Wl=0,6&Ml)throw Error(a(331));var i=Ml;for(Ml|=4,Yo=e.current;null!==Yo;){var s=Yo,o=s.child;if(16&Yo.flags){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Yo=u;null!==Yo;){var d=Yo;switch(d.tag){case 0:case 11:case 15:Jo(8,d,s)}var h=d.child;if(null!==h)h.return=d,Yo=h;else for(;null!==Yo;){var f=(d=Yo).sibling,p=d.return;if(nl(d),d===u){Yo=null;break}if(null!==f){f.return=p,Yo=f;break}Yo=p}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}Yo=s}}if(2064&s.subtreeFlags&&null!==o)o.return=s,Yo=o;else e:for(;null!==Yo;){if(2048&(s=Yo).flags)switch(s.tag){case 0:case 11:case 15:Jo(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Yo=y;break e}Yo=s.return}}var v=e.current;for(Yo=v;null!==Yo;){var b=(o=Yo).child;if(2064&o.subtreeFlags&&null!==b)b.return=o,Yo=b;else e:for(o=v;null!==Yo;){if(2048&(l=Yo).flags)try{switch(l.tag){case 0:case 11:case 15:el(9,l)}}catch(e){xc(l,l.return,e)}if(l===o){Yo=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Yo=x;break e}Yo=l.return}}if(Ml=i,Bi(),at&&"function"==typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(e){}r=!0}return r}finally{vt=n,Al.transition=t}}return!1}function bc(e,t,n){e=Oa(e,t=co(0,t=ao(n,t),1),1),t=Zl(),null!==e&&(_t(e,1,t),ec(e,t))}function xc(e,t,n){if(3===e.tag)bc(e,e,n);else for(;null!==t;){if(3===t.tag){bc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===$l||!$l.has(r))){t=Oa(t,e=uo(t,e=ao(n,e),1),1),e=Zl(),null!==t&&(_t(t,1,e),ec(t,e));break}}t=t.return}}function wc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Zl(),e.pingedLanes|=e.suspendedLanes&n,El===e&&(Tl&n)===n&&(4===Rl||3===Rl&&(130023424&Tl)===Tl&&500>Ze()-Ul?cc(e,0):Nl|=n),ec(e,t)}function Sc(e,t){0===t&&(1&e.mode?(t=ut,!(130023424&(ut<<=1))&&(ut=4194304)):t=1);var n=Zl();null!==(e=Ra(e,t))&&(_t(e,t,n),ec(e,n))}function Ac(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Sc(e,n)}function Mc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Sc(e,n)}function Ec(e,t){return qe(e,t)}function Cc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tc(e,t,n,r){return new Cc(e,t,n,r)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ic(e,t){var n=e.alternate;return null===n?((n=Tc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rc(e,t,n,r,i,s){var o=2;if(r=e,"function"==typeof e)Pc(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case S:return kc(n.children,i,s,t);case A:o=8,i|=8;break;case M:return(e=Tc(12,n,t,2|i)).elementType=M,e.lanes=s,e;case P:return(e=Tc(13,n,t,i)).elementType=P,e.lanes=s,e;case I:return(e=Tc(19,n,t,i)).elementType=I,e.lanes=s,e;case D:return Dc(n,i,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case E:o=10;break e;case C:o=9;break e;case T:o=11;break e;case R:o=14;break e;case k:o=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Tc(o,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function kc(e,t,n,r){return(e=Tc(7,e,r,t)).lanes=n,e}function Dc(e,t,n,r){return(e=Tc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Lc(e,t,n){return(e=Tc(6,e,null,t)).lanes=n,e}function Nc(e,t,n){return(t=Tc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Oc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Fc(e,t,n,r,i,a,s,o,l){return e=new Oc(e,t,n,o,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Tc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Da(a),e}function Uc(e){if(!e)return Ai;e:{if(He(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Pi(n))return ki(e,n,t)}return t}function Bc(e,t,n,r,i,a,s,o,l){return(e=Fc(n,r,!0,e,0,a,0,o,l)).context=Uc(null),n=e.current,(a=Na(r=Zl(),i=Ql(n))).callback=null!=t?t:null,Oa(n,a,i),e.current.lanes=i,_t(e,i,r),ec(e,r),e}function zc(e,t,n,r){var i=t.current,a=Zl(),s=Ql(i);return n=Uc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Na(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Oa(i,t,s))&&(Jl(e,i,s,a),Fa(e,i,s)),s}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function $c(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}bl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ei.current)go=!0;else{if(!(e.lanes&n||128&t.flags))return go=!1,function(e,t,n){switch(t.tag){case 3:Eo(t),ua();break;case 5:Xa(t);break;case 1:Pi(t.type)&&Di(t);break;case 4:Wa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Si(va,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Si(Ka,1&Ka.current),t.flags|=128,null):n&t.child.childLanes?Lo(e,t,n):(Si(Ka,1&Ka.current),null!==(e=Vo(e,t,n))?e.sibling:null);Si(Ka,1&Ka.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return Bo(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Si(Ka,Ka.current),r)break;return null;case 22:case 23:return t.lanes=0,xo(e,t,n)}return Vo(e,t,n)}(e,t,n);go=!!(131072&e.flags)}else go=!1,ta&&1048576&t.flags&&Ki(t,$i,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;zo(e,t),e=t.pendingProps;var i=Ti(t,Mi.current);Ea(t,n),i=hs(null,t,r,e,i,n);var s=fs();return t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(r)?(s=!0,Di(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Da(t),i.updater=eo,t.stateNode=i,i._reactInternals=t,io(t,r,e,n),t=Mo(null,t,r,!0,s,n)):(t.tag=0,ta&&s&&Zi(t),_o(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(zo(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"==typeof e)return Pc(e)?1:0;if(null!=e){if((e=e.$$typeof)===T)return 11;if(e===R)return 14}return 2}(r),e=Qs(r,e),i){case 0:t=So(null,t,r,e,n);break e;case 1:t=Ao(null,t,r,e,n);break e;case 11:t=yo(null,t,r,e,n);break e;case 14:t=vo(null,t,r,Qs(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,So(e,t,r,i=t.elementType===r?i:Qs(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ao(e,t,r,i=t.elementType===r?i:Qs(r,i),n);case 3:e:{if(Eo(t),null===e)throw Error(a(387));r=t.pendingProps,i=(s=t.memoizedState).element,La(e,t),Ba(t,r,null,n);var o=t.memoizedState;if(r=o.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Co(e,t,r,n,i=ao(Error(a(423)),t));break e}if(r!==i){t=Co(e,t,r,n,i=ao(Error(a(424)),t));break e}for(ea=si(t.stateNode.containerInfo.firstChild),Ji=t,ta=!0,na=null,n=ya(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ua(),r===i){t=Vo(e,t,n);break e}_o(e,t,r,n)}t=t.child}return t;case 5:return Xa(t),null===e&&sa(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,o=i.children,Jr(r,i)?o=null:null!==s&&Jr(r,s)&&(t.flags|=32),wo(e,t),_o(e,t,o,n),t.child;case 6:return null===e&&sa(t),null;case 13:return Lo(e,t,n);case 4:return Wa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=_a(t,null,r,n):_o(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,yo(e,t,r,i=t.elementType===r?i:Qs(r,i),n);case 7:return _o(e,t,t.pendingProps,n),t.child;case 8:case 12:return _o(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value,Si(va,r._currentValue),r._currentValue=o,null!==s)if(ir(s.value,o)){if(s.children===i.children&&!Ei.current){t=Vo(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){o=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=Na(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ma(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(o=s.return))throw Error(a(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ma(o,n,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}_o(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Ea(t,n),r=r(i=Ca(i)),t.flags|=1,_o(e,t,r,n),t.child;case 14:return i=Qs(r=t.type,t.pendingProps),vo(e,t,r,i=Qs(r.type,i),n);case 15:return bo(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Qs(r,i),zo(e,t),t.tag=1,Pi(r)?(e=!0,Di(t)):e=!1,Ea(t,n),no(t,r,i),io(t,r,i,n),Mo(null,t,r,!0,e,n);case 19:return Bo(e,t,n);case 22:return xo(e,t,n)}throw Error(a(156,t.tag))};var Gc="function"==typeof reportError?reportError:function(e){console.error(e)};function jc(e){this._internalRoot=e}function Wc(e){this._internalRoot=e}function qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Yc(){}function Kc(e,t,n,r,i){var a=n._reactRootContainer;if(a){var s=a;if("function"==typeof i){var o=i;i=function(){var e=Vc(s);o.call(e)}}zc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"==typeof r){var a=r;r=function(){var e=Vc(s);a.call(e)}}var s=Bc(t,r,e,0,null,!1,0,"",Yc);return e._reactRootContainer=s,e[di]=s.current,Br(8===e.nodeType?e.parentNode:e),oc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var o=r;r=function(){var e=Vc(l);o.call(e)}}var l=Fc(e,0,!1,null,0,!1,0,"",Yc);return e._reactRootContainer=l,e[di]=l.current,Br(8===e.nodeType?e.parentNode:e),oc((function(){zc(t,l,n,r)})),l}(n,t,e,i,r);return Vc(s)}Wc.prototype.render=jc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));zc(e,t,null,null)},Wc.prototype.unmount=jc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;oc((function(){zc(null,e,null,null)})),t[di]=null}},Wc.prototype.unstable_scheduleHydration=function(e){if(e){var t=At();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ft(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),ec(t,Ze()),!(6&Ml)&&(Bl=Ze()+500,Bi()))}break;case 13:oc((function(){var t=Ra(e,1);if(null!==t){var n=Zl();Jl(t,e,1,n)}})),$c(e,1)}},wt=function(e){if(13===e.tag){var t=Ra(e,134217728);null!==t&&Jl(t,e,134217728,Zl()),$c(e,134217728)}},St=function(e){if(13===e.tag){var t=Ql(e),n=Ra(e,t);null!==n&&Jl(n,e,t,Zl()),$c(e,t)}},At=function(){return vt},Mt=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},we=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=yi(r);if(!i)throw Error(a(90));q(r),Q(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=sc,Pe=oc;var Zc={usingClientEntryPoint:!1,Events:[gi,_i,yi,Ee,Ce,sc]},Qc={findFiberByHostInstance:mi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Jc={bundleType:Qc.bundleType,version:Qc.version,rendererPackageName:Qc.rendererPackageName,rendererConfig:Qc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=je(e))?null:e.stateNode},findFiberByHostInstance:Qc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var eu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!eu.isDisabled&&eu.supportsFiber)try{it=eu.inject(Jc),at=eu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!qc(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!qc(e))throw Error(a(299));var n=!1,r="",i=Gc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Fc(e,1,!1,null,0,n,0,r,i),e[di]=t.current,Br(8===e.nodeType?e.parentNode:e),new jc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return null===(e=je(t))?null:e.stateNode},t.flushSync=function(e){return oc(e)},t.hydrate=function(e,t,n){if(!Xc(t))throw Error(a(200));return Kc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!qc(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",o=Gc;if(null!=n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Bc(t,null,e,1,null!=n?n:null,i,0,s,o),e[di]=t.current,Br(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Wc(t)},t.render=function(e,t,n){if(!Xc(t))throw Error(a(200));return Kc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(a(40));return!!e._reactRootContainer&&(oc((function(){Kc(null,null,e,!1,(function(){e._reactRootContainer=null,e[di]=null}))})),!0)},t.unstable_batchedUpdates=sc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Xc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Kc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},338:(e,t,n)=>{"use strict";var r=n(961);t.H=r.createRoot,r.hydrateRoot},961:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(551)},287:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator,p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=_.prototype;var b=v.prototype=new y;b.constructor=v,m(b,_.prototype),b.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function M(e,t,r){var i,a={},s=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,i)&&!A.hasOwnProperty(i)&&(a[i]=t[i]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===a[i]&&(a[i]=l[i]);return{$$typeof:n,type:e,key:s,ref:o,props:a,_owner:S.current}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function T(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,i,a,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===a?"."+T(l,0):a,x(s)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),P(s,t,i,"",(function(e){return e}))):null!=s&&(E(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+e)),t.push(s)),1;if(l=0,a=""===a?".":a+":",x(e))for(var c=0;c<e.length;c++){var u=a+T(o=e[c],c);l+=P(o,t,i,u,s)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=P(o=o.value,t,i,u=a+T(o,c++),s);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,n){if(null==e)return e;var r=[],i=0;return P(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var k={current:null},D={transition:null},L={ReactCurrentDispatcher:k,ReactCurrentBatchConfig:D,ReactCurrentOwner:S};function N(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:I,forEach:function(e,t,n){I(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=i,t.Profiler=s,t.PureComponent=v,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.act=N,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),a=e.key,s=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,o=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!A.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:a,ref:s,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=M,t.createFactory=function(e){var t=M.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=N,t.useCallback=function(e,t){return k.current.useCallback(e,t)},t.useContext=function(e){return k.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return k.current.useDeferredValue(e)},t.useEffect=function(e,t){return k.current.useEffect(e,t)},t.useId=function(){return k.current.useId()},t.useImperativeHandle=function(e,t,n){return k.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return k.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return k.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return k.current.useMemo(e,t)},t.useReducer=function(e,t,n){return k.current.useReducer(e,t,n)},t.useRef=function(e){return k.current.useRef(e)},t.useState=function(e){return k.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return k.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return k.current.useTransition()},t.version="18.3.1"},540:(e,t,n)=>{"use strict";e.exports=n(287)},463:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>a(l,n))c<i&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<i&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,m=!1,g=!1,_="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(g=!1,b(e),!m)if(null!==r(c))m=!0,D(w);else{var t=r(u);null!==t&&L(x,t.startTime-e)}}function w(e,n){m=!1,g&&(g=!1,y(E),E=-1),p=!0;var a=f;try{for(b(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!P());){var s=h.callback;if("function"==typeof s){h.callback=null,f=h.priorityLevel;var o=s(h.expirationTime<=n);n=t.unstable_now(),"function"==typeof o?h.callback=o:h===r(c)&&i(c),b(n)}else i(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&L(x,d.startTime-n),l=!1}return l}finally{h=null,f=a,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,A=!1,M=null,E=-1,C=5,T=-1;function P(){return!(t.unstable_now()-T<C)}function I(){if(null!==M){var e=t.unstable_now();T=e;var n=!0;try{n=M(!0,e)}finally{n?S():(A=!1,M=null)}}else A=!1}if("function"==typeof v)S=function(){v(I)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,k=R.port2;R.port1.onmessage=I,S=function(){k.postMessage(null)}}else S=function(){_(I,0)};function D(e){M=e,A||(A=!0,S())}function L(e,n){E=_((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,a){var s=t.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?s+a:s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(g?(y(E),E=-1):g=!0,L(x,a-s))):(e.sortIndex=o,n(c,e),m||p||(m=!0,D(w))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},982:(e,t,n)=>{"use strict";e.exports=n(463)},955:function(e,t,n){var r;e=n.nmd(e),function(){var n,i,a,s,o,l,c,u,d,h,f,p,m,g,_,y,v,b,x,w,S,A,M,E,C,T,P,I,R,k,D,L,N,O,F,U,B,z,V,H,$,G,j,W,q,X,Y,K,Z,Q,J,ee,te,ne,re,ie,ae,se,oe,le,ce,ue,de,he,fe,pe,me,ge,_e,ye,ve,be,xe,we,Se,Ae,Me,Ee,Ce,Te,Pe=[].slice;Ae=function(){var e,t,n,r,i;for(e={},r=0,t=(i="Boolean Number String Function Array Date RegExp Undefined Null".split(" ")).length;r<t;r++)n=i[r],e["[object "+n+"]"]=n.toLowerCase();return function(t){var n;return n=Object.prototype.toString.call(t),e[n]||"object"}}(),Y=function(e,t,n){return null==t&&(t=0),null==n&&(n=1),e<t&&(e=t),e>n&&(e=n),e},Me=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},S=function(e){var t,n;for(e._clipped=!1,e._unclipped=e.slice(0),t=n=0;n<3;t=++n)t<3?((e[t]<0||e[t]>255)&&(e._clipped=!0),e[t]<0&&(e[t]=0),e[t]>255&&(e[t]=255)):3===t&&(e[t]<0&&(e[t]=0),e[t]>1&&(e[t]=1));return e._clipped||delete e._unclipped,e},s=Math.PI,ve=Math.round,M=Math.cos,I=Math.floor,re=Math.pow,K=Math.log,xe=Math.sin,we=Math.sqrt,g=Math.atan2,J=Math.max,m=Math.abs,c=2*s,o=s/3,i=s/180,l=180/s,w=function(){return arguments[0]instanceof n?arguments[0]:function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,arguments,(function(){}))},w.default=w,p=[],null!==e&&null!=e.exports&&(e.exports=w),void 0===(r=function(){return w}.apply(t,[]))||(e.exports=r),w.version="1.4.1",f={},d=[],h=!1,n=function(){function e(){var e,t,n,r,i,a,s,o,l;for(a=this,t=[],o=0,r=arguments.length;o<r;o++)null!=(e=arguments[o])&&t.push(e);if(t.length>1&&(s=t[t.length-1]),null!=f[s])a._rgb=S(f[s](Me(t.slice(0,-1))));else{for(h||(d=d.sort((function(e,t){return t.p-e.p})),h=!0),l=0,i=d.length;l<i&&!(s=(n=d[l]).test.apply(n,t));l++);s&&(a._rgb=S(f[s].apply(f,t)))}null==a._rgb&&console.warn("unknown format: "+t),null==a._rgb&&(a._rgb=[0,0,0]),3===a._rgb.length&&a._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),w._input=f,w.brewer=b={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,t;for(e in t=[],b)t.push(b[e.toLowerCase()]=b[e])}(),w.colors=Ee={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},G=function(){var e,t,n,r,i,s,o;return r=(t=Me(arguments))[0],e=t[1],n=t[2],s=(r+16)/116,i=isNaN(e)?s:s+e/500,o=isNaN(n)?s:s-n/200,s=a.Yn*j(s),i=a.Xn*j(i),o=a.Zn*j(o),[Te(3.2404542*i-1.5371385*s-.4985314*o),Te(-.969266*i+1.8760108*s+.041556*o),n=Te(.0556434*i-.2040259*s+1.0572252*o),t.length>3?t[3]:1]},Te=function(e){return 255*(e<=.00304?12.92*e:1.055*re(e,1/2.4)-.055)},j=function(e){return e>a.t1?e*e*e:a.t2*(e-a.t0)},a={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},de=function(){var e,t,n,r,i,a,s;return n=(r=Me(arguments))[0],t=r[1],e=r[2],a=(i=ge(n,t,e))[0],[116*(s=i[1])-16,500*(a-s),200*(s-i[2])]},_e=function(e){return(e/=255)<=.04045?e/12.92:re((e+.055)/1.055,2.4)},Ce=function(e){return e>a.t3?re(e,1/3):e/a.t2+a.t0},ge=function(){var e,t,n,r;return n=(r=Me(arguments))[0],t=r[1],e=r[2],n=_e(n),t=_e(t),e=_e(e),[Ce((.4124564*n+.3575761*t+.1804375*e)/a.Xn),Ce((.2126729*n+.7151522*t+.072175*e)/a.Yn),Ce((.0193339*n+.119192*t+.9503041*e)/a.Zn)]},w.lab=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["lab"]),(function(){}))},f.lab=G,n.prototype.lab=function(){return de(this._rgb)},_=function(e){var t,n,r,i,a,s,o,l,c,u,d;return 2===(e=function(){var t,n,r;for(r=[],n=0,t=e.length;n<t;n++)i=e[n],r.push(w(i));return r}()).length?(c=function(){var t,n,r;for(r=[],n=0,t=e.length;n<t;n++)i=e[n],r.push(i.lab());return r}(),a=c[0],s=c[1],t=function(e){var t,n;return n=function(){var n,r;for(r=[],t=n=0;n<=2;t=++n)r.push(a[t]+e*(s[t]-a[t]));return r}(),w.lab.apply(w,n)}):3===e.length?(u=function(){var t,n,r;for(r=[],n=0,t=e.length;n<t;n++)i=e[n],r.push(i.lab());return r}(),a=u[0],s=u[1],o=u[2],t=function(e){var t,n;return n=function(){var n,r;for(r=[],t=n=0;n<=2;t=++n)r.push((1-e)*(1-e)*a[t]+2*(1-e)*e*s[t]+e*e*o[t]);return r}(),w.lab.apply(w,n)}):4===e.length?(d=function(){var t,n,r;for(r=[],n=0,t=e.length;n<t;n++)i=e[n],r.push(i.lab());return r}(),a=d[0],s=d[1],o=d[2],l=d[3],t=function(e){var t,n;return n=function(){var n,r;for(r=[],t=n=0;n<=2;t=++n)r.push((1-e)*(1-e)*(1-e)*a[t]+3*(1-e)*(1-e)*e*s[t]+3*(1-e)*e*e*o[t]+e*e*e*l[t]);return r}(),w.lab.apply(w,n)}):5===e.length&&(n=_(e.slice(0,3)),r=_(e.slice(2,5)),t=function(e){return e<.5?n(2*e):r(2*(e-.5))}),t},w.bezier=function(e){var t;return(t=_(e)).scale=function(){return w.scale(t)},t},w.cubehelix=function(e,t,n,r,i){var a,s,o;return null==e&&(e=300),null==t&&(t=-1.5),null==n&&(n=1),null==r&&(r=1),null==i&&(i=[0,1]),a=0,"array"===Ae(i)?s=i[1]-i[0]:(s=0,i=[i,i]),(o=function(o){var l,u,d,h,f;return l=c*((e+120)/360+t*o),h=re(i[0]+s*o,r),u=(0!==a?n[0]+o*a:n)*h*(1-h)/2,d=M(l),f=xe(l),w(S([255*(h+u*(-.14861*d+1.78277*f)),255*(h+u*(-.29227*d-.90649*f)),255*(h+u*(1.97294*d)),1]))}).start=function(t){return null==t?e:(e=t,o)},o.rotations=function(e){return null==e?t:(t=e,o)},o.gamma=function(e){return null==e?r:(r=e,o)},o.hue=function(e){return null==e?n:("array"===Ae(n=e)?0==(a=n[1]-n[0])&&(n=n[1]):a=0,o)},o.lightness=function(e){return null==e?i:("array"===Ae(e)?(i=e,s=e[1]-e[0]):(i=[e,e],s=0),o)},o.scale=function(){return w.scale(o)},o.hue(n),o},w.random=function(){var e,t;for(e="#",t=0;t<6;++t)e+="0123456789abcdef".charAt(I(16*Math.random()));return new n(e)},p=[],F=function(e,t,n,r){var i,a,s,o;for(null==n&&(n=.5),null==r&&(r="rgb"),"object"!==Ae(e)&&(e=w(e)),"object"!==Ae(t)&&(t=w(t)),s=0,a=p.length;s<a;s++)if(r===(i=p[s])[0]){o=i[1](e,t,n,r);break}if(null==o)throw"color mode "+r+" is not supported";return o.alpha(e.alpha()+n*(t.alpha()-e.alpha()))},w.interpolate=F,n.prototype.interpolate=function(e,t,n){return F(this,e,t,n)},w.mix=F,n.prototype.mix=n.prototype.interpolate,f.rgb=function(){var e,t,n,r;for(e in n=[],t=Me(arguments))r=t[e],n.push(r);return n},w.rgb=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["rgb"]),(function(){}))},n.prototype.rgb=function(e){return null==e&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},n.prototype.rgba=function(e){return null==e&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},d.push({p:3,test:function(e){var t;return t=Me(arguments),"array"===Ae(t)&&3===t.length||4===t.length&&"number"===Ae(t[3])&&t[3]>=0&&t[3]<=1?"rgb":void 0}}),f.lrgb=f.rgb,z=function(e,t,r,i){var a,s;return a=e._rgb,s=t._rgb,new n(we(re(a[0],2)*(1-r)+re(s[0],2)*r),we(re(a[1],2)*(1-r)+re(s[1],2)*r),we(re(a[2],2)*(1-r)+re(s[2],2)*r),i)},u=function(e){var t,r,i,a,s;for(t=1/e.length,s=[0,0,0,0],i=0,r=e.length;i<r;i++)a=e[i]._rgb,s[0]+=re(a[0],2)*t,s[1]+=re(a[1],2)*t,s[2]+=re(a[2],2)*t,s[3]+=a[3]*t;return s[0]=we(s[0]),s[1]=we(s[1]),s[2]=we(s[2]),s[3]>1&&(s[3]=1),new n(S(s))},p.push(["lrgb",z]),w.average=function(e,t){var n,r,i,a,o,l,c,d,h,f,p,m,_;if(null==t&&(t="rgb"),h=e.length,e=e.map((function(e){return w(e)})),c=e.splice(0,1)[0],"lrgb"===t)return u(e);for(d in a=[],o=0,l=0,m=c.get(t))m[d]=m[d]||0,a.push(isNaN(m[d])?0:1),"h"!==t.charAt(d)||isNaN(m[d])||(n=m[d]/180*s,o+=M(n),l+=xe(n));for(r=c.alpha(),p=0,f=e.length;p<f;p++)for(d in _=(i=e[p]).get(t),r+=i.alpha(),m)isNaN(_[d])||(a[d]+=1,"h"===t.charAt(d)?(n=_[d]/180*s,o+=M(n),l+=xe(n)):m[d]+=_[d]);for(d in m)if("h"===t.charAt(d)){for(n=g(l/a[d],o/a[d])/s*180;n<0;)n+=360;for(;n>=360;)n-=360;m[d]=n}else m[d]=m[d]/a[d];return w(m,t).alpha(r/h)},k=function(e){var t,n;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return 4!==e.length&&7!==e.length||(e=e.substr(1)),3===e.length&&(e=(e=e.split(""))[0]+e[0]+e[1]+e[1]+e[2]+e[2]),[(n=parseInt(e,16))>>16,n>>8&255,255&n,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return 9===e.length&&(e=e.substr(1)),[(n=parseInt(e,16))>>24&255,n>>16&255,n>>8&255,ve((255&n)/255*100)/100];if(null!=f.css&&(t=f.css(e)))return t;throw"unknown color: "+e},oe=function(e,t){var n,r,i,a,s,o;return null==t&&(t="auto"),s=e[0],i=e[1],r=e[2],n=e[3],"auto"===t&&(t=n<1?"rgba":"rgb"),s=Math.round(s),i=Math.round(i),r=Math.round(r),o=(o="000000"+(s<<16|i<<8|r).toString(16)).substr(o.length-6),a=(a="0"+ve(255*n).toString(16)).substr(a.length-2),"#"+function(){switch(t.toLowerCase()){case"rgba":return o+a;case"argb":return a+o;default:return o}}()},f.hex=function(e){return k(e)},w.hex=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["hex"]),(function(){}))},n.prototype.hex=function(e){return null==e&&(e="auto"),oe(this._rgb,e)},d.push({p:4,test:function(e){if(1===arguments.length&&"string"===Ae(e))return"hex"}}),N=function(){var e,t,n,r,i,a,s,o,l,c,u,d,h,f;if(i=(e=Me(arguments))[0],u=e[1],s=e[2],0===u)l=r=t=255*s;else{for(n=[0,0,0],d=2*s-(h=s<.5?s*(1+u):s+u-s*u),(f=[0,0,0])[0]=(i/=360)+1/3,f[1]=i,f[2]=i-1/3,a=o=0;o<=2;a=++o)f[a]<0&&(f[a]+=1),f[a]>1&&(f[a]-=1),6*f[a]<1?n[a]=d+6*(h-d)*f[a]:2*f[a]<1?n[a]=h:3*f[a]<2?n[a]=d+(h-d)*(2/3-f[a])*6:n[a]=d;l=(c=[ve(255*n[0]),ve(255*n[1]),ve(255*n[2])])[0],r=c[1],t=c[2]}return e.length>3?[l,r,t,e[3]]:[l,r,t]},ce=function(e,t,n){var r,i,a,s,o;return void 0!==e&&e.length>=3&&(e=(s=e)[0],t=s[1],n=s[2]),e/=255,t/=255,n/=255,a=Math.min(e,t,n),i=((J=Math.max(e,t,n))+a)/2,J===a?(o=0,r=Number.NaN):o=i<.5?(J-a)/(J+a):(J-a)/(2-J-a),e===J?r=(t-n)/(J-a):t===J?r=2+(n-e)/(J-a):n===J&&(r=4+(e-t)/(J-a)),(r*=60)<0&&(r+=360),[r,o,i]},w.hsl=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["hsl"]),(function(){}))},f.hsl=N,n.prototype.hsl=function(){return ce(this._rgb)},O=function(){var e,t,n,r,i,a,s,o,l,c,u,d,h,f,p,m,g,_;if(i=(e=Me(arguments))[0],m=e[1],_=e[2],_*=255,0===m)l=r=t=_;else switch(360===i&&(i=0),i>360&&(i-=360),i<0&&(i+=360),s=_*(1-m),o=_*(1-m*(n=(i/=60)-(a=I(i)))),g=_*(1-m*(1-n)),a){case 0:l=(c=[_,g,s])[0],r=c[1],t=c[2];break;case 1:l=(u=[o,_,s])[0],r=u[1],t=u[2];break;case 2:l=(d=[s,_,g])[0],r=d[1],t=d[2];break;case 3:l=(h=[s,o,_])[0],r=h[1],t=h[2];break;case 4:l=(f=[g,s,_])[0],r=f[1],t=f[2];break;case 5:l=(p=[_,s,o])[0],r=p[1],t=p[2]}return[l,r,t,e.length>3?e[3]:1]},ue=function(){var e,t,n,r,i,a,s,o,l;return a=(s=Me(arguments))[0],n=s[1],e=s[2],i=Math.min(a,n,e),t=(J=Math.max(a,n,e))-i,l=J/255,0===J?(r=Number.NaN,o=0):(o=t/J,a===J&&(r=(n-e)/t),n===J&&(r=2+(e-a)/t),e===J&&(r=4+(a-n)/t),(r*=60)<0&&(r+=360)),[r,o,l]},w.hsv=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["hsv"]),(function(){}))},f.hsv=O,n.prototype.hsv=function(){return ue(this._rgb)},te=function(e){return"number"===Ae(e)&&e>=0&&e<=16777215?[e>>16,e>>8&255,255&e,1]:(console.warn("unknown num color: "+e),[0,0,0,1])},pe=function(){var e;return((e=Me(arguments))[0]<<16)+(e[1]<<8)+e[2]},w.num=function(e){return new n(e,"num")},n.prototype.num=function(e){return null==e&&(e="rgb"),pe(this._rgb,e)},f.num=te,d.push({p:1,test:function(e){if(1===arguments.length&&"number"===Ae(e)&&e>=0&&e<=16777215)return"num"}}),R=function(){var e,t,n,r,i,a,s,o,l,c,u,d,h,f,p,m,g,_,y,v;if(o=(n=Me(arguments))[0],i=n[1],t=n[2],s=s/100*255,e=255*(i/=100),0===i)d=s=r=t;else switch(360===o&&(o=0),o>360&&(o-=360),o<0&&(o+=360),u=(c=t*(1-i))+e*(1-(a=(o/=60)-(l=I(o)))),y=c+e*a,v=c+e,l){case 0:d=(h=[v,y,c])[0],s=h[1],r=h[2];break;case 1:d=(f=[u,v,c])[0],s=f[1],r=f[2];break;case 2:d=(p=[c,v,y])[0],s=p[1],r=p[2];break;case 3:d=(m=[c,u,v])[0],s=m[1],r=m[2];break;case 4:d=(g=[y,c,v])[0],s=g[1],r=g[2];break;case 5:d=(_=[v,c,u])[0],s=_[1],r=_[2]}return[d,s,r,n.length>3?n[3]:1]},se=function(){var e,t,n,r,i,a,s,o,l;return o=(l=Me(arguments))[0],i=l[1],t=l[2],s=Math.min(o,i,t),n=100*(r=(J=Math.max(o,i,t))-s)/255,e=s/(255-r)*100,0===r?a=Number.NaN:(o===J&&(a=(i-t)/r),i===J&&(a=2+(t-o)/r),t===J&&(a=4+(o-i)/r),(a*=60)<0&&(a+=360)),[a,n,e]},w.hcg=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["hcg"]),(function(){}))},f.hcg=R,n.prototype.hcg=function(){return se(this._rgb)},E=function(e){var t,n,r,i,a,s,o,l;if(e=e.toLowerCase(),null!=w.colors&&w.colors[e])return k(w.colors[e]);if(a=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(o=a.slice(1,4),i=s=0;s<=2;i=++s)o[i]=+o[i];o[3]=1}else if(a=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(o=a.slice(1,5),i=l=0;l<=3;i=++l)o[i]=+o[i];else if(a=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(o=a.slice(1,4),i=t=0;t<=2;i=++t)o[i]=ve(2.55*o[i]);o[3]=1}else if(a=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(o=a.slice(1,5),i=n=0;n<=2;i=++n)o[i]=ve(2.55*o[i]);o[3]=+o[3]}else(a=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?((r=a.slice(1,4))[1]*=.01,r[2]*=.01,(o=N(r))[3]=1):(a=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&((r=a.slice(1,4))[1]*=.01,r[2]*=.01,(o=N(r))[3]=+a[4]);return o},ae=function(e){var t;return"rgb"==(t=e[3]<1?"rgba":"rgb")?t+"("+e.slice(0,3).map(ve).join(",")+")":"rgba"===t?t+"("+e.slice(0,3).map(ve).join(",")+","+e[3]+")":void 0},ye=function(e){return ve(100*e)/100},L=function(e,t){var n;return n=t<1?"hsla":"hsl",e[0]=ye(e[0]||0),e[1]=ye(100*e[1])+"%",e[2]=ye(100*e[2])+"%","hsla"===n&&(e[3]=t),n+"("+e.join(",")+")"},f.css=function(e){return E(e)},w.css=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["css"]),(function(){}))},n.prototype.css=function(e){return null==e&&(e="rgb"),"rgb"===e.slice(0,3)?ae(this._rgb):"hsl"===e.slice(0,3)?L(this.hsl(),this.alpha()):void 0},f.named=function(e){return k(Ee[e])},d.push({p:5,test:function(e){if(1===arguments.length&&null!=Ee[e])return"named"}}),n.prototype.name=function(e){var t,n;for(n in arguments.length&&(Ee[e]&&(this._rgb=k(Ee[e])),this._rgb[3]=1),t=this.hex("rgb"),Ee)if(t===Ee[n])return n;return t},W=function(){var e,t,n,r;return n=(r=Me(arguments))[0],e=r[1],t=r[2],[n,M(t*=i)*e,xe(t)*e]},q=function(){var e,t,n,r,i,a,s,o,l;return s=(n=Me(arguments))[0],i=n[1],a=n[2],e=(o=W(s,i,a))[0],t=o[1],r=o[2],[(l=G(e,t,r))[0],l[1],r=l[2],n.length>3?n[3]:1]},$=function(){var e,t,n,r,i,a;return i=(a=Me(arguments))[0],e=a[1],t=a[2],n=we(e*e+t*t),r=(g(t,e)*l+360)%360,0===ve(1e4*n)&&(r=Number.NaN),[i,n,r]},he=function(){var e,t,n,r,i,a,s;return i=(a=Me(arguments))[0],n=a[1],t=a[2],r=(s=de(i,n,t))[0],e=s[1],t=s[2],$(r,e,t)},w.lch=function(){var e;return e=Me(arguments),new n(e,"lch")},w.hcl=function(){var e;return e=Me(arguments),new n(e,"hcl")},f.lch=q,f.hcl=function(){var e,t,n,r;return t=(r=Me(arguments))[0],e=r[1],n=r[2],q([n,e,t])},n.prototype.lch=function(){return he(this._rgb)},n.prototype.hcl=function(){return he(this._rgb).reverse()},ie=function(e){var t,n,r,i,a,s;return null==e&&(e="rgb"),a=(s=Me(arguments))[0],r=s[1],t=s[2],r/=255,t/=255,[(1-(a/=255)-(i=1-Math.max(a,Math.max(r,t))))*(n=i<1?1/(1-i):0),(1-r-i)*n,(1-t-i)*n,i]},A=function(){var e,t,n,r,i,a;return n=(t=Me(arguments))[0],i=t[1],a=t[2],r=t[3],e=t.length>4?t[4]:1,1===r?[0,0,0,e]:[n>=1?0:255*(1-n)*(1-r),i>=1?0:255*(1-i)*(1-r),a>=1?0:255*(1-a)*(1-r),e]},f.cmyk=function(){return A(Me(arguments))},w.cmyk=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["cmyk"]),(function(){}))},n.prototype.cmyk=function(){return ie(this._rgb)},f.gl=function(){var e,t,n,r,i;for(r=function(){var e,n;for(t in n=[],e=Me(arguments))i=e[t],n.push(i);return n}.apply(this,arguments),e=n=0;n<=2;e=++n)r[e]*=255;return r},w.gl=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["gl"]),(function(){}))},n.prototype.gl=function(){var e;return[(e=this._rgb)[0]/255,e[1]/255,e[2]/255,e[3]]},fe=function(e,t,n){var r;return e=(r=Me(arguments))[0],t=r[1],n=r[2],.2126*(e=Z(e))+.7152*(t=Z(t))+.0722*Z(n)},Z=function(e){return(e/=255)<=.03928?e/12.92:re((e+.055)/1.055,2.4)},H=function(e,t,r,i){var a,s;return a=e._rgb,s=t._rgb,new n(a[0]+r*(s[0]-a[0]),a[1]+r*(s[1]-a[1]),a[2]+r*(s[2]-a[2]),i)},p.push(["rgb",H]),n.prototype.luminance=function(e,t){var n,r,i,a;return null==t&&(t="rgb"),arguments.length?(i=this._rgb,0===e?i=[0,0,0,this._rgb[3]]:1===e?i=[255,255,255,this[3]]:(n=fe(this._rgb),r=20,a=function(n,i){var s,o;return s=(o=n.interpolate(i,.5,t)).luminance(),Math.abs(e-s)<1e-7||!r--?o:s>e?a(n,o):a(o,i)},i=n>e?a(w("black"),this).rgba():a(this,w("white")).rgba()),w(i).alpha(this.alpha())):fe(this._rgb)},Se=function(e){var t,n,r,i;return(i=e/100)<66?(r=255,n=-155.25485562709179-.44596950469579133*(n=i-2)+104.49216199393888*K(n),t=i<20?0:.8274096064007395*(t=i-10)-254.76935184120902+115.67994401066147*K(t)):(r=351.97690566805693+.114206453784165*(r=i-55)-40.25366309332127*K(r),n=325.4494125711974+.07943456536662342*(n=i-50)-28.0852963507957*K(n),t=255),[r,n,t]},me=function(){var e,t,n,r,i,a,s;for(r=(i=Me(arguments))[0],i[1],e=i[2],n=1e3,t=4e4;t-n>.4;)(a=Se(s=.5*(t+n)))[2]/a[0]>=e/r?t=s:n=s;return ve(s)},w.temperature=w.kelvin=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["temperature"]),(function(){}))},f.temperature=f.kelvin=f.K=Se,n.prototype.temperature=function(){return me(this._rgb)},n.prototype.kelvin=n.prototype.temperature,w.contrast=function(e,t){var r,i,a,s;return"string"!==(a=Ae(e))&&"number"!==a||(e=new n(e)),"string"!==(s=Ae(t))&&"number"!==s||(t=new n(t)),(r=e.luminance())>(i=t.luminance())?(r+.05)/(i+.05):(i+.05)/(r+.05)},w.distance=function(e,t,r){var i,a,s,o,l,c,u;for(a in null==r&&(r="lab"),"string"!==(l=Ae(e))&&"number"!==l||(e=new n(e)),"string"!==(c=Ae(t))&&"number"!==c||(t=new n(t)),s=e.get(r),o=t.get(r),u=0,s)u+=(i=(s[a]||0)-(o[a]||0))*i;return Math.sqrt(u)},w.deltaE=function(e,t,r,i){var a,o,l,c,u,d,h,f,p,_,y,v,b,x,w,S,A,E,C,T,P,I,R,k;for(null==r&&(r=1),null==i&&(i=1),"string"!==(w=Ae(e))&&"number"!==w||(e=new n(e)),"string"!==(S=Ae(t))&&"number"!==S||(t=new n(t)),a=(A=e.lab())[0],l=A[1],u=A[2],o=(E=t.lab())[0],c=E[1],d=E[2],h=we(l*l+u*u),f=we(c*c+d*d),T=a<16?.511:.040975*a/(1+.01765*a),C=.0638*h/(1+.0131*h)+.638,x=h<1e-6?0:180*g(u,l)/s;x<0;)x+=360;for(;x>=360;)x-=360;return P=x>=164&&x<=345?.56+m(.2*M(s*(x+168)/180)):.36+m(.4*M(s*(x+35)/180)),b=we((p=h*h*h*h)/(p+1900)),we((I=(a-o)/(r*T))*I+(R=(v=h-f)/(i*C))*R+((_=l-c)*_+(y=u-d)*y-v*v)/((k=C*(b*P+1-b))*k))},n.prototype.get=function(e){var t,n,r,i,a;return r=(i=e.split("."))[0],t=i[1],a=this[r](),t?(n=r.indexOf(t))>-1?a[n]:console.warn("unknown channel "+t+" in mode "+r):a},n.prototype.set=function(e,t){var n,r,i,a,s;if(i=(a=e.split("."))[0],n=a[1])if(s=this[i](),(r=i.indexOf(n))>-1)if("string"===Ae(t))switch(t.charAt(0)){case"+":case"-":s[r]+=+t;break;case"*":s[r]*=+t.substr(1);break;case"/":s[r]/=+t.substr(1);break;default:s[r]=+t}else s[r]=t;else console.warn("unknown channel "+n+" in mode "+i);else s=t;return w(s,i).alpha(this.alpha())},n.prototype.clipped=function(){return this._rgb._clipped||!1},n.prototype.alpha=function(e){return arguments.length?w.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},n.prototype.darken=function(e){var t;return null==e&&(e=1),(t=this.lab())[0]-=a.Kn*e,w.lab(t).alpha(this.alpha())},n.prototype.brighten=function(e){return null==e&&(e=1),this.darken(-e)},n.prototype.darker=n.prototype.darken,n.prototype.brighter=n.prototype.brighten,n.prototype.saturate=function(e){var t;return null==e&&(e=1),(t=this.lch())[1]+=e*a.Kn,t[1]<0&&(t[1]=0),w.lch(t).alpha(this.alpha())},n.prototype.desaturate=function(e){return null==e&&(e=1),this.saturate(-e)},n.prototype.premultiply=function(){var e,t;return t=this.rgb(),e=this.alpha(),w(t[0]*e,t[1]*e,t[2]*e,e)},ee=function(e,t){return e*t/255},C=function(e,t){return e>t?t:e},X=function(e,t){return e>t?e:t},be=function(e,t){return 255*(1-(1-e/255)*(1-t/255))},ne=function(e,t){return t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255))},x=function(e,t){return 255*(1-(1-t/255)/(e/255))},T=function(e,t){return 255===e||(e=t/255*255/(1-e/255))>255?255:e},(y=function(e,t,n){if(!y[n])throw"unknown blend mode "+n;return y[n](e,t)}).normal=(v=function(e){return function(t,n){var r,i;return r=w(n).rgb(),i=w(t).rgb(),w(e(r,i),"rgb")}})((P=function(e){return function(t,n){var r,i,a;for(a=[],r=i=0;i<=3;r=++i)a[r]=e(t[r],n[r]);return a}})((function(e,t){return e}))),y.multiply=v(P(ee)),y.screen=v(P(be)),y.overlay=v(P(ne)),y.darken=v(P(C)),y.lighten=v(P(X)),y.dodge=v(P(T)),y.burn=v(P(x)),w.blend=y,w.analyze=function(e){var t,n,r,i;for(r={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},n=0,t=e.length;n<t;n++)null==(i=e[n])||isNaN(i)||(r.values.push(i),r.sum+=i,i<r.min&&(r.min=i),i>r.max&&(r.max=i),r.count+=1);return r.domain=[r.min,r.max],r.limits=function(e,t){return w.limits(r,e,t)},r},w.scale=function(e,t){var n,r,i,a,s,o,l,c,u,d,h,f,p,m,g,_,y,v,b,x,S;return u="rgb",d=w("#ccc"),m=0,s=[0,1],p=[],f=[0,0],n=!1,i=[],h=!1,c=0,l=1,a=!1,r={},g=!0,o=1,x=function(e){var t,n,r,a,s,o;if(null==e&&(e=["#fff","#000"]),null!=e&&"string"===Ae(e)&&null!=w.brewer&&(e=w.brewer[e]||w.brewer[e.toLowerCase()]||e),"array"===Ae(e)){for(1===e.length&&(e=[e[0],e[0]]),t=r=0,a=(e=e.slice(0)).length-1;0<=a?r<=a:r>=a;t=0<=a?++r:--r)n=e[t],"string"===Ae(n)&&(e[t]=w(n));for(p.length=0,t=o=0,s=e.length-1;0<=s?o<=s:o>=s;t=0<=s?++o:--o)p.push(t/(e.length-1))}return b(),i=e},y=function(e){var t,r;if(null!=n){for(r=n.length-1,t=0;t<r&&e>=n[t];)t++;return t-1}return 0},S=function(e){return e},v=function(e,t){var a,s,h,m,_,v,b;if(null==t&&(t=!1),isNaN(e)||null===e)return d;if(b=t?e:n&&n.length>2?y(e)/(n.length-2):l!==c?(e-c)/(l-c):1,t||(b=S(b)),1!==o&&(b=re(b,o)),b=f[0]+b*(1-f[0]-f[1]),b=Math.min(1,Math.max(0,b)),h=Math.floor(1e4*b),g&&r[h])a=r[h];else{if("array"===Ae(i))for(s=m=0,v=p.length-1;0<=v?m<=v:m>=v;s=0<=v?++m:--m){if(b<=(_=p[s])){a=i[s];break}if(b>=_&&s===p.length-1){a=i[s];break}if(b>_&&b<p[s+1]){b=(b-_)/(p[s+1]-_),a=w.interpolate(i[s],i[s+1],b,u);break}}else"function"===Ae(i)&&(a=i(b));g&&(r[h]=a)}return a},b=function(){return r={}},x(e),(_=function(e){var t;return t=w(v(e)),h&&t[h]?t[h]():t}).classes=function(e){var t;return null!=e?("array"===Ae(e)?(n=e,s=[e[0],e[e.length-1]]):(t=w.analyze(s),n=0===e?[t.min,t.max]:w.limits(t,"e",e)),_):n},_.domain=function(e){var t,n,r,a,o,u,d;if(!arguments.length)return s;if(c=e[0],l=e[e.length-1],p=[],r=i.length,e.length===r&&c!==l)for(o=0,a=e.length;o<a;o++)n=e[o],p.push((n-c)/(l-c));else for(t=d=0,u=r-1;0<=u?d<=u:d>=u;t=0<=u?++d:--d)p.push(t/(r-1));return s=[c,l],_},_.mode=function(e){return arguments.length?(u=e,b(),_):u},_.range=function(e,t){return x(e),_},_.out=function(e){return h=e,_},_.spread=function(e){return arguments.length?(m=e,_):m},_.correctLightness=function(e){return null==e&&(e=!0),a=e,b(),S=a?function(e){var t,n,r,i,a,s,o,l;for(s=(t=v(0,!0).lab()[0])>(n=v(1,!0).lab()[0]),r=v(e,!0).lab()[0]-(i=t+(n-t)*e),o=0,l=1,a=20;Math.abs(r)>.01&&a-- >0;)s&&(r*=-1),r<0?(o=e,e+=.5*(l-e)):(l=e,e+=.5*(o-e)),r=v(e,!0).lab()[0]-i;return e}:function(e){return e},_},_.padding=function(e){return null!=e?("number"===Ae(e)&&(e=[e,e]),f=e,_):f},_.colors=function(t,r){var a,o,l,c,u,d,h,f;if(arguments.length<2&&(r="hex"),u=[],0===arguments.length)u=i.slice(0);else if(1===t)u=[_(.5)];else if(t>1)o=s[0],a=s[1]-o,u=function(){d=[];for(var e=0;0<=t?e<t:e>t;0<=t?e++:e--)d.push(e);return d}.apply(this).map((function(e){return _(o+e/(t-1)*a)}));else{if(e=[],h=[],n&&n.length>2)for(l=f=1,c=n.length;1<=c?f<c:f>c;l=1<=c?++f:--f)h.push(.5*(n[l-1]+n[l]));else h=s;u=h.map((function(e){return _(e)}))}return w[r]&&(u=u.map((function(e){return e[r]()}))),u},_.cache=function(e){return null!=e?(g=e,_):g},_.gamma=function(e){return null!=e?(o=e,_):o},_.nodata=function(e){return null!=e?(d=w(e),_):d},_},null==w.scales&&(w.scales={}),w.scales.cool=function(){return w.scale([w.hsl(180,1,.9),w.hsl(250,.7,.4)])},w.scales.hot=function(){return w.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},w.analyze=function(e,t,n){var r,i,a,s,o,l;if(o={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},null==n&&(n=function(){return!0}),r=function(e){null==e||isNaN(e)||(o.values.push(e),o.sum+=e,e<o.min&&(o.min=e),e>o.max&&(o.max=e),o.count+=1)},l=function(e,i){if(n(e,i))return null!=t&&"function"===Ae(t)?r(t(e)):null!=t&&"string"===Ae(t)||"number"===Ae(t)?r(e[t]):r(e)},"array"===Ae(e))for(s=0,a=e.length;s<a;s++)l(e[s]);else for(i in e)l(e[i],i);return o.domain=[o.min,o.max],o.limits=function(e,t){return w.limits(o,e,t)},o},w.limits=function(e,t,n){var r,i,a,s,o,l,c,u,d,h,f,p,g,_,y,v,b,x,S,A,M,E,C,T,P,R,k,D,L,N,O,F,U,B,z,V,H,$,G,j,W,q,X,Y,Z,Q,ee,te,ne,ie,ae,se,oe,le,ce;if(null==t&&(t="equal"),null==n&&(n=7),"array"===Ae(e)&&(e=w.analyze(e)),P=e.min,J=e.max,e.sum,le=e.values.sort((function(e,t){return e-t})),1===n)return[P,J];if(C=[],"c"===t.substr(0,1)&&(C.push(P),C.push(J)),"e"===t.substr(0,1)){for(C.push(P),A=O=1,z=n-1;1<=z?O<=z:O>=z;A=1<=z?++O:--O)C.push(P+A/n*(J-P));C.push(J)}else if("l"===t.substr(0,1)){if(P<=0)throw"Logarithmic scales are only possible for values > 0";for(R=Math.LOG10E*K(P),T=Math.LOG10E*K(J),C.push(P),A=ce=1,V=n-1;1<=V?ce<=V:ce>=V;A=1<=V?++ce:--ce)C.push(re(10,R+A/n*(T-R)));C.push(J)}else if("q"===t.substr(0,1)){for(C.push(P),A=r=1,q=n-1;1<=q?r<=q:r>=q;A=1<=q?++r:--r)F=(le.length-1)*A/n,(U=I(F))===F?C.push(le[U]):(B=F-U,C.push(le[U]*(1-B)+le[U+1]*B));C.push(J)}else if("k"===t.substr(0,1)){for(D=le.length,_=new Array(D),x=new Array(n),ie=!0,L=0,v=null,(v=[]).push(P),A=i=1,X=n-1;1<=X?i<=X:i>=X;A=1<=X?++i:--i)v.push(P+A/n*(J-P));for(v.push(J);ie;){for(M=a=0,Y=n-1;0<=Y?a<=Y:a>=Y;M=0<=Y?++a:--a)x[M]=0;for(A=s=0,Z=D-1;0<=Z?s<=Z:s>=Z;A=0<=Z?++s:--s){for(oe=le[A],k=Number.MAX_VALUE,M=o=0,Q=n-1;0<=Q?o<=Q:o>=Q;M=0<=Q?++o:--o)(S=m(v[M]-oe))<k&&(k=S,y=M);x[y]++,_[A]=y}for(N=new Array(n),M=l=0,ee=n-1;0<=ee?l<=ee:l>=ee;M=0<=ee?++l:--l)N[M]=null;for(A=c=0,te=D-1;0<=te?c<=te:c>=te;A=0<=te?++c:--c)null===N[b=_[A]]?N[b]=le[A]:N[b]+=le[A];for(M=u=0,ne=n-1;0<=ne?u<=ne:u>=ne;M=0<=ne?++u:--u)N[M]*=1/x[M];for(ie=!1,M=d=0,H=n-1;0<=H?d<=H:d>=H;M=0<=H?++d:--d)if(N[M]!==v[A]){ie=!0;break}v=N,++L>200&&(ie=!1)}for(E={},M=h=0,$=n-1;0<=$?h<=$:h>=$;M=0<=$?++h:--h)E[M]=[];for(A=f=0,G=D-1;0<=G?f<=G:f>=G;A=0<=G?++f:--f)E[b=_[A]].push(le[A]);for(ae=[],M=p=0,j=n-1;0<=j?p<=j:p>=j;M=0<=j?++p:--p)ae.push(E[M][0]),ae.push(E[M][E[M].length-1]);for(ae=ae.sort((function(e,t){return e-t})),C.push(ae[0]),A=g=1,W=ae.length-1;g<=W;A=g+=2)se=ae[A],isNaN(se)||-1!==C.indexOf(se)||C.push(se)}return C},D=function(e,t,n){var r,i,a,s;return e=(r=Me(arguments))[0],t=r[1],n=r[2],isNaN(e)&&(e=0),(e/=360)<1/3?a=1-((i=(1-t)/3)+(s=(1+t*M(c*e)/M(o-c*e))/3)):e<2/3?i=1-((s=(1-t)/3)+(a=(1+t*M(c*(e-=1/3))/M(o-c*e))/3)):s=1-((a=(1-t)/3)+(i=(1+t*M(c*(e-=2/3))/M(o-c*e))/3)),[255*(s=Y(n*s*3)),255*(a=Y(n*a*3)),255*(i=Y(n*i*3)),r.length>3?r[3]:1]},le=function(){var e,t,n,r,i,a,s;return i=(a=Me(arguments))[0],t=a[1],e=a[2],c=2*Math.PI,i/=255,t/=255,e/=255,0==(s=1-Math.min(i,t,e)/(r=(i+t+e)/3))?n=0:(n=(i-t+(i-e))/2,n/=Math.sqrt((i-t)*(i-t)+(i-e)*(t-e)),n=Math.acos(n),e>t&&(n=c-n),n/=c),[360*n,s,r]},w.hsi=function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,Pe.call(arguments).concat(["hsi"]),(function(){}))},f.hsi=D,n.prototype.hsi=function(){return le(this._rgb)},U=function(e,t,n,r){var i,a,s,o,l,c,u,d,h,f;return"hsl"===r?(h=e.hsl(),f=t.hsl()):"hsv"===r?(h=e.hsv(),f=t.hsv()):"hcg"===r?(h=e.hcg(),f=t.hcg()):"hsi"===r?(h=e.hsi(),f=t.hsi()):"lch"!==r&&"hcl"!==r||(r="hcl",h=e.hcl(),f=t.hcl()),"h"===r.substr(0,1)&&(a=h[0],u=h[1],o=h[2],s=f[0],d=f[1],l=f[2]),isNaN(a)||isNaN(s)?isNaN(a)?isNaN(s)?i=Number.NaN:(i=s,1!==o&&0!==o||"hsv"===r||(c=d)):(i=a,1!==l&&0!==l||"hsv"===r||(c=u)):i=a+n*(s>a&&s-a>180?s-(a+360):s<a&&a-s>180?s+360-a:s-a),null==c&&(c=u+n*(d-u)),w[r](i,c,o+n*(l-o))},V=function(e,t,n,r){var i,a;return i=e.num(),a=t.num(),w.num(i+(a-i)*n,"num")},(p=p.concat(function(){var e,t,n,r;for(r=[],t=0,e=(n=["hsv","hsl","hsi","hcl","lch","hcg"]).length;t<e;t++)Q=n[t],r.push([Q,U]);return r}())).push(["num",V]),B=function(e,t,r,i){var a,s;return a=e.lab(),s=t.lab(),new n(a[0]+r*(s[0]-a[0]),a[1]+r*(s[1]-a[1]),a[2]+r*(s[2]-a[2]),i)},p.push(["lab",B])}.call(this)},30:function(e,t,n){var r;!function(i){function a(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function s(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function o(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){o.prototype.dispatch.apply(e,arguments)}}a.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},o.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,r){var i,s=this._indexOfListener(e,n);if(-1!==s){if((i=this._bindings[s]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else i=new a(this,e,t,n,r),this._addBinding(i);return this.memorize&&this._prevParams&&i.execute(this._prevParams),i},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,r=this._bindings.length;r--;)if((n=this._bindings[r])._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return s(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return s(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){s(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){t=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(t[r]&&this._shouldPropagate&&!1!==t[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var l=o;l.Signal=o,void 0===(r=function(){return l}.call(t,n,t,e))||(e.exports=r)}()},304:(e,t,n)=>{var r;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function a(e){return function(e,t){var n,r,s,o,l,c,u,d,h,f=1,p=e.length,m="";for(r=0;r<p;r++)if("string"==typeof e[r])m+=e[r];else if("object"==typeof e[r]){if((o=e[r]).keys)for(n=t[f],s=0;s<o.keys.length;s++){if(null==n)throw new Error(a('[sprintf] Cannot access property "%s" of undefined value "%s"',o.keys[s],o.keys[s-1]));n=n[o.keys[s]]}else n=o.param_no?t[o.param_no]:t[f++];if(i.not_type.test(o.type)&&i.not_primitive.test(o.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(o.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(a("[sprintf] expecting number but found %T",n));switch(i.number.test(o.type)&&(d=n>=0),o.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,o.width?parseInt(o.width):0);break;case"e":n=o.precision?parseFloat(n).toExponential(o.precision):parseFloat(n).toExponential();break;case"f":n=o.precision?parseFloat(n).toFixed(o.precision):parseFloat(n);break;case"g":n=o.precision?String(Number(n.toPrecision(o.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=o.precision?n.substring(0,o.precision):n;break;case"t":n=String(!!n),n=o.precision?n.substring(0,o.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=o.precision?n.substring(0,o.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=o.precision?n.substring(0,o.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(o.type)?m+=n:(!i.number.test(o.type)||d&&!o.sign?h="":(h=d?"+":"-",n=n.toString().replace(i.sign,"")),c=o.pad_char?"0"===o.pad_char?"0":o.pad_char.charAt(1):" ",u=o.width-(h+n).length,l=o.width&&u>0?c.repeat(u):"",m+=o.align?h+n+l:"0"===c?h+l+n:l+h+n)}return m}(function(e){if(o[e])return o[e];for(var t,n=e,r=[],a=0;n;){if(null!==(t=i.text.exec(n)))r.push(t[0]);else if(null!==(t=i.modulo.exec(n)))r.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){a|=1;var s=[],l=t[2],c=[];if(null===(c=i.key.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(s.push(c[1]);""!==(l=l.substring(c[0].length));)if(null!==(c=i.key_access.exec(l)))s.push(c[1]);else{if(null===(c=i.index_access.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");s.push(c[1])}t[2]=s}else a|=2;if(3===a)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return o[e]=r}(e),arguments)}function s(e,t){return a.apply(null,[e].concat(t||[]))}var o=Object.create(null);t.sprintf=a,t.vsprintf=s,"undefined"!=typeof window&&(window.sprintf=a,window.vsprintf=s,void 0===(r=function(){return{sprintf:a,vsprintf:s}}.call(t,n,t,e))||(e.exports=r))}()}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var a=Object.create(null);i.r(a);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,i.d(a,s),a},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e,t=i(540),n=i.t(t,2),r=i(338),a=i(961),s=i.t(a,2);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const l="popstate";function c(e,t){if(!1===e||null==e)throw new Error(t)}function u(e,t){if(!e){"undefined"!=typeof console&&console.warn(t);try{throw new Error(t)}catch(e){}}}function d(e,t){return{usr:e.state,key:e.key,idx:t}}function h(e,t,n,r){return void 0===n&&(n=null),o({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?p(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function f(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function p(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var m;function g(e,t,n){return void 0===n&&(n="/"),function(e,t,n,r){let i=I(("string"==typeof t?p(t):t).pathname||"/",n);if(null==i)return null;let a=_(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){return e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]))?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(a);let s=null;for(let e=0;null==s&&e<a.length;++e){let t=P(i);s=C(a[e],t,r)}return s}(e,t,n,!1)}function _(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,a)=>{let s={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};s.relativePath.startsWith("/")&&(c(s.relativePath.startsWith(r),'Absolute route path "'+s.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(r.length));let o=L([r,s.relativePath]),l=n.concat(s);e.children&&e.children.length>0&&(c(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),_(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:E(o,e.index),routesMeta:l})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let n of y(e.path))i(e,t,n);else i(e,t)})),t}function y(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===r.length)return i?[a,""]:[a];let s=y(r.join("/")),o=[];return o.push(...s.map((e=>""===e?a:[a,e].join("/")))),i&&o.push(...s),o.map((t=>e.startsWith("/")&&""===t?"/":t))}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={})),new Set(["lazy","caseSensitive","path","id","index","children"]);const v=/^:[\w-]+$/,b=3,x=2,w=1,S=10,A=-2,M=e=>"*"===e;function E(e,t){let n=e.split("/"),r=n.length;return n.some(M)&&(r+=A),t&&(r+=x),n.filter((e=>!M(e))).reduce(((e,t)=>e+(v.test(t)?b:""===t?w:S)),r)}function C(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,i={},a="/",s=[];for(let e=0;e<r.length;++e){let o=r[e],l=e===r.length-1,c="/"===a?t:t.slice(a.length)||"/",u=T({path:o.relativePath,caseSensitive:o.caseSensitive,end:l},c),d=o.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=T({path:o.relativePath,caseSensitive:o.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),s.push({params:i,pathname:L([a,u.pathname]),pathnameBase:N(L([a,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(a=L([a,u.pathnameBase]))}return s}function T(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0),u("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));return e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let a=i[0],s=a.replace(/(.)\/+$/,"$1"),o=i.slice(1),l=r.reduce(((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=o[n]||"";s=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[r]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{});return{params:l,pathname:a,pathnameBase:s,pattern:e}}function P(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return u(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function I(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function R(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function k(e,t){let n=function(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}(e);return t?n.map(((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)):n.map((e=>e.pathnameBase))}function D(e,t,n,r){let i;void 0===r&&(r=!1),"string"==typeof e?i=p(e):(i=o({},e),c(!i.pathname||!i.pathname.includes("?"),R("?","pathname","search",i)),c(!i.pathname||!i.pathname.includes("#"),R("#","pathname","hash",i)),c(!i.search||!i.search.includes("#"),R("#","search","hash",i)));let a,s=""===e||""===i.pathname,l=s?"/":i.pathname;if(null==l)a=n;else{let e=t.length-1;if(!r&&l.startsWith("..")){let t=l.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}a=e>=0?t[e]:"/"}let u=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:i=""}="string"==typeof e?p(e):e,a=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:a,search:O(r),hash:F(i)}}(i,a),d=l&&"/"!==l&&l.endsWith("/"),h=(s||"."===l)&&n.endsWith("/");return u.pathname.endsWith("/")||!d&&!h||(u.pathname+="/"),u}const L=e=>e.join("/").replace(/\/\/+/g,"/"),N=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),O=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;const U=["post","put","patch","delete"],B=(new Set(U),["get",...U]);function z(){return z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},z.apply(this,arguments)}new Set(B),new Set([301,302,303,307,308]),new Set([307,308]),Symbol("deferred");const V=t.createContext(null),H=t.createContext(null),$=t.createContext(null),G=t.createContext(null),j=t.createContext({outlet:null,matches:[],isDataRoute:!1}),W=t.createContext(null);function q(){return null!=t.useContext(G)}function X(){return q()||c(!1),t.useContext(G).location}function Y(e){t.useContext($).static||t.useLayoutEffect(e)}function K(){let{isDataRoute:e}=t.useContext(j);return e?function(){let{router:e}=function(e){let n=t.useContext(V);return n||c(!1),n}(re.UseNavigateStable),n=ae(ie.UseNavigateStable),r=t.useRef(!1);Y((()=>{r.current=!0}));let i=t.useCallback((function(t,i){void 0===i&&(i={}),r.current&&("number"==typeof t?e.navigate(t):e.navigate(t,z({fromRouteId:n},i)))}),[e,n]);return i}():function(){q()||c(!1);let e=t.useContext(V),{basename:n,future:r,navigator:i}=t.useContext($),{matches:a}=t.useContext(j),{pathname:s}=X(),o=JSON.stringify(k(a,r.v7_relativeSplatPath)),l=t.useRef(!1);Y((()=>{l.current=!0}));let u=t.useCallback((function(t,r){if(void 0===r&&(r={}),!l.current)return;if("number"==typeof t)return void i.go(t);let a=D(t,JSON.parse(o),s,"path"===r.relative);null==e&&"/"!==n&&(a.pathname="/"===a.pathname?n:L([n,a.pathname])),(r.replace?i.replace:i.push)(a,r.state,r)}),[n,i,o,s,e]);return u}()}function Z(e,n){let{relative:r}=void 0===n?{}:n,{future:i}=t.useContext($),{matches:a}=t.useContext(j),{pathname:s}=X(),o=JSON.stringify(k(a,i.v7_relativeSplatPath));return t.useMemo((()=>D(e,JSON.parse(o),s,"path"===r)),[e,o,s,r])}function Q(n,r,i,a){q()||c(!1);let{navigator:s}=t.useContext($),{matches:o}=t.useContext(j),l=o[o.length-1],u=l?l.params:{},d=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let h,f=X();if(r){var m;let e="string"==typeof r?p(r):r;"/"===d||(null==(m=e.pathname)?void 0:m.startsWith(d))||c(!1),h=e}else h=f;let _=h.pathname||"/",y=_;if("/"!==d){let e=d.replace(/^\//,"").split("/");y="/"+_.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=g(n,{pathname:y}),b=function(e,n,r,i){var a;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),null==e){var s;if(null==(s=r)||!s.errors)return null;e=r.matches}let o=e,l=null==(a=r)?void 0:a.errors;if(null!=l){let e=o.findIndex((e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id])));e>=0||c(!1),o=o.slice(0,Math.min(o.length,e+1))}let u=!1,d=-1;if(r&&i&&i.v7_partialHydration)for(let e=0;e<o.length;e++){let t=o[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(d=e),t.route.id){let{loaderData:e,errors:n}=r,i=t.route.loader&&void 0===e[t.route.id]&&(!n||void 0===n[t.route.id]);if(t.route.lazy||i){u=!0,o=d>=0?o.slice(0,d+1):[o[0]];break}}}return o.reduceRight(((e,i,a)=>{let s,c=!1,h=null,f=null;var p;r&&(s=l&&i.route.id?l[i.route.id]:void 0,h=i.route.errorElement||ee,u&&(d<0&&0===a?(se[p="route-fallback"]||(se[p]=!0),c=!0,f=null):d===a&&(c=!0,f=i.route.hydrateFallbackElement||null)));let m=n.concat(o.slice(0,a+1)),g=()=>{let n;return n=s?h:c?f:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(ne,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:n})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===a)?t.createElement(te,{location:r.location,revalidation:r.revalidation,component:h,error:s,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}(v&&v.map((e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:L([d,s.encodeLocation?s.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:L([d,s.encodeLocation?s.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),o,i,a);return r&&b?t.createElement(G.Provider,{value:{location:z({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:e.Pop}},b):b}function J(){let e=function(){var e;let n=t.useContext(W),r=function(e){let n=t.useContext(H);return n||c(!1),n}(ie.UseRouteError),i=ae(ie.UseRouteError);return void 0!==n?n:null==(e=r.errors)?void 0:e[i]}(),n=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:i},r):null,null)}const ee=t.createElement(J,null);class te extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(j.Provider,{value:this.props.routeContext},t.createElement(W.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ne(e){let{routeContext:n,match:r,children:i}=e,a=t.useContext(V);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(j.Provider,{value:n},i)}var re=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(re||{}),ie=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ie||{});function ae(e){let n=function(e){let n=t.useContext(j);return n||c(!1),n}(),r=n.matches[n.matches.length-1];return r.route.id||c(!1),r.route.id}const se={};function oe(e){c(!1)}function le(n){let{basename:r="/",children:i=null,location:a,navigationType:s=e.Pop,navigator:o,static:l=!1,future:u}=n;q()&&c(!1);let d=r.replace(/^\/*/,"/"),h=t.useMemo((()=>({basename:d,navigator:o,static:l,future:z({v7_relativeSplatPath:!1},u)})),[d,u,o,l]);"string"==typeof a&&(a=p(a));let{pathname:f="/",search:m="",hash:g="",state:_=null,key:y="default"}=a,v=t.useMemo((()=>{let e=I(f,d);return null==e?null:{location:{pathname:e,search:m,hash:g,state:_,key:y},navigationType:s}}),[d,f,m,g,_,y,s]);return null==v?null:t.createElement($.Provider,{value:h},t.createElement(G.Provider,{children:i,value:v}))}function ce(e){let{children:t,location:n}=e;return Q(ue(t),n)}function ue(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,((e,i)=>{if(!t.isValidElement(e))return;let a=[...n,i];if(e.type===t.Fragment)return void r.push.apply(r,ue(e.props.children,a));e.type!==oe&&c(!1),e.props.index&&e.props.children&&c(!1);let s={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(s.children=ue(e.props.children,a)),r.push(s)})),r}function de(){return de=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},de.apply(this,arguments)}n.startTransition,new Promise((()=>{})),t.Component,new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const he=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(e){}new Map;const fe=n.startTransition;function pe(n){let{basename:r,children:i,future:a,window:s}=n,u=t.useRef();var p;null==u.current&&(u.current=(void 0===(p={window:s,v5Compat:!0})&&(p={}),function(t,n,r,i){void 0===i&&(i={});let{window:a=document.defaultView,v5Compat:s=!1}=i,u=a.history,p=e.Pop,m=null,g=_();function _(){return(u.state||{idx:null}).idx}function y(){p=e.Pop;let t=_(),n=null==t?null:t-g;g=t,m&&m({action:p,location:b.location,delta:n})}function v(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,n="string"==typeof e?e:f(e);return n=n.replace(/ $/,"%20"),c(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,u.replaceState(o({},u.state,{idx:g}),""));let b={get action(){return p},get location(){return t(a,u)},listen(e){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(l,y),m=e,()=>{a.removeEventListener(l,y),m=null}},createHref:e=>n(a,e),createURL:v,encodeLocation(e){let t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){p=e.Push;let i=h(b.location,t,n);r&&r(i,t),g=_()+1;let o=d(i,g),l=b.createHref(i);try{u.pushState(o,"",l)}catch(e){if(e instanceof DOMException&&"DataCloneError"===e.name)throw e;a.location.assign(l)}s&&m&&m({action:p,location:b.location,delta:1})},replace:function(t,n){p=e.Replace;let i=h(b.location,t,n);r&&r(i,t),g=_();let a=d(i,g),o=b.createHref(i);u.replaceState(a,"",o),s&&m&&m({action:p,location:b.location,delta:0})},go:e=>u.go(e)};return b}((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return h("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"==typeof t?t:f(t)}),null,p)));let m=u.current,[g,_]=t.useState({action:m.action,location:m.location}),{v7_startTransition:y}=a||{},v=t.useCallback((e=>{y&&fe?fe((()=>_(e))):_(e)}),[_,y]);return t.useLayoutEffect((()=>m.listen(v)),[m,v]),t.createElement(le,{basename:r,children:i,location:g.location,navigationType:g.action,navigator:m,future:a})}s.flushSync,n.useId;const me="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,ge=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_e=t.forwardRef((function(e,n){let r,{onClick:i,relative:a,reloadDocument:s,replace:o,state:l,target:u,to:d,preventScrollReset:h,unstable_viewTransition:p}=e,m=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,he),{basename:g}=t.useContext($),_=!1;if("string"==typeof d&&ge.test(d)&&(r=d,me))try{let e=new URL(window.location.href),t=d.startsWith("//")?new URL(e.protocol+d):new URL(d),n=I(t.pathname,g);t.origin===e.origin&&null!=n?d=n+t.search+t.hash:_=!0}catch(e){}let y=function(e,n){let{relative:r}=void 0===n?{}:n;q()||c(!1);let{basename:i,navigator:a}=t.useContext($),{hash:s,pathname:o,search:l}=Z(e,{relative:r}),u=o;return"/"!==i&&(u="/"===o?i:L([i,o])),a.createHref({pathname:u,search:l,hash:s})}(d,{relative:a}),v=function(e,n){let{target:r,replace:i,state:a,preventScrollReset:s,relative:o,unstable_viewTransition:l}=void 0===n?{}:n,c=K(),u=X(),d=Z(e,{relative:o});return t.useCallback((t=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(t,r)){t.preventDefault();let n=void 0!==i?i:f(u)===f(d);c(e,{replace:n,state:a,preventScrollReset:s,relative:o,unstable_viewTransition:l})}}),[u,c,d,i,a,r,e,s,o,l])}(d,{replace:o,state:l,target:u,preventScrollReset:h,relative:a,unstable_viewTransition:p});return t.createElement("a",de({},m,{href:r||y,onClick:_||s?i:function(e){i&&i(e),e.defaultPrevented||v(e)},ref:n,target:u}))}));var ye,ve;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(ye||(ye={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(ve||(ve={}));const be=function(){return t.createElement("nav",{className:"bg-slate-400 p-5"},t.createElement("div",{className:"navbar-container"},t.createElement("div",{className:"nav-header"},t.createElement("h1",{className:"navbar-title"},"Hi, I'm Matt"),t.createElement("h3",{className:"navbar-subtitle"},"MS Biotechnology| Computaional Biologist")),t.createElement("ul",{className:"nav-list"},t.createElement("li",null,t.createElement(_e,{to:"/",className:"nav-item"},"Home")),t.createElement("li",null,t.createElement(_e,{to:"/about",className:"nav-item"},"About")),t.createElement("li",null,t.createElement(_e,{to:"/projects",className:"nav-item"},"Projects")),t.createElement("li",null,t.createElement(_e,{to:"/press",className:"nav-item"},"Press")),t.createElement("li",null,t.createElement(_e,{to:"/CV",className:"nav-item"},"CV")))),t.createElement("div",{className:"navbar-divider"}))},xe="158",we=1,Se=2,Ae=3,Me=0,Ee=1,Ce=2,Te=100,Pe=101,Ie=102,Re=200,ke=201,De=202,Le=203,Ne=204,Oe=205,Fe=206,Ue=207,Be=208,ze=209,Ve=210,He=211,$e=212,Ge=213,je=214,We=0,qe=1,Xe=2,Ye=0,Ke=1,Ze=2,Qe=3,Je=4,et=5,tt=301,nt=302,rt=306,it=1e3,at=1001,st=1002,ot=1003,lt=1004,ct=1005,ut=1006,dt=1007,ht=1008,ft=1009,pt=1012,mt=1014,gt=1015,_t=1016,yt=1020,vt=1023,bt=1026,xt=1027,wt=33776,St=33777,At=33778,Mt=33779,Et=36492,Ct=2300,Tt=2301,Pt=2302,It=3001,Rt="",kt="srgb",Dt="srgb-linear",Lt="display-p3",Nt="display-p3-linear",Ot="linear",Ft="srgb",Ut="rec709",Bt="p3",zt=7680,Vt=512,Ht=513,$t=514,Gt=515,jt=516,Wt=517,qt=518,Xt=519,Yt=35044,Kt=35048,Zt="300 es",Qt=1035,Jt=2e3,en=2001;class tn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const nn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],rn=Math.PI/180,an=180/Math.PI;function sn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(nn[255&e]+nn[e>>8&255]+nn[e>>16&255]+nn[e>>24&255]+"-"+nn[255&t]+nn[t>>8&255]+"-"+nn[t>>16&15|64]+nn[t>>24&255]+"-"+nn[63&n|128]+nn[n>>8&255]+"-"+nn[n>>16&255]+nn[n>>24&255]+nn[255&r]+nn[r>>8&255]+nn[r>>16&255]+nn[r>>24&255]).toLowerCase()}function on(e,t,n){return Math.max(t,Math.min(n,e))}function ln(e,t,n){return(1-n)*e+n*t}function cn(e){return!(e&e-1)&&0!==e}function un(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function dn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function hn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class fn{constructor(e=0,t=0){fn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(on(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pn{constructor(e,t,n,r,i,a,s,o,l){pn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,s,o,l)}set(e,t,n,r,i,a,s,o,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=i,c[5]=o,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[3],o=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],f=n[8],p=r[0],m=r[3],g=r[6],_=r[1],y=r[4],v=r[7],b=r[2],x=r[5],w=r[8];return i[0]=a*p+s*_+o*b,i[3]=a*m+s*y+o*x,i[6]=a*g+s*v+o*w,i[1]=l*p+c*_+u*b,i[4]=l*m+c*y+u*x,i[7]=l*g+c*v+u*w,i[2]=d*p+h*_+f*b,i[5]=d*m+h*y+f*x,i[8]=d*g+h*v+f*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-n*i*c+n*s*o+r*i*l-r*a*o}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=c*a-s*l,d=s*o-c*i,h=l*i-a*o,f=t*u+n*d+r*h;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(s*n-r*a)*p,e[3]=d*p,e[4]=(c*t-r*o)*p,e[5]=(r*i-s*t)*p,e[6]=h*p,e[7]=(n*o-l*t)*p,e[8]=(a*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,s){const o=Math.cos(i),l=Math.sin(i);return this.set(n*o,n*l,-n*(o*a+l*s)+a+e,-r*l,r*o,-r*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(mn.makeScale(e,t)),this}rotate(e){return this.premultiply(mn.makeRotation(-e)),this}translate(e,t){return this.premultiply(mn.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const mn=new pn;function gn(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function _n(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function yn(){const e=_n("canvas");return e.style.display="block",e}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const vn={};function bn(e){e in vn||(vn[e]=!0,console.warn(e))}const xn=(new pn).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),wn=(new pn).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Sn={[Dt]:{transfer:Ot,primaries:Ut,toReference:e=>e,fromReference:e=>e},[kt]:{transfer:Ft,primaries:Ut,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[Nt]:{transfer:Ot,primaries:Bt,toReference:e=>e.applyMatrix3(wn),fromReference:e=>e.applyMatrix3(xn)},[Lt]:{transfer:Ft,primaries:Bt,toReference:e=>e.convertSRGBToLinear().applyMatrix3(wn),fromReference:e=>e.applyMatrix3(xn).convertLinearToSRGB()}},An=new Set([Dt,Nt]),Mn={enabled:!0,_workingColorSpace:Dt,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!An.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=Sn[t].toReference;return(0,Sn[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return Sn[e].primaries},getTransfer:function(e){return e===Rt?Ot:Sn[e].transfer}};function En(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Cn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Tn;class Pn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Tn&&(Tn=_n("canvas")),Tn.width=e.width,Tn.height=e.height;const n=Tn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Tn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=_n("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*En(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*En(t[e]/255)):t[e]=En(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let In=0;class Rn{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:In++}),this.uuid=sn(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(kn(r[t].image)):e.push(kn(r[t]))}else e=kn(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function kn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Pn.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Dn=0;class Ln extends tn{constructor(e=Ln.DEFAULT_IMAGE,t=Ln.DEFAULT_MAPPING,n=1001,r=1001,i=1006,a=1008,s=1023,o=1009,l=Ln.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Dn++}),this.uuid=sn(),this.name="",this.source=new Rn(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new fn(0,0),this.repeat=new fn(1,1),this.center=new fn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(bn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===It?kt:Rt),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case it:e.x=e.x-Math.floor(e.x);break;case at:e.x=e.x<0?0:1;break;case st:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case it:e.y=e.y-Math.floor(e.y);break;case at:e.y=e.y<0?0:1;break;case st:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return bn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===kt?It:3e3}set encoding(e){bn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===It?kt:Rt}}Ln.DEFAULT_IMAGE=null,Ln.DEFAULT_MAPPING=300,Ln.DEFAULT_ANISOTROPY=1;class Nn{constructor(e=0,t=0,n=0,r=1){Nn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const a=.01,s=.1,o=e.elements,l=o[0],c=o[4],u=o[8],d=o[1],h=o[5],f=o[9],p=o[2],m=o[6],g=o[10];if(Math.abs(c-d)<a&&Math.abs(u-p)<a&&Math.abs(f-m)<a){if(Math.abs(c+d)<s&&Math.abs(u+p)<s&&Math.abs(f+m)<s&&Math.abs(l+h+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(h+1)/2,_=(g+1)/2,y=(c+d)/4,v=(u+p)/4,b=(f+m)/4;return e>o&&e>_?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=v/n):o>_?o<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=y/r,i=b/r):_<a?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(_),n=v/i,r=b/i),this.set(n,r,i,t),this}let _=Math.sqrt((m-f)*(m-f)+(u-p)*(u-p)+(d-c)*(d-c));return Math.abs(_)<.001&&(_=1),this.x=(m-f)/_,this.y=(u-p)/_,this.z=(d-c)/_,this.w=Math.acos((l+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class On extends tn{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Nn(0,0,e,t),this.scissorTest=!1,this.viewport=new Nn(0,0,e,t);const r={width:e,height:t,depth:1};void 0!==n.encoding&&(bn("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===It?kt:Rt),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ut,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Ln(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Rn(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Fn extends On{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Un extends Ln{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=ot,this.minFilter=ot,this.wrapR=at,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bn extends Ln{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=ot,this.minFilter=ot,this.wrapR=at,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class zn{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,s){let o=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const d=i[a+0],h=i[a+1],f=i[a+2],p=i[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=d,e[t+1]=h,e[t+2]=f,void(e[t+3]=p);if(u!==p||o!==d||l!==h||c!==f){let e=1-s;const t=o*d+l*h+c*f+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,s=Math.sin(s*a)/i}const i=s*n;if(o=o*e+d*i,l=l*e+h*i,c=c*e+f*i,u=u*e+p*i,e===1-s){const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){const s=n[r],o=n[r+1],l=n[r+2],c=n[r+3],u=i[a],d=i[a+1],h=i[a+2],f=i[a+3];return e[t]=s*f+c*u+o*h-l*d,e[t+1]=o*f+c*d+l*u-s*h,e[t+2]=l*f+c*h+s*d-o*u,e[t+3]=c*f-s*u-o*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,r=e._y,i=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(n/2),c=s(r/2),u=s(i/2),d=o(n/2),h=o(r/2),f=o(i/2);switch(a){case"XYZ":this._x=d*c*u+l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u-d*h*f;break;case"YXZ":this._x=d*c*u+l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u+d*h*f;break;case"ZXY":this._x=d*c*u-l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u-d*h*f;break;case"ZYX":this._x=d*c*u-l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u+d*h*f;break;case"YZX":this._x=d*c*u+l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u-d*h*f;break;case"XZY":this._x=d*c*u-l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u+d*h*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],s=t[5],o=t[9],l=t[2],c=t[6],u=t[10],d=n+s+u;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-o)*e,this._y=(i-l)*e,this._z=(a-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-o)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(i-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(a-r)/e,this._x=(i+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(on(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+a*s+r*l-i*o,this._y=r*c+a*o+i*s-n*l,this._z=i*c+a*l+n*o-r*s,this._w=a*c-n*s-r*o-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let s=a*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;const o=1-s*s;if(o<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=a*u+this._w*d,this._x=n*u+this._x*d,this._y=r*u+this._y*d,this._z=i*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vn{constructor(e=0,t=0,n=0){Vn.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion($n.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion($n.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*r-s*n),c=2*(s*t-i*r),u=2*(i*n-a*t);return this.x=t+o*l+a*u-s*c,this.y=n+o*c+s*l-i*u,this.z=r+o*u+i*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,s=t.y,o=t.z;return this.x=r*o-i*s,this.y=i*a-n*o,this.z=n*s-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Hn.copy(this).projectOnVector(e),this.sub(Hn)}reflect(e){return this.sub(Hn.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(on(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Hn=new Vn,$n=new zn;class Gn{constructor(e=new Vn(1/0,1/0,1/0),t=new Vn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Wn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Wn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Wn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Wn):Wn.fromBufferAttribute(r,t),Wn.applyMatrix4(e.matrixWorld),this.expandByPoint(Wn);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),qn.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),qn.copy(n.boundingBox)),qn.applyMatrix4(e.matrixWorld),this.union(qn)}const r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Wn),Wn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(er),tr.subVectors(this.max,er),Xn.subVectors(e.a,er),Yn.subVectors(e.b,er),Kn.subVectors(e.c,er),Zn.subVectors(Yn,Xn),Qn.subVectors(Kn,Yn),Jn.subVectors(Xn,Kn);let t=[0,-Zn.z,Zn.y,0,-Qn.z,Qn.y,0,-Jn.z,Jn.y,Zn.z,0,-Zn.x,Qn.z,0,-Qn.x,Jn.z,0,-Jn.x,-Zn.y,Zn.x,0,-Qn.y,Qn.x,0,-Jn.y,Jn.x,0];return!!ir(t,Xn,Yn,Kn,tr)&&(t=[1,0,0,0,1,0,0,0,1],!!ir(t,Xn,Yn,Kn,tr)&&(nr.crossVectors(Zn,Qn),t=[nr.x,nr.y,nr.z],ir(t,Xn,Yn,Kn,tr)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Wn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Wn).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(jn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),jn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),jn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),jn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),jn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),jn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),jn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),jn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(jn)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const jn=[new Vn,new Vn,new Vn,new Vn,new Vn,new Vn,new Vn,new Vn],Wn=new Vn,qn=new Gn,Xn=new Vn,Yn=new Vn,Kn=new Vn,Zn=new Vn,Qn=new Vn,Jn=new Vn,er=new Vn,tr=new Vn,nr=new Vn,rr=new Vn;function ir(e,t,n,r,i){for(let a=0,s=e.length-3;a<=s;a+=3){rr.fromArray(e,a);const s=i.x*Math.abs(rr.x)+i.y*Math.abs(rr.y)+i.z*Math.abs(rr.z),o=t.dot(rr),l=n.dot(rr),c=r.dot(rr);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}const ar=new Gn,sr=new Vn,or=new Vn;class lr{constructor(e=new Vn,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):ar.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;sr.subVectors(e,this.center);const t=sr.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(sr,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(or.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(sr.copy(e.center).add(or)),this.expandByPoint(sr.copy(e.center).sub(or))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const cr=new Vn,ur=new Vn,dr=new Vn,hr=new Vn,fr=new Vn,pr=new Vn,mr=new Vn;class gr{constructor(e=new Vn,t=new Vn(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,cr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=cr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(cr.copy(this.origin).addScaledVector(this.direction,t),cr.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){ur.copy(e).add(t).multiplyScalar(.5),dr.copy(t).sub(e).normalize(),hr.copy(this.origin).sub(ur);const i=.5*e.distanceTo(t),a=-this.direction.dot(dr),s=hr.dot(this.direction),o=-hr.dot(dr),l=hr.lengthSq(),c=Math.abs(1-a*a);let u,d,h,f;if(c>0)if(u=a*o-s,d=a*s-o,f=i*c,u>=0)if(d>=-f)if(d<=f){const e=1/c;u*=e,d*=e,h=u*(u+a*d+2*s)+d*(a*u+d+2*o)+l}else d=i,u=Math.max(0,-(a*d+s)),h=-u*u+d*(d+2*o)+l;else d=-i,u=Math.max(0,-(a*d+s)),h=-u*u+d*(d+2*o)+l;else d<=-f?(u=Math.max(0,-(-a*i+s)),d=u>0?-i:Math.min(Math.max(-i,-o),i),h=-u*u+d*(d+2*o)+l):d<=f?(u=0,d=Math.min(Math.max(-i,-o),i),h=d*(d+2*o)+l):(u=Math.max(0,-(a*i+s)),d=u>0?i:Math.min(Math.max(-i,-o),i),h=-u*u+d*(d+2*o)+l);else d=a>0?-i:i,u=Math.max(0,-(a*d+s)),h=-u*u+d*(d+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(ur).addScaledVector(dr,d),h}intersectSphere(e,t){cr.subVectors(e.center,this.origin);const n=cr.dot(this.direction),r=cr.dot(cr)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),s=n-a,o=n+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,s,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),c>=0?(i=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(i=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),n>a||i>r?null:((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),u>=0?(s=(e.min.z-d.z)*u,o=(e.max.z-d.z)*u):(s=(e.max.z-d.z)*u,o=(e.min.z-d.z)*u),n>o||s>r?null:((s>n||n!=n)&&(n=s),(o<r||r!=r)&&(r=o),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,cr)}intersectTriangle(e,t,n,r,i){fr.subVectors(t,e),pr.subVectors(n,e),mr.crossVectors(fr,pr);let a,s=this.direction.dot(mr);if(s>0){if(r)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}hr.subVectors(this.origin,e);const o=a*this.direction.dot(pr.crossVectors(hr,pr));if(o<0)return null;const l=a*this.direction.dot(fr.cross(hr));if(l<0)return null;if(o+l>s)return null;const c=-a*hr.dot(mr);return c<0?null:this.at(c/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class _r{constructor(e,t,n,r,i,a,s,o,l,c,u,d,h,f,p,m){_r.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,s,o,l,c,u,d,h,f,p,m)}set(e,t,n,r,i,a,s,o,l,c,u,d,h,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new _r).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/yr.setFromMatrixColumn(e,0).length(),i=1/yr.setFromMatrixColumn(e,1).length(),a=1/yr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),s=Math.sin(n),o=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=a*c,n=a*u,r=s*c,i=s*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-s*o,t[2]=i-e*l,t[6]=r+n*l,t[10]=a*o}else if("YXZ"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=a*o}else if("ZXY"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e-i*s,t[4]=-a*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=a*c,t[9]=i-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){const e=a*c,n=a*u,r=s*c,i=s*u;t[0]=o*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=o*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){const e=a*o,n=a*l,r=s*o,i=s*l;t[0]=o*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=a*o,n=a*l,r=s*o,i=s*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=a*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(br,e,xr)}lookAt(e,t,n){const r=this.elements;return Ar.subVectors(e,t),0===Ar.lengthSq()&&(Ar.z=1),Ar.normalize(),wr.crossVectors(n,Ar),0===wr.lengthSq()&&(1===Math.abs(n.z)?Ar.x+=1e-4:Ar.z+=1e-4,Ar.normalize(),wr.crossVectors(n,Ar)),wr.normalize(),Sr.crossVectors(Ar,wr),r[0]=wr.x,r[4]=Sr.x,r[8]=Ar.x,r[1]=wr.y,r[5]=Sr.y,r[9]=Ar.y,r[2]=wr.z,r[6]=Sr.z,r[10]=Ar.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[4],o=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],g=n[14],_=n[3],y=n[7],v=n[11],b=n[15],x=r[0],w=r[4],S=r[8],A=r[12],M=r[1],E=r[5],C=r[9],T=r[13],P=r[2],I=r[6],R=r[10],k=r[14],D=r[3],L=r[7],N=r[11],O=r[15];return i[0]=a*x+s*M+o*P+l*D,i[4]=a*w+s*E+o*I+l*L,i[8]=a*S+s*C+o*R+l*N,i[12]=a*A+s*T+o*k+l*O,i[1]=c*x+u*M+d*P+h*D,i[5]=c*w+u*E+d*I+h*L,i[9]=c*S+u*C+d*R+h*N,i[13]=c*A+u*T+d*k+h*O,i[2]=f*x+p*M+m*P+g*D,i[6]=f*w+p*E+m*I+g*L,i[10]=f*S+p*C+m*R+g*N,i[14]=f*A+p*T+m*k+g*O,i[3]=_*x+y*M+v*P+b*D,i[7]=_*w+y*E+v*I+b*L,i[11]=_*S+y*C+v*R+b*N,i[15]=_*A+y*T+v*k+b*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+i*o*u-r*l*u-i*s*d+n*l*d+r*s*h-n*o*h)+e[7]*(+t*o*h-t*l*d+i*a*d-r*a*h+r*l*c-i*o*c)+e[11]*(+t*l*u-t*s*h-i*a*u+n*a*h+i*s*c-n*l*c)+e[15]*(-r*s*c-t*o*u+t*s*d+r*a*u-n*a*d+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],f=e[12],p=e[13],m=e[14],g=e[15],_=u*m*l-p*d*l+p*o*h-s*m*h-u*o*g+s*d*g,y=f*d*l-c*m*l-f*o*h+a*m*h+c*o*g-a*d*g,v=c*p*l-f*u*l+f*s*h-a*p*h-c*s*g+a*u*g,b=f*u*o-c*p*o-f*s*d+a*p*d+c*s*m-a*u*m,x=t*_+n*y+r*v+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return e[0]=_*w,e[1]=(p*d*i-u*m*i-p*r*h+n*m*h+u*r*g-n*d*g)*w,e[2]=(s*m*i-p*o*i+p*r*l-n*m*l-s*r*g+n*o*g)*w,e[3]=(u*o*i-s*d*i-u*r*l+n*d*l+s*r*h-n*o*h)*w,e[4]=y*w,e[5]=(c*m*i-f*d*i+f*r*h-t*m*h-c*r*g+t*d*g)*w,e[6]=(f*o*i-a*m*i-f*r*l+t*m*l+a*r*g-t*o*g)*w,e[7]=(a*d*i-c*o*i+c*r*l-t*d*l-a*r*h+t*o*h)*w,e[8]=v*w,e[9]=(f*u*i-c*p*i-f*n*h+t*p*h+c*n*g-t*u*g)*w,e[10]=(a*p*i-f*s*i+f*n*l-t*p*l-a*n*g+t*s*g)*w,e[11]=(c*s*i-a*u*i-c*n*l+t*u*l+a*n*h-t*s*h)*w,e[12]=b*w,e[13]=(c*p*r-f*u*r+f*n*d-t*p*d-c*n*m+t*u*m)*w,e[14]=(f*s*r-a*p*r-f*n*o+t*p*o+a*n*m-t*s*m)*w,e[15]=(a*u*r-c*s*r+c*n*o-t*u*o-a*n*d+t*s*d)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,s=e.y,o=e.z,l=i*a,c=i*s;return this.set(l*a+n,l*s-r*o,l*o+r*s,0,l*s+r*o,c*s+n,c*o-r*a,0,l*o-r*s,c*o+r*a,i*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,a=t._y,s=t._z,o=t._w,l=i+i,c=a+a,u=s+s,d=i*l,h=i*c,f=i*u,p=a*c,m=a*u,g=s*u,_=o*l,y=o*c,v=o*u,b=n.x,x=n.y,w=n.z;return r[0]=(1-(p+g))*b,r[1]=(h+v)*b,r[2]=(f-y)*b,r[3]=0,r[4]=(h-v)*x,r[5]=(1-(d+g))*x,r[6]=(m+_)*x,r[7]=0,r[8]=(f+y)*w,r[9]=(m-_)*w,r[10]=(1-(d+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=yr.set(r[0],r[1],r[2]).length();const a=yr.set(r[4],r[5],r[6]).length(),s=yr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],vr.copy(this);const o=1/i,l=1/a,c=1/s;return vr.elements[0]*=o,vr.elements[1]*=o,vr.elements[2]*=o,vr.elements[4]*=l,vr.elements[5]*=l,vr.elements[6]*=l,vr.elements[8]*=c,vr.elements[9]*=c,vr.elements[10]*=c,t.setFromRotationMatrix(vr),n.x=i,n.y=a,n.z=s,this}makePerspective(e,t,n,r,i,a,s=2e3){const o=this.elements,l=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),d=(n+r)/(n-r);let h,f;if(s===Jt)h=-(a+i)/(a-i),f=-2*a*i/(a-i);else{if(s!==en)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);h=-a/(a-i),f=-a*i/(a-i)}return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=d,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,r,i,a,s=2e3){const o=this.elements,l=1/(t-e),c=1/(n-r),u=1/(a-i),d=(t+e)*l,h=(n+r)*c;let f,p;if(s===Jt)f=(a+i)*u,p=-2*u;else{if(s!==en)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);f=i*u,p=-1*u}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-d,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=p,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const yr=new Vn,vr=new _r,br=new Vn(0,0,0),xr=new Vn(1,1,1),wr=new Vn,Sr=new Vn,Ar=new Vn,Mr=new _r,Er=new zn;class Cr{constructor(e=0,t=0,n=0,r=Cr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],a=r[4],s=r[8],o=r[1],l=r[5],c=r[9],u=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(on(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-on(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(on(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-on(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(on(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(s,h));break;case"XZY":this._z=Math.asin(-on(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Mr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Mr,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Er.setFromEuler(this),this.setFromQuaternion(Er,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Cr.DEFAULT_ORDER="XYZ";class Tr{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let Pr=0;const Ir=new Vn,Rr=new zn,kr=new _r,Dr=new Vn,Lr=new Vn,Nr=new Vn,Or=new zn,Fr=new Vn(1,0,0),Ur=new Vn(0,1,0),Br=new Vn(0,0,1),zr={type:"added"},Vr={type:"removed"};class Hr extends tn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Pr++}),this.uuid=sn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hr.DEFAULT_UP.clone();const e=new Vn,t=new Cr,n=new zn,r=new Vn(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new _r},normalMatrix:{value:new pn}}),this.matrix=new _r,this.matrixWorld=new _r,this.matrixAutoUpdate=Hr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Tr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Rr.setFromAxisAngle(e,t),this.quaternion.multiply(Rr),this}rotateOnWorldAxis(e,t){return Rr.setFromAxisAngle(e,t),this.quaternion.premultiply(Rr),this}rotateX(e){return this.rotateOnAxis(Fr,e)}rotateY(e){return this.rotateOnAxis(Ur,e)}rotateZ(e){return this.rotateOnAxis(Br,e)}translateOnAxis(e,t){return Ir.copy(e).applyQuaternion(this.quaternion),this.position.add(Ir.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Fr,e)}translateY(e){return this.translateOnAxis(Ur,e)}translateZ(e){return this.translateOnAxis(Br,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(kr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Dr.copy(e):Dr.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Lr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?kr.lookAt(Lr,Dr,this.up):kr.lookAt(Dr,Lr,this.up),this.quaternion.setFromRotationMatrix(kr),r&&(kr.extractRotation(r.matrixWorld),Rr.setFromRotationMatrix(kr),this.quaternion.premultiply(Rr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(zr)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Vr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),kr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),kr.multiply(e.parent.matrixWorld)),e.applyMatrix4(kr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let r=0,i=this.children.length;r<i;r++){const i=this.children[r].getObjectsByProperty(e,t);i.length>0&&(n=n.concat(i))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Lr,e,Nr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Lr,Or,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=a(e.geometries),r=a(e.materials),i=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),c=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Hr.DEFAULT_UP=new Vn(0,1,0),Hr.DEFAULT_MATRIX_AUTO_UPDATE=!0,Hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const $r=new Vn,Gr=new Vn,jr=new Vn,Wr=new Vn,qr=new Vn,Xr=new Vn,Yr=new Vn,Kr=new Vn,Zr=new Vn,Qr=new Vn;let Jr=!1;class ei{constructor(e=new Vn,t=new Vn,n=new Vn){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),$r.subVectors(e,t),r.cross($r);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){$r.subVectors(r,t),Gr.subVectors(n,t),jr.subVectors(e,t);const a=$r.dot($r),s=$r.dot(Gr),o=$r.dot(jr),l=Gr.dot(Gr),c=Gr.dot(jr),u=a*l-s*s;if(0===u)return i.set(-2,-1,-1);const d=1/u,h=(l*o-s*c)*d,f=(a*c-s*o)*d;return i.set(1-h-f,f,h)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Wr),Wr.x>=0&&Wr.y>=0&&Wr.x+Wr.y<=1}static getUV(e,t,n,r,i,a,s,o){return!1===Jr&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Jr=!0),this.getInterpolation(e,t,n,r,i,a,s,o)}static getInterpolation(e,t,n,r,i,a,s,o){return this.getBarycoord(e,t,n,r,Wr),o.setScalar(0),o.addScaledVector(i,Wr.x),o.addScaledVector(a,Wr.y),o.addScaledVector(s,Wr.z),o}static isFrontFacing(e,t,n,r){return $r.subVectors(n,t),Gr.subVectors(e,t),$r.cross(Gr).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return $r.subVectors(this.c,this.b),Gr.subVectors(this.a,this.b),.5*$r.cross(Gr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ei.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ei.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return!1===Jr&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Jr=!0),ei.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}getInterpolation(e,t,n,r,i){return ei.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return ei.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ei.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let a,s;qr.subVectors(r,n),Xr.subVectors(i,n),Kr.subVectors(e,n);const o=qr.dot(Kr),l=Xr.dot(Kr);if(o<=0&&l<=0)return t.copy(n);Zr.subVectors(e,r);const c=qr.dot(Zr),u=Xr.dot(Zr);if(c>=0&&u<=c)return t.copy(r);const d=o*u-c*l;if(d<=0&&o>=0&&c<=0)return a=o/(o-c),t.copy(n).addScaledVector(qr,a);Qr.subVectors(e,i);const h=qr.dot(Qr),f=Xr.dot(Qr);if(f>=0&&h<=f)return t.copy(i);const p=h*l-o*f;if(p<=0&&l>=0&&f<=0)return s=l/(l-f),t.copy(n).addScaledVector(Xr,s);const m=c*f-h*u;if(m<=0&&u-c>=0&&h-f>=0)return Yr.subVectors(i,r),s=(u-c)/(u-c+(h-f)),t.copy(r).addScaledVector(Yr,s);const g=1/(m+p+d);return a=p*g,s=d*g,t.copy(n).addScaledVector(qr,a).addScaledVector(Xr,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const ti={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ni={h:0,s:0,l:0},ri={h:0,s:0,l:0};function ii(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class ai{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=kt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Mn.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=Mn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Mn.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=Mn.workingColorSpace){if(e=(e%(i=1)+i)%i,t=on(t,0,1),n=on(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=ii(i,r,e+1/3),this.g=ii(i,r,e),this.b=ii(i,r,e-1/3)}var i;return Mn.toWorkingColorSpace(this,r),this}setStyle(e,t=kt){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=r[1],s=r[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=kt){const n=ti[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=En(e.r),this.g=En(e.g),this.b=En(e.b),this}copyLinearToSRGB(e){return this.r=Cn(e.r),this.g=Cn(e.g),this.b=Cn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=kt){return Mn.fromWorkingColorSpace(si.copy(this),e),65536*Math.round(on(255*si.r,0,255))+256*Math.round(on(255*si.g,0,255))+Math.round(on(255*si.b,0,255))}getHexString(e=kt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Mn.workingColorSpace){Mn.fromWorkingColorSpace(si.copy(this),t);const n=si.r,r=si.g,i=si.b,a=Math.max(n,r,i),s=Math.min(n,r,i);let o,l;const c=(s+a)/2;if(s===a)o=0,l=0;else{const e=a-s;switch(l=c<=.5?e/(a+s):e/(2-a-s),a){case n:o=(r-i)/e+(r<i?6:0);break;case r:o=(i-n)/e+2;break;case i:o=(n-r)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=Mn.workingColorSpace){return Mn.fromWorkingColorSpace(si.copy(this),t),e.r=si.r,e.g=si.g,e.b=si.b,e}getStyle(e=kt){Mn.fromWorkingColorSpace(si.copy(this),e);const t=si.r,n=si.g,r=si.b;return e!==kt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(ni),this.setHSL(ni.h+e,ni.s+t,ni.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ni),e.getHSL(ri);const n=ln(ni.h,ri.h,t),r=ln(ni.s,ri.s,t),i=ln(ni.l,ri.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const si=new ai;ai.NAMES=ti;let oi=0;class li extends tn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:oi++}),this.uuid=sn(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=Te,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ai(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zt,this.stencilZFail=zt,this.stencilZPass=zt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==Te&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==zt&&(n.stencilFail=this.stencilFail),this.stencilZFail!==zt&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==zt&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class ci extends li{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ai(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=We,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ui=new Vn,di=new fn;class hi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Yt,this.updateRange={offset:0,count:-1},this.gpuType=gt,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)di.fromBufferAttribute(this,t),di.applyMatrix3(e),this.setXY(t,di.x,di.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)ui.fromBufferAttribute(this,t),ui.applyMatrix3(e),this.setXYZ(t,ui.x,ui.y,ui.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ui.fromBufferAttribute(this,t),ui.applyMatrix4(e),this.setXYZ(t,ui.x,ui.y,ui.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ui.fromBufferAttribute(this,t),ui.applyNormalMatrix(e),this.setXYZ(t,ui.x,ui.y,ui.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ui.fromBufferAttribute(this,t),ui.transformDirection(e),this.setXYZ(t,ui.x,ui.y,ui.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=dn(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=hn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=dn(t,this.array)),t}setX(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=dn(t,this.array)),t}setY(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=dn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=dn(t,this.array)),t}setW(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array),r=hn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array),r=hn(r,this.array),i=hn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Yt&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class fi extends hi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class pi extends hi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class mi extends hi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let gi=0;const _i=new _r,yi=new Hr,vi=new Vn,bi=new Gn,xi=new Gn,wi=new Vn;class Si extends tn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gi++}),this.uuid=sn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(gn(e)?pi:fi)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new pn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return _i.makeRotationFromQuaternion(e),this.applyMatrix4(_i),this}rotateX(e){return _i.makeRotationX(e),this.applyMatrix4(_i),this}rotateY(e){return _i.makeRotationY(e),this.applyMatrix4(_i),this}rotateZ(e){return _i.makeRotationZ(e),this.applyMatrix4(_i),this}translate(e,t,n){return _i.makeTranslation(e,t,n),this.applyMatrix4(_i),this}scale(e,t,n){return _i.makeScale(e,t,n),this.applyMatrix4(_i),this}lookAt(e){return yi.lookAt(e),yi.updateMatrix(),this.applyMatrix4(yi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vi).negate(),this.translate(vi.x,vi.y,vi.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new mi(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Gn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vn(-1/0,-1/0,-1/0),new Vn(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];bi.setFromBufferAttribute(n),this.morphTargetsRelative?(wi.addVectors(this.boundingBox.min,bi.min),this.boundingBox.expandByPoint(wi),wi.addVectors(this.boundingBox.max,bi.max),this.boundingBox.expandByPoint(wi)):(this.boundingBox.expandByPoint(bi.min),this.boundingBox.expandByPoint(bi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new lr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vn,1/0);if(e){const n=this.boundingSphere.center;if(bi.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];xi.setFromBufferAttribute(n),this.morphTargetsRelative?(wi.addVectors(bi.min,xi.min),bi.expandByPoint(wi),wi.addVectors(bi.max,xi.max),bi.expandByPoint(wi)):(bi.expandByPoint(xi.min),bi.expandByPoint(xi.max))}bi.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)wi.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(wi));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],s=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)wi.fromBufferAttribute(a,t),s&&(vi.fromBufferAttribute(e,t),wi.add(vi)),r=Math.max(r,n.distanceToSquared(wi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,a=t.uv.array,s=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new hi(new Float32Array(4*s),4));const o=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<s;e++)l[e]=new Vn,c[e]=new Vn;const u=new Vn,d=new Vn,h=new Vn,f=new fn,p=new fn,m=new fn,g=new Vn,_=new Vn;function y(e,t,n){u.fromArray(r,3*e),d.fromArray(r,3*t),h.fromArray(r,3*n),f.fromArray(a,2*e),p.fromArray(a,2*t),m.fromArray(a,2*n),d.sub(u),h.sub(u),p.sub(f),m.sub(f);const i=1/(p.x*m.y-m.x*p.y);isFinite(i)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(h,-p.y).multiplyScalar(i),_.copy(h).multiplyScalar(p.x).addScaledVector(d,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(_),c[t].add(_),c[n].add(_))}let v=this.groups;0===v.length&&(v=[{start:0,count:n.length}]);for(let e=0,t=v.length;e<t;++e){const t=v[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)y(n[e+0],n[e+1],n[e+2])}const b=new Vn,x=new Vn,w=new Vn,S=new Vn;function A(e){w.fromArray(i,3*e),S.copy(w);const t=l[e];b.copy(t),b.sub(w.multiplyScalar(w.dot(t))).normalize(),x.crossVectors(S,t);const n=x.dot(c[e])<0?-1:1;o[4*e]=b.x,o[4*e+1]=b.y,o[4*e+2]=b.z,o[4*e+3]=n}for(let e=0,t=v.length;e<t;++e){const t=v[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)A(n[e+0]),A(n[e+1]),A(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new hi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new Vn,i=new Vn,a=new Vn,s=new Vn,o=new Vn,l=new Vn,c=new Vn,u=new Vn;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),f=e.getX(d+1),p=e.getX(d+2);r.fromBufferAttribute(t,h),i.fromBufferAttribute(t,f),a.fromBufferAttribute(t,p),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),s.fromBufferAttribute(n,h),o.fromBufferAttribute(n,f),l.fromBufferAttribute(n,p),s.add(c),o.add(c),l.add(c),n.setXYZ(h,s.x,s.y,s.z),n.setXYZ(f,o.x,o.y,o.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)wi.fromBufferAttribute(e,t),wi.normalize(),e.setXYZ(t,wi.x,wi.y,wi.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let s=0,o=0;for(let i=0,l=t.length;i<l;i++){s=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)a[o++]=n[s++]}return new hi(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Si,n=this.index.array,r=this.attributes;for(const i in r){const a=e(r[i],n);t.setAttribute(i,a)}const i=this.morphAttributes;for(const r in i){const a=[],s=i[r];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);a.push(r)}t.morphAttributes[r]=a}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let e=0,n=a.length;e<n;e++){const n=a[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],a=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];a.push(r.toJSON(e.data))}a.length>0&&(r[t]=a,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let e=0,t=a.length;e<t;e++){const t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ai=new _r,Mi=new gr,Ei=new lr,Ci=new Vn,Ti=new Vn,Pi=new Vn,Ii=new Vn,Ri=new Vn,ki=new Vn,Di=new fn,Li=new fn,Ni=new fn,Oi=new Vn,Fi=new Vn,Ui=new Vn,Bi=new Vn,zi=new Vn;class Vi extends Hr{constructor(e=new Si,t=new ci){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const s=this.morphTargetInfluences;if(i&&s){ki.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=s[n],o=i[n];0!==r&&(Ri.fromBufferAttribute(o,e),a?ki.addScaledVector(Ri,r):ki.addScaledVector(Ri.sub(t),r))}t.add(ki)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Ei.copy(n.boundingSphere),Ei.applyMatrix4(i),Mi.copy(e.ray).recast(e.near),!1===Ei.containsPoint(Mi.origin)){if(null===Mi.intersectSphere(Ei,Ci))return;if(Mi.origin.distanceToSquared(Ci)>(e.far-e.near)**2)return}Ai.copy(i).invert(),Mi.copy(e.ray).applyMatrix4(Ai),null!==n.boundingBox&&!1===Mi.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Mi)}}_computeIntersections(e,t,n){let r;const i=this.geometry,a=this.material,s=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,d=i.groups,h=i.drawRange;if(null!==s)if(Array.isArray(a))for(let i=0,o=d.length;i<o;i++){const o=d[i],f=a[o.materialIndex];for(let i=Math.max(o.start,h.start),a=Math.min(s.count,Math.min(o.start+o.count,h.start+h.count));i<a;i+=3)r=Hi(this,f,e,n,l,c,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,t.push(r))}else for(let i=Math.max(0,h.start),o=Math.min(s.count,h.start+h.count);i<o;i+=3)r=Hi(this,a,e,n,l,c,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r));else if(void 0!==o)if(Array.isArray(a))for(let i=0,s=d.length;i<s;i++){const s=d[i],f=a[s.materialIndex];for(let i=Math.max(s.start,h.start),a=Math.min(o.count,Math.min(s.start+s.count,h.start+h.count));i<a;i+=3)r=Hi(this,f,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=s.materialIndex,t.push(r))}else for(let i=Math.max(0,h.start),s=Math.min(o.count,h.start+h.count);i<s;i+=3)r=Hi(this,a,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}function Hi(e,t,n,r,i,a,s,o,l,c){e.getVertexPosition(o,Ti),e.getVertexPosition(l,Pi),e.getVertexPosition(c,Ii);const u=function(e,t,n,r,i,a,s,o){let l;if(l=1===t.side?r.intersectTriangle(s,a,i,!0,o):r.intersectTriangle(i,a,s,0===t.side,o),null===l)return null;zi.copy(o),zi.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(zi);return c<n.near||c>n.far?null:{distance:c,point:zi.clone(),object:e}}(e,t,n,r,Ti,Pi,Ii,Bi);if(u){i&&(Di.fromBufferAttribute(i,o),Li.fromBufferAttribute(i,l),Ni.fromBufferAttribute(i,c),u.uv=ei.getInterpolation(Bi,Ti,Pi,Ii,Di,Li,Ni,new fn)),a&&(Di.fromBufferAttribute(a,o),Li.fromBufferAttribute(a,l),Ni.fromBufferAttribute(a,c),u.uv1=ei.getInterpolation(Bi,Ti,Pi,Ii,Di,Li,Ni,new fn),u.uv2=u.uv1),s&&(Oi.fromBufferAttribute(s,o),Fi.fromBufferAttribute(s,l),Ui.fromBufferAttribute(s,c),u.normal=ei.getInterpolation(Bi,Ti,Pi,Ii,Oi,Fi,Ui,new Vn),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const e={a:o,b:l,c,normal:new Vn,materialIndex:0};ei.getNormal(Ti,Pi,Ii,e.normal),u.face=e}return u}class $i extends Si{constructor(e=1,t=1,n=1,r=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const s=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const o=[],l=[],c=[],u=[];let d=0,h=0;function f(e,t,n,r,i,a,f,p,m,g,_){const y=a/m,v=f/g,b=a/2,x=f/2,w=p/2,S=m+1,A=g+1;let M=0,E=0;const C=new Vn;for(let a=0;a<A;a++){const s=a*v-x;for(let o=0;o<S;o++){const d=o*y-b;C[e]=d*r,C[t]=s*i,C[n]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=p>0?1:-1,c.push(C.x,C.y,C.z),u.push(o/m),u.push(1-a/g),M+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=d+t+S*e,r=d+t+S*(e+1),i=d+(t+1)+S*(e+1),a=d+(t+1)+S*e;o.push(n,r,a),o.push(r,i,a),E+=6}s.addGroup(h,E,_),h+=E,d+=M}f("z","y","x",-1,-1,n,t,e,a,i,0),f("z","y","x",1,-1,n,t,-e,a,i,1),f("x","z","y",1,1,e,n,t,r,a,2),f("x","z","y",1,-1,e,n,-t,r,a,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(o),this.setAttribute("position",new mi(l,3)),this.setAttribute("normal",new mi(c,3)),this.setAttribute("uv",new mi(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $i(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Gi(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function ji(e){const t={};for(let n=0;n<e.length;n++){const r=Gi(e[n]);for(const e in r)t[e]=r[e]}return t}function Wi(e){return null===e.getRenderTarget()?e.outputColorSpace:Mn.workingColorSpace}const qi={clone:Gi,merge:ji};class Xi extends li{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Gi(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Yi extends Hr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new _r,this.projectionMatrix=new _r,this.projectionMatrixInverse=new _r,this.coordinateSystem=Jt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Ki extends Yi{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*an*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*rn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*an*Math.atan(Math.tan(.5*rn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*rn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/s,r*=a.width/e,n*=a.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Zi=-90;class Qi extends Hr{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ki(Zi,1,e,t);r.layers=this.layers,this.add(r);const i=new Ki(Zi,1,e,t);i.layers=this.layers,this.add(i);const a=new Ki(Zi,1,e,t);a.layers=this.layers,this.add(a);const s=new Ki(Zi,1,e,t);s.layers=this.layers,this.add(s);const o=new Ki(Zi,1,e,t);o.layers=this.layers,this.add(o);const l=new Ki(Zi,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,a,s,o]=t;for(const e of t)this.remove(e);if(e===Jt)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==en)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,a,s,o,l,c]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,s),e.setRenderTarget(n,3,r),e.render(t,o),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,d,h),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class Ji extends Ln{constructor(e,t,n,r,i,a,s,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:tt,n,r,i,a,s,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ea extends Fn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];void 0!==t.encoding&&(bn("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===It?kt:Rt),this.texture=new Ji(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ut}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new $i(5,5,5),s=new Xi({name:"CubemapFromEquirect",uniforms:Gi(n),vertexShader:r,fragmentShader:i,side:1,blending:0});s.uniforms.tEquirect.value=t;const o=new Vi(a,s),l=t.minFilter;return t.minFilter===ht&&(t.minFilter=ut),new Qi(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}const ta=new Vn,na=new Vn,ra=new pn;class ia{constructor(e=new Vn(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=ta.subVectors(n,t).cross(na.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(ta),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||ra.getNormalMatrix(e),r=this.coplanarPoint(ta).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const aa=new lr,sa=new Vn;class oa{constructor(e=new ia,t=new ia,n=new ia,r=new ia,i=new ia,a=new ia){this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,r=e.elements,i=r[0],a=r[1],s=r[2],o=r[3],l=r[4],c=r[5],u=r[6],d=r[7],h=r[8],f=r[9],p=r[10],m=r[11],g=r[12],_=r[13],y=r[14],v=r[15];if(n[0].setComponents(o-i,d-l,m-h,v-g).normalize(),n[1].setComponents(o+i,d+l,m+h,v+g).normalize(),n[2].setComponents(o+a,d+c,m+f,v+_).normalize(),n[3].setComponents(o-a,d-c,m-f,v-_).normalize(),n[4].setComponents(o-s,d-u,m-p,v-y).normalize(),t===Jt)n[5].setComponents(o+s,d+u,m+p,v+y).normalize();else{if(t!==en)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,p,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),aa.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),aa.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(aa)}intersectsSprite(e){return aa.center.set(0,0,0),aa.radius=.7071067811865476,aa.applyMatrix4(e.matrixWorld),this.intersectsSphere(aa)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(sa.x=r.normal.x>0?e.max.x:e.min.x,sa.y=r.normal.y>0?e.max.y:e.min.y,sa.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(sa)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function la(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function ca(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=r.get(t);void 0===a?r.set(t,function(t,r){const i=t.array,a=t.usage,s=e.createBuffer();let o;if(e.bindBuffer(r,s),e.bufferData(r,i,a),t.onUploadCallback(),i instanceof Float32Array)o=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=e.HALF_FLOAT}else o=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=e.SHORT;else if(i instanceof Uint32Array)o=e.UNSIGNED_INT;else if(i instanceof Int32Array)o=e.INT;else if(i instanceof Int8Array)o=e.BYTE;else if(i instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=e.UNSIGNED_BYTE}return{buffer:s,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):a.version<t.version&&(function(t,r,i){const a=r.array,s=r.updateRange;e.bindBuffer(i,t),-1===s.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):e.bufferSubData(i,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1),r.onUploadCallback()}(a.buffer,t,i),a.version=t.version)}}}class ua extends Si{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,s=Math.floor(n),o=Math.floor(r),l=s+1,c=o+1,u=e/s,d=t/o,h=[],f=[],p=[],m=[];for(let e=0;e<c;e++){const t=e*d-a;for(let n=0;n<l;n++){const r=n*u-i;f.push(r,-t,0),p.push(0,0,1),m.push(n/s),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),a=t+1+l*e;h.push(n,r,a),h.push(r,i,a)}this.setIndex(h),this.setAttribute("position",new mi(f,3)),this.setAttribute("normal",new mi(p,3)),this.setAttribute("uv",new mi(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ua(e.width,e.height,e.widthSegments,e.heightSegments)}}const da={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},ha={common:{diffuse:{value:new ai(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new pn},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new pn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new pn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new pn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new pn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new pn},normalScale:{value:new fn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new pn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new pn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new pn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new pn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ai(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ai(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0},uvTransform:{value:new pn}},sprite:{diffuse:{value:new ai(16777215)},opacity:{value:1},center:{value:new fn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new pn},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0}}},fa={basic:{uniforms:ji([ha.common,ha.specularmap,ha.envmap,ha.aomap,ha.lightmap,ha.fog]),vertexShader:da.meshbasic_vert,fragmentShader:da.meshbasic_frag},lambert:{uniforms:ji([ha.common,ha.specularmap,ha.envmap,ha.aomap,ha.lightmap,ha.emissivemap,ha.bumpmap,ha.normalmap,ha.displacementmap,ha.fog,ha.lights,{emissive:{value:new ai(0)}}]),vertexShader:da.meshlambert_vert,fragmentShader:da.meshlambert_frag},phong:{uniforms:ji([ha.common,ha.specularmap,ha.envmap,ha.aomap,ha.lightmap,ha.emissivemap,ha.bumpmap,ha.normalmap,ha.displacementmap,ha.fog,ha.lights,{emissive:{value:new ai(0)},specular:{value:new ai(1118481)},shininess:{value:30}}]),vertexShader:da.meshphong_vert,fragmentShader:da.meshphong_frag},standard:{uniforms:ji([ha.common,ha.envmap,ha.aomap,ha.lightmap,ha.emissivemap,ha.bumpmap,ha.normalmap,ha.displacementmap,ha.roughnessmap,ha.metalnessmap,ha.fog,ha.lights,{emissive:{value:new ai(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:da.meshphysical_vert,fragmentShader:da.meshphysical_frag},toon:{uniforms:ji([ha.common,ha.aomap,ha.lightmap,ha.emissivemap,ha.bumpmap,ha.normalmap,ha.displacementmap,ha.gradientmap,ha.fog,ha.lights,{emissive:{value:new ai(0)}}]),vertexShader:da.meshtoon_vert,fragmentShader:da.meshtoon_frag},matcap:{uniforms:ji([ha.common,ha.bumpmap,ha.normalmap,ha.displacementmap,ha.fog,{matcap:{value:null}}]),vertexShader:da.meshmatcap_vert,fragmentShader:da.meshmatcap_frag},points:{uniforms:ji([ha.points,ha.fog]),vertexShader:da.points_vert,fragmentShader:da.points_frag},dashed:{uniforms:ji([ha.common,ha.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:da.linedashed_vert,fragmentShader:da.linedashed_frag},depth:{uniforms:ji([ha.common,ha.displacementmap]),vertexShader:da.depth_vert,fragmentShader:da.depth_frag},normal:{uniforms:ji([ha.common,ha.bumpmap,ha.normalmap,ha.displacementmap,{opacity:{value:1}}]),vertexShader:da.meshnormal_vert,fragmentShader:da.meshnormal_frag},sprite:{uniforms:ji([ha.sprite,ha.fog]),vertexShader:da.sprite_vert,fragmentShader:da.sprite_frag},background:{uniforms:{uvTransform:{value:new pn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:da.background_vert,fragmentShader:da.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:da.backgroundCube_vert,fragmentShader:da.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:da.cube_vert,fragmentShader:da.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:da.equirect_vert,fragmentShader:da.equirect_frag},distanceRGBA:{uniforms:ji([ha.common,ha.displacementmap,{referencePosition:{value:new Vn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:da.distanceRGBA_vert,fragmentShader:da.distanceRGBA_frag},shadow:{uniforms:ji([ha.lights,ha.fog,{color:{value:new ai(0)},opacity:{value:1}}]),vertexShader:da.shadow_vert,fragmentShader:da.shadow_frag}};fa.physical={uniforms:ji([fa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new pn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new pn},clearcoatNormalScale:{value:new fn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new pn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new pn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new pn},sheen:{value:0},sheenColor:{value:new ai(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new pn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new pn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new pn},transmissionSamplerSize:{value:new fn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new pn},attenuationDistance:{value:0},attenuationColor:{value:new ai(0)},specularColor:{value:new ai(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new pn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new pn},anisotropyVector:{value:new fn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new pn}}]),vertexShader:da.meshphysical_vert,fragmentShader:da.meshphysical_frag};const pa={r:0,b:0,g:0};function ma(e,t,n,r,i,a,s){const o=new ai(0);let l,c,u=!0===a?0:1,d=null,h=0,f=null;function p(t,n){t.getRGB(pa,Wi(e)),r.buffers.color.setClear(pa.r,pa.g,pa.b,n,s)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),u=t,p(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,p(o,u)},render:function(a,m){let g=!1,_=!0===m.isScene?m.background:null;_&&_.isTexture&&(_=(m.backgroundBlurriness>0?n:t).get(_)),null===_?p(o,u):_&&_.isColor&&(p(_,1),g=!0);const y=e.xr.getEnvironmentBlendMode();"additive"===y?r.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===y&&r.buffers.color.setClear(0,0,0,0,s),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===rt)?(void 0===c&&(c=new Vi(new $i(1,1,1),new Xi({name:"BackgroundCubeMaterial",uniforms:Gi(fa.backgroundCube.uniforms),vertexShader:fa.backgroundCube.vertexShader,fragmentShader:fa.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=Mn.getTransfer(_.colorSpace)!==Ft,d===_&&h===_.version&&f===e.toneMapping||(c.material.needsUpdate=!0,d=_,h=_.version,f=e.toneMapping),c.layers.enableAll(),a.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(void 0===l&&(l=new Vi(new ua(2,2),new Xi({name:"BackgroundMaterial",uniforms:Gi(fa.background.uniforms),vertexShader:fa.background.vertexShader,fragmentShader:fa.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=Mn.getTransfer(_.colorSpace)!==Ft,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),d===_&&h===_.version&&f===e.toneMapping||(l.material.needsUpdate=!0,d=_,h=_.version,f=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null))}}}function ga(e,t,n,r){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),s=r.isWebGL2||null!==a,o={},l=f(null);let c=l,u=!1;function d(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function f(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,i){const a=c.newAttributes,s=c.enabledAttributes,o=c.attributeDivisors;a[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),o[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),o[n]=i)}function _(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,r,i,a,s,o){!0===o?e.vertexAttribIPointer(t,n,r,a,s):e.vertexAttribPointer(t,n,r,i,a,s)}function v(){b(),u=!0,c!==l&&(c=l,d(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,v,b){let x=!1;if(s){const t=function(t,n,i){const s=!0===i.wireframe;let l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[s];return void 0===u&&(u=f(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[s]=u),u}(v,h,l);c!==t&&(c=t,d(c.object)),x=function(e,t,n,r){const i=c.attributes,a=t.attributes;let s=0;const o=n.getAttributes();for(const t in o)if(o[t].location>=0){const n=i[t];let r=a[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;s++}return c.attributesNum!==s||c.index!==r}(i,v,h,b),x&&function(e,t,n,r){const i={},a=t.attributes;let s=0;const o=n.getAttributes();for(const t in o)if(o[t].location>=0){let n=a[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[t]=r,s++}c.attributes=i,c.attributesNum=s,c.index=r}(i,v,h,b)}else{const e=!0===l.wireframe;c.geometry===v.id&&c.program===h.id&&c.wireframe===e||(c.geometry=v.id,c.program=h.id,c.wireframe=e,x=!0)}null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),(x||u)&&(u=!1,function(i,a,s,o){if(!1===r.isWebGL2&&(i.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=o.attributes,c=s.getAttributes(),u=a.defaultAttributeValues;for(const t in c){const a=c[t];if(a.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&i.instanceMatrix&&(s=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(s=i.instanceColor)),void 0!==s){const t=s.normalized,l=s.itemSize,c=n.get(s);if(void 0===c)continue;const u=c.buffer,d=c.type,h=c.bytesPerElement,f=!0===r.isWebGL2&&(d===e.INT||d===e.UNSIGNED_INT||1013===s.gpuType);if(s.isInterleavedBufferAttribute){const n=s.data,r=n.stride,c=s.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<a.locationSize;e++)g(a.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,d,t,r*h,(c+l/a.locationSize*e)*h,f)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)g(a.location+e,s.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,d,t,l*h,l/a.locationSize*e*h,f)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(a.location,n);break;case 3:e.vertexAttrib3fv(a.location,n);break;case 4:e.vertexAttrib4fv(a.location,n);break;default:e.vertexAttrib1fv(a.location,n)}}}}_()}(i,l,h,v),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:v,resetDefaultState:b,dispose:function(){v();for(const e in o){const t=o[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;const t=o[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(const t in o){const n=o[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)h(r[e].object),delete r[e];delete n[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:_}}function _a(e,t,n,r){const i=r.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),n.update(r,a,1)},this.renderInstances=function(r,s,o){if(0===o)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](a,r,s,o),n.update(s,a,o)}}function ya(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let s=void 0!==n.precision?n.precision:"highp";const o=i(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);const l=a||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=d>0,v=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:a?e.getParameter(e.MAX_SAMPLES):0}}function va(e){const t=this;let n=null,r=0,i=!1,a=!1;const s=new ia,o=new pn,l={value:null,needsUpdate:!1};function c(e,n,r,i){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==i||null===c){const t=r+4*a,i=n.matrixWorldInverse;o.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==a;++t,n+=4)s.copy(e[t]).applyMatrix4(i,o),s.normal.toArray(c,n),c[n+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,o,u){const d=s.clippingPlanes,h=s.clipIntersection,f=s.clipShadows,p=e.get(s);if(!i||null===d||0===d.length||a&&!f)a?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0);else{const e=a?0:r,t=4*e;let i=p.clippingState||null;l.value=i,i=c(d,o,t,u);for(let e=0;e!==t;++e)i[e]=n[e];p.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function ba(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=tt:304===t&&(e.mapping=nt),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const a=i.mapping;if(303===a||304===a){if(t.has(i))return n(t.get(i).texture,i.mapping);{const a=i.image;if(a&&a.height>0){const s=new ea(a.height/2);return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class xa extends Yi{constructor(e=-1,t=1,n=1,r=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,s=r+t,o=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,s,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const wa=[.125,.215,.35,.446,.526,.582],Sa=new xa,Aa=new ai;let Ma=null,Ea=0,Ca=0;const Ta=(1+Math.sqrt(5))/2,Pa=1/Ta,Ia=[new Vn(1,1,1),new Vn(-1,1,1),new Vn(1,1,-1),new Vn(-1,1,-1),new Vn(0,Ta,Pa),new Vn(0,Ta,-Pa),new Vn(Pa,0,Ta),new Vn(-Pa,0,Ta),new Vn(Ta,Pa,0),new Vn(-Ta,Pa,0)];class Ra{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){Ma=this._renderer.getRenderTarget(),Ea=this._renderer.getActiveCubeFace(),Ca=this._renderer.getActiveMipmapLevel(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Na(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=La(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ma,Ea,Ca),e.scissorTest=!1,Da(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===tt||e.mapping===nt?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ma=this._renderer.getRenderTarget(),Ea=this._renderer.getActiveCubeFace(),Ca=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ut,minFilter:ut,generateMipmaps:!1,type:_t,format:vt,colorSpace:Dt,depthBuffer:!1},r=ka(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ka(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+wa.length;for(let s=0;s<a;s++){const a=Math.pow(2,i);n.push(a);let o=1/a;s>e-4?o=wa[s-e+4-1]:0===s&&(o=0),r.push(o);const l=1/(a-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,f=6,p=3,m=2,g=1,_=new Float32Array(p*f*h),y=new Float32Array(m*f*h),v=new Float32Array(g*f*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];_.set(r,p*f*e),y.set(d,m*f*e);const i=[e,e,e,e,e,e];v.set(i,g*f*e)}const b=new Si;b.setAttribute("position",new hi(_,p)),b.setAttribute("uv",new hi(y,m)),b.setAttribute("faceIndex",new hi(v,g)),t.push(b),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(20),i=new Vn(0,1,0);return new Xi({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new Vi(this._lodPlanes[0],e);this._renderer.compile(t,Sa)}_sceneToCubeUV(e,t,n,r){const i=new Ki(90,1,t,n),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(Aa),o.toneMapping=Ye,o.autoClear=!1;const u=new ci({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Vi(new $i,u);let h=!1;const f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,h=!0):(u.color.copy(Aa),h=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(i.up.set(0,a[t],0),i.lookAt(s[t],0,0)):1===n?(i.up.set(0,0,a[t]),i.lookAt(0,s[t],0)):(i.up.set(0,a[t],0),i.lookAt(0,0,s[t]));const l=this._cubeSize;Da(r,n*l,t>2?l:0,l,l),o.setRenderTarget(r),h&&o.render(d,i),o.render(e,i)}d.geometry.dispose(),d.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===tt||e.mapping===nt;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Na()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=La());const i=r?this._cubemapMaterial:this._equirectMaterial,a=new Vi(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const s=this._cubeSize;Da(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(a,Sa)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=Ia[(t-1)%Ia.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,s){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Vi(this._lodPlanes[r],l),u=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,f=i/h,p=isFinite(i)?1+Math.floor(3*f):20;p>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/f,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<p&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=m,u.latitudinal.value="latitudinal"===a,s&&(u.poleAxis.value=s);const{_lodMax:_}=this;u.dTheta.value=h,u.mipInt.value=_-n;const y=this._sizeLods[r];Da(t,3*y*(r>_-4?r-_+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,Sa)}}function ka(e,t,n){const r=new Fn(e,t,n);return r.texture.mapping=rt,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Da(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function La(){return new Xi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Na(){return new Xi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Oa(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping,s=303===a||304===a,o=a===tt||a===nt;if(s||o){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=t.get(i);return null===n&&(n=new Ra(e)),r=s?n.fromEquirectangular(i,r):n.fromCubemap(i,r),t.set(i,r),r.texture}if(t.has(i))return t.get(i).texture;{const a=i.image;if(s&&a&&a.height>0||o&&a&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(a)){null===n&&(n=new Ra(e));const a=s?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,a),i.addEventListener("dispose",r),a.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Fa(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ua(e,t,n,r){const i={},a=new WeakMap;function s(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);for(const e in o.morphAttributes){const n=o.morphAttributes[e];for(let e=0,r=n.length;e<r;e++)t.remove(n[e])}o.removeEventListener("dispose",s),delete i[o.id];const l=a.get(o);l&&(t.remove(l),a.delete(o)),r.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{if(void 0===i)return;{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const o=new(gn(n)?pi:fi)(n,1);o.version=s;const l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",s),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return a.get(e)}}}function Ba(e,t,n,r){const i=r.isWebGL2;let a,s,o;this.setMode=function(e){a=e},this.setIndex=function(e){s=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(a,r,s,t*o),n.update(r,a,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,d;if(i)u=e,d="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](a,l,s,r*o,c),n.update(l,a,c)}}function za(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Va(e,t){return e[0]-t[0]}function Ha(e,t){return Math.abs(t[1])-Math.abs(e[1])}function $a(e,t,n){const r={},i=new Float32Array(8),a=new WeakMap,s=new Nn,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,c,u){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const h=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,f=void 0!==h?h.length:0;let p=a.get(c);if(void 0===p||p.count!==f){void 0!==p&&p.texture.dispose();const _=void 0!==c.morphAttributes.position,y=void 0!==c.morphAttributes.normal,v=void 0!==c.morphAttributes.color,b=c.morphAttributes.position||[],x=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let S=0;!0===_&&(S=1),!0===y&&(S=2),!0===v&&(S=3);let A=c.attributes.position.count*S,M=1;A>t.maxTextureSize&&(M=Math.ceil(A/t.maxTextureSize),A=t.maxTextureSize);const E=new Float32Array(A*M*4*f),C=new Un(E,A,M,f);C.type=gt,C.needsUpdate=!0;const T=4*S;for(let I=0;I<f;I++){const R=b[I],k=x[I],D=w[I],L=A*M*4*I;for(let N=0;N<R.count;N++){const O=N*T;!0===_&&(s.fromBufferAttribute(R,N),E[L+O+0]=s.x,E[L+O+1]=s.y,E[L+O+2]=s.z,E[L+O+3]=0),!0===y&&(s.fromBufferAttribute(k,N),E[L+O+4]=s.x,E[L+O+5]=s.y,E[L+O+6]=s.z,E[L+O+7]=0),!0===v&&(s.fromBufferAttribute(D,N),E[L+O+8]=s.x,E[L+O+9]=s.y,E[L+O+10]=s.z,E[L+O+11]=4===D.itemSize?s.w:1)}}function P(){C.dispose(),a.delete(c),c.removeEventListener("dispose",P)}p={count:f,texture:C,size:new fn(A,M)},a.set(c,p),c.addEventListener("dispose",P)}let m=0;for(let F=0;F<d.length;F++)m+=d[F];const g=c.morphTargetsRelative?1:1-m;u.getUniforms().setValue(e,"morphTargetBaseInfluence",g),u.getUniforms().setValue(e,"morphTargetInfluences",d),u.getUniforms().setValue(e,"morphTargetsTexture",p.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",p.size)}else{const U=void 0===d?0:d.length;let B=r[c.id];if(void 0===B||B.length!==U){B=[];for(let G=0;G<U;G++)B[G]=[G,0];r[c.id]=B}for(let j=0;j<U;j++){const W=B[j];W[0]=j,W[1]=d[j]}B.sort(Ha);for(let q=0;q<8;q++)q<U&&B[q][1]?(o[q][0]=B[q][0],o[q][1]=B[q][1]):(o[q][0]=Number.MAX_SAFE_INTEGER,o[q][1]=0);o.sort(Va);const z=c.morphAttributes.position,V=c.morphAttributes.normal;let H=0;for(let X=0;X<8;X++){const Y=o[X],K=Y[0],Z=Y[1];K!==Number.MAX_SAFE_INTEGER&&Z?(z&&c.getAttribute("morphTarget"+X)!==z[K]&&c.setAttribute("morphTarget"+X,z[K]),V&&c.getAttribute("morphNormal"+X)!==V[K]&&c.setAttribute("morphNormal"+X,V[K]),i[X]=Z,H+=Z):(z&&!0===c.hasAttribute("morphTarget"+X)&&c.deleteAttribute("morphTarget"+X),V&&!0===c.hasAttribute("morphNormal"+X)&&c.deleteAttribute("morphNormal"+X),i[X]=0)}const $=c.morphTargetsRelative?1:1-H;u.getUniforms().setValue(e,"morphTargetBaseInfluence",$),u.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function Ga(e,t,n,r){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const o=r.render.frame,l=s.geometry,c=t.get(s,l);if(i.get(c)!==o&&(t.update(c),i.set(c,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),i.get(s)!==o&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),i.set(s,o))),s.isSkinnedMesh){const e=s.skeleton;i.get(e)!==o&&(e.update(),i.set(e,o))}return c},dispose:function(){i=new WeakMap}}}const ja=new Ln,Wa=new Un,qa=new Bn,Xa=new Ji,Ya=[],Ka=[],Za=new Float32Array(16),Qa=new Float32Array(9),Ja=new Float32Array(4);function es(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=Ya[i];if(void 0===a&&(a=new Float32Array(i),Ya[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function ts(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function ns(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function rs(e,t){let n=Ka[t];void 0===n&&(n=new Int32Array(t),Ka[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function is(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function as(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ts(n,t))return;e.uniform2fv(this.addr,t),ns(n,t)}}function ss(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ts(n,t))return;e.uniform3fv(this.addr,t),ns(n,t)}}function os(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ts(n,t))return;e.uniform4fv(this.addr,t),ns(n,t)}}function ls(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ts(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ns(n,t)}else{if(ts(n,r))return;Ja.set(r),e.uniformMatrix2fv(this.addr,!1,Ja),ns(n,r)}}function cs(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ts(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ns(n,t)}else{if(ts(n,r))return;Qa.set(r),e.uniformMatrix3fv(this.addr,!1,Qa),ns(n,r)}}function us(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ts(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ns(n,t)}else{if(ts(n,r))return;Za.set(r),e.uniformMatrix4fv(this.addr,!1,Za),ns(n,r)}}function ds(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function hs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ts(n,t))return;e.uniform2iv(this.addr,t),ns(n,t)}}function fs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ts(n,t))return;e.uniform3iv(this.addr,t),ns(n,t)}}function ps(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ts(n,t))return;e.uniform4iv(this.addr,t),ns(n,t)}}function ms(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function gs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ts(n,t))return;e.uniform2uiv(this.addr,t),ns(n,t)}}function _s(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ts(n,t))return;e.uniform3uiv(this.addr,t),ns(n,t)}}function ys(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ts(n,t))return;e.uniform4uiv(this.addr,t),ns(n,t)}}function vs(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||ja,i)}function bs(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||qa,i)}function xs(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Xa,i)}function ws(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Wa,i)}function Ss(e,t){e.uniform1fv(this.addr,t)}function As(e,t){const n=es(t,this.size,2);e.uniform2fv(this.addr,n)}function Ms(e,t){const n=es(t,this.size,3);e.uniform3fv(this.addr,n)}function Es(e,t){const n=es(t,this.size,4);e.uniform4fv(this.addr,n)}function Cs(e,t){const n=es(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ts(e,t){const n=es(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Ps(e,t){const n=es(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Is(e,t){e.uniform1iv(this.addr,t)}function Rs(e,t){e.uniform2iv(this.addr,t)}function ks(e,t){e.uniform3iv(this.addr,t)}function Ds(e,t){e.uniform4iv(this.addr,t)}function Ls(e,t){e.uniform1uiv(this.addr,t)}function Ns(e,t){e.uniform2uiv(this.addr,t)}function Os(e,t){e.uniform3uiv(this.addr,t)}function Fs(e,t){e.uniform4uiv(this.addr,t)}function Us(e,t,n){const r=this.cache,i=t.length,a=rs(n,i);ts(r,a)||(e.uniform1iv(this.addr,a),ns(r,a));for(let e=0;e!==i;++e)n.setTexture2D(t[e]||ja,a[e])}function Bs(e,t,n){const r=this.cache,i=t.length,a=rs(n,i);ts(r,a)||(e.uniform1iv(this.addr,a),ns(r,a));for(let e=0;e!==i;++e)n.setTexture3D(t[e]||qa,a[e])}function zs(e,t,n){const r=this.cache,i=t.length,a=rs(n,i);ts(r,a)||(e.uniform1iv(this.addr,a),ns(r,a));for(let e=0;e!==i;++e)n.setTextureCube(t[e]||Xa,a[e])}function Vs(e,t,n){const r=this.cache,i=t.length,a=rs(n,i);ts(r,a)||(e.uniform1iv(this.addr,a),ns(r,a));for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||Wa,a[e])}class Hs{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return is;case 35664:return as;case 35665:return ss;case 35666:return os;case 35674:return ls;case 35675:return cs;case 35676:return us;case 5124:case 35670:return ds;case 35667:case 35671:return hs;case 35668:case 35672:return fs;case 35669:case 35673:return ps;case 5125:return ms;case 36294:return gs;case 36295:return _s;case 36296:return ys;case 35678:case 36198:case 36298:case 36306:case 35682:return vs;case 35679:case 36299:case 36307:return bs;case 35680:case 36300:case 36308:case 36293:return xs;case 36289:case 36303:case 36311:case 36292:return ws}}(t.type)}}class $s{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ss;case 35664:return As;case 35665:return Ms;case 35666:return Es;case 35674:return Cs;case 35675:return Ts;case 35676:return Ps;case 5124:case 35670:return Is;case 35667:case 35671:return Rs;case 35668:case 35672:return ks;case 35669:case 35673:return Ds;case 5125:return Ls;case 36294:return Ns;case 36295:return Os;case 36296:return Fs;case 35678:case 36198:case 36298:case 36306:case 35682:return Us;case 35679:case 36299:case 36307:return Bs;case 35680:case 36300:case 36308:case 36293:return zs;case 36289:case 36303:case 36311:case 36292:return Vs}}(t.type)}}class Gs{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}}}const js=/(\w+)(\])?(\[|\.)?/g;function Ws(e,t){e.seq.push(t),e.map[t.id]=t}function qs(e,t,n){const r=e.name,i=r.length;for(js.lastIndex=0;;){const a=js.exec(r),s=js.lastIndex;let o=a[1];const l="]"===a[2],c=a[3];if(l&&(o|=0),void 0===c||"["===c&&s+2===i){Ws(n,void 0===c?new Hs(o,e,t):new $s(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new Gs(o),Ws(n,e)),n=e}}}class Xs{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);qs(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function Ys(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}const Ks=37297;let Zs=0;function Qs(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let e=i;e<a;e++){const i=e+1;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function Js(e,t){const n=function(e){const t=Mn.getPrimaries(Mn.workingColorSpace),n=Mn.getPrimaries(e);let r;switch(t===n?r="":t===Bt&&n===Ut?r="LinearDisplayP3ToLinearSRGB":t===Ut&&n===Bt&&(r="LinearSRGBToLinearDisplayP3"),e){case Dt:case Nt:return[r,"LinearTransferOETF"];case kt:case Lt:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[r,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function eo(e,t){let n;switch(t){case Ke:n="Linear";break;case Ze:n="Reinhard";break;case Qe:n="OptimizedCineon";break;case Je:n="ACESFilmic";break;case et:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function to(e){return""!==e}function no(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ro(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const io=/^[ \t]*#include +<([\w\d./]+)>/gm;function ao(e){return e.replace(io,oo)}const so=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function oo(e,t){let n=da[t];if(void 0===n){const e=so.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=da[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return ao(n)}const lo=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function co(e){return e.replace(lo,uo)}function uo(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function ho(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function fo(e,t,n,r){const i=e.getContext(),a=n.defines;let s=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===we?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Se?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Ae&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case tt:case nt:t="ENVMAP_TYPE_CUBE";break;case rt:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===nt&&(t="ENVMAP_MODE_REFRACTION"),t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case We:t="ENVMAP_BLENDING_MULTIPLY";break;case qe:t="ENVMAP_BLENDING_MIX";break;case Xe:t="ENVMAP_BLENDING_ADD"}return t}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),f=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(to).join("\n")}(n),p=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),m=i.createProgram();let g,_,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(to).join("\n"),g.length>0&&(g+="\n"),_=[f,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(to).join("\n"),_.length>0&&(_+="\n")):(g=[ho(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(to).join("\n"),_=[f,ho(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Ye?"#define TONE_MAPPING":"",n.toneMapping!==Ye?da.tonemapping_pars_fragment:"",n.toneMapping!==Ye?eo("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",da.colorspace_pars_fragment,Js("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(to).join("\n")),s=ao(s),s=no(s,n),s=ro(s,n),o=ao(o),o=no(o,n),o=ro(o,n),s=co(s),o=co(o),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===Zt?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Zt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const v=y+g+s,b=y+_+o,x=Ys(i,i.VERTEX_SHADER,v),w=Ys(i,i.FRAGMENT_SHADER,b);function S(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(m).trim(),r=i.getShaderInfoLog(x).trim(),a=i.getShaderInfoLog(w).trim();let s=!0,o=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(s=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,m,x,w);else{const e=Qs(i,x,"vertex"),t=Qs(i,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+t)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==a||(o=!1);o&&(t.diagnostics={runnable:s,programLog:n,vertexShader:{log:r,prefix:g},fragmentShader:{log:a,prefix:_}})}i.deleteShader(x),i.deleteShader(w),A=new Xs(i,m),M=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),a=r.name;let s=1;r.type===e.FLOAT_MAT2&&(s=2),r.type===e.FLOAT_MAT3&&(s=3),r.type===e.FLOAT_MAT4&&(s=4),n[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:s}}return n}(i,m)}let A,M;i.attachShader(m,x),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===A&&S(this),A},this.getAttributes=function(){return void 0===M&&S(this),M};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=i.getProgramParameter(m,Ks)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Zs++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}let po=0;class mo{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new go(e),t.set(e,n)),n}}class go{constructor(e){this.id=po++,this.code=e,this.usedTimes=0}}function _o(e,t,n,r,i,a,s){const o=new Tr,l=new mo,c=[],u=i.isWebGL2,d=i.logarithmicDepthBuffer,h=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(a,o,c,g,_){const y=g.fog,v=_.geometry,b=a.isMeshStandardMaterial?g.environment:null,x=(a.isMeshStandardMaterial?n:t).get(a.envMap||b),w=x&&x.mapping===rt?x.image.height:null,S=p[a.type];null!==a.precision&&(f=i.getMaxPrecision(a.precision),f!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead."));const A=v.morphAttributes.position||v.morphAttributes.normal||v.morphAttributes.color,M=void 0!==A?A.length:0;let E,C,T,P,I=0;if(void 0!==v.morphAttributes.position&&(I=1),void 0!==v.morphAttributes.normal&&(I=2),void 0!==v.morphAttributes.color&&(I=3),S){const e=fa[S];E=e.vertexShader,C=e.fragmentShader}else E=a.vertexShader,C=a.fragmentShader,l.update(a),T=l.getVertexShaderID(a),P=l.getFragmentShaderID(a);const R=e.getRenderTarget(),k=!0===_.isInstancedMesh,D=!!a.map,L=!!a.matcap,N=!!x,O=!!a.aoMap,F=!!a.lightMap,U=!!a.bumpMap,B=!!a.normalMap,z=!!a.displacementMap,V=!!a.emissiveMap,H=!!a.metalnessMap,$=!!a.roughnessMap,G=a.anisotropy>0,j=a.clearcoat>0,W=a.iridescence>0,q=a.sheen>0,X=a.transmission>0,Y=G&&!!a.anisotropyMap,K=j&&!!a.clearcoatMap,Z=j&&!!a.clearcoatNormalMap,Q=j&&!!a.clearcoatRoughnessMap,J=W&&!!a.iridescenceMap,ee=W&&!!a.iridescenceThicknessMap,te=q&&!!a.sheenColorMap,ne=q&&!!a.sheenRoughnessMap,re=!!a.specularMap,ie=!!a.specularColorMap,ae=!!a.specularIntensityMap,se=X&&!!a.transmissionMap,oe=X&&!!a.thicknessMap,le=!!a.gradientMap,ce=!!a.alphaMap,ue=a.alphaTest>0,de=!!a.alphaHash,he=!!a.extensions,fe=!!v.attributes.uv1,pe=!!v.attributes.uv2,me=!!v.attributes.uv3;let ge=Ye;return a.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(ge=e.toneMapping)),{isWebGL2:u,shaderID:S,shaderType:a.type,shaderName:a.name,vertexShader:E,fragmentShader:C,defines:a.defines,customVertexShaderID:T,customFragmentShaderID:P,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,instancing:k,instancingColor:k&&null!==_.instanceColor,supportsVertexTextures:h,outputColorSpace:null===R?e.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:Dt,map:D,matcap:L,envMap:N,envMapMode:N&&x.mapping,envMapCubeUVHeight:w,aoMap:O,lightMap:F,bumpMap:U,normalMap:B,displacementMap:h&&z,emissiveMap:V,normalMapObjectSpace:B&&1===a.normalMapType,normalMapTangentSpace:B&&0===a.normalMapType,metalnessMap:H,roughnessMap:$,anisotropy:G,anisotropyMap:Y,clearcoat:j,clearcoatMap:K,clearcoatNormalMap:Z,clearcoatRoughnessMap:Q,iridescence:W,iridescenceMap:J,iridescenceThicknessMap:ee,sheen:q,sheenColorMap:te,sheenRoughnessMap:ne,specularMap:re,specularColorMap:ie,specularIntensityMap:ae,transmission:X,transmissionMap:se,thicknessMap:oe,gradientMap:le,opaque:!1===a.transparent&&1===a.blending,alphaMap:ce,alphaTest:ue,alphaHash:de,combine:a.combine,mapUv:D&&m(a.map.channel),aoMapUv:O&&m(a.aoMap.channel),lightMapUv:F&&m(a.lightMap.channel),bumpMapUv:U&&m(a.bumpMap.channel),normalMapUv:B&&m(a.normalMap.channel),displacementMapUv:z&&m(a.displacementMap.channel),emissiveMapUv:V&&m(a.emissiveMap.channel),metalnessMapUv:H&&m(a.metalnessMap.channel),roughnessMapUv:$&&m(a.roughnessMap.channel),anisotropyMapUv:Y&&m(a.anisotropyMap.channel),clearcoatMapUv:K&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:Z&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Q&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:J&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:ee&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:te&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ne&&m(a.sheenRoughnessMap.channel),specularMapUv:re&&m(a.specularMap.channel),specularColorMapUv:ie&&m(a.specularColorMap.channel),specularIntensityMapUv:ae&&m(a.specularIntensityMap.channel),transmissionMapUv:se&&m(a.transmissionMap.channel),thicknessMapUv:oe&&m(a.thicknessMap.channel),alphaMapUv:ce&&m(a.alphaMap.channel),vertexTangents:!!v.attributes.tangent&&(B||G),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!v.attributes.color&&4===v.attributes.color.itemSize,vertexUv1s:fe,vertexUv2s:pe,vertexUv3s:me,pointsUvs:!0===_.isPoints&&!!v.attributes.uv&&(D||ce),fog:!!y,useFog:!0===a.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===_.isSkinnedMesh,morphTargets:void 0!==v.morphAttributes.position,morphNormals:void 0!==v.morphAttributes.normal,morphColors:void 0!==v.morphAttributes.color,morphTargetsCount:M,morphTextureStride:I,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,useLegacyLights:e._useLegacyLights,decodeVideoTexture:D&&!0===a.map.isVideoTexture&&Mn.getTransfer(a.map.colorSpace)===Ft,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:he&&!0===a.extensions.derivatives,extensionFragDepth:he&&!0===a.extensions.fragDepth,extensionDrawBuffers:he&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:he&&!0===a.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0),t.supportsVertexTextures&&o.enable(1),t.instancing&&o.enable(2),t.instancingColor&&o.enable(3),t.matcap&&o.enable(4),t.envMap&&o.enable(5),t.normalMapObjectSpace&&o.enable(6),t.normalMapTangentSpace&&o.enable(7),t.clearcoat&&o.enable(8),t.iridescence&&o.enable(9),t.alphaTest&&o.enable(10),t.vertexColors&&o.enable(11),t.vertexAlphas&&o.enable(12),t.vertexUv1s&&o.enable(13),t.vertexUv2s&&o.enable(14),t.vertexUv3s&&o.enable(15),t.vertexTangents&&o.enable(16),t.anisotropy&&o.enable(17),t.alphaHash&&o.enable(18),e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.skinning&&o.enable(4),t.morphTargets&&o.enable(5),t.morphNormals&&o.enable(6),t.morphColors&&o.enable(7),t.premultipliedAlpha&&o.enable(8),t.shadowMapEnabled&&o.enable(9),t.useLegacyLights&&o.enable(10),t.doubleSided&&o.enable(11),t.flipSided&&o.enable(12),t.useDepthPacking&&o.enable(13),t.dithering&&o.enable(14),t.transmission&&o.enable(15),t.sheen&&o.enable(16),t.opaque&&o.enable(17),t.pointsUvs&&o.enable(18),t.decodeVideoTexture&&o.enable(19),e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=fa[t];n=qi.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new fo(e,n,t,a),c.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function yo(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function vo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function bo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function xo(){const e=[];let t=0;const n=[],r=[],i=[];function a(n,r,i,a,s,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:s,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,s,o,l,c){const u=a(e,t,s,o,l,c);s.transmission>0?r.push(u):!0===s.transparent?i.push(u):n.push(u)},unshift:function(e,t,s,o,l,c){const u=a(e,t,s,o,l,c);s.transmission>0?r.unshift(u):!0===s.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||vo),r.length>1&&r.sort(t||bo),i.length>1&&i.sort(t||bo)}}}function wo(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new xo,e.set(t,[i])):n>=r.length?(i=new xo,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function So(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Vn,color:new ai};break;case"SpotLight":n={position:new Vn,direction:new Vn,color:new ai,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Vn,color:new ai,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Vn,skyColor:new ai,groundColor:new ai};break;case"RectAreaLight":n={color:new ai,position:new Vn,halfWidth:new Vn,halfHeight:new Vn}}return e[t.id]=n,n}}}let Ao=0;function Mo(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Eo(e,t){const n=new So,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)i.probe.push(new Vn);const a=new Vn,s=new _r,o=new _r;return{setup:function(a,s){let o=0,l=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let u=0,d=0,h=0,f=0,p=0,m=0,g=0,_=0,y=0,v=0,b=0;a.sort(Mo);const x=!0===s?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],s=t.color,w=t.intensity,S=t.distance,A=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=s.r*w*x,l+=s.g*w*x,c+=s.b*w*x;else if(t.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],w);b++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=A,i.directionalShadowMatrix[u]=t.shadow.matrix,m++}i.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(w*x),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,i.spot[h]=e;const a=t.shadow;if(t.map&&(i.spotLightMap[y]=t.map,y++,a.updateMatrices(t),t.castShadow&&v++),i.spotLightMatrix[h]=a.matrix,t.castShadow){const e=r.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,i.spotShadow[h]=e,i.spotShadowMap[h]=A,_++}h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(s).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[f]=e,f++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[d]=n,i.pointShadowMap[d]=A,i.pointShadowMatrix[d]=t.shadow.matrix,g++}i.point[d]=e,d++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(w*x),e.groundColor.copy(t.groundColor).multiplyScalar(w*x),i.hemi[p]=e,p++}}f>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=ha.LTC_FLOAT_1,i.rectAreaLTC2=ha.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=ha.LTC_HALF_1,i.rectAreaLTC2=ha.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=o,i.ambient[1]=l,i.ambient[2]=c;const w=i.hash;w.directionalLength===u&&w.pointLength===d&&w.spotLength===h&&w.rectAreaLength===f&&w.hemiLength===p&&w.numDirectionalShadows===m&&w.numPointShadows===g&&w.numSpotShadows===_&&w.numSpotMaps===y&&w.numLightProbes===b||(i.directional.length=u,i.spot.length=h,i.rectArea.length=f,i.point.length=d,i.hemi.length=p,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotLightMatrix.length=_+y-v,i.spotLightMap.length=y,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=b,w.directionalLength=u,w.pointLength=d,w.spotLength=h,w.rectAreaLength=f,w.hemiLength=p,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=_,w.numSpotMaps=y,w.numLightProbes=b,i.version=Ao++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const d=t.matrixWorldInverse;for(let t=0,h=e.length;t<h;t++){const h=e[t];if(h.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(h.matrixWorld),a.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),n++}else if(h.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(h.matrixWorld),a.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),l++}else if(h.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),o.identity(),s.copy(h.matrixWorld),s.premultiply(d),o.extractRotation(s),e.halfWidth.set(.5*h.width,0,0),e.halfHeight.set(0,.5*h.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(h.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),r++}else if(h.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(h.matrixWorld),e.direction.transformDirection(d),u++}}},state:i}}function Co(e,t){const n=new Eo(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function To(e,t){let n=new WeakMap;return{get:function(r,i=0){const a=n.get(r);let s;return void 0===a?(s=new Co(e,t),n.set(r,[s])):i>=a.length?(s=new Co(e,t),a.push(s)):s=a[i],s},dispose:function(){n=new WeakMap}}}class Po extends li{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Io extends li{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Ro(e,t,n){let r=new oa;const i=new fn,a=new fn,s=new Nn,o=new Po({depthPacking:3201}),l=new Io,c={},u=n.maxTextureSize,d={[Me]:1,[Ee]:0,[Ce]:2},h=new Xi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new fn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new Si;p.setAttribute("position",new hi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Vi(p,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=we;let _=this.type;function y(n,r){const a=t.update(m);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Fn(i.x,i.y)),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,h,m,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,f,m,null)}function v(t,n,r,i){let a=null;const s=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===r.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=a.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=a.clone(),r[t]=i),a=i}return a.visible=n.visible,a.wireframe=n.wireframe,a.side=i===Ae?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=r),a}function b(n,i,a,s,o){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===Ae)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=i[c.materialIndex];if(u&&u.visible){const t=v(n,u,s,o);e.renderBufferDirect(a,null,r,t,n,c)}}}else if(i.visible){const t=v(n,i,s,o);e.renderBufferDirect(a,null,r,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)b(l[e],i,a,s,o)}this.render=function(t,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const f=_!==Ae&&this.type===Ae,p=_===Ae&&this.type!==Ae;for(let l=0,c=t.length;l<c;l++){const c=t[l],d=c.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;i.copy(d.mapSize);const m=d.getFrameExtents();if(i.multiply(m),a.copy(d.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(a.x=Math.floor(u/m.x),i.x=a.x*m.x,d.mapSize.x=a.x),i.y>u&&(a.y=Math.floor(u/m.y),i.y=a.y*m.y,d.mapSize.y=a.y)),null===d.map||!0===f||!0===p){const e=this.type!==Ae?{minFilter:ot,magFilter:ot}:{};null!==d.map&&d.map.dispose(),d.map=new Fn(i.x,i.y,e),d.map.texture.name=c.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();const g=d.getViewportCount();for(let e=0;e<g;e++){const t=d.getViewport(e);s.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),h.viewport(s),d.updateMatrices(c,e),r=d.getFrustum(),b(n,o,d.camera,c,this.type)}!0!==d.isPointLightShadow&&this.type===Ae&&y(d,o),d.needsUpdate=!1}_=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function ko(e,t,n){const r=n.isWebGL2,i=new function(){let t=!1;const n=new Nn;let r=null;const i=new Nn(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,s,o){!0===o&&(t*=s,r*=s,a*=s),n.set(t,r,a,s),!1===i.equals(n)&&(e.clearColor(t,r,a,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},a=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?H(e.DEPTH_TEST):$(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},s=new function(){let t=!1,n=null,r=null,i=null,a=null,s=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?H(e.STENCIL_TEST):$(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&a===s||(e.stencilFunc(t,n,s),r=t,i=n,a=s)},setOp:function(t,n,r){s===t&&o===n&&l===r||(e.stencilOp(t,n,r),s=t,o=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,s=null,o=null,l=null,c=null}}},o=new WeakMap,l=new WeakMap;let c={},u={},d=new WeakMap,h=[],f=null,p=!1,m=null,g=null,_=null,y=null,v=null,b=null,x=null,w=new ai(0,0,0),S=0,A=!1,M=null,E=null,C=null,T=null,P=null;const I=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,k=0;const D=e.getParameter(e.VERSION);-1!==D.indexOf("WebGL")?(k=parseFloat(/^WebGL (\d)/.exec(D)[1]),R=k>=1):-1!==D.indexOf("OpenGL ES")&&(k=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),R=k>=2);let L=null,N={};const O=e.getParameter(e.SCISSOR_BOX),F=e.getParameter(e.VIEWPORT),U=(new Nn).fromArray(O),B=(new Nn).fromArray(F);function z(t,n,i,a){const s=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<i;o++)!r||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,s);return o}const V={};function H(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function $(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}V[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),V[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(V[e.TEXTURE_2D_ARRAY]=z(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),V[e.TEXTURE_3D]=z(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),i.setClear(0,0,0,1),a.setClear(1),s.setClear(0),H(e.DEPTH_TEST),a.setFunc(3),q(!1),X(1),H(e.CULL_FACE),W(0);const G={[Te]:e.FUNC_ADD,[Pe]:e.FUNC_SUBTRACT,[Ie]:e.FUNC_REVERSE_SUBTRACT};if(r)G[103]=e.MIN,G[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(G[103]=e.MIN_EXT,G[104]=e.MAX_EXT)}const j={[Re]:e.ZERO,[ke]:e.ONE,[De]:e.SRC_COLOR,[Ne]:e.SRC_ALPHA,[Ve]:e.SRC_ALPHA_SATURATE,[Be]:e.DST_COLOR,[Fe]:e.DST_ALPHA,[Le]:e.ONE_MINUS_SRC_COLOR,[Oe]:e.ONE_MINUS_SRC_ALPHA,[ze]:e.ONE_MINUS_DST_COLOR,[Ue]:e.ONE_MINUS_DST_ALPHA,[He]:e.CONSTANT_COLOR,[$e]:e.ONE_MINUS_CONSTANT_COLOR,[Ge]:e.CONSTANT_ALPHA,[je]:e.ONE_MINUS_CONSTANT_ALPHA};function W(t,n,r,i,a,s,o,l,c,u){if(0!==t){if(!1===p&&(H(e.BLEND),p=!0),5===t)a=a||n,s=s||r,o=o||i,n===g&&a===v||(e.blendEquationSeparate(G[n],G[a]),g=n,v=a),r===_&&i===y&&s===b&&o===x||(e.blendFuncSeparate(j[r],j[i],j[s],j[o]),_=r,y=i,b=s,x=o),!1!==l.equals(w)&&c===S||(e.blendColor(l.r,l.g,l.b,c),w.copy(l),S=c),m=t,A=!1;else if(t!==m||u!==A){if(g===Te&&v===Te||(e.blendEquation(e.FUNC_ADD),g=Te,v=Te),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}_=null,y=null,b=null,x=null,w.set(0,0,0),S=0,m=t,A=u}}else!0===p&&($(e.BLEND),p=!1)}function q(t){M!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),M=t)}function X(t){0!==t?(H(e.CULL_FACE),t!==E&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):$(e.CULL_FACE),E=t}function Y(t,n,r){t?(H(e.POLYGON_OFFSET_FILL),T===n&&P===r||(e.polygonOffset(n,r),T=n,P=r)):$(e.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:a,stencil:s},enable:H,disable:$,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,r&&(t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(r,i){let a=h,s=!1;if(r)if(a=d.get(i),void 0===a&&(a=[],d.set(i,a)),r.isWebGLMultipleRenderTargets){const t=r.texture;if(a.length!==t.length||a[0]!==e.COLOR_ATTACHMENT0){for(let n=0,r=t.length;n<r;n++)a[n]=e.COLOR_ATTACHMENT0+n;a.length=t.length,s=!0}}else a[0]!==e.COLOR_ATTACHMENT0&&(a[0]=e.COLOR_ATTACHMENT0,s=!0);else a[0]!==e.BACK&&(a[0]=e.BACK,s=!0);s&&(n.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:W,setMaterial:function(t,n){2===t.side?$(e.CULL_FACE):H(e.CULL_FACE);let r=1===t.side;n&&(r=!r),q(r),1===t.blending&&!1===t.transparent?W(0):W(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),i.setMask(t.colorWrite);const o=t.stencilWrite;s.setTest(o),o&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Y(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?H(e.SAMPLE_ALPHA_TO_COVERAGE):$(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:q,setCullFace:X,setLineWidth:function(t){t!==C&&(R&&e.lineWidth(t),C=t)},setPolygonOffset:Y,setScissorTest:function(t){t?H(e.SCISSOR_TEST):$(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+I-1),L!==t&&(e.activeTexture(t),L=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===L?e.TEXTURE0+I-1:L);let i=N[r];void 0===i&&(i={type:void 0,texture:void 0},N[r]=i),i.type===t&&i.texture===n||(L!==r&&(e.activeTexture(r),L=r),e.bindTexture(t,n||V[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=N[L];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let r=l.get(n);void 0===r&&(r=new WeakMap,l.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=l.get(n).get(t);o.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),o.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===B.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),B.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===r&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},L=null,N={},u={},d=new WeakMap,h=[],f=null,p=!1,m=null,g=null,_=null,y=null,v=null,b=null,x=null,w=new ai(0,0,0),S=0,A=!1,M=null,E=null,C=null,T=null,P=null,U.set(0,0,e.canvas.width,e.canvas.height),B.set(0,0,e.canvas.width,e.canvas.height),i.reset(),a.reset(),s.reset()}}}function Do(e,t,n,r,i,a,s){const o=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,d=i.maxSamples,h=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function y(e,t){return _?new OffscreenCanvas(e,t):_n("canvas")}function v(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?un:Math.floor,a=r(i*e.width),s=r(i*e.height);void 0===m&&(m=y(a,s));const o=n?y(a,s):m;return o.width=a,o.height=s,o.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return cn(e.width)&&cn(e.height)}function x(e,t){return e.generateMipmaps&&t&&e.minFilter!==ot&&e.minFilter!==ut}function w(t){e.generateMipmap(t)}function S(n,r,i,a,s=!1){if(!1===o)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=r;if(r===e.RED&&(i===e.FLOAT&&(l=e.R32F),i===e.HALF_FLOAT&&(l=e.R16F),i===e.UNSIGNED_BYTE&&(l=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(l=e.R8UI),i===e.UNSIGNED_SHORT&&(l=e.R16UI),i===e.UNSIGNED_INT&&(l=e.R32UI),i===e.BYTE&&(l=e.R8I),i===e.SHORT&&(l=e.R16I),i===e.INT&&(l=e.R32I)),r===e.RG&&(i===e.FLOAT&&(l=e.RG32F),i===e.HALF_FLOAT&&(l=e.RG16F),i===e.UNSIGNED_BYTE&&(l=e.RG8)),r===e.RGBA){const t=s?Ot:Mn.getTransfer(a);i===e.FLOAT&&(l=e.RGBA32F),i===e.HALF_FLOAT&&(l=e.RGBA16F),i===e.UNSIGNED_BYTE&&(l=t===Ft?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function A(e,t,n){return!0===x(e,n)||e.isFramebufferTexture&&e.minFilter!==ot&&e.minFilter!==ut?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function M(t){return t===ot||1004===t||t===ct?e.NEAREST:e.LINEAR}function E(e){const t=e.target;t.removeEventListener("dispose",E),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=g.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&T(e),0===Object.keys(i).length&&g.delete(n)}r.remove(e)}(t),t.isVideoTexture&&p.delete(t)}function C(t){const n=t.target;n.removeEventListener("dispose",C),function(t){const n=t.texture,i=r.get(t),a=r.get(n);if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),s.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(i.__webglFramebuffer[t]))for(let n=0;n<i.__webglFramebuffer[t].length;n++)e.deleteFramebuffer(i.__webglFramebuffer[t][n]);else e.deleteFramebuffer(i.__webglFramebuffer[t]);i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t])}else{if(Array.isArray(i.__webglFramebuffer))for(let t=0;t<i.__webglFramebuffer.length;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let t=0;t<i.__webglColorRenderbuffer.length;t++)i.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[t]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),s.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}(n)}function T(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete g.get(i)[n.__cacheKey],s.memory.textures--}let P=0;function I(t,i){const a=r.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void O(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}const R={[it]:e.REPEAT,[at]:e.CLAMP_TO_EDGE,[st]:e.MIRRORED_REPEAT},k={[ot]:e.NEAREST,[lt]:e.NEAREST_MIPMAP_NEAREST,[ct]:e.NEAREST_MIPMAP_LINEAR,[ut]:e.LINEAR,[dt]:e.LINEAR_MIPMAP_NEAREST,[ht]:e.LINEAR_MIPMAP_LINEAR},D={[Vt]:e.NEVER,[Xt]:e.ALWAYS,[Ht]:e.LESS,[Gt]:e.LEQUAL,[$t]:e.EQUAL,[qt]:e.GEQUAL,[jt]:e.GREATER,[Wt]:e.NOTEQUAL};function L(n,a,s){if(s?(e.texParameteri(n,e.TEXTURE_WRAP_S,R[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,R[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,R[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,k[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,k[a.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),a.wrapS===at&&a.wrapT===at||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,M(a.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,M(a.minFilter)),a.minFilter!==ot&&a.minFilter!==ut&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,D[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const s=t.get("EXT_texture_filter_anisotropic");if(a.magFilter===ot)return;if(a.minFilter!==ct&&a.minFilter!==ht)return;if(a.type===gt&&!1===t.has("OES_texture_float_linear"))return;if(!1===o&&a.type===_t&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function N(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",E));const i=n.source;let a=g.get(i);void 0===a&&(a={},g.set(i,a));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,r=!0),a[o].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&T(n)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return r}function O(t,i,s){let l=e.TEXTURE_2D;(i.isDataArrayTexture||i.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),i.isData3DTexture&&(l=e.TEXTURE_3D);const c=N(t,i),d=i.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+s);const h=r.get(d);if(d.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+s);const t=Mn.getPrimaries(Mn.workingColorSpace),r=i.colorSpace===Rt?null:Mn.getPrimaries(i.colorSpace),f=i.colorSpace===Rt||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);const p=function(e){return!o&&(e.wrapS!==at||e.wrapT!==at||e.minFilter!==ot&&e.minFilter!==ut)}(i)&&!1===b(i.image);let m=v(i.image,p,!1,u);m=H(i,m);const g=b(m)||o,_=a.convert(i.format,i.colorSpace);let y,M=a.convert(i.type),E=S(i.internalFormat,_,M,i.colorSpace,i.isVideoTexture);L(l,i,g);const C=i.mipmaps,T=o&&!0!==i.isVideoTexture,P=void 0===h.__version||!0===c,I=A(i,m,g);if(i.isDepthTexture)E=e.DEPTH_COMPONENT,o?E=i.type===gt?e.DEPTH_COMPONENT32F:i.type===mt?e.DEPTH_COMPONENT24:i.type===yt?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:i.type===gt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===bt&&E===e.DEPTH_COMPONENT&&i.type!==pt&&i.type!==mt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=mt,M=a.convert(i.type)),i.format===xt&&E===e.DEPTH_COMPONENT&&(E=e.DEPTH_STENCIL,i.type!==yt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=yt,M=a.convert(i.type))),P&&(T?n.texStorage2D(e.TEXTURE_2D,1,E,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,E,m.width,m.height,0,_,M,null));else if(i.isDataTexture)if(C.length>0&&g){T&&P&&n.texStorage2D(e.TEXTURE_2D,I,E,C[0].width,C[0].height);for(let t=0,r=C.length;t<r;t++)y=C[t],T?n.texSubImage2D(e.TEXTURE_2D,t,0,0,y.width,y.height,_,M,y.data):n.texImage2D(e.TEXTURE_2D,t,E,y.width,y.height,0,_,M,y.data);i.generateMipmaps=!1}else T?(P&&n.texStorage2D(e.TEXTURE_2D,I,E,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,_,M,m.data)):n.texImage2D(e.TEXTURE_2D,0,E,m.width,m.height,0,_,M,m.data);else if(i.isCompressedTexture)if(i.isCompressedArrayTexture){T&&P&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,E,C[0].width,C[0].height,m.depth);for(let t=0,r=C.length;t<r;t++)y=C[t],i.format!==vt?null!==_?T?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,y.width,y.height,m.depth,_,y.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,E,y.width,y.height,m.depth,0,y.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,y.width,y.height,m.depth,_,M,y.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,E,y.width,y.height,m.depth,0,_,M,y.data)}else{T&&P&&n.texStorage2D(e.TEXTURE_2D,I,E,C[0].width,C[0].height);for(let t=0,r=C.length;t<r;t++)y=C[t],i.format!==vt?null!==_?T?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,y.width,y.height,_,y.data):n.compressedTexImage2D(e.TEXTURE_2D,t,E,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?n.texSubImage2D(e.TEXTURE_2D,t,0,0,y.width,y.height,_,M,y.data):n.texImage2D(e.TEXTURE_2D,t,E,y.width,y.height,0,_,M,y.data)}else if(i.isDataArrayTexture)T?(P&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,E,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,_,M,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,E,m.width,m.height,m.depth,0,_,M,m.data);else if(i.isData3DTexture)T?(P&&n.texStorage3D(e.TEXTURE_3D,I,E,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,_,M,m.data)):n.texImage3D(e.TEXTURE_3D,0,E,m.width,m.height,m.depth,0,_,M,m.data);else if(i.isFramebufferTexture){if(P)if(T)n.texStorage2D(e.TEXTURE_2D,I,E,m.width,m.height);else{let t=m.width,r=m.height;for(let i=0;i<I;i++)n.texImage2D(e.TEXTURE_2D,i,E,t,r,0,_,M,null),t>>=1,r>>=1}}else if(C.length>0&&g){T&&P&&n.texStorage2D(e.TEXTURE_2D,I,E,C[0].width,C[0].height);for(let t=0,r=C.length;t<r;t++)y=C[t],T?n.texSubImage2D(e.TEXTURE_2D,t,0,0,_,M,y):n.texImage2D(e.TEXTURE_2D,t,E,_,M,y);i.generateMipmaps=!1}else T?(P&&n.texStorage2D(e.TEXTURE_2D,I,E,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,_,M,m)):n.texImage2D(e.TEXTURE_2D,0,E,_,M,m);x(i,g)&&w(l),h.__version=d.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function F(t,i,s,o,l,c){const u=a.convert(s.format,s.colorSpace),d=a.convert(s.type),f=S(s.internalFormat,u,d,s.colorSpace);if(!r.get(i).__hasExternalTextures){const t=Math.max(1,i.width>>c),r=Math.max(1,i.height>>c);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,c,f,t,r,i.depth,0,u,d,null):n.texImage2D(l,c,f,t,r,0,u,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),V(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,l,r.get(s).__webglTexture,0,z(i)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,l,r.get(s).__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function U(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=!0===o?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(r||V(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===gt?i=e.DEPTH_COMPONENT32F:t.type===mt&&(i=e.DEPTH_COMPONENT24));const r=z(n);V(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,i,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=z(n);r&&!1===V(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):V(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let i=0;i<t.length;i++){const s=t[i],o=a.convert(s.format,s.colorSpace),l=a.convert(s.type),c=S(s.internalFormat,o,l,s.colorSpace),u=z(n);r&&!1===V(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,c,n.width,n.height):V(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function B(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),I(i.depthTexture,0);const a=r.get(i.depthTexture).__webglTexture,s=z(i);if(i.depthTexture.format===bt)V(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(i.depthTexture.format!==xt)throw new Error("Unknown depthTexture format");V(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),U(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),U(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function z(e){return Math.min(d,e.samples)}function V(e){const n=r.get(e);return o&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,n){const r=e.colorSpace,i=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Qt||r!==Dt&&r!==Rt&&(Mn.getTransfer(r)===Ft?!1===o?!0===t.has("EXT_sRGB")&&i===vt?(e.format=Qt,e.minFilter=ut,e.generateMipmaps=!1):n=Pn.sRGBToLinear(n):i===vt&&a===ft||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),n}this.allocateTextureUnit=function(){const e=P;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),P+=1,e},this.resetTextureUnits=function(){P=0},this.setTexture2D=I,this.setTexture2DArray=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?O(a,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?O(a,t,i):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,i,s){if(6!==i.image.length)return;const l=N(t,i),u=i.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+s);const d=r.get(u);if(u.version!==d.__version||!0===l){n.activeTexture(e.TEXTURE0+s);const t=Mn.getPrimaries(Mn.workingColorSpace),r=i.colorSpace===Rt?null:Mn.getPrimaries(i.colorSpace),h=i.colorSpace===Rt||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const f=i.isCompressedTexture||i.image[0].isCompressedTexture,p=i.image[0]&&i.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=f||p?p?i.image[e].image:i.image[e]:v(i.image[e],!1,!0,c),m[e]=H(i,m[e]);const g=m[0],_=b(g)||o,y=a.convert(i.format,i.colorSpace),M=a.convert(i.type),E=S(i.internalFormat,y,M,i.colorSpace),C=o&&!0!==i.isVideoTexture,T=void 0===d.__version||!0===l;let P,I=A(i,g,_);if(L(e.TEXTURE_CUBE_MAP,i,_),f){C&&T&&n.texStorage2D(e.TEXTURE_CUBE_MAP,I,E,g.width,g.height);for(let t=0;t<6;t++){P=m[t].mipmaps;for(let r=0;r<P.length;r++){const a=P[r];i.format!==vt?null!==y?C?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,a.width,a.height,y,a.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,E,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,a.width,a.height,y,M,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,E,a.width,a.height,0,y,M,a.data)}}}else{P=i.mipmaps,C&&T&&(P.length>0&&I++,n.texStorage2D(e.TEXTURE_CUBE_MAP,I,E,m[0].width,m[0].height));for(let t=0;t<6;t++)if(p){C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,y,M,m[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,E,m[t].width,m[t].height,0,y,M,m[t].data);for(let r=0;r<P.length;r++){const i=P[r].image[t].image;C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,y,M,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,E,i.width,i.height,0,y,M,i.data)}}else{C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,y,M,m[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,E,y,M,m[t]);for(let r=0;r<P.length;r++){const i=P[r];C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,y,M,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,E,y,M,i.image[t])}}}x(i,_)&&w(e.TEXTURE_CUBE_MAP),d.__version=u.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(s,t,i):n.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+i)},this.rebindTextures=function(t,n,i){const a=r.get(t);void 0!==n&&F(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&B(t)},this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",C),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,s.memory.textures++);const d=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,f=b(t)||o;if(d){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(h)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&t.samples>0&&!1===V(t)){const r=h?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<r.length;n++){const i=r[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const s=a.convert(i.format,i.colorSpace),o=a.convert(i.type),l=S(i.internalFormat,s,o,i.colorSpace,!0===t.isXRRenderTarget),u=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),U(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(d){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),L(e.TEXTURE_CUBE_MAP,l,f);for(let n=0;n<6;n++)if(o&&l.mipmaps&&l.mipmaps.length>0)for(let r=0;r<l.mipmaps.length;r++)F(c.__webglFramebuffer[n][r],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else F(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);x(l,f)&&w(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){const i=t.texture;for(let a=0,s=i.length;a<s;a++){const s=i[a],o=r.get(s);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),L(e.TEXTURE_2D,s,f),F(c.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+a,e.TEXTURE_2D,0),x(s,f)&&w(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(o?r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(r,u.__webglTexture),L(r,l,f),o&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)F(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,r,n);else F(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,r,0);x(l,f)&&w(r),n.unbindTexture()}t.depthBuffer&&B(t)},this.updateRenderTargetMipmap=function(t){const i=b(t)||o,a=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=a.length;s<o;s++){const o=a[s];if(x(o,i)){const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=r.get(o).__webglTexture;n.bindTexture(i,a),w(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(o&&t.samples>0&&!1===V(t)){const i=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,s=t.height;let o=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const h=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===h&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),d&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===h&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),d){const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),f&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const a=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=B,this.setupFrameBufferTexture=F,this.useMultisampledRTT=V}function Lo(e,t,n){const r=n.isWebGL2;return{convert:function(n,i=""){let a;const s=Mn.getTransfer(i);if(n===ft)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===pt)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(n===mt)return e.UNSIGNED_INT;if(n===gt)return e.FLOAT;if(n===_t)return r?e.HALF_FLOAT:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===vt)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===bt)return e.DEPTH_COMPONENT;if(n===xt)return e.DEPTH_STENCIL;if(n===Qt)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===n)return e.RED;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===wt||n===St||n===At||n===Mt)if(s===Ft){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(n===wt)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===St)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===At)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Mt)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(n===wt)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===St)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===At)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Mt)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===n)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===n)return s===Ft?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return s===Ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Et||36494===n||36495===n){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(n===Et)return s===Ft?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(n===Et)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===yt?r?e.UNSIGNED_INT_24_8:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class No extends Ki{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Oo extends Hr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Fo={type:"move"};class Uo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Oo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Oo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Oo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vn),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n),i=this._getHandJoint(l,r);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],s=r.position.distanceTo(i.position),o=.02,c=.005;l.inputState.pinching&&s>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Fo)))}return null!==s&&(s.visible=null!==r),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Oo;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Bo extends Ln{constructor(e,t,n,r,i,a,s,o,l,c){if((c=void 0!==c?c:bt)!==bt&&c!==xt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===bt&&(n=mt),void 0===n&&c===xt&&(n=yt),super(null,r,i,a,s,o,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:ot,this.minFilter=void 0!==o?o:ot,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class zo extends tn{constructor(e,t){super();const n=this;let r=null,i=1,a=null,s="local-floor",o=1,l=null,c=null,u=null,d=null,h=null,f=null;const p=t.getContextAttributes();let m=null,g=null;const _=[],y=[],v=new Ki;v.layers.enable(1),v.viewport=new Nn;const b=new Ki;b.layers.enable(2),b.viewport=new Nn;const x=[v,b],w=new No;w.layers.enable(1),w.layers.enable(2);let S=null,A=null;function M(e){const t=y.indexOf(e.inputSource);if(-1===t)return;const n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function E(){r.removeEventListener("select",M),r.removeEventListener("selectstart",M),r.removeEventListener("selectend",M),r.removeEventListener("squeeze",M),r.removeEventListener("squeezestart",M),r.removeEventListener("squeezeend",M),r.removeEventListener("end",E),r.removeEventListener("inputsourceschange",C);for(let e=0;e<_.length;e++){const t=y[e];null!==t&&(y[e]=null,_[e].disconnect(t))}S=null,A=null,e.setRenderTarget(m),h=null,d=null,u=null,r=null,g=null,k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function C(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=y.indexOf(n);r>=0&&(y[r]=null,_[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=y.indexOf(n);if(-1===r){for(let e=0;e<_.length;e++){if(e>=y.length){y.push(n),r=e;break}if(null===y[e]){y[e]=n,r=e;break}}if(-1===r)break}const i=_[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new Uo,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new Uo,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new Uo,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(m=e.getRenderTarget(),r.addEventListener("select",M),r.addEventListener("selectstart",M),r.addEventListener("selectend",M),r.addEventListener("squeeze",M),r.addEventListener("squeezestart",M),r.addEventListener("squeezeend",M),r.addEventListener("end",E),r.addEventListener("inputsourceschange",C),!0!==p.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||p.antialias,alpha:!0,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:i};h=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:h}),g=new Fn(h.framebufferWidth,h.framebufferHeight,{format:vt,type:ft,colorSpace:e.outputColorSpace,stencilBuffer:p.stencil})}else{let n=null,a=null,s=null;p.depth&&(s=p.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=p.stencil?xt:bt,a=p.stencil?yt:mt);const o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:i};u=new XRWebGLBinding(r,t),d=u.createProjectionLayer(o),r.updateRenderState({layers:[d]}),g=new Fn(d.textureWidth,d.textureHeight,{format:vt,type:ft,depthTexture:new Bo(d.textureWidth,d.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:p.stencil,colorSpace:e.outputColorSpace,samples:p.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await r.requestReferenceSpace(s),k.setContext(r),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const T=new Vn,P=new Vn;function I(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;w.near=b.near=v.near=e.near,w.far=b.far=v.far=e.far,S===w.near&&A===w.far||(r.updateRenderState({depthNear:w.near,depthFar:w.far}),S=w.near,A=w.far);const t=e.parent,n=w.cameras;I(w,t);for(let e=0;e<n.length;e++)I(n[e],t);2===n.length?function(e,t,n){T.setFromMatrixPosition(t.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const r=T.distanceTo(P),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,s=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],d=(a[8]+1)/a[0],h=s*u,f=s*d,p=r/(-u+d),m=p*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+p,_=o+p,y=h-m,v=f+(r-m),b=l*o/_*g,x=c*o/_*g;e.projectionMatrix.makePerspective(y,v,b,x,g,_),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(w,v,b):w.projectionMatrix.copy(v.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*an*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,w,t)},this.getCamera=function(){return w},this.getFoveation=function(){if(null!==d||null!==h)return o},this.setFoveation=function(e){o=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)};let R=null;const k=new la;k.setAnimationLoop((function(t,r){if(c=r.getViewerPose(l||a),f=r,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(g,h.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==w.cameras.length&&(w.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let a=null;if(null!==h)a=h.getViewport(i);else{const t=u.getViewSubImage(d,i);a=t.viewport,0===r&&(e.setRenderTargetTextures(g,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let s=x[r];void 0===s&&(s=new Ki,s.layers.enable(r),s.viewport=new Nn,x[r]=s),s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(i.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),0===r&&(w.matrix.copy(s.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),!0===n&&w.cameras.push(s)}}for(let e=0;e<_.length;e++){const t=y[e],n=_[e];null!==t&&void 0!==n&&n.update(t,r,l||a)}R&&R(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),f=null})),this.setAnimationLoop=function(e){R=e},this.dispose=function(){}}}function Vo(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,i){r.opacity.value=i.opacity,i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map,n(i.map,r.mapTransform)),i.alphaMap&&(r.alphaMap.value=i.alphaMap,n(i.alphaMap,r.alphaMapTransform)),i.bumpMap&&(r.bumpMap.value=i.bumpMap,n(i.bumpMap,r.bumpMapTransform),r.bumpScale.value=i.bumpScale,1===i.side&&(r.bumpScale.value*=-1)),i.normalMap&&(r.normalMap.value=i.normalMap,n(i.normalMap,r.normalMapTransform),r.normalScale.value.copy(i.normalScale),1===i.side&&r.normalScale.value.negate()),i.displacementMap&&(r.displacementMap.value=i.displacementMap,n(i.displacementMap,r.displacementMapTransform),r.displacementScale.value=i.displacementScale,r.displacementBias.value=i.displacementBias),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,r.emissiveMapTransform)),i.specularMap&&(r.specularMap.value=i.specularMap,n(i.specularMap,r.specularMapTransform)),i.alphaTest>0&&(r.alphaTest.value=i.alphaTest);const a=t.get(i).envMap;if(a&&(r.envMap.value=a,r.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,r.reflectivity.value=i.reflectivity,r.ior.value=i.ior,r.refractionRatio.value=i.refractionRatio),i.lightMap){r.lightMap.value=i.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;r.lightMapIntensity.value=i.lightMapIntensity*t,n(i.lightMap,r.lightMapTransform)}i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Wi(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,a,s,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,r){e.metalness.value=r.metalness,r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap,n(r.metalnessMap,e.metalnessMapTransform)),e.roughness.value=r.roughness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap,n(r.roughnessMap,e.roughnessMapTransform));t.get(r).envMap&&(e.envMapIntensity.value=r.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,o)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,s):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Ho(e,t,n,r){let i={},a={},s=[];const o=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const r=e.value;if(void 0===n[t]){if("number"==typeof r)n[t]=r;else{const e=Array.isArray(r)?r:[r],i=[];for(let t=0;t<e.length;t++)i.push(e[t].clone());n[t]=i}return!0}if("number"==typeof r){if(n[t]!==r)return n[t]=r,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],i=Array.isArray(r)?r:[r];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(i[t]))return n.copy(i[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=s.indexOf(n.__bindingPointIndex);s.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,d){let h=i[n.id];void 0===h&&(function(e){const t=e.uniforms;let n=0;let r=0;for(let e=0,i=t.length;e<i;e++){const i=t[e],a={boundary:0,storage:0},s=Array.isArray(i.value)?i.value:[i.value];for(let e=0,t=s.length;e<t;e++){const t=c(s[e]);a.boundary+=t.boundary,a.storage+=t.storage}i.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,e>0&&(r=n%16,0!==r&&16-r-a.boundary<0&&(n+=16-r,i.__offset=n)),n+=a.storage}r=n%16,r>0&&(n+=16-r),e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=h,n.addEventListener("dispose",u));const f=d.program;r.updateUBOMapping(n,f);const p=t.render.frame;a[n.id]!==p&&(function(t){const n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=r.length;t<n;t++){const n=r[t];if(!0===l(n,t,a)){const t=n.__offset,r=Array.isArray(n.value)?n.value:[n.value];let i=0;for(let a=0;a<r.length;a++){const s=r[a],o=c(s);"number"==typeof s?(n.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+i,n.__data)):s.isMatrix3?(n.__data[0]=s.elements[0],n.__data[1]=s.elements[1],n.__data[2]=s.elements[2],n.__data[3]=s.elements[0],n.__data[4]=s.elements[3],n.__data[5]=s.elements[4],n.__data[6]=s.elements[5],n.__data[7]=s.elements[0],n.__data[8]=s.elements[6],n.__data[9]=s.elements[7],n.__data[10]=s.elements[8],n.__data[11]=s.elements[0]):(s.toArray(n.__data,i),i+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=p)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);s=[],i={},a={}}}}class $o{constructor(e={}){const{canvas:t=yn(),context:n=null,depth:r=!0,stencil:i=!0,alpha:a=!1,antialias:s=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==n?n.getContextAttributes().alpha:a;const h=new Uint32Array(4),f=new Int32Array(4);let p=null,m=null;const g=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=kt,this._useLegacyLights=!1,this.toneMapping=Ye,this.toneMappingExposure=1;const y=this;let v=!1,b=0,x=0,w=null,S=-1,A=null;const M=new Nn,E=new Nn;let C=null;const T=new ai(0);let P=0,I=t.width,R=t.height,k=1,D=null,L=null;const N=new Nn(0,0,I,R),O=new Nn(0,0,I,R);let F=!1;const U=new oa;let B=!1,z=!1,V=null;const H=new _r,$=new fn,G=new Vn,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===w?k:1}let q,X,Y,K,Z,Q,J,ee,te,ne,re,ie,ae,se,oe,le,ce,ue,de,he,fe,pe,me,ge,_e=n;function ye(e,n){for(let r=0;r<e.length;r++){const i=e[r],a=t.getContext(i,n);if(null!==a)return a}return null}try{const e={alpha:!0,depth:r,stencil:i,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${xe}`),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",Se,!1),t.addEventListener("webglcontextcreationerror",Ae,!1),null===_e){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),_e=ye(t,e),null===_e)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&_e instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ve(){q=new Fa(_e),X=new ya(_e,q,e),q.init(X),pe=new Lo(_e,q,X),Y=new ko(_e,q,X),K=new za(_e),Z=new yo,Q=new Do(_e,q,Y,Z,X,pe,K),J=new ba(y),ee=new Oa(y),te=new ca(_e,X),me=new ga(_e,q,te,X),ne=new Ua(_e,te,K,me),re=new Ga(_e,ne,te,K),de=new $a(_e,X,Q),le=new va(Z),ie=new _o(y,J,ee,q,X,me,le),ae=new Vo(y,Z),se=new wo,oe=new To(q,X),ue=new ma(y,J,ee,Y,re,d,o),ce=new Ro(y,re,X),ge=new Ho(_e,K,X,Y),he=new _a(_e,q,K,X),fe=new Ba(_e,q,K,X),K.programs=ie.programs,y.capabilities=X,y.extensions=q,y.properties=Z,y.renderLists=se,y.shadowMap=ce,y.state=Y,y.info=K}ve();const be=new zo(y,_e);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const e=K.autoReset,t=ce.enabled,n=ce.autoUpdate,r=ce.needsUpdate,i=ce.type;ve(),K.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=r,ce.type=i}function Ae(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Me(e){const t=e.target;t.removeEventListener("dispose",Me),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach((function(e){ie.releaseProgram(e)})),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ne(e,t,n),e.side=0,e.needsUpdate=!0,Ne(e,t,n),e.side=2):Ne(e,t,n)}this.xr=be,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=q.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=q.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(e){void 0!==e&&(k=e,this.setSize(I,R,!1))},this.getSize=function(e){return e.set(I,R)},this.setSize=function(e,n,r=!0){be.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(I=e,R=n,t.width=Math.floor(e*k),t.height=Math.floor(n*k),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(I*k,R*k).floor()},this.setDrawingBufferSize=function(e,n,r){I=e,R=n,k=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(M)},this.getViewport=function(e){return e.copy(N)},this.setViewport=function(e,t,n,r){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,r),Y.viewport(M.copy(N).multiplyScalar(k).floor())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,r){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,r),Y.scissor(E.copy(O).multiplyScalar(k).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){Y.setScissorTest(F=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){L=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){let e=!1;if(null!==w){const t=w.texture.format;e=1033===t||1031===t||1029===t}if(e){const e=w.texture.type,t=e===ft||e===mt||e===pt||e===yt||1017===e||1018===e,n=ue.getClearColor(),r=ue.getClearAlpha(),i=n.r,a=n.g,s=n.b;t?(h[0]=i,h[1]=a,h[2]=s,h[3]=r,_e.clearBufferuiv(_e.COLOR,0,h)):(f[0]=i,f[1]=a,f[2]=s,f[3]=r,_e.clearBufferiv(_e.COLOR,0,f))}else r|=_e.COLOR_BUFFER_BIT}t&&(r|=_e.DEPTH_BUFFER_BIT),n&&(r|=_e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),_e.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",Se,!1),t.removeEventListener("webglcontextcreationerror",Ae,!1),se.dispose(),oe.dispose(),Z.dispose(),J.dispose(),ee.dispose(),re.dispose(),me.dispose(),ge.dispose(),ie.dispose(),be.dispose(),be.removeEventListener("sessionstart",Te),be.removeEventListener("sessionend",Pe),V&&(V.dispose(),V=null),Ie.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=j);const s=i.isMesh&&i.matrixWorld.determinant()<0,o=function(e,t,n,r,i){!0!==t.isScene&&(t=j),Q.resetTextureUnits();const a=t.fog,s=r.isMeshStandardMaterial?t.environment:null,o=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Dt,l=(r.isMeshStandardMaterial?ee:J).get(r.envMap||s),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,f=!!n.morphAttributes.color;let p=Ye;r.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(p=y.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,_=void 0!==g?g.length:0,v=Z.get(r),b=m.state.lights;if(!0===B&&(!0===z||e!==A)){const t=e===A&&r.id===S;le.setState(r,e,t)}let x=!1;r.version===v.__version?v.needsLights&&v.lightsStateVersion!==b.state.version||v.outputColorSpace!==o||i.isInstancedMesh&&!1===v.instancing?x=!0:i.isInstancedMesh||!0!==v.instancing?i.isSkinnedMesh&&!1===v.skinning?x=!0:i.isSkinnedMesh||!0!==v.skinning?i.isInstancedMesh&&!0===v.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===v.instancingColor&&null!==i.instanceColor||v.envMap!==l||!0===r.fog&&v.fog!==a?x=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===le.numPlanes&&v.numIntersection===le.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==d||v.morphNormals!==h||v.morphColors!==f||v.toneMapping!==p||!0===X.isWebGL2&&v.morphTargetsCount!==_)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,v.__version=r.version);let M=v.currentProgram;!0===x&&(M=Ne(r,t,i));let E=!1,C=!1,T=!1;const P=M.getUniforms(),I=v.uniforms;if(Y.useProgram(M.program)&&(E=!0,C=!0,T=!0),r.id!==S&&(S=r.id,C=!0),E||A!==e){P.setValue(_e,"projectionMatrix",e.projectionMatrix),P.setValue(_e,"viewMatrix",e.matrixWorldInverse);const t=P.map.cameraPosition;void 0!==t&&t.setValue(_e,G.setFromMatrixPosition(e.matrixWorld)),X.logarithmicDepthBuffer&&P.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&P.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),A!==e&&(A=e,C=!0,T=!0)}if(i.isSkinnedMesh){P.setOptional(_e,i,"bindMatrix"),P.setOptional(_e,i,"bindMatrixInverse");const e=i.skeleton;e&&(X.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),P.setValue(_e,"boneTexture",e.boneTexture,Q),P.setValue(_e,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const D=n.morphAttributes;var L,N;if((void 0!==D.position||void 0!==D.normal||void 0!==D.color&&!0===X.isWebGL2)&&de.update(i,n,M),(C||v.receiveShadow!==i.receiveShadow)&&(v.receiveShadow=i.receiveShadow,P.setValue(_e,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),C&&(P.setValue(_e,"toneMappingExposure",y.toneMappingExposure),v.needsLights&&(N=T,(L=I).ambientLightColor.needsUpdate=N,L.lightProbe.needsUpdate=N,L.directionalLights.needsUpdate=N,L.directionalLightShadows.needsUpdate=N,L.pointLights.needsUpdate=N,L.pointLightShadows.needsUpdate=N,L.spotLights.needsUpdate=N,L.spotLightShadows.needsUpdate=N,L.rectAreaLights.needsUpdate=N,L.hemisphereLights.needsUpdate=N),a&&!0===r.fog&&ae.refreshFogUniforms(I,a),ae.refreshMaterialUniforms(I,r,k,R,V),Xs.upload(_e,Oe(v),I,Q)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Xs.upload(_e,Oe(v),I,Q),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&P.setValue(_e,"center",i.center),P.setValue(_e,"modelViewMatrix",i.modelViewMatrix),P.setValue(_e,"normalMatrix",i.normalMatrix),P.setValue(_e,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(X.isWebGL2){const n=e[t];ge.update(n,M),ge.bind(n,M)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return M}(e,t,n,r,i);Y.setMaterial(r,s);let l=n.index,c=1;if(!0===r.wireframe){if(l=ne.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,d=n.attributes.position;let h=u.start*c,f=(u.start+u.count)*c;null!==a&&(h=Math.max(h,a.start*c),f=Math.min(f,(a.start+a.count)*c)),null!==l?(h=Math.max(h,0),f=Math.min(f,l.count)):null!=d&&(h=Math.max(h,0),f=Math.min(f,d.count));const p=f-h;if(p<0||p===1/0)return;let g;me.setup(i,r,o,n,l);let _=he;if(null!==l&&(g=te.get(l),_=fe,_.setIndex(g)),i.isMesh)!0===r.wireframe?(Y.setLineWidth(r.wireframeLinewidth*W()),_.setMode(_e.LINES)):_.setMode(_e.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),Y.setLineWidth(e*W()),i.isLineSegments?_.setMode(_e.LINES):i.isLineLoop?_.setMode(_e.LINE_LOOP):_.setMode(_e.LINE_STRIP)}else i.isPoints?_.setMode(_e.POINTS):i.isSprite&&_.setMode(_e.TRIANGLES);if(i.isInstancedMesh)_.renderInstances(h,p,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);_.renderInstances(h,p,t)}else _.render(h,p)},this.compile=function(e,t,n=null){null===n&&(n=e),m=oe.get(n),m.init(),_.push(m),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(y._useLegacyLights);const r=new Set;return e.traverse((function(e){const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const a=t[i];Ee(a,n,e),r.add(a)}else Ee(t,n,e),r.add(t)})),_.pop(),m=null,r},this.compileAsync=function(e,t,n=null){const r=this.compile(e,t,n);return new Promise((t=>{function n(){r.forEach((function(e){Z.get(e).currentProgram.isReady()&&r.delete(e)})),0!==r.size?setTimeout(n,10):t(e)}null!==q.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ce=null;function Te(){Ie.stop()}function Pe(){Ie.start()}const Ie=new la;function Re(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=re.update(e),i=e.material;i.visible&&p.push(e,t,i,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){const t=re.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)),G.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(i)){const r=t.groups;for(let a=0,s=r.length;a<s;a++){const s=r[a],o=i[s.materialIndex];o&&o.visible&&p.push(e,t,o,n,G.z,s)}}else i.visible&&p.push(e,t,i,n,G.z,null)}const i=e.children;for(let e=0,a=i.length;e<a;e++)Re(i[e],t,n,r)}function ke(e,t,n,r){const i=e.opaque,a=e.transmissive,s=e.transparent;m.setupLightsView(n),!0===B&&le.setGlobalState(y.clippingPlanes,n),a.length>0&&function(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;const i=X.isWebGL2;null===V&&(V=new Fn(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")?_t:ft,minFilter:ht,samples:i?4:0})),y.getDrawingBufferSize($),i?V.setSize($.x,$.y):V.setSize(un($.x),un($.y));const a=y.getRenderTarget();y.setRenderTarget(V),y.getClearColor(T),P=y.getClearAlpha(),P<1&&y.setClearColor(16777215,.5),y.clear();const s=y.toneMapping;y.toneMapping=Ye,De(e,n,r),Q.updateMultisampleRenderTarget(V),Q.updateRenderTargetMipmap(V);let o=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e],a=i.object,s=i.geometry,l=i.material,c=i.group;if(2===l.side&&a.layers.test(r.layers)){const e=l.side;l.side=1,l.needsUpdate=!0,Le(a,n,r,s,l,c),l.side=e,l.needsUpdate=!0,o=!0}}!0===o&&(Q.updateMultisampleRenderTarget(V),Q.updateRenderTargetMipmap(V)),y.setRenderTarget(a),y.setClearColor(T,P),y.toneMapping=s}(i,a,t,n),r&&Y.viewport(M.copy(r)),i.length>0&&De(i,t,n),a.length>0&&De(a,t,n),s.length>0&&De(s,t,n),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function De(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],s=a.object,o=a.geometry,l=null===r?a.material:r,c=a.group;s.layers.test(n.layers)&&Le(s,t,n,o,l,c)}}function Le(e,t,n,r,i,a){e.onBeforeRender(y,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(y,t,n,r,e,a),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,a),i.side=0,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,a),i.side=2):y.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(y,t,n,r,i,a)}function Ne(e,t,n){!0!==t.isScene&&(t=j);const r=Z.get(e),i=m.state.lights,a=m.state.shadowsArray,s=i.state.version,o=ie.getParameters(e,i.state,a,t,n),l=ie.getProgramCacheKey(o);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ee:J).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",Me),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===s)return Fe(e,o),u}else o.uniforms=ie.getUniforms(e),e.onBuild(n,o,y),e.onBeforeCompile(o,y),u=ie.acquireProgram(o,l),c.set(l,u),r.uniforms=o.uniforms;const d=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=le.uniform),Fe(e,o),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.directionalLightShadows.value=i.state.directionalShadow,d.spotLights.value=i.state.spot,d.spotLightShadows.value=i.state.spotShadow,d.rectAreaLights.value=i.state.rectArea,d.ltc_1.value=i.state.rectAreaLTC1,d.ltc_2.value=i.state.rectAreaLTC2,d.pointLights.value=i.state.point,d.pointLightShadows.value=i.state.pointShadow,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotLightMatrix.value=i.state.spotLightMatrix,d.spotLightMap.value=i.state.spotLightMap,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Oe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Xs.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Fe(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ie.setAnimationLoop((function(e){Ce&&Ce(e)})),"undefined"!=typeof self&&Ie.setContext(self),this.setAnimationLoop=function(e){Ce=e,be.setAnimationLoop(e),null===e?Ie.stop():Ie.start()},be.addEventListener("sessionstart",Te),be.addEventListener("sessionend",Pe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===v)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===be.enabled&&!0===be.isPresenting&&(!0===be.cameraAutoUpdate&&be.updateCamera(t),t=be.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,w),m=oe.get(e,_.length),m.init(),_.push(m),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(H),z=this.localClippingEnabled,B=le.init(this.clippingPlanes,z),p=se.get(e,g.length),p.init(),g.push(p),Re(e,t,0,y.sortObjects),p.finish(),!0===y.sortObjects&&p.sort(D,L),this.info.render.frame++,!0===B&&le.beginShadows();const n=m.state.shadowsArray;if(ce.render(n,e,t),!0===B&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),ue.render(p,e),m.setupLights(y._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];ke(p,e,r,r.viewport)}}else ke(p,e,t);null!==w&&(Q.updateMultisampleRenderTarget(w),Q.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(y,e,t),me.resetDefaultState(),S=-1,A=null,_.pop(),m=_.length>0?_[_.length-1]:null,g.pop(),p=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=n;const r=Z.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===q.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){w=e,b=t,x=n;let r=!0,i=null,a=!1,s=!1;if(e){const o=Z.get(e);void 0!==o.__useDefaultFramebuffer?(Y.bindFramebuffer(_e.FRAMEBUFFER,null),r=!1):void 0===o.__webglFramebuffer?Q.setupRenderTarget(e):o.__hasExternalTextures&&Q.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(c[t])?c[t][n]:c[t],a=!0):i=X.isWebGL2&&e.samples>0&&!1===Q.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,M.copy(e.viewport),E.copy(e.scissor),C=e.scissorTest}else M.copy(N).multiplyScalar(k).floor(),E.copy(O).multiplyScalar(k).floor(),C=F;if(Y.bindFramebuffer(_e.FRAMEBUFFER,i)&&X.drawBuffers&&r&&Y.drawBuffers(e,i),Y.viewport(M),Y.scissor(E),Y.setScissorTest(C),a){const r=Z.get(e.texture);_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(s){const r=Z.get(e.texture),i=t||0;_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}S=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){Y.bindFramebuffer(_e.FRAMEBUFFER,o);try{const s=e.texture,o=s.format,l=s.type;if(o!==vt&&pe.convert(o)!==_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===_t&&(q.has("EXT_color_buffer_half_float")||X.isWebGL2&&q.has("EXT_color_buffer_float"));if(!(l===ft||pe.convert(l)===_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_TYPE)||l===gt&&(X.isWebGL2||q.has("OES_texture_float")||q.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&_e.readPixels(t,n,r,i,pe.convert(o),pe.convert(l),a)}finally{const e=null!==w?Z.get(w).__webglFramebuffer:null;Y.bindFramebuffer(_e.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r);Q.setTexture2D(t,0),_e.copyTexSubImage2D(_e.TEXTURE_2D,n,0,0,e.x,e.y,i,a),Y.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,a=t.image.height,s=pe.convert(n.format),o=pe.convert(n.type);Q.setTexture2D(n,0),_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,n.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?_e.texSubImage2D(_e.TEXTURE_2D,r,e.x,e.y,i,a,s,o,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(_e.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):_e.texSubImage2D(_e.TEXTURE_2D,r,e.x,e.y,s,o,t.image),0===r&&n.generateMipmaps&&_e.generateMipmap(_e.TEXTURE_2D),Y.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,o=e.max.z-e.min.z+1,l=pe.convert(r.format),c=pe.convert(r.type);let u;if(r.isData3DTexture)Q.setTexture3D(r,0),u=_e.TEXTURE_3D;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Q.setTexture2DArray(r,0),u=_e.TEXTURE_2D_ARRAY}_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,r.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,r.unpackAlignment);const d=_e.getParameter(_e.UNPACK_ROW_LENGTH),h=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),f=_e.getParameter(_e.UNPACK_SKIP_PIXELS),p=_e.getParameter(_e.UNPACK_SKIP_ROWS),m=_e.getParameter(_e.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;_e.pixelStorei(_e.UNPACK_ROW_LENGTH,g.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,g.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,e.min.x),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,e.min.y),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?_e.texSubImage3D(u,i,t.x,t.y,t.z,a,s,o,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_e.compressedTexSubImage3D(u,i,t.x,t.y,t.z,a,s,o,l,g.data)):_e.texSubImage3D(u,i,t.x,t.y,t.z,a,s,o,l,c,g),_e.pixelStorei(_e.UNPACK_ROW_LENGTH,d),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,h),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,f),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,p),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,m),0===i&&r.generateMipmaps&&_e.generateMipmap(u),Y.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?Q.setTextureCube(e,0):e.isData3DTexture?Q.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Q.setTexture2DArray(e,0):Q.setTexture2D(e,0),Y.unbindTexture()},this.resetState=function(){b=0,x=0,w=null,Y.reset(),me.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Jt}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Lt?"display-p3":"srgb",t.unpackColorSpace=Mn.workingColorSpace===Nt?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===kt?It:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===It?kt:Dt}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class extends $o{}).prototype.isWebGL1Renderer=!0;class Go extends Ln{constructor(e=null,t=1,n=1,r,i,a,s,o,l=1003,c=1003,u,d){super(null,a,s,o,l,c,r,i,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class jo extends li{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ai(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Wo=new Vn,qo=new Vn,Xo=new _r,Yo=new gr,Ko=new lr;class Zo extends Hr{constructor(e=new Si,t=new jo){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Wo.fromBufferAttribute(t,e-1),qo.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Wo.distanceTo(qo);e.setAttribute("lineDistance",new mi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ko.copy(n.boundingSphere),Ko.applyMatrix4(r),Ko.radius+=i,!1===e.ray.intersectsSphere(Ko))return;Xo.copy(r).invert(),Yo.copy(e.ray).applyMatrix4(Xo);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=new Vn,c=new Vn,u=new Vn,d=new Vn,h=this.isLineSegments?2:1,f=n.index,p=n.attributes.position;if(null!==f)for(let n=Math.max(0,a.start),r=Math.min(f.count,a.start+a.count)-1;n<r;n+=h){const r=f.getX(n),i=f.getX(n+1);if(l.fromBufferAttribute(p,r),c.fromBufferAttribute(p,i),Yo.distanceSqToSegment(l,c,d,u)>o)continue;d.applyMatrix4(this.matrixWorld);const a=e.ray.origin.distanceTo(d);a<e.near||a>e.far||t.push({distance:a,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,a.start),r=Math.min(p.count,a.start+a.count)-1;n<r;n+=h){if(l.fromBufferAttribute(p,n),c.fromBufferAttribute(p,n+1),Yo.distanceSqToSegment(l,c,d,u)>o)continue;d.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(d);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const Qo=new Vn,Jo=new Vn;class el extends Zo{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)Qo.fromBufferAttribute(t,e),Jo.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Qo.distanceTo(Jo);e.setAttribute("lineDistance",new mi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class tl extends li{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ai(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const nl=new _r,rl=new gr,il=new lr,al=new Vn;class sl extends Hr{constructor(e=new Si,t=new tl){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),il.copy(n.boundingSphere),il.applyMatrix4(r),il.radius+=i,!1===e.ray.intersectsSphere(il))return;nl.copy(r).invert(),rl.copy(e.ray).applyMatrix4(nl);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=n.index,c=n.attributes.position;if(null!==l)for(let n=Math.max(0,a.start),i=Math.min(l.count,a.start+a.count);n<i;n++){const i=l.getX(n);al.fromBufferAttribute(c,i),ol(al,i,o,r,e,t,this)}else for(let n=Math.max(0,a.start),i=Math.min(c.count,a.start+a.count);n<i;n++)al.fromBufferAttribute(c,n),ol(al,n,o,r,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function ol(e,t,n,r,i,a,s){const o=rl.distanceSqToPoint(e);if(o<n){const n=new Vn;rl.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,object:s})}}class ll extends Ln{constructor(e,t,n,r,i,a,s,o,l){super(e,t,n,r,i,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class cl extends Si{constructor(e=1,t=1,n=1,r=32,i=1,a=!1,s=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:o};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],d=[],h=[];let f=0;const p=[],m=n/2;let g=0;function _(n){const i=f,a=new fn,p=new Vn;let _=0;const y=!0===n?e:t,v=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*v,0),d.push(0,v,0),h.push(.5,.5),f++;const b=f;for(let e=0;e<=r;e++){const t=e/r*o+s,n=Math.cos(t),i=Math.sin(t);p.x=y*i,p.y=m*v,p.z=y*n,u.push(p.x,p.y,p.z),d.push(0,v,0),a.x=.5*n+.5,a.y=.5*i*v+.5,h.push(a.x,a.y),f++}for(let e=0;e<r;e++){const t=i+e,r=b+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),_+=3}l.addGroup(g,_,!0===n?1:2),g+=_}!function(){const a=new Vn,_=new Vn;let y=0;const v=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*o+s,l=Math.sin(i),p=Math.cos(i);_.x=y*l,_.y=-g*n+m,_.z=y*p,u.push(_.x,_.y,_.z),a.set(l,v,p).normalize(),d.push(a.x,a.y,a.z),h.push(t,1-g),c.push(f++)}p.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=p[t][e],r=p[t+1][e],i=p[t+1][e+1],a=p[t][e+1];c.push(n,r,a),c.push(r,i,a),y+=6}l.addGroup(g,y,0),g+=y}(),!1===a&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new mi(u,3)),this.setAttribute("normal",new mi(d,3)),this.setAttribute("uv",new mi(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cl(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ul extends cl{constructor(e=1,t=1,n=32,r=1,i=!1,a=0,s=2*Math.PI){super(0,e,t,n,r,i,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:s}}static fromJSON(e){return new ul(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class dl extends Si{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],a=[];function s(e,t,n,r){const i=r+1,a=[];for(let r=0;r<=i;r++){a[r]=[];const s=e.clone().lerp(n,r/i),o=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)a[r][e]=0===e&&r===i?s:s.clone().lerp(o,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(o(a[e][n+1]),o(a[e+1][n]),o(a[e][n])):(o(a[e][n+1]),o(a[e+1][n+1]),o(a[e+1][n]))}}function o(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new Vn,r=new Vn,i=new Vn;for(let a=0;a<t.length;a+=3)l(t[a+0],n),l(t[a+1],r),l(t[a+2],i),s(n,r,i,e)}(r),function(e){const t=new Vn;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new Vn;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=u(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);a.push(r,1-s)}var t;(function(){const e=new Vn,t=new Vn,n=new Vn,r=new Vn,s=new fn,o=new fn,l=new fn;for(let d=0,h=0;d<i.length;d+=9,h+=6){e.set(i[d+0],i[d+1],i[d+2]),t.set(i[d+3],i[d+4],i[d+5]),n.set(i[d+6],i[d+7],i[d+8]),s.set(a[h+0],a[h+1]),o.set(a[h+2],a[h+3]),l.set(a[h+4],a[h+5]),r.copy(e).add(t).add(n).divideScalar(3);const f=u(r);c(s,h+0,e,f),c(o,h+2,t,f),c(l,h+4,n,f)}})(),function(){for(let e=0;e<a.length;e+=6){const t=a[e+0],n=a[e+2],r=a[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new mi(i,3)),this.setAttribute("normal",new mi(i.slice(),3)),this.setAttribute("uv",new mi(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dl(e.vertices,e.indices,e.radius,e.details)}}class hl extends dl{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new hl(e.radius,e.detail)}}class fl extends dl{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new fl(e.radius,e.detail)}}class pl extends dl{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new pl(e.radius,e.detail)}}class ml extends Si{constructor(e=1,t=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const a=[],s=[],o=[],l=[],c=new Vn,u=new Vn,d=new Vn;for(let a=0;a<=n;a++)for(let h=0;h<=r;h++){const f=h/r*i,p=a/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(f),u.y=(e+t*Math.cos(p))*Math.sin(f),u.z=t*Math.sin(p),s.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),d.subVectors(u,c).normalize(),o.push(d.x,d.y,d.z),l.push(h/r),l.push(a/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,s=(r+1)*(e-1)+t,o=(r+1)*e+t;a.push(n,i,o),a.push(i,s,o)}this.setIndex(a),this.setAttribute("position",new mi(s,3)),this.setAttribute("normal",new mi(o,3)),this.setAttribute("uv",new mi(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ml(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}function gl(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}class _l{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(e>=i)break e;{const s=t[1];e<s&&(n=2,i=s);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=i,i=t[--n-1],e>=i)break t}a=n,n=0}}for(;n<a;){const r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class yl extends _l{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,a=e+1,s=r[i],o=r[a];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:i=e,s=2*t-n;break;case 2402:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:a=e,o=2*n-t;break;case 2402:a=1,o=n+r[1]-r[0];break;default:a=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-n),this._offsetPrev=i*c,this._offsetNext=a*c}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,g=-d*m+2*d*p-d*f,_=(1+d)*m+(-1.5-2*d)*p+(-.5+d)*f+1,y=(-1-h)*m+(1.5+h)*p+.5*f,v=h*m-h*p;for(let e=0;e!==s;++e)i[e]=g*a[c+e]+_*a[l+e]+y*a[o+e]+v*a[u+e];return i}}class vl extends _l{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==s;++e)i[e]=a[l+e]*u+a[o+e]*c;return i}}class bl extends _l{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class xl{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=gl(t,this.TimeBufferType),this.values=gl(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:gl(e.times,Array),values:gl(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new bl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new vl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new yl(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ct:t=this.InterpolantFactoryMethodDiscrete;break;case Tt:t=this.InterpolantFactoryMethodLinear;break;case Pt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ct;case this.InterpolantFactoryMethodLinear:return Tt;case this.InterpolantFactoryMethodSmooth:return Pt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,a=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=n.slice(i,a),this.values=this.values.slice(i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==a&&a>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,a),e=!1;break}a=r}if(void 0!==r&&(s=r,ArrayBuffer.isView(s)&&!(s instanceof DataView)))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}var s;return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Pt,i=e.length-1;let a=1;for(let s=1;s<i;++s){let i=!1;const o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0]))if(r)i=!0;else{const e=s*n,r=e-n,a=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[a+s]){i=!0;break}}}if(i){if(s!==a){e[a]=e[s];const r=s*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,s=0;s!==n;++s)t[r+s]=t[e+s];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}xl.prototype.TimeBufferType=Float32Array,xl.prototype.ValueBufferType=Float32Array,xl.prototype.DefaultInterpolation=Tt;class wl extends xl{}wl.prototype.ValueTypeName="bool",wl.prototype.ValueBufferType=Array,wl.prototype.DefaultInterpolation=Ct,wl.prototype.InterpolantFactoryMethodLinear=void 0,wl.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends xl{}).prototype.ValueTypeName="color";(class extends xl{}).prototype.ValueTypeName="number";class Sl extends _l{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(n-t)/(r-t);let l=e*s;for(let e=l+s;l!==e;l+=4)zn.slerpFlat(i,0,a,l-s,a,l,o);return i}}class Al extends xl{InterpolantFactoryMethodLinear(e){return new Sl(this.times,this.values,this.getValueSize(),e)}}Al.prototype.ValueTypeName="quaternion",Al.prototype.DefaultInterpolation=Tt,Al.prototype.InterpolantFactoryMethodSmooth=void 0;class Ml extends xl{}Ml.prototype.ValueTypeName="string",Ml.prototype.ValueBufferType=Array,Ml.prototype.DefaultInterpolation=Ct,Ml.prototype.InterpolantFactoryMethodLinear=void 0,Ml.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends xl{}).prototype.ValueTypeName="vector";Error;const El="\\[\\]\\.:\\/",Cl=new RegExp("["+El+"]","g"),Tl="[^"+El+"]",Pl="[^"+El.replace("\\.","")+"]",Il=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Tl)+/(WCOD+)?/.source.replace("WCOD",Pl)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Tl)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Tl)+"$"),Rl=["material","materials","bones","map"];class kl{constructor(e,t,n){this.path=t,this.parsedPath=n||kl.parseTrackName(t),this.node=kl.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new kl.Composite(e,t,n):new kl(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Cl,"")}static parseTrackName(e){const t=Il.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==Rl.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=kl.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}kl.Composite=class{constructor(e,t,n){const r=n||kl.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},kl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},kl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},kl.prototype.GetterByBindingType=[kl.prototype._getValue_direct,kl.prototype._getValue_array,kl.prototype._getValue_arrayElement,kl.prototype._getValue_toArray],kl.prototype.SetterByBindingTypeAndVersioning=[[kl.prototype._setValue_direct,kl.prototype._setValue_direct_setNeedsUpdate,kl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[kl.prototype._setValue_array,kl.prototype._setValue_array_setNeedsUpdate,kl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[kl.prototype._setValue_arrayElement,kl.prototype._setValue_arrayElement_setNeedsUpdate,kl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[kl.prototype._setValue_fromArray,kl.prototype._setValue_fromArray_setNeedsUpdate,kl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:xe}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=xe);var Dl=i(955),Ll=i(30),Nl=i(304);function Ol(e,t){return void 0!==e?e:t}function Fl(e,t){const n=Object.assign({},e);for(const r in t)void 0===e[r]&&(n[r]=t[r]);return n}function Ul(e,t){return e<t?-1:e>t?1:0}function Bl(e,t,n=Ul){let r=0,i=e.length-1;for(;r<=i;){const a=r+i>>1,s=n(t,e[a]);if(s>0)r=a+1;else{if(!(s<0))return a;i=a-1}}return-r-1}function zl(e,t,n){const r=function(e,t){let n=e.length-1;if(e[n]<t)return-1;let r=0;for(;r<=n;){const i=r+n>>1;e[i]>=t?n=i-1:r=i+1}return n+1}(e,t),i=function(e,t){if(e[0]>t)return-1;let n=0,r=e.length-1;for(;n<=r;){const i=n+r>>1;e[i]>t?r=i-1:n=i+1}return n-1}(e,n);return-1===r||-1===i||r>i?0:i-r+1}function Vl(e){return e.sort().filter((function(e,t,n){return 0===t||e!==n[t-1]}))}function Hl(e){const t=28672;if(e.length>t){const n=[];for(let r=0;r<e.length;r+=t)n.push(String.fromCharCode.apply(null,e.subarray(r,r+t)));return n.join("")}return String.fromCharCode.apply(null,e)}function $l(e,t){switch(e){case"int8":return new Int8Array(t);case"int16":return new Int16Array(t);case"int32":return new Int32Array(t);case"uint8":return new Uint8Array(t);case"uint16":return new Uint16Array(t);case"uint32":return new Uint32Array(t);case"float32":return new Float32Array(t);default:throw new Error("arrayType unknown: "+e)}}function Gl(e,t){return new(t>65535?Uint32Array:Uint16Array)(e)}function jl(e){return e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e}function Wl(e){return function(e,t){return void 0===e?e=new t:Array.isArray(e)&&(e=(new t).fromArray(e)),e}(e,Vn)}function ql(e){return(t=e)instanceof(n=Float32Array)?t:new n(t);var t,n}function Xl(e){return Ol(e,"").toString().toLowerCase()}class Yl{constructor(e){this.name=e,this._dict={}}add(e,t){this._dict[Xl(e)]=t}get(e){return this._dict[Xl(e)]}get names(){return Object.keys(this._dict)}}function Kl(e){return.01745*e}const Zl="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Ql=new Array(36);function Jl(){let e,t=0;for(let n=0;n<36;n++)8===n||13===n||18===n||23===n?Ql[n]="-":14===n?Ql[n]="4":(t<=2&&(t=33554432+16777216*Math.random()|0),e=15&t,t>>=4,Ql[n]=Zl[19===n?3&e|8:e]);return Ql.join("")}function ec(e,t,n){return e+(t-e)*n}function tc(e,t,n,r,i,a){const s=(n-e)*a,o=(r-t)*a,l=i*i;return(2*t-2*n+s+o)*(i*l)+(-3*t+3*n-2*s-o)*l+s*i+t}function nc(e,t,n){var r;return r=function(e,t,n){return(e-t)/(n-t)}(n,e,t),(n=function(e,t,n){return Math.max(t,Math.min(n,e))}(r,0,1))*n*(3-2*n)}const rc={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},ic=new ai;function ac(e,t,n){const r=n.value;return n.value=function(e,t){let n=r.bind(this,e,t)();return n},n}class sc{constructor(e={}){this.parameters=Fl(e,rc),"string"==typeof this.parameters.value&&(this.parameters.value=ic.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(e={}){const t=Fl(e,this.parameters);return"rainbow"===t.scale?t.scale=["red","orange","yellow","green","blue"]:"rwb"===t.scale&&(t.scale=["red","white","blue"]),t.reverse&&(t.domain=t.domain.slice().reverse()),Dl.scale(t.scale).mode(t.mode).domain(t.domain).out("num")}colorToArray(e,t=[],n=0){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t}atomColorToArray(e,t,n){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,n)}bondColor(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(e,t,n,r){return this.colorToArray(this.bondColor(e,t),n,r)}volumeColorToArray(e,t,n){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,n)}positionColorToArray(e,t,n){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,n)}}var oc,lc;(lc=oc||(oc={}))[lc.PROTEIN=1]="PROTEIN",lc[lc.NUCLEIC=2]="NUCLEIC",lc[lc.RNA=3]="RNA",lc[lc.DNA=4]="DNA",lc[lc.POLYMER=5]="POLYMER",lc[lc.WATER=6]="WATER",lc[lc.HELIX=7]="HELIX",lc[lc.SHEET=8]="SHEET",lc[lc.TURN=9]="TURN",lc[lc.BACKBONE=10]="BACKBONE",lc[lc.SIDECHAIN=11]="SIDECHAIN",lc[lc.ALL=12]="ALL",lc[lc.HETERO=13]="HETERO",lc[lc.ION=14]="ION",lc[lc.SACCHARIDE=15]="SACCHARIDE",lc[lc.SUGAR=15]="SUGAR",lc[lc.BONDED=16]="BONDED",lc[lc.RING=17]="RING",lc[lc.AROMATICRING=18]="AROMATICRING",lc[lc.METAL=19]="METAL",lc[lc.POLARH=20]="POLARH",lc[lc.NONE=21]="NONE";const cc=["*","","ALL"],uc=["NONE"],dc=[oc.BACKBONE,oc.SIDECHAIN,oc.BONDED,oc.RING,oc.AROMATICRING,oc.METAL,oc.POLARH],hc=[oc.POLYMER,oc.WATER],fc=["ALA","GLY","SER"],pc=["CYS","SER","THR"],mc=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],gc=["PHE","TRP","TYR","HIS"],_c=["ASN","GLN"],yc=["ASP","GLU"],vc=["ARG","HIS","LYS"],bc=["ARG","ASP","GLU","HIS","LYS"],xc=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],wc=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],Sc=["HIS","PHE","PRO","TRP","TYR"],Ac=["ALA","GLY","ILE","LEU","VAL"];function Mc(e,t){if(void 0===t.atomname&&void 0===t.element&&void 0===t.altloc&&void 0===t.atomindex&&void 0===t.keyword&&void 0===t.inscode&&void 0===t.resname&&void 0===t.sstruc&&void 0===t.resno&&void 0===t.chainname&&void 0===t.model)return-1;if(void 0!==t.keyword){if(t.keyword===oc.BACKBONE&&!e.isBackbone())return!1;if(t.keyword===oc.SIDECHAIN&&!e.isSidechain())return!1;if(t.keyword===oc.BONDED&&!e.isBonded())return!1;if(t.keyword===oc.RING&&!e.isRing())return!1;if(t.keyword===oc.AROMATICRING&&!e.isAromatic())return!1;if(t.keyword===oc.HETERO&&!e.isHetero())return!1;if(t.keyword===oc.PROTEIN&&!e.isProtein())return!1;if(t.keyword===oc.NUCLEIC&&!e.isNucleic())return!1;if(t.keyword===oc.RNA&&!e.isRna())return!1;if(t.keyword===oc.DNA&&!e.isDna())return!1;if(t.keyword===oc.POLYMER&&!e.isPolymer())return!1;if(t.keyword===oc.WATER&&!e.isWater())return!1;if(t.keyword===oc.HELIX&&!e.isHelix())return!1;if(t.keyword===oc.SHEET&&!e.isSheet())return!1;if(t.keyword===oc.TURN&&!e.isTurn())return!1;if(t.keyword===oc.ION&&!e.isIon())return!1;if(t.keyword===oc.SACCHARIDE&&!e.isSaccharide())return!1;if(t.keyword===oc.METAL&&!e.isMetal())return!1;if(t.keyword===oc.POLARH&&!e.isPolarHydrogen())return!1}if(void 0!==t.atomname&&t.atomname!==e.atomname)return!1;if(void 0!==t.element&&t.element!==e.element)return!1;if(void 0!==t.altloc&&t.altloc!==e.altloc)return!1;if(void 0!==t.atomindex&&Bl(t.atomindex,e.index)<0)return!1;if(void 0!==t.resname)if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1;if(void 0!==t.sstruc&&t.sstruc!==e.sstruc)return!1;if(void 0!==t.resno)if(Array.isArray(t.resno)&&2===t.resno.length){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1;return!(void 0!==t.inscode&&t.inscode!==e.inscode||void 0!==t.chainname&&t.chainname!==e.chainname||void 0!==t.model&&t.model!==e.modelIndex)}function Ec(e,t){if(void 0===t.resname&&void 0===t.resno&&void 0===t.inscode&&void 0===t.sstruc&&void 0===t.model&&void 0===t.chainname&&void 0===t.atomindex&&(void 0===t.keyword||dc.includes(t.keyword)))return-1;if(void 0!==t.keyword){if(t.keyword===oc.HETERO&&!e.isHetero())return!1;if(t.keyword===oc.PROTEIN&&!e.isProtein())return!1;if(t.keyword===oc.NUCLEIC&&!e.isNucleic())return!1;if(t.keyword===oc.RNA&&!e.isRna())return!1;if(t.keyword===oc.DNA&&!e.isDna())return!1;if(t.keyword===oc.POLYMER&&!e.isPolymer())return!1;if(t.keyword===oc.WATER&&!e.isWater())return!1;if(t.keyword===oc.HELIX&&!e.isHelix())return!1;if(t.keyword===oc.SHEET&&!e.isSheet())return!1;if(t.keyword===oc.TURN&&!e.isTurn())return!1;if(t.keyword===oc.ION&&!e.isIon())return!1;if(t.keyword===oc.SACCHARIDE&&!e.isSaccharide())return!1}if(void 0!==t.atomindex&&0===zl(t.atomindex,e.atomOffset,e.atomEnd))return!1;if(void 0!==t.resname)if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1;if(void 0!==t.sstruc&&t.sstruc!==e.sstruc)return!1;if(void 0!==t.resno)if(Array.isArray(t.resno)&&2===t.resno.length){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1;return!(void 0!==t.inscode&&t.inscode!==e.inscode||void 0!==t.chainname&&t.chainname!==e.chainname||void 0!==t.model&&t.model!==e.modelIndex)}function Cc(e,t){if(!(void 0!==t.chainname||void 0!==t.model||void 0!==t.atomindex||void 0!==t.keyword&&hc.includes(t.keyword)&&e.entity))return-1;if(void 0!==t.keyword){if(t.keyword===oc.POLYMER&&!e.entity.isPolymer())return!1;if(t.keyword===oc.WATER&&!e.entity.isWater())return!1}return!(void 0!==t.atomindex&&0===zl(t.atomindex,e.atomOffset,e.atomEnd)||void 0!==t.chainname&&t.chainname!==e.chainname||void 0!==t.model&&t.model!==e.modelIndex)}function Tc(e,t){return void 0===t.model&&void 0===t.atomindex?-1:!(void 0!==t.atomindex&&0===zl(t.atomindex,e.atomOffset,e.atomEnd)||void 0!==t.model&&t.model!==e.index)}function Pc(e,t){if(null===e)return!1;if(e.error)return!1;if(!e.rules||0===e.rules.length)return!1;const n=e.rules.length,r=!e.negate,i=!!e.negate,a=[];for(let r=0;r<n;++r){const n=e.rules[r];n.hasOwnProperty("operator")&&(a[r]=Pc(n,t))}return function(s){const o="AND"===e.operator;let l=!1;for(let c=0;c<n;++c){const n=e.rules[c];let u;if(n.hasOwnProperty("operator")){const e=a[c];if(u=!1!==e?e(s):-1,-1===u){l=!0;continue}if(!0===u){if(o)continue;return r}if(o)return i}else{if(n.keyword===oc.ALL){if(o)continue;return r}if(n.keyword===oc.NONE){if(o)continue;return i}if(u=t(s,n),-1!==u){if(!0===u){if(o)continue;return r}if(o)return i}else l=!0}}return l?-1:o?r:i}}function Ic(e,t){if(e.error)return e;if(!e.rules||0===e.rules.length)return e;const n=e.rules.length,r={operator:e.operator,rules:[]};e.hasOwnProperty("negate")&&(r.negate=e.negate);for(let i=0;i<n;++i){const n=e.rules[i];if(n.hasOwnProperty("operator")){const e=Ic(n,t);null!==e&&r.rules.push(e)}else t(n)||r.rules.push(n)}return r.rules.length>0?e:null}function Rc(e,t=!1){let n=e;return t&&(n=Ic(e,(function(e){return void 0!==e.keyword&&!dc.includes(e.keyword)||void 0!==e.model||void 0!==e.chainname||void 0!==e.resname||void 0!==e.resno||void 0!==e.sstruc}))),Pc(n,Mc)}function kc(e,t=!1){let n=e;return t&&(n=Ic(e,(function(e){return!(void 0===e.keyword||!dc.includes(e.keyword))||void 0!==e.model||void 0!==e.chainname||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc}))),Pc(n,Ec)}function Dc(e,t=!1){let n=e;return t&&(n=Ic(e,(function(e){return void 0!==e.keyword&&!hc.includes(e.keyword)||void 0!==e.resname||void 0!==e.resno||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc||void 0!==e.sstruc||void 0!==e.inscode}))),Pc(n,Cc)}function Lc(e,t=!1){let n=e;return t&&(n=Ic(e,(function(e){return void 0!==e.keyword||void 0!==e.chainname||void 0!==e.resname||void 0!==e.resno||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc||void 0!==e.sstruc||void 0!==e.inscode}))),Pc(n,Tc)}class Nc{constructor(e){this.signals={stringChanged:new Ll.Signal},this.setString(e)}get type(){return"selection"}setString(e,t){if(void 0===e&&(e=this.string||""),e===this.string)return;try{this.selection=function(e){let t={operator:void 0,rules:[]};if(!e)return t;let n,r,i=t;const a=[];"("===(e=e.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)&&")"===e.substr(-1)&&(e=e.slice(1,-1).trim());const s=e.split(/\s+/),o=e=>{n={operator:e,rules:[]},void 0===i?(i=n,t=n):(i.rules.push(n),a.push(i),i=n)},l=function(e){r=i,i=a.pop(),void 0===i&&(o(e),c(r))},c=function(e){i.rules.push(e)};let u=!1;for(let e=0;e<s.length;++e){const t=s[e],n=t.toUpperCase();if("("===t){u=!1,o();continue}if(")"===t){l(),i.negate&&l();continue}if(u>0)if("NOT"===n)u=1;else if(1===u)u=2;else{if(2!==u)throw new Error("something went wrong with 'not'");u=!1,l()}if("AND"===n){if("OR"===i.operator){const e=i.rules.pop();o("AND"),c(e)}else i.operator="AND";continue}if("OR"===n){"AND"===i.operator?l("OR"):i.operator="OR";continue}if("NOT"===t.toUpperCase()){u=1,o(),i.negate=!0;continue}if(+n!=+n){const e=oc[n];if(void 0!==e){c({keyword:e});continue}}if("HYDROGEN"===n){c({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if("SMALL"===n){c({resname:fc});continue}if("NUCLEOPHILIC"===n){c({resname:pc});continue}if("HYDROPHOBIC"===n){c({resname:mc});continue}if("AROMATIC"===n){c({resname:gc});continue}if("AMIDE"===n){c({resname:_c});continue}if("ACIDIC"===n){c({resname:yc});continue}if("BASIC"===n){c({resname:vc});continue}if("CHARGED"===n){c({resname:bc});continue}if("POLAR"===n){c({resname:xc});continue}if("NONPOLAR"===n){c({resname:wc});continue}if("CYCLIC"===n){c({resname:Sc});continue}if("ALIPHATIC"===n){c({resname:Ac});continue}if("SIDECHAINATTACHED"===n){c({operator:"OR",rules:[{keyword:oc.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:oc.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:oc.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if("APOLARH"===n){c({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:oc.POLARH}]}]});continue}if("LIGAND"===n){c({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:oc.HETERO},{negate:!0,operator:void 0,rules:[{keyword:oc.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:oc.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:oc.WATER},{keyword:oc.ION}]}]}]});continue}if(-1!==cc.indexOf(n)){c({keyword:oc.ALL});continue}if("@"===t.charAt(0)){const e=t.substr(1).split(",").map((e=>parseInt(e)));e.sort((function(e,t){return e-t})),c({atomindex:e});continue}if("#"===t.charAt(0)){console.error("# for element selection deprecated, use _"),c({element:n.substr(1)});continue}if("_"===t.charAt(0)){c({element:n.substr(1)});continue}if("["===t[0]&&"]"===t[t.length-1]){const e=n.substr(1,t.length-2).split(","),r=e.length>1?e:e[0];c({resname:r});continue}if(t.length>=1&&t.length<=4&&"^"!==t[0]&&":"!==t[0]&&"."!==t[0]&&"%"!==t[0]&&"/"!==t[0]&&isNaN(parseInt(t))){c({resname:n});continue}const r={operator:"AND",rules:[]},a=t.split("/");if(a.length>1&&a[1]){if(isNaN(parseInt(a[1])))throw new Error("model must be an integer");r.rules.push({model:parseInt(a[1])})}const d=a[0].split("%");d.length>1&&r.rules.push({altloc:d[1]});const h=d[0].split(".");if(h.length>1&&h[1]){if(h[1].length>4)throw new Error("atomname must be one to four characters");r.rules.push({atomname:h[1].substring(0,4).toUpperCase()})}const f=h[0].split(":");f.length>1&&f[1]&&r.rules.push({chainname:f[1]});const p=f[0].split("^");if(p.length>1&&r.rules.push({inscode:p[1]}),p[0]){let e,t;"-"===p[0][0]&&(p[0]=p[0].substr(1),e=!0),p[0].includes("--")&&(p[0]=p[0].replace("--","-"),t=!0);let n=p[0].split("-");if(1===n.length){let t=parseInt(n[0]);if(isNaN(t))throw new Error("resi must be an integer");e&&(t*=-1),r.rules.push({resno:t})}else{if(2!==n.length)throw new Error("resi range must contain one '-'");{const i=n.map((e=>parseInt(e)));e&&(i[0]*=-1),t&&(i[1]*=-1),r.rules.push({resno:[i[0],i[1]]})}}}if(1===r.rules.length)c(r.rules[0]);else{if(!(r.rules.length>1))throw new Error("empty selection chunk");c(r)}}return void 0===t.operator&&1===t.rules.length&&t.rules[0].hasOwnProperty("operator")&&(t=t.rules[0]),t}(e)}catch(e){this.selection={error:e.message}}const n=this.selection;this.string=e,this.test=Rc(n),this.residueTest=kc(n),this.chainTest=Dc(n),this.modelTest=Lc(n),this.atomOnlyTest=Rc(n,!0),this.residueOnlyTest=kc(n,!0),this.chainOnlyTest=Dc(n,!0),this.modelOnlyTest=Lc(n,!0),t||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return cc.includes(this.string.toUpperCase())}isNoneSelection(){return uc.includes(this.string.toUpperCase())}}class Oc extends sc{constructor(e){super(e),this.colormakerList=[],this.selectionList=[],(e.dataList||[]).forEach((e=>{const[t,n,r={}]=e;Zc.hasScheme(t)?Object.assign(r,{scheme:t,structure:this.parameters.structure}):Object.assign(r,{scheme:"uniform",value:new ai(t).getHex()}),this.colormakerList.push(Zc.getScheme(r)),this.selectionList.push(new Nc(n))}))}atomColor(e){for(let t=0,n=this.selectionList.length;t<n;++t){const n=this.selectionList[t].test;if(n&&n(e))return this.colormakerList[t].atomColor(e)}return 16777215}}const Fc={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},Uc={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};function Bc(e){const t=e;return e.forEach((function(e){e.__deps&&Array.prototype.push.apply(t,Bc(e.__deps))})),t}function zc(e){return Vl(Bc(e)).map((function(e){return e.toString()})).join("\n\n\n")}function Vc(e){const t=e.data.__name,n=e.data.__postId;if(void 0===t)console.error("message __name undefined");else if(void 0===self.func)console.error("worker func undefined",t);else{const t=function(e,t){e=e||{},void 0!==n&&(e.__postId=n);try{self.postMessage(e,t)}catch(t){console.error("self.postMessage:",t),self.postMessage(e)}};self.func(e,t)}}function Hc(e,t){let n="'use strict';\n\n"+zc(t);return n+="\n\n\nself.func = "+e.toString()+";",n+="\n\n\nself.onmessage = "+Vc.toString()+";",new Blob([n],{type:"application/javascript"})}const $c=function(){if("undefined"==typeof window)return!1;const e=window.navigator.userAgent;return/Opera|OPR/.test(e)?"Opera":/Chrome/i.test(e)?"Chrome":/Firefox/i.test(e)?"Firefox":/Mobile(\/.*)? Safari/i.test(e)?"Mobile Safari":/MSIE/i.test(e)?"Internet Explorer":!!/Safari/i.test(e)&&"Safari"}();let Gc=!1;try{const e=Object.defineProperty({},"passive",{get:function(){Gc=!0}});window.addEventListener("test",(e=>{}),e)}catch(lc){}const jc="undefined"!=typeof window&&void 0!==window.orientation;const Wc={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let qc={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1},Xc=!!(Yc=function(e){if("undefined"==typeof window)return;const t=new RegExp("debug=([^&#=]*)").exec(window.location.search);return t?decodeURIComponent(t[1]):void 0}())&&("string"!=typeof Yc||/^1|true|t|yes|y$/i.test(Yc));var Yc;const Kc=new class{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(e,t,n){this._funcDict[e]=t,this._depsDict[e]=n}get(e){return this._blobDict[e]||(this._blobDict[e]=Hc(this._funcDict[e],this._depsDict[e])),this._blobDict[e]}},Zc=new class{constructor(){this.schemes={},this.userSchemes={}}getScheme(e){const t=((e||{}).scheme||"").toLowerCase();let n;return n=t in this.schemes?this.schemes[t]:t in this.userSchemes?this.userSchemes[t]:sc,new n(e)}getSchemes(){const e={};return Object.keys(this.schemes).forEach((function(t){e[t]=t})),Object.keys(this.userSchemes).forEach((function(t){e[t]=t.split("|")[1]})),e}getScales(){return Fc}getModes(){return Uc}add(e,t){e=e.toLowerCase(),this.schemes[e]=t}addScheme(e,t){return function(e){return e instanceof sc}(e)||(e=this._createScheme(e)),this._addUserScheme(e,t)}_addUserScheme(e,t){t=t||"";const n=`${Jl()}|${t}`.toLowerCase();return this.userSchemes[n]=e,n}removeScheme(e){e=e.toLowerCase(),delete this.userSchemes[e]}_createScheme(e){return class extends sc{constructor(t){super(t),e.call(this,t)}}}addSelectionScheme(e,t){return this._addUserScheme(class extends Oc{constructor(t){super(Object.assign({dataList:e},t))}},t)}hasScheme(e){return(e=e.toLowerCase())in this.schemes||e in this.userSchemes}},Qc=new Yl("datasource"),Jc=new Yl("representatation"),eu=new class extends Yl{constructor(){super("parser")}__hasObjName(e,t){const n=this.get(e);return n&&n.prototype.__objName===t}isTrajectory(e){return this.__hasObjName(e,"frames")}isStructure(e){return this.__hasObjName(e,"structure")}isVolume(e){return this.__hasObjName(e,"volume")}isSurface(e){return this.__hasObjName(e,"surface")}isBinary(e){const t=this.get(e);return t&&t.prototype.isBinary}isXml(e){const t=this.get(e);return t&&t.prototype.isXml}isJson(e){const t=this.get(e);return t&&t.prototype.isJson}getTrajectoryExtensions(){return this.names.filter((e=>this.isTrajectory(e)))}getStructureExtensions(){return this.names.filter((e=>this.isStructure(e)))}getVolumeExtensions(){return this.names.filter((e=>this.isVolume(e)))}getSurfaceExtensions(){return this.names.filter((e=>this.isSurface(e)))}},tu=new Yl("shader"),nu=new Yl("decompressor"),ru=new Yl("component"),iu=new Yl("buffer"),au=new Yl("picker");let su;function ou(e){const t=nu.names;let n,r,i="";n=e instanceof File?e.name:e instanceof Blob?"":e;const a=n.lastIndexOf("?"),s=-1!==a?n.substring(a):"";n=n.substring(0,-1===a?n.length:a);const o=n.replace(/^.*[\\/]/,"");let l=o.substring(0,o.lastIndexOf("."));const c=o.split(".");let u=c.length>1?(c.pop()||"").toLowerCase():"";const d=n.match(/^(.+):\/\/(.+)$/);d&&(i=d[1].toLowerCase(),n=d[2]||"");const h=n.substring(0,n.lastIndexOf("/")+1);if(t.includes(u)){r=u;const e=n.length-u.length-1;u=(n.substr(0,e).split(".").pop()||"").toLowerCase();const t=l.length-u.length-1;l=l.substr(0,t)}else r=!1;return{path:n,name:o,ext:u,base:l,dir:h,compressed:r,protocol:i,query:s,src:e}}const lu=[];class cu{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;void 0===e&&(e=8192),"number"==typeof e?e=new ArrayBuffer(e):n=!0;const r=t.offset?t.offset>>>0:0;let i=e.byteLength-r,a=r;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(a=e.byteOffset+r),e=e.buffer),this._lastWrittenByte=n?i:0,this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=a,this._data=new DataView(this.buffer,a,i)}available(e){return void 0===e&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return void 0===e&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(void 0===e&&(e=1),!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){void 0===e&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){lu.length=e;for(var t=0;t<e;t++)lu[t]=this.readChar();return lu.join("")}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class uu{constructor(){this.count=0,this.signals={countChanged:new Ll.Signal}}clear(){this.change(-this.count)}change(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&Wc.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(e){this.change(e.count),e.signals.countChanged.add(this.change,this)}unlisten(e){const t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)}onZeroOnce(e,t){if(0===this.count)e.call(t);else{const n=()=>{0===this.count&&(this.signals.countChanged.remove(n,this),e.call(t))};this.signals.countChanged.add(n,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}tu.add("shader/BasicLine.vert","void main(){\n#include begin_vertex\n#include project_vertex\n}"),tu.add("shader/BasicLine.frag","uniform vec3 uColor;\n#include common\n#include fog_pars_fragment\nvoid main(){\ngl_FragColor = vec4( uColor, 1.0 );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n}"),tu.add("shader/Quad.vert","varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),tu.add("shader/Quad.frag","varying vec2 vUv;\nuniform sampler2D tForeground;\nuniform float scale;\nvoid main() {\nvec4 foreground = texture2D( tForeground, vUv );\ngl_FragColor = foreground * scale;\n}"),tu.add("shader/chunk/fog_fragment.glsl","#ifdef USE_FOG\nfloat depth = length( vViewPosition );\n#ifdef FOG_EXP2\nfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif"),tu.add("shader/chunk/interior_fragment.glsl","if( gl_FrontFacing == false ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}"),tu.add("shader/chunk/matrix_scale.glsl","float matrixScale( in mat4 m ){\nvec4 r = m[ 0 ];\nreturn sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );\n}"),tu.add("shader/chunk/nearclip_vertex.glsl","#ifdef NEAR_CLIP\nif( vViewPosition.z < clipNear - 5.0 )\ngl_Position.z = 2.0 * gl_Position.w;\n#endif"),tu.add("shader/chunk/nearclip_fragment.glsl","#ifdef NEAR_CLIP\nif( vViewPosition.z < clipNear )\ndiscard;\n#endif"),tu.add("shader/chunk/opaque_back_fragment.glsl","#ifdef OPAQUE_BACK\n#ifdef FLIP_SIDED\nif( gl_FrontFacing == true ){\ngl_FragColor.a = 1.0;\n}\n#else\nif( gl_FrontFacing == false ){\ngl_FragColor.a = 1.0;\n}\n#endif\n#endif"),tu.add("shader/chunk/radiusclip_vertex.glsl","#ifdef RADIUS_CLIP\nif( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )\ngl_Position.z = 2.0 * gl_Position.w;\n#endif"),tu.add("shader/chunk/radiusclip_fragment.glsl","#ifdef RADIUS_CLIP\nif( distance( vViewPosition, vClipCenter ) > clipRadius )\ndiscard;\n#endif"),tu.add("shader/chunk/unpack_color.glsl","vec3 unpackColor(float f) {\nvec3 color;\ncolor.r = floor(f / 256.0 / 256.0);\ncolor.g = floor((f - color.r * 256.0 * 256.0) / 256.0);\ncolor.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);\nreturn color / 255.0;\n}");const du=/^(?!\/\/)\s*#include\s+(\S+)/gim,hu={};if("undefined"!=typeof WebGLRenderingContext){const e=WebGLRenderingContext.prototype,t=e.getShaderParameter;e.getShaderParameter=function(){return!Xc||t.apply(this,arguments)};const n=e.getShaderInfoLog;e.getShaderInfoLog=function(){return Xc?n.apply(this,arguments):""};const r=e.getProgramParameter;e.getProgramParameter=function(t,n){return!Xc&&n===e.LINK_STATUS||r.apply(this,arguments)};const i=e.getProgramInfoLog;e.getProgramInfoLog=function(){return Xc?i.apply(this,arguments):""}}[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]].forEach((e=>{e.forEach((e=>{e[0]*=.0625,e[1]*=.0625}))}));const fu=2*Math.PI,pu=180/Math.PI;function mu(e,t,n=1,r=0,i){const a=i?i.length:e.length/n;let s=0,o=0;if(i)for(let l=0;l<a;++l){const a=(e[i[l]*n+r]+t)%t/t*fu-Math.PI;s+=Math.cos(a),o+=Math.sin(a)}else for(let i=r;i<a;i+=n){const n=(e[i]+t)%t/t*fu-Math.PI;s+=Math.cos(n),o+=Math.sin(n)}return s/=a,o/=a,(Math.atan2(o,s)+Math.PI)/fu*t}function gu(e,t,n,r=0){const i=e.length,a=n||new Float32Array(i);for(let n=0;n<i;n+=3)a[r+n+0]=(e[n+0]+t[n+0])/2,a[r+n+1]=(e[n+1]+t[n+1])/2,a[r+n+2]=(e[n+2]+t[n+2])/2;return a}function _u(e,t){const n=e.length,r=new Float32Array(n);for(let i=0;i<n;i+=3)r[i+0]=t[i+0]-e[i+0],r[i+1]=t[i+1]-e[i+1],r[i+2]=t[i+2]-e[i+2];return r}function yu(e,t,n){const r=n||new Float32Array(e);for(let n=0;n<e;++n)r[n]=t;return r}function vu(e,t,n,r,i){const a=i||new Float32Array(3*e);for(let i=0;i<e;++i){const e=3*i;a[e+0]=t,a[e+1]=n,a[e+2]=r}return a}function bu(e){const t=new Float32Array(e);for(let n=0;n<e;++n)t[n]=n;return t}function xu(e,t,n=0,r){const i=r||new Float32Array(e*t);for(let r=0;r<e;++r){const e=n+r*t;for(let n=0;n<t;++n)i[e+n]=r}return i}function wu(e,t){const n=e.length,r=new Float32Array(n*t);for(let i=0;i<n;++i){const n=i*t,a=e[i];for(let e=0;e<t;++e)r[n+e]=a}return r}function Su(e,t,n,r,i){for(let a=0;a<i;++a)t[r+a]=e[n+a]}function Au(e,t,n,r){Su(e,e,t,n,r)}function Mu(e){let t=-1/0;for(let n=0,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}function Eu(e){let t=1/0;for(let n=0,r=e.length;n<r;++n)e[n]<t&&(t=e[n]);return t}function Cu(e,t=1,n=0){const r=e.length;let i=0;for(let a=n;a<r;a+=t)i+=e[a];return i}function Tu(e,t=1,n=0){return Cu(e,t,n)/(e.length/t)}new Vn,new _r,new _r,new fn,new _r,new _r,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),new Float32Array(100),new Uint8Array(100),new _r,new _r,new _r,new _r,new _r,new _r,new Vn,new zn,new zn,new _r,new Vn,new Vn,new Vn,new zn,new Vn,new Vn,new Vn,new Vn,new _r,new Vn,new _r;class Pu{constructor(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(let e=0,n=t.length;e<n;++e)this.queue.push(t[e]);this.next()}}run(e){this.fn(e,this.next)}next(){const e=this.queue.shift();void 0!==e?(this.pending=!0,setTimeout((()=>this.run(e)))):this.pending=!1}push(e){this.queue.push(e),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class Iu{constructor(e,t,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:Zc.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:Zc.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new uu,this.queue=new Pu(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=Zc.getSchemes()),this.toBePrepared=!1}init(e){const t=e||{};this.clipNear=Ol(t.clipNear,0),this.clipRadius=Ol(t.clipRadius,0),this.clipCenter=Ol(t.clipCenter,new Vn),this.flatShaded=Ol(t.flatShaded,!1),this.side=Ol(t.side,"double"),this.opacity=Ol(t.opacity,1),this.depthWrite=Ol(t.depthWrite,!0),this.wireframe=Ol(t.wireframe,!1),this.setColor(t.color,t),this.colorData=Ol(t.colorData,void 0),this.colorScheme=Ol(t.colorScheme,"uniform"),this.colorScale=Ol(t.colorScale,""),this.colorReverse=Ol(t.colorReverse,!1),this.colorValue=Ol(t.colorValue,9474192),this.colorDomain=Ol(t.colorDomain,void 0),this.colorMode=Ol(t.colorMode,"hcl"),this.visible=Ol(t.visible,!0),this.quality=Ol(t.quality,void 0),this.roughness=Ol(t.roughness,.4),this.metalness=Ol(t.metalness,0),this.diffuse=Ol(t.diffuse,16777215),this.diffuseInterior=Ol(t.diffuseInterior,!1),this.useInteriorColor=Ol(t.useInteriorColor,!1),this.interiorColor=Ol(t.interiorColor,2236962),this.interiorDarkening=Ol(t.interiorDarkening,0),this.lazy=Ol(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=Ol(t.matrix,new _r),this.disablePicking=Ol(t.disablePicking,!1);const n=this.parameters;!0===n.sphereDetail&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),!0===n.radialSegments&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),!0===n.openEnded&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),!0===n.disableImpostor&&(n.disableImpostor={type:"boolean",rebuild:!0}),"low"===t.quality?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):"medium"===t.quality?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):"high"===t.quality?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=Ol(t.sphereDetail,1)),n.radialSegments&&(this.radialSegments=Ol(t.radialSegments,10))),n.openEnded&&(this.openEnded=Ol(t.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=Ol(t.disableImpostor,!1))}getColorParams(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)}getBufferParams(e={}){return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)}setColor(e,t){const n=Object.keys(Zc.getSchemes());if("string"==typeof e&&n.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(void 0!==e){let n=new ai(e).getHex();t?(t.colorScheme="uniform",t.colorValue=n):this.setParameters({colorScheme:"uniform",colorValue:n})}return this}prepare(e){}create(){}update(e){this.build()}build(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0}make(e,t){Xc&&Wc.time("Representation.make "+this.type);const n=()=>{e?(this.update(e),this.viewer.requestRender(),this.tasks.decrement(),t&&t()):(this.clear(),this.create(),this.manualAttach||this.disposed||(Xc&&Wc.time("Representation.attach "+this.type),this.attach((()=>{Xc&&Wc.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),t&&t()})))),Xc&&Wc.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(n):n()}attach(e){this.setVisibility(this.visible),e()}setVisibility(e,t){if(this.visible=e,this.visible&&this.opacity){const e=this.lazyProps,t=e.bufferParams,n=e.what;if(e.build)return e.build=!1,this.build(),this;(Object.keys(t).length||Object.keys(n).length)&&(e.bufferParams={},e.what={},this.updateParameters(t,n))}return this.bufferList.forEach((function(t){t.setVisibility(e)})),t||this.viewer.requestRender(),this}setParameters(e,t={},n=!1){const r=e||{},i=this.parameters,a={};this.opacity||void 0===r.opacity||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(a,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(r.color,r);for(let e in r)void 0!==r[e]&&null!=i[e]&&(i[e].int&&(r[e]=parseInt(r[e])),i[e].float&&(r[e]=parseFloat(r[e])),r[e]!==this[e]||r[e].equals&&!r[e].equals(this[e]))&&(this[e]&&this[e].copy&&r[e].copy?this[e].copy(r[e]):this[e]&&this[e].set?this[e].set(r[e]):this[e]=r[e],i[e].buffer&&(!0===i[e].buffer?a[e]=r[e]:a[i[e].buffer]=r[e]),i[e].update&&(t[i[e].update]=!0),!i[e].rebuild||(i[e].rebuild,0)||(n=!0));return n?this.build():this.updateParameters(a,t),this}updateParameters(e={},t){if(this.lazy&&(!this.visible||!this.opacity)&&!1===e.hasOwnProperty("opacity"))return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach((function(t){t.setParameters(e)})),Object.keys(t).length&&this.update(t),this.viewer.requestRender()}getParameters(){const e={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach((t=>{null!==this.parameters[t]&&(e[t]=this[t])})),e}clear(){this.bufferList.forEach((e=>{this.viewer.remove(e),e.dispose()})),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class Ru{constructor(e){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=e,this.blobUrl=window.URL.createObjectURL(Kc.get(e)),this.worker=new Worker(this.blobUrl),Kc.activeWorkerCount+=1,this.worker.onmessage=t=>{this.pending-=1;const n=t.data.__postId;Xc&&Wc.timeEnd("Worker.postMessage "+e+" #"+n);const r=this.onmessageDict[n];r&&r.call(this.worker,t),delete this.onmessageDict[n],delete this.onerrorDict[n]},this.worker.onerror=t=>{if(this.pending-=1,t.data){const n=t.data.__postId,r=this.onerrorDict[n];r?r.call(this.worker,t):Wc.error("Worker.onerror",n,e,t),delete this.onmessageDict[n],delete this.onerrorDict[n]}else Wc.error("Worker.onerror",e,t)}}post(e={},t,n,r){this.onmessageDict[this.postCount]=n,this.onerrorDict[this.postCount]=r,e.__name=this.name,e.__postId=this.postCount,e.__debug=Xc,Xc&&Wc.time(`Worker.postMessage ${this.name} #${this.postCount}`);try{this.worker.postMessage(e,t)}catch(t){Wc.error("worker.post:",t),this.worker.postMessage(e)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),Kc.activeWorkerCount-=1):Wc.log("no worker to terminate")}}class ku{constructor(e,t=2){this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e}post(e={},t,n,r){const i=this.getNextWorker();return i?i.post(e,t,n,r):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach((function(e){e.terminate()}))}getNextWorker(){let e,t=1/0;for(let n=0;n<this.maxCount;++n){if(n>=this.count){e=new Ru(this.name),this.pool.push(e),this.count+=1;break}const r=this.pool[n];if(0===r.pending){e=r;break}r.pending<t&&(t=r.pending,e=r)}return e}}function Du(e){const t=e.length,n=t/3;let r=0,i=0,a=0;for(let n=0;n<t;n+=3)r+=e[n+0],i+=e[n+1],a+=e[n+2];return new Vn(r/n,i/n,a/n)}function Lu(e,t,n){return n?e.sub(n).projectOnVector(t).add(n):e.projectOnVector(t),e}function Nu(e){let t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,s=-1/0;for(let o=0,l=e.length;o<l;o+=3){const l=e[o],c=e[o+1],u=e[o+2];l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>a&&(a=c),u>s&&(s=u)}return[Bu([t,n,r]),Bu([i,a,s])]}function Ou(e,t){for(let n=0,r=t.length;n<r;n+=3){const r=t[n],i=t[n+1],a=t[n+2];t[n]=e[0]*r+e[4]*i+e[8]*a+e[12],t[n+1]=e[1]*r+e[5]*i+e[9]*a+e[13],t[n+2]=e[2]*r+e[6]*i+e[10]*a+e[14]}}function Fu(e,t){for(let n=0,r=t.length;n<r;n+=3){const r=t[n],i=t[n+1],a=t[n+2];t[n]=e[0]*r+e[3]*i+e[6]*a,t[n+1]=e[1]*r+e[4]*i+e[7]*a,t[n+2]=e[2]*r+e[5]*i+e[8]*a}}function Uu(e){for(let t=0,n=e.length;t<n;t+=3){const n=e[t],r=e[t+1],i=e[t+2],a=n*n+r*r+i*i;if(a>0){const s=1/Math.sqrt(a);e[t]=n*s,e[t+1]=r*s,e[t+2]=i*s}}}function Bu(e){return new Float32Array(e||3)}function zu(e,t,n){const r=t[0],i=t[1],a=t[2],s=n[0],o=n[1],l=n[2];e[0]=i*l-a*o,e[1]=a*s-r*l,e[2]=r*o-i*s}function Vu(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Hu(e,t,n){e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2]}function $u(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}function Gu(e,t,n=0){e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}function ju(e,t,n=0){t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2]}function Wu(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function qu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function Xu(e,t,n){Yu(e,t,1/n)}function Yu(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}function Ku(e,t){const n=Wu(t);0==n?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):Yu(e,t,1/Math.sqrt(n))}function Zu(e,t,n){e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n}function Qu(e,t,n){e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n}function Ju(e,t){e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2])}function ed(e,t){e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2])}function td(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]}function nd(e,t){const n=e[0],r=e[1],i=e[2],a=t[0],s=t[1],o=t[2],l=r*o-i*s,c=i*a-n*o,u=n*s-r*a,d=Math.sqrt(l*l+c*c+u*u),h=n*a+r*s+i*o;return Math.atan2(d,h)}function rd(e,t=9){const n=Math.floor(t/2),r=e.position1.length/3,i=n*r*3,a=1/t,s=_u(e.position1,e.position2),o=new Float32Array(i),l=new Float32Array(i),c=new Vn;for(let t=0;t<r;++t){const r=3*t;c.set(s[r],s[r+1],s[r+2]);const i=e.position1[r],u=e.position1[r+1],d=e.position1[r+2];for(let e=0;e<n;++e){const t=n*r+3*e,s=a*(2*e+1),h=a*(2*e+2);o[t]=i+c.x*s,o[t+1]=u+c.y*s,o[t+2]=d+c.z*s,l[t]=i+c.x*h,l[t+1]=u+c.y*h,l[t+2]=d+c.z*h}}const u=gu(o,l),d=function(e,t){const n=e.length/3,r=new Float32Array(n*t*3);for(let i=0;i<n;++i){const n=3*i,a=i*t*3,s=e[n+0],o=e[n+1],l=e[n+2];for(let e=0;e<t;++e){const t=a+3*e;r[t+0]=s,r[t+1]=o,r[t+2]=l}}return r}(e.color,n),h={position:u,position1:o,position2:l,color:d,color2:d};return e.radius&&(h.radius=wu(e.radius,n)),e.picking&&e.picking.array&&(e.picking.array=wu(e.picking.array,n),h.picking=e.picking),e.primitiveId&&(h.primitiveId=wu(e.primitiveId,n)),h}function id(e,t=.1){const n=_u(e.position1,e.position2),r=[],i=[],a=[],s=e.radius?[]:void 0,o=e.picking?[]:void 0,l=e.primitiveId?[]:void 0,c=new Vn,u=e.position1.length/3;let d=0;for(let h=0;h<u;++h){const u=3*h;c.set(n[u],n[u+1],n[u+2]);const f=c.length()/t,p=Math.floor(f/2),m=1/f,g=e.position1[u],_=e.position1[u+1],y=e.position1[u+2];for(let t=0;t<p;++t){const n=3*d+3*t,f=m*(2*t+1),p=m*(2*t+2);r[n]=g+c.x*f,r[n+1]=_+c.y*f,r[n+2]=y+c.z*f,i[n]=g+c.x*p,i[n+1]=_+c.y*p,i[n+2]=y+c.z*p,e.color&&(a[n]=e.color[u],a[n+1]=e.color[u+1],a[n+2]=e.color[u+2]),s&&(s[d+t]=e.radius[h]),o&&(e.picking.array?o[d+t]=e.picking.array[h]:o[d+t]=h),l&&(l[d+t]=e.primitiveId[h])}d+=p}const h=new Float32Array(r),f=new Float32Array(i),p=gu(h,f),m=new Float32Array(a),g={position:p,position1:h,position2:f,color:m,color2:m};return s&&(g.radius=new Float32Array(s)),o&&e.picking&&(e.picking.array=new Float32Array(o),g.picking=e.picking),l&&(g.primitiveId=new Float32Array(l)),g}function ad(e,t=.1){const n=_u(e.position1,e.position2),r=[],i=[],a=[],s=e.radius?[]:void 0,o=e.picking?[]:void 0,l=e.primitiveId?[]:void 0,c=new Vn,u=e.position1.length/3;let d=t,h=!0,f=0,p=0,m=0;for(let g=0;g<u;++g){const u=3*g,_=e.position1[u],y=e.position1[u+1],v=e.position1[u+2];c.set(n[u],n[u+1],n[u+2]);const b=c.length();h&&(r[p]=_,r[p+1]=y,r[p+2]=v);let x=d;const w=1/b;for(;x<b;){const e=h?i:r;e[p]=_+c.x*x*w,e[p+1]=y+c.y*x*w,e[p+2]=v+c.z*x*w,h&&(f++,p=3*f),h=!h,d=t,x+=t}h&&(i[p]=e.position2[u],i[p+1]=e.position2[u+1],i[p+2]=e.position2[u+2],f++,p=3*f),d=x-b;for(let t=m;t<f;t++){if(e.color){const n=3*t;a[n]=e.color[u],a[n+1]=e.color[u+1],a[n+2]=e.color[u+2]}s&&(s[t]=e.radius[g]),o&&(e.picking.array?o[t]=e.picking.array[g]:o[t]=g),l&&(l[t]=e.primitiveId[g])}m=f}if(!h&&u>0){const t=3*f;i[t]=e.position2[3*u-3],i[t+1]=e.position2[3*u-2],i[t+1]=e.position2[3*u-1]}const g=new Float32Array(r),_=new Float32Array(i),y=gu(g,_),v=new Float32Array(a),b={position:y,position1:g,position2:_,color:v,color2:v};return s&&(b.radius=new Float32Array(s)),o&&e.picking&&(e.picking.array=new Float32Array(o),b.picking=e.picking),l&&(b.primitiveId=new Float32Array(l)),b}ku.prototype.constructor=ku,Nu.__deps=[Bu],Xu.__deps=[Yu],Ku.__deps=[Yu,Wu];const sd=new Vn;class od{static get Picker(){return au.get(this.type)}static get Buffer(){return iu.get(this.type)}static getShapeKey(e){return this.type+e[0].toUpperCase()+e.substr(1)}static expandBoundingBox(e,t){}static valueToShape(e,t,n){const r=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":!function(e,t){void 0!==e.toArray?e=e.toArray():void 0!==e.x?e=[e.x,e.y,e.z]:void 0!==e.r&&(e=[e.r,e.g,e.b]),t.push.apply(t,e)}(n,r);break;default:r.push(n)}}static objectToShape(e,t){Object.keys(this.fields).forEach((n=>{this.valueToShape(e,n,t[n])})),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)}static valueFromShape(e,t,n){const r=e._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return(new Vn).fromArray(r,3*t);case"c":return(new ai).fromArray(r,3*t);default:return r[t]}}static objectFromShape(e,t){let n=this.valueFromShape(e,t,"name");void 0===n&&(n=`${this.type}: ${t} (${e.name})`);const r={shape:e,name:n};return Object.keys(this.fields).forEach((n=>{r[n]=this.valueFromShape(e,t,n)})),r}static arrayFromShape(e,t){const n=e._primitiveData[this.getShapeKey(t)];return"s"===this.fields[t]?n:new Float32Array(n)}static dataFromShape(e){const t={};return this.Picker&&(t.picking=new this.Picker(e)),Object.keys(this.fields).forEach((n=>{t[n]=this.arrayFromShape(e,n)})),t}static bufferFromShape(e,t){return new this.Buffer(this.dataFromShape(e),t)}}od.type="",od.fields={};class ld extends od{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(sd.fromArray(t.position))}}ld.type="sphere",ld.fields={position:"v3",color:"c",radius:"f"};class cd extends od{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(sd.fromArray(t.position))}}cd.type="box",cd.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class ud extends cd{}ud.type="octahedron";class dd extends cd{}dd.type="tetrahedron";class hd extends od{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),r=this.valueFromShape(e,t,"position2");return n.add(r).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(sd.fromArray(t.position1)),e.expandByPoint(sd.fromArray(t.position2))}static bufferFromShape(e,t={}){let n=this.dataFromShape(e);return"cylinder"===this.type&&t.dashedCylinder&&(n=id(n)),new this.Buffer(n,t)}}hd.type="cylinder",hd.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class fd extends hd{}fd.type="arrow";class pd extends hd{}pd.type="cone";class md extends ld{}md.type="ellipsoid",md.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class gd extends md{}gd.type="torus";class _d extends od{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(sd.fromArray(t.position))}}_d.type="text",_d.fields={position:"v3",color:"c",size:"f",text:"s"};class yd extends od{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(sd.fromArray(t.position))}}yd.type="point",yd.fields={position:"v3",color:"c"};class vd extends od{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),r=this.valueFromShape(e,t,"position2");return n.add(r).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(sd.fromArray(t.position1)),e.expandByPoint(sd.fromArray(t.position2))}}vd.type="wideline",vd.fields={position1:"v3",position2:"v3",color:"c"};class bd{constructor(e,t){this.exp=3;const n=t||function(e){const{x:t,y:n,z:r}=e,i=new Gn,a=t.length,{min:s,max:o}=i;for(let e=0;e<a;e++)s.x=Math.min(t[e],s.x),s.y=Math.min(n[e],s.y),s.z=Math.min(r[e],s.z),o.x=Math.max(t[e],o.x),o.y=Math.max(n[e],o.y),o.z=Math.max(r[e],o.z);return i}(e);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);const r=this.boundX*this.boundY*this.boundZ,i=void 0!==e.count?e.count:e.x.length,a=e.x,s=e.y,o=e.z;let l=0;const c=new Uint32Array(r),u=new Int32Array(i);for(let e=0;e<i;++e){const t=a[e]-this.minX>>this.exp,n=s[e]-this.minY>>this.exp,r=o[e]-this.minZ>>this.exp,i=(t*this.boundY+n)*this.boundZ+r;1===(c[i]+=1)&&(l+=1),u[e]=i}const d=new Uint16Array(l);for(let e=0,t=0;e<r;++e){const n=c[e];n>0&&(c[e]=t+1,d[t]=n,t+=1)}const h=new Uint32Array(l);for(let e=1;e<l;++e)h[e]+=h[e-1]+d[e-1];const f=new Uint16Array(l),p=new Int32Array(i);for(let e=0;e<i;++e){const t=c[u[e]];if(t>0){const n=t-1;p[h[n]+f[n]]=e,f[n]+=1}}this.grid=c,this.bucketCount=d,this.bucketOffset=h,this.bucketArray=p,this.xArray=a,this.yArray=s,this.zArray=o}within(e,t,n,r){const i=[];return this.eachWithin(e,t,n,r,(e=>i.push(e))),i}eachWithin(e,t,n,r,i){const a=r*r,s=Math.max(0,e-r-this.minX>>this.exp),o=Math.max(0,t-r-this.minY>>this.exp),l=Math.max(0,n-r-this.minZ>>this.exp),c=Math.min(this.boundX,1+(e+r-this.minX>>this.exp)),u=Math.min(this.boundY,1+(t+r-this.minY>>this.exp)),d=Math.min(this.boundZ,1+(n+r-this.minZ>>this.exp));for(let r=s;r<c;++r)for(let s=o;s<u;++s)for(let o=l;o<d;++o){const l=(r*this.boundY+s)*this.boundZ+o,c=this.grid[l];if(c>0){const r=c-1,s=this.bucketOffset[r],o=s+this.bucketCount[r];for(let r=s;r<o;++r){const s=this.bucketArray[r],o=this.xArray[s]-e,l=this.yArray[s]-t,c=this.zArray[s]-n,u=o*o+l*l+c*c;u<=a&&i(s,u)}}}}}class xd{constructor(e=0){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(e){this.length=e,this.count=0;for(let e=0,t=this._fields.length;e<t;++e){const[t,n,r]=this._fields[e];this._initField(t,n,r)}}_initField(e,t,n){this[e]=$l(n,this.length*t)}addField(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let e=0,t=this._fields.length;e<t;++e){const t=this._fields[e][0],n=this._fields[e][1],r=this.length*n,i=new this[t].constructor(r);this[t].length>r?i.set(this[t].subarray(0,r)):i.set(this[t]),this[t]=i}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}copyFrom(e,t,n,r){for(let i=0,a=this._fields.length;i<a;++i){const a=this._fields[i][0],s=this._fields[i][1],o=this[a],l=e[a];for(let e=0;e<r;++e){const r=s*(t+e),i=s*(n+e);for(let e=0;e<s;++e)o[r+e]=l[i+e]}}}copyWithin(e,t,n){for(let r=0,i=this._fields.length;r<i;++r){const i=this._fields[r][0],a=this._fields[r][1],s=this[i];for(let r=0;r<n;++r){const n=a*(e+r),i=a*(t+r);for(let e=0;e<a;++e)s[n+e]=s[i+e]}}}sort(e){Wc.time("Store.sort");const t=this,n=new this.constructor(1);!function r(i,a){if(i<a){let l=Math.floor((i+a)/2),c=i,u=a;do{for(;e(c,l)<0;)c+=1;for(;e(u,l)>0;)u-=1;c<=u&&(c===l?l=u:u===l&&(l=c),(s=c)!==(o=u)&&(n.copyFrom(t,0,s,1),t.copyWithin(s,o,1),t.copyFrom(n,o,0,1)),c+=1,u-=1)}while(c<=u);r(i,u),r(c,a)}var s,o}(0,this.count-1),Wc.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]}}class wd extends xd{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(e,t,n){this.growIfFull();const r=this.count;e<t?(this.index1[r]=e,this.index2[r]=t):(this.index2[r]=e,this.index1[r]=t),n&&(this.type[r]=n),this.count+=1}}function Sd(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24}class Ad{constructor(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),!0===t&&this.setAll()}get(e){return!!(this._words[e>>>5]&1<<e)}set(e){this._words[e>>>5]|=1<<e}clear(e){this._words[e>>>5]&=~(1<<e)}flip(e){this._words[e>>>5]^=1<<e}_assignRange(e,t,n){if(t<e)return;const r=this._words,i=!0===n?4294967295:0,a=e>>>5,s=t>>>5;for(let e=a+1;e<s;++e)r[e]=i;const o=a<<5,l=s<<5;if(!0===n)if(t-e<32)for(let n=e,i=t+1;n<i;++n)r[n>>>5]|=1<<n;else{for(let t=e,n=o+32;t<n;++t)r[t>>>5]|=1<<t;for(let e=l,n=t+1;e<n;++e)r[e>>>5]|=1<<e}else if(t-e<32)for(let n=e,i=t+1;n<i;++n)r[n>>>5]&=~(1<<n);else{for(let t=e,n=o+32;t<n;++t)r[t>>>5]&=~(1<<t);for(let e=l,n=t+1;e<n;++e)r[e>>>5]&=~(1<<e)}return this}setRange(e,t){return this._assignRange(e,t,!0)}clearRange(e,t){return this._assignRange(e,t,!1)}setBits(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const n=e[r];t[n>>>5]|=1<<n}return this}clearBits(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const n=e[r];t[n>>>5]&=~(1<<n)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const e=this._words.length,t=this._words,n=32-this.length%32;for(let n=0;n<e-1;++n)t[n]=~t[n];return t[e-1]=~(t[e-1]<<n)>>>n,this}_isRangeValue(e,t,n){if(t<e)return;const r=this._words,i=!0===n?4294967295:0,a=e>>>5,s=t>>>5;for(let e=a+1;e<s;++e)if(r[e]!==i)return!1;if(t-e<32){for(let i=e,a=t+1;i<a;++i)if(!!(r[i>>>5]&1<<i)!==n)return!1}else{const i=s<<5;for(let t=e,i=32+(a<<5);t<i;++t)if(!!(r[t>>>5]&1<<t)!==n)return!1;for(let e=i,a=t+1;e<a;++e)if(!!(r[e>>>5]&1<<e)!==n)return!1}return!0}isRangeSet(e,t){return this._isRangeValue(e,t,!0)}isRangeClear(e,t){return this._isRangeValue(e,t,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const n=e[r];if(!(t[n>>>5]&1<<n))return!1}return!0}isClear(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const n=e[r];if(t[n>>>5]&1<<n)return!1}return!0}isEqualTo(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let e=0;e<r;++e)if(t[e]!==n[e])return!1;return!0}getSize(){const e=this._words.length,t=this._words;let n=0;for(let r=0;r<e;++r)n+=Sd(t[r]);return n}difference(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let e=0;e<r;++e)t[e]=t[e]&~n[e];for(let e=t.length;e<r;++e)t[e]=0;return this}union(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let e=0;e<r;++e)t[e]|=n[e];for(let e=t.length;e<r;++e)t[e]=0;return this}intersection(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let e=0;e<r;++e)t[e]&=n[e];for(let e=t.length;e<r;++e)t[e]=0;return this}intersects(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let e=0;e<r;++e)if(t[e]&n[e])return!0;return!1}getIntersectionSize(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);let i=0;for(let e=0;e<r;++e)i+=Sd(t[e]&n[e]);return i}makeIntersection(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length),i=new Uint32Array(r),a=Object.create(Ad.prototype);a._words=i,a.length=Math.min(this.length,e.length);for(let e=0;e<r;++e)i[e]=t[e]&n[e];return a}forEach(e){const t=this._words.length,n=this._words;let r=0;for(let i=0;i<t;++i){let t=n[i];for(;0!==t;){const n=t&-t;e((i<<5)+Sd(n-1),r),t^=n,++r}}}toArray(){const e=this._words,t=new Array(this.getSize()),n=this._words.length;let r=0;for(let i=0;i<n;++i){let n=e[i];for(;0!==n;){const e=n&-n;t[r++]=(i<<5)+Sd(e-1),n^=e}}return t}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(Ad.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e}}function Md(e){const{edgeCount:t,nodeCount:n,nodeArray1:r,nodeArray2:i}=e,a=new Uint8Array(n),s=new Int32Array(n);for(let e=0;e<t;++e)a[r[e]]+=1,a[i[e]]+=1;for(let e=1;e<n;++e)s[e]+=s[e-1]+a[e-1];const o=2*t,l=new Int32Array(o);for(let e=0;e<o;++e)l[e]=-1;for(let e=0;e<t;++e){const t=r[e],n=i[e];let a=s[t];for(;-1!==l[a]&&a<o;)a+=1;l[a]=e;let c=s[n];for(;-1!==l[c]&&c<o;)c+=1;l[c]=e}return{countArray:a,offsetArray:s,indexArray:l}}function Ed(e=0,t=0){return{type:e,group:t,x:0,y:0,z:0,atomSet:[]}}function Cd(e,t){e.x+=t.x,e.y+=t.y,e.z+=t.z,e.atomSet.push(t.index)}function Td(e,t){const n=t.atomSet.length;if(n>0){const{types:r,groups:i,centers:a,atomSets:s}=e;r.push(t.type),i.push(t.group),a.x.push(t.x/n),a.y.push(t.y/n),a.z.push(t.z/n),s.push(t.atomSet)}}const Pd=0,Id=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],Rd=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],kd=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],Dd=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],Ld=["NON-POLYMER"].concat(["OTHER"],Dd),Nd=["h","g","i"],Od=["e","b"],Fd=["s","t","l",""],Ud={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},Bd={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},zd={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},Vd={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},Hd={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},$d={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},Gd=[0,0,0],jd={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},Wd=Object.keys(jd),qd=["A","C","T","G","U","I"],Xd=["DA","DC","DT","DG","DU","DI"],Yd=["A","G","I","DA","DG","DI"],Kd=qd.concat(Xd),Zd=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],Qd=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],Jd=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],eh=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],th=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],nh={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]}};nh[Pd]={};const rh={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function ih(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const ah=new Map([[2,Kl(180)],[3,Kl(120)],[4,Kl(109.4721)],[6,Kl(90)]]);function sh(e,t){let n=[];const r=new Vn,i=new Vn;return r.subVectors(t,e),e.eachBondedAtom((t=>{1!==t.number&&(i.subVectors(t,e),n.push(r.angleTo(i)))})),n}function oh(e,t){const n=e.clone(),r=new Vn;r.subVectors(t,e);const i=[new Vn,new Vn];let a=0;if(e.eachBondedAtom((t=>{a>1||1!==t.number&&(n.index=t.index,i[a++].subVectors(t,e))})),1===a&&n.eachBondedAtom((t=>{a>1||1!==t.number&&t.index!==e.index&&i[a++].subVectors(t,e)})),2!==a)return;const s=i[0].cross(i[1]);return Math.abs(Math.PI/2-s.angleTo(r))}function lh(e){if(e["@valenceModel"])return e["@valenceModel"];const t=function(e,t){const n=e.structure,r=n.atomCount,i=new Int8Array(r),a=new Int8Array(r),s=new Int8Array(r),o=new Int8Array(r);return n.eachAtom((e=>{const n=e.index,[r,l,c,u]=function(e,t){const n=e.bondToElementCount(1);let r=e.formalCharge||0;const i="always"===t.assignCharge||"auto"===t.assignCharge&&0===r,a="always"===t.assignH||"auto"===t.assignH&&0===n,s=e.bondCount,o=function(e){let t=0;return e.eachBond((e=>t+=e.bondOrder)),t}(e),l=function(e){const t=e.structure.getBondProxy(),n=e.number,r=8===n||7===n;if(r&&4===e.bondCount)return!1;let i=!1;return e.eachBond((n=>{if(n.bondOrder>1)i=!0;else if(r){const r=n.getOtherAtom(e);r.eachBond((e=>{if(e.bondOrder>1){const t=r.number;if((15===t||16===t)&&8===e.getOtherAtom(r).number)return;i=!0}}),t)}})),i}(e),c=o-s>0;let u=0,d=8;switch(e.number){case 1:i&&(0===s?(r=1,d=0):1===s&&(r=0,d=1));break;case 6:i&&(r=0),a&&(u=Math.max(0,4-o-Math.abs(r))),d=ih(s+u+Math.max(0,-r));break;case 7:if(i)if(a)if(l&&o<4)r=s-n==1&&o-n==2?1:0;else{let t=!1;e.eachBondedAtom((e=>{(16===e.number||e.isMetal())&&(t=!0)})),r=t?0:1}else r=o-3;a&&(u=Math.max(0,3-o+r)),d=ih(l&&!c?s+u-r:s+u+1-r);break;case 8:i&&(a||(r=o-2),1===o&&e.eachBondedAtom((t=>{t.eachBond((n=>{const i=n.getOtherAtom(t);i.index!==e.index&&8===i.number&&2===n.bondOrder&&(r=-1)}))}))),a&&(u=Math.max(0,2-o+r)),d=ih(l&&!c?s+u-r+1:s+u-r+2);break;case 16:i&&(a||(r=o<=3&&!e.bondToElementCount(8)?o-2:0)),a&&o<2&&(u=Math.max(0,2-o+r)),o<=3&&(d=ih(s+u-r+2));break;case 9:case 17:case 35:case 53:case 85:i&&(r=o-1);break;case 3:case 11:case 19:case 37:case 55:case 87:i&&(r=1-o);break;case 4:case 12:case 20:case 38:case 56:case 88:i&&(r=2-o);break;default:console.warn("Requested charge, protonation for an unhandled element",e.element)}return[r,u,u+n,d]}(e,t);i[n]=r,a[n]=l,s[n]=c,o[n]=u})),{charge:i,implicitH:a,totalH:s,idealGeometry:o}}(e,{assignCharge:"auto",assignH:"auto"});return e["@valenceModel"]=t,t}function ch(e){return 15===e.number&&e.bondToElementCount(8)===e.bondCount}const uh=["ARG","HIS","LYS"],dh=["GLU","ASP"];function hh(e,t){return 2===e&&1===t||1===e&&2===t}function fh(e,t){return 3===e&&3===t}function ph(e,t){return 3===e&&1===t||1===e&&3===t}function mh(e){return"HIS"===e.resname&&7==e.number&&e.isRing()}function gh(e,t){return 5===e&&4===t||4===e&&5===t}function _h(e,t){return 9===e&&5===t||5===e&&9===t}const yh=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function vh(e,t){return 12===e?11===t||12===t:13===e?10===t:void 0}const bh=[17,35,53,85],xh=[7,8,16],wh=[6,7,15,16],Sh=Kl(180),Ah=Kl(120);function Mh(e,t,n){return!Ch(e,t,n)&&(e.modelIndex!==t.modelIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}const Eh={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function Ch(e,t,n){return e.modelIndex===n&&t.modelIndex!==n||t.modelIndex===n&&e.modelIndex!==n}function Th(e,t,n){return!Ch(e,t,n)&&(e.modelIndex!==t.modelIndex||e.residueIndex===t.residueIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}function Ph(e){switch(e){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const Ih={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},Rh=new ai;class kh{constructor(e){this.array=e}get type(){return""}get data(){return{}}getIndex(e){return this.array?this.array[e]:e}getObject(e){return{}}_applyTransformations(e,t,n){return t&&e.applyMatrix4(t.matrix),n&&e.applyMatrix4(n.matrix),e}_getPosition(e){return new Vn}getPosition(e,t,n){return this._applyTransformations(this._getPosition(e),t,n)}}class Dh extends kh{constructor(e){super(),this.shape=e}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(e){return this.primitive.objectFromShape(this.shape,this.getIndex(e))}_getPosition(e){return this.primitive.positionFromShape(this.shape,this.getIndex(e))}}class Lh extends kh{constructor(e,t){super(e),this.structure=t}get type(){return"atom"}get data(){return this.structure}getObject(e){return this.structure.getAtomProxy(this.getIndex(e))}_getPosition(e){return(new Vn).copy(this.getObject(e))}}class Nh extends kh{constructor(e){super(),this.axes=e}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class Oh extends kh{constructor(e,t,n){super(e),this.structure=t,this.bondStore=n||t.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(e){const t=this.structure.getBondProxy(this.getIndex(e));return t.bondStore=this.bondStore,t}_getPosition(e){const t=this.getObject(e);return(new Vn).copy(t.atom1).add(t.atom2).multiplyScalar(.5)}}class Fh extends kh{constructor(e,t,n){super(e),this.contacts=t,this.structure=n}get type(){return"contact"}get data(){return this.contacts}getObject(e){const t=this.getIndex(e),{features:n,contactStore:r}=this.contacts,{centers:i,atomSets:a}=n,{x:s,y:o,z:l}=i,{index1:c,index2:u,type:d}=r,h=c[t],f=u[t];return{center1:new Vn(s[h],o[h],l[h]),center2:new Vn(s[f],o[f],l[f]),atom1:this.structure.getAtomProxy(a[h][0]),atom2:this.structure.getAtomProxy(a[f][0]),type:Ph(d[t])}}_getPosition(e){const{center1:t,center2:n}=this.getObject(e);return(new Vn).addVectors(t,n).multiplyScalar(.5)}}class Uh extends kh{constructor(e,t,n){super(e),this.validation=t,this.structure=n}get type(){return"clash"}get data(){return this.validation}getObject(e){const t=this.validation,n=this.getIndex(e);return{validation:t,index:n,clash:t.clashArray[n]}}_getAtomProxyFromSele(e){const t=new Nc(e),n=this.structure.getAtomIndices(t)[0];return this.structure.getAtomProxy(n)}_getPosition(e){const t=this.getObject(e).clash,n=this._getAtomProxyFromSele(t.sele1),r=this._getAtomProxyFromSele(t.sele2);return(new Vn).copy(n).add(r).multiplyScalar(.5)}}class Bh extends Oh{get type(){return"distance"}}class zh extends kh{get type(){return"ignore"}}class Vh extends Dh{constructor(e,t){super(e),this.mesh=t}get type(){return"mesh"}getObject(){const e=this.mesh;return{shape:this.shape,name:e.name,serial:e.serial}}_getPosition(){return this.__position||(this.__position=Du(this.mesh.position)),this.__position}}class Hh extends kh{constructor(e,t){super(e),this.surface=t}get type(){return"surface"}get data(){return this.surface}getObject(e){return{surface:this.surface,index:this.getIndex(e)}}_getPosition(){return this.surface.center.clone()}}class $h extends kh{constructor(e,t){super(),this.unitcell=e,this.structure=t}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class Gh extends kh{constructor(e,t){super(e),this.volume=t}get type(){return"volume"}get data(){return this.volume}getObject(e){const t=this.volume,n=this.getIndex(e);return{volume:t,index:n,value:t.data[n]}}_getPosition(e){const t=this.volume.position,n=this.getIndex(e);return new Vn(t[3*n],t[3*n+1],t[3*n+2])}}class jh extends Gh{get type(){return"slice"}}function Wh(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function qh(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function Xh(e,t,n,r,i){var a,s,o,l,c,u,d,h=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],f=0,p=!1,m=!1,g=!1,_=!1,y=-1,v=t*n*r,b=t,x=t*n,w=new Int32Array(12),S=[],A=[],M=[],E=[],C=Wh(),T=qh();function P(e,t,n){return e+(t-e)*n}function I(e,i,a){return x*(a=(a+d)%r)+b*(i=(i+u)%n)+(e+c)%t}function R(e,t,n,r,l,c,u){var d=3*e;if(s[d]<0){var h=(f-c)/(u-c),m=a,g=3*o;if(S[g]=n+h,S[g+1]=r,S[g+2]=l,!p){var _=3*e;A[g]=y*P(m[_],m[_+3],h),A[g+1]=y*P(m[_+1],m[_+4],h),A[g+2]=y*P(m[_+2],m[_+5],h)}i&&(E[o]=i[e+Math.round(h)]),s[d]=o,w[t]=o,o+=1}else w[t]=s[d]}function k(e,t,n,r,l,c,u){var d=3*e+1;if(s[d]<0){var h=(f-c)/(u-c),m=a,g=3*o;if(S[g]=n,S[g+1]=r+h,S[g+2]=l,!p){var _=3*e,v=_+3*b;A[g]=y*P(m[_],m[v],h),A[g+1]=y*P(m[_+1],m[v+1],h),A[g+2]=y*P(m[_+2],m[v+2],h)}i&&(E[o]=i[e+Math.round(h)*b]),s[d]=o,w[t]=o,o+=1}else w[t]=s[d]}function D(e,t,n,r,l,c,u){var d=3*e+2;if(s[d]<0){var h=(f-c)/(u-c),m=a,g=3*o;if(S[g]=n,S[g+1]=r,S[g+2]=l+h,!p){var _=3*e,v=_+3*x;A[g]=y*P(m[_],m[v],h),A[g+1]=y*P(m[_+1],m[v+1],h),A[g+2]=y*P(m[_+2],m[v+2],h)}i&&(E[o]=i[e+Math.round(h)*x]),s[d]=o,w[t]=o,o+=1}else w[t]=s[d]}function L(t){var n=3*t;0===a[n]&&(a[n]=e[(t-1+v)%v]-e[(t+1)%v],a[n+1]=e[(t-b+v)%v]-e[(t+b)%v],a[n+2]=e[(t-x+v)%v]-e[(t+x)%v])}function N(t,n,r,i,a){var s,o,c,u,d,y,v;g?(i=I(t,n,r),s=I(t+1,n,r),o=I(t,n+1,r),c=I(t,n,r+1),u=I(t+1,n+1,r),d=I(t+1,n,r+1),y=I(t,n+1,r+1),v=I(t+1,n+1,r+1)):(s=i+1,u=(o=i+b)+1,d=(c=i+x)+1,v=(y=o+x)+1);var S=0,A=e[i],E=e[s],P=e[o],N=e[u],O=e[c],F=e[d],U=e[y],B=e[v];A<f&&(S|=1),E<f&&(S|=2),P<f&&(S|=8),N<f&&(S|=4),O<f&&(S|=16),F<f&&(S|=32),U<f&&(S|=128),B<f&&(S|=64);var z=C[S];if(0===z)return 0;var V=t+1,H=n+1,$=r+1;1&z&&(p||(L(i),L(s)),R(i,0,t,n,r,A,E)),2&z&&(p||(L(s),L(u)),k(s,1,V,n,r,E,N)),4&z&&(p||(L(o),L(u)),R(o,2,t,H,r,P,N)),8&z&&(p||(L(i),L(o)),k(i,3,t,n,r,A,P)),16&z&&(p||(L(c),L(d)),R(c,4,t,n,$,O,F)),32&z&&(p||(L(d),L(v)),k(d,5,V,n,$,F,B)),64&z&&(p||(L(y),L(v)),R(y,6,t,H,$,U,B)),128&z&&(p||(L(c),L(y)),k(c,7,t,n,$,O,U)),256&z&&(p||(L(i),L(c)),D(i,8,t,n,r,A,O)),512&z&&(p||(L(s),L(d)),D(s,9,V,n,r,E,F)),1024&z&&(p||(L(u),L(v)),D(u,10,V,H,r,N,B)),2048&z&&(p||(L(o),L(y)),D(o,11,t,H,r,P,U));for(var G,j,W,q=S<<4,X=0;-1!==T[q+X];)G=T[q+X],j=T[q+X+1],W=T[q+X+2],m?(h[G][j]&a&&(M[l++]=w[G],M[l++]=w[j]),h[j][W]&a&&(M[l++]=w[j],M[l++]=w[W]),h[G][W]&a&&(M[l++]=w[G],M[l++]=w[W])):(M[l++]=w[_?G:j],M[l++]=w[_?j:G],M[l++]=w[W]),X+=3}function O(i,a,o,l,c,u){let d,h,m,_,y,v,w,S,A,M,E,C,T;if(i=void 0!==i?i:0,a=void 0!==a?a:0,o=void 0!==o?o:0,l=void 0!==l?l:t-1,c=void 0!==c?c:n-1,u=void 0!==u?u:r-1,g||(p?(i=Math.max(0,i),a=Math.max(0,a),o=Math.max(0,o),l=Math.min(t-1,l),c=Math.min(n-1,c),u=Math.min(r-1,u)):(i=Math.max(1,i),a=Math.max(1,a),o=Math.max(1,o),l=Math.min(t-2,l),c=Math.min(n-2,c),u=Math.min(r-2,u))),g)for(S=i-2,A=a-2,M=o-2,E=l+2,C=c+2,T=u+2,y=M;y<T;++y)for(_=A;_<C;++_)for(m=S;m<E;++m)h=3*I(m,_,y),s[h]=-1,s[h+1]=-1,s[h+2]=-1;else for(S=Math.max(0,i-2),A=Math.max(0,a-2),M=Math.max(0,o-2),E=Math.min(t,l+2),C=Math.min(n,c+2),T=Math.min(r,u+2),y=M;y<T;++y)for(w=x*y,_=A;_<C;++_)for(v=w+b*_,m=S;m<E;++m)d=3*(v+m),s[d]=-1,s[d+1]=-1,s[d+2]=-1;if(!g){var P,R=i,k=a,D=o,L=l,O=c,F=u;for(P=!1,y=o;y<u;++y){for(_=a;_<c;++_){for(m=i;m<l;++m)if(d=t*n*y+t*_+m,e[d]>=f){D=y,P=!0;break}if(P)break}if(P)break}for(P=!1,_=a;_<c;++_){for(y=D;y<u;++y){for(m=i;m<l;++m)if(d=t*n*y+t*_+m,e[d]>=f){k=_,P=!0;break}if(P)break}if(P)break}for(P=!1,m=i;m<l;++m){for(_=k;_<c;++_){for(y=D;y<u;++y)if(d=t*n*y+t*_+m,e[d]>=f){R=m,P=!0;break}if(P)break}if(P)break}for(P=!1,y=u;y>=o;--y){for(_=c;_>=a;--_){for(m=l;m>=i;--m)if(d=t*n*y+t*_+m,e[d]>=f){F=y,P=!0;break}if(P)break}if(P)break}for(P=!1,_=c;_>=a;--_){for(y=F;y>=o;--y){for(m=l;m>=i;--m)if(d=t*n*y+t*_+m,e[d]>=f){O=_,P=!0;break}if(P)break}if(P)break}for(P=!1,m=l;m>=i;--m){for(_=O;_>=a;--_){for(y=F;y>=o;--y)if(d=t*n*y+t*_+m,e[d]>=f){L=m,P=!0;break}if(P)break}if(P)break}p?(i=Math.max(0,R-1),a=Math.max(0,k-1),o=Math.max(0,D-1),l=Math.min(t-1,L+1),c=Math.min(n-1,O+1),u=Math.min(r-1,F+1)):(i=Math.max(1,R-1),a=Math.max(1,k-1),o=Math.max(1,D-1),l=Math.min(t-2,L+1),c=Math.min(n-2,O+1),u=Math.min(r-2,F+1))}var U=15;for(y=o;y<u;++y,U&=-5)for(w=x*y,U|=2,_=a;_<c;++_,U&=-3)for(v=w+b*_,U|=1,m=i;m<l;++m,U&=-2)d=v+m,N(m,_,y,d,U)}this.triangulate=function(e,h,b,x,w){_=(f=e)<0,m=x,g=w,(p=h||m)||(y=f>0?-1:1,a||(a=new Float32Array(3*v)));var C=3*v;if(s&&s.length===C||(s=new Int32Array(C)),o=0,l=0,void 0!==b){var T=b[0].map(Math.round),P=b[1].map(Math.round);c=t*Math.ceil(Math.abs(T[0])/t),u=n*Math.ceil(Math.abs(T[1])/n),d=r*Math.ceil(Math.abs(T[2])/r),O(T[0],T[1],T[2],P[0],P[1],P[2])}else c=u=d=0,O();return S.length=3*o,p||(A.length=3*o),M.length=l,i&&(E.length=o),{position:new Float32Array(S),normal:p?void 0:new Float32Array(A),index:Gl(M,S.length/3),atomindex:i?new Int32Array(E):void 0,contour:m}}}au.add("arrow",class extends Dh{get primitive(){return fd}}),au.add("box",class extends Dh{get primitive(){return cd}}),au.add("cone",class extends Dh{get primitive(){return pd}}),au.add("cylinder",class extends Dh{get primitive(){return hd}}),au.add("ellipsoid",class extends Dh{get primitive(){return md}}),au.add("octahedron",class extends Dh{get primitive(){return ud}}),au.add("sphere",class extends Dh{get primitive(){return ld}}),au.add("tetrahedron",class extends Dh{get primitive(){return dd}}),au.add("torus",class extends Dh{get primitive(){return gd}}),au.add("point",class extends Dh{get primitive(){return yd}}),au.add("wideline",class extends Dh{get primitive(){return vd}}),Object.assign(Xh,{__deps:[Wh,qh,Gl]});class Yh{constructor(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(e){e.data.set(this.data)}}function Kh(e,t){let n=0,r=0;const i=t.rows,a=t.cols;let s=0,o=0,l=0;const c=t.data,u=e.data;for(;n<i;o+=1,s+=a,n++)for(l=o,r=0;r<a;l+=i,r++)u[l]=c[s+r]}function Zh(e,t,n){let r=0,i=0,a=0,s=0,o=0,l=0,c=0;const u=t.cols,d=t.rows,h=n.rows,f=t.data,p=n.data,m=e.data;let g=0;for(;r<d;s+=u,r++)for(l=0,i=0;i<h;c++,i++){for(o=s,g=0,a=0;a<u;o++,l++,a++)g+=f[o]*p[l];m[c]=g}}function Qh(e,t,n){const r=e.data,i=t.data,a=n.data,s=i[0],o=i[1],l=i[2],c=i[3],u=i[4],d=i[5],h=i[6],f=i[7],p=i[8],m=a[0],g=a[1],_=a[2],y=a[3],v=a[4],b=a[5],x=a[6],w=a[7],S=a[8];r[0]=s*m+o*y+l*x,r[1]=s*g+o*v+l*w,r[2]=s*_+o*b+l*S,r[3]=c*m+u*y+d*x,r[4]=c*g+u*v+d*w,r[5]=c*_+u*b+d*S,r[6]=h*m+f*y+p*x,r[7]=h*g+f*v+p*w,r[8]=h*_+f*b+p*S}function Jh(e){const t=e.rows,n=e.cols,r=e.data,i=new Array(n);for(let e=0;e<n;++e)i[e]=0;for(let e=0,a=0;e<t;++e)for(let e=0;e<n;++e,++a)i[e]+=r[a];for(let e=0;e<n;++e)i[e]/=t;return i}function ef(e,t){const n=e.rows,r=e.cols,i=e.data;for(let e=0,a=0;e<n;++e)for(let e=0;e<r;++e,++a)i[a]-=t[e]}function tf(e,t,n,r){r=e[t],e[t]=e[n],e[n]=r}function nf(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}function rf(e,t,n,r){let i=0,a=0;const s=e.rows,o=e.cols;let l=s,c=o;l<c&&(i=1,a=l,l=c,c=a);const u=new Yh(l,l),d=new Yh(1,c),h=new Yh(c,c);if(0===i)Kh(u,e);else{for(a=0;a<o*s;a++)u.data[a]=e.data[a];for(;a<c*l;a++)u.data[a]=0}if(function(e,t,n,r,i,a,s,o){let l=0,c=0,u=0,d=0;const h=Math.max(a,30);let f=0,p=0,m=0,g=0,_=0,y=0,v=0,b=0,x=0,w=0,S=0,A=0,M=0,E=0,C=0,T=0,P=0,I=4660,R=0,k=0,D=0;const L=new Float64Array(s<<3);for(;l<s;l++){for(u=0,S=0;u<a;u++)b=e[l*t+u],S+=b*b;if(L[l]=S,r){for(u=0;u<s;u++)r[l*i+u]=0;r[l*i+l]=1}}for(;d<h;d++){for(_=0,l=0;l<s-1;l++)for(c=l+1;c<s;c++){for(f=l*t|0,p=c*t|0,C=L[l],T=0,P=L[c],u=2,T+=e[f]*e[p],T+=e[f+1]*e[p+1];u<a;u++)T+=e[f+u]*e[p+u];if(!(Math.abs(T)<=2.384185792e-7*Math.sqrt(C*P))){for(T*=2,A=C-P,M=nf(T,A),A<0?(E=.5*(M-A),v=Math.sqrt(E/M),y=T/(M*v*2)):(y=Math.sqrt((M+A)/(2*M)),v=T/(M*y*2)),C=0,P=0,u=2,x=y*e[f]+v*e[p],w=-v*e[f]+y*e[p],e[f]=x,e[p]=w,C+=x*x,P+=w*w,x=y*e[f+1]+v*e[p+1],w=-v*e[f+1]+y*e[p+1],e[f+1]=x,e[p+1]=w,C+=x*x,P+=w*w;u<a;u++)x=y*e[f+u]+v*e[p+u],w=-v*e[f+u]+y*e[p+u],e[f+u]=x,e[p+u]=w,C+=x*x,P+=w*w;if(L[l]=C,L[c]=P,_=1,r)for(m=l*i|0,g=c*i|0,u=2,x=y*r[m]+v*r[g],w=-v*r[m]+y*r[g],r[m]=x,r[g]=w,x=y*r[m+1]+v*r[g+1],w=-v*r[m+1]+y*r[g+1],r[m+1]=x,r[g+1]=w;u<s;u++)x=y*r[m+u]+v*r[g+u],w=-v*r[m+u]+y*r[g+u],r[m+u]=x,r[g+u]=w}}if(0===_)break}for(l=0;l<s;l++){for(u=0,S=0;u<a;u++)b=e[l*t+u],S+=b*b;L[l]=Math.sqrt(S)}for(l=0;l<s-1;l++){for(c=l,u=l+1;u<s;u++)L[c]<L[u]&&(c=u);if(l!==c&&(tf(L,l,c,S),r)){for(u=0;u<a;u++)tf(e,l*t+u,c*t+u,b);for(u=0;u<s;u++)tf(r,l*i+u,c*i+u,b)}}for(l=0;l<s;l++)n[l]=L[l];if(r)for(l=0;l<o;l++){for(S=l<s?L[l]:0;S<=1e-37;){for(k=1/a,u=0;u<a;u++)I=214013*I+2531011,R=256&I>>16?k:-k,e[l*t+u]=R;for(d=0;d<2;d++)for(c=0;c<l;c++){for(S=0,u=0;u<a;u++)S+=e[l*t+u]*e[c*t+u];for(D=0,u=0;u<a;u++)b=e[l*t+u]-S*e[c*t+u],e[l*t+u]=b,D+=Math.abs(b);for(D=D?1/D:0,u=0;u<a;u++)e[l*t+u]*=D}for(S=0,u=0;u<a;u++)b=e[l*t+u],S+=b*b;S=Math.sqrt(S)}for(v=1/S,u=0;u<a;u++)e[l*t+u]*=v}}(u.data,l,d.data,h.data,c,l,c,l),t){for(a=0;a<c;a++)t.data[a]=d.data[a];for(;a<o;a++)t.data[a]=0}0===i?(n&&Kh(n,u),r&&Kh(r,h)):(n&&Kh(n,h),r&&Kh(r,u))}function af(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function sf(e,t,n,r,i,a,s,o,l,c,u,d,h,f,p,m,g){e[0]=t,e[4]=n,e[8]=r,e[12]=i,e[1]=a,e[5]=s,e[9]=o,e[13]=l,e[2]=c,e[6]=u,e[10]=d,e[14]=h,e[3]=f,e[7]=p,e[11]=m,e[15]=g}function of(e,t,n){const r=t[0],i=t[4],a=t[8],s=t[12],o=t[1],l=t[5],c=t[9],u=t[13],d=t[2],h=t[6],f=t[10],p=t[14],m=t[3],g=t[7],_=t[11],y=t[15],v=n[0],b=n[4],x=n[8],w=n[12],S=n[1],A=n[5],M=n[9],E=n[13],C=n[2],T=n[6],P=n[10],I=n[14],R=n[3],k=n[7],D=n[11],L=n[15];e[0]=r*v+i*S+a*C+s*R,e[4]=r*b+i*A+a*T+s*k,e[8]=r*x+i*M+a*P+s*D,e[12]=r*w+i*E+a*I+s*L,e[1]=o*v+l*S+c*C+u*R,e[5]=o*b+l*A+c*T+u*k,e[9]=o*x+l*M+c*P+u*D,e[13]=o*w+l*E+c*I+u*L,e[2]=d*v+h*S+f*C+p*R,e[6]=d*b+h*A+f*T+p*k,e[10]=d*x+h*M+f*P+p*D,e[14]=d*w+h*E+f*I+p*L,e[3]=m*v+g*S+_*C+y*R,e[7]=m*b+g*A+_*T+y*k,e[11]=m*x+g*M+_*P+y*D,e[15]=m*w+g*E+_*I+y*L}function lf(e,t,n,r){sf(e,t,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1)}function cf(e,t,n,r){sf(e,1,0,0,t,0,1,0,n,0,0,1,r,0,0,0,1)}function uf(e,t){const n=Math.cos(t),r=Math.sin(t);sf(e,n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1)}function df(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function hf(e,t){const n=Bu([t[0],t[1],t[2]]),r=Bu([t[4],t[5],t[6]]),i=Bu([t[8],t[9],t[10]]),a=Bu();zu(a,r,i),e[0]=a[0],e[1]=a[1],e[2]=a[2],zu(a,i,n),e[3]=a[0],e[4]=a[1],e[5]=a[2],zu(a,n,r),e[6]=a[0],e[7]=a[1],e[8]=a[2]}function ff(e,t,n,r){n=n||1,r=r||!0;const i=e.length/3,a=t.length/3;let s;r&&(s=new Float32Array(3*i));const o=new Float32Array(3*i);let l;const c=new Array(20);for(l=0;l<20;++l)c[l]=new Uint32Array(i);for(l=0;l<i;++l)c[0][l]=0;let u,d,h;for(l=0;l<a;++l){var f=3*l,p=3*l+1,m=3*l+2;for(h=!0,u=0,d=c[0][t[f]];u<d;++u)if(t[p]===c[u+1][t[f]]){h=!1;break}for(h&&(c[0][t[f]]++,c[c[0][t[f]]][t[f]]=t[p]),h=!0,u=0,d=c[0][t[f]];u<d;++u)if(t[m]===c[u+1][t[f]]){h=!1;break}for(h&&(c[0][t[f]]++,c[c[0][t[f]]][t[f]]=t[m]),h=!0,u=0,d=c[0][t[p]];u<d;++u)if(t[f]===c[u+1][t[p]]){h=!1;break}for(h&&(c[0][t[p]]++,c[c[0][t[p]]][t[p]]=t[f]),h=!0,u=0,d=c[0][t[p]];u<d;++u)if(t[m]===c[u+1][t[p]]){h=!1;break}for(h&&(c[0][t[p]]++,c[c[0][t[p]]][t[p]]=t[m]),h=!0,u=0;u<c[0][t[m]];++u)if(t[f]===c[u+1][t[m]]){h=!1;break}for(h&&(c[0][t[m]]++,c[c[0][t[m]]][t[m]]=t[f]),h=!0,u=0,d=c[0][t[m]];u<d;++u)if(t[p]===c[u+1][t[m]]){h=!1;break}h&&(c[0][t[m]]++,c[c[0][t[m]]][t[m]]=t[p])}for(var g,_,y,v,b,x=.5,w=.75/4.5,S=0;S<n;++S){for(l=0;l<i;++l)if(g=3*l,(y=c[0][l])<3)o[g]=e[g],o[g+1]=e[g+1],o[g+2]=e[g+2];else if(3===y||4===y){for(o[g]=0,o[g+1]=0,o[g+2]=0,u=0;u<y;++u)_=3*c[u+1][l],o[g]+=e[_],o[g+1]+=e[_+1],o[g+2]+=e[_+2];o[g]+=x*e[g],o[g+1]+=x*e[g+1],o[g+2]+=x*e[g+2],b=x+y,o[g]/=b,o[g+1]/=b,o[g+2]/=b}else{for(o[g]=0,o[g+1]=0,o[g+2]=0,u=0;u<y;++u)_=3*c[u+1][l],o[g]+=e[_],o[g+1]+=e[_+1],o[g+2]+=e[_+2];o[g]+=1*e[g],o[g+1]+=1*e[g+1],o[g+2]+=1*e[g+2],v=1+y,o[g]/=v,o[g+1]/=v,o[g+2]/=v}if(e.set(o),r){pf(e,t,s);var A=3*i;for(g=0;g<A;g+=3)e[g]+=-1*w*s[g],e[g+1]+=-1*w*s[g+1],e[g+2]+=-1*w*s[g+2]}}}function pf(e,t,n){var r,i;if(void 0===n)n=new Float32Array(e.length);else for(r=0,i=n.length;r<i;r++)n[r]=0;var a=new Float32Array(3),s=new Float32Array(3),o=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3);if(t)for(r=0,i=t.length;r<i;r+=3){var u=3*t[r],d=3*t[r+1],h=3*t[r+2];Gu(a,e,u),Gu(s,e,d),Gu(o,e,h),Hu(l,o,s),Hu(c,a,s),zu(l,l,c),n[u]+=l[0],n[u+1]+=l[1],n[u+2]+=l[2],n[d]+=l[0],n[d+1]+=l[1],n[d+2]+=l[2],n[h]+=l[0],n[h+1]+=l[1],n[h+2]+=l[2]}else for(r=0,i=e.length;r<i;r+=9)Gu(a,e,r),Gu(s,e,r+3),Gu(o,e,r+6),Hu(l,o,s),Hu(c,a,s),zu(l,l,c),n[r]=l[0],n[r+1]=l[1],n[r+2]=l[2],n[r+3]=l[0],n[r+4]=l[1],n[r+5]=l[2],n[r+6]=l[0],n[r+7]=l[1],n[r+8]=l[2];return Uu(n),n}function mf(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}function gf(e,t,n,r,i){var a=1/r*3;Zu(e,e,i+(a+=n)),Qu(t,t,i+a),Yu(e,e,r),Ju(e,e),Xu(e,e,r),Yu(t,t,r),ed(t,t),Xu(t,t,r);var s=new Float32Array(3);Hu(s,t,e),Yu(s,s,r),ed(s,s),Qu(s,s,1);var o=256*Math.pow(10,6),l=s[0]*s[1]*s[2]*3;o<=l&&(Yu(e,e,r*=Math.pow(o/l,1/3)),Ju(e,e),Xu(e,e,r),Yu(t,t,r),ed(t,t),Xu(t,t,r),Hu(s,t,e),Yu(s,s,r),ed(s,s),Qu(s,s,1));var c=new Float32Array(e);td(c,c);var u=af(),d=af();uf(d,Kl(90)),of(u,u,d);var h=af();lf(h,-1/r,1/r,1/r),of(u,u,h);var f=af();return cf(f,-r*c[2],-r*c[1],-r*c[0]),of(u,u,f),{dim:s,tran:c,matrix:u,scaleFactor:r}}lf.__deps=[sf],cf.__deps=[sf],uf.__deps=[sf],hf.__deps=[Bu,zu],Object.assign(ff,{__deps:[pf]}),Object.assign(pf,{__deps:[Hu,zu,Gu,Uu]}),Object.assign(gf,{__deps:[Kl,Zu,Qu,Xu,Yu,Ju,ed,Hu,td,af,of,cf,lf,uf]});class _f{constructor(e,t,n){this.name=e||"",this.path=t||"",this.info={},this.center=new Vn,this.boundingBox=new Gn,n instanceof Si||n instanceof Oo?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(e,t,n,r,i,a=!1){this.position=e,this.index=t,this.normal=n,this.color=r,this.atomindex=i,this.size=e.length/3,this.contour=a}fromGeometry(e){let t,n,r,i;if(Xc&&Wc.time("GeometrySurface.fromGeometry"),t=e instanceof Si?e:e[0],t.boundingBox||t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox),this.boundingBox.getCenter(this.center),t instanceof Si){const e=t.attributes,a=!!e.normal&&e.normal.array;(!a||0===a[0]&&0===a[1]&&0===a[2])&&t.computeVertexNormals(),n=e.position.array,r=e.index?e.index.array:null,i=e.normal.array}this.set(n,r,i,void 0,void 0),Xc&&Wc.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(e){const t=e||{};t.surface=this;const n=this.size,r=new Float32Array(3*n),i=Zc.getScheme(t);if(i.volumeColor||"random"===t.scheme)for(let e=0;e<n;++e)i.volumeColorToArray(e,r,3*e);else if(i.positionColor){const e=new Vn,t=this.position;for(let s=0;s<n;++s){var a=3*s;e.set(t[a],t[a+1],t[a+2]),i.positionColorToArray(e,r,a)}}else if(i.atomColor&&this.atomindex){const e=t.structure.getAtomProxy(),a=this.atomindex;for(let t=0;t<n;++t)e.index=a[t],i.atomColorToArray(e,r,3*t)}else{const e=new ai(t.value);vu(n,e.r,e.g,e.b,r)}return r}getPicking(e){return this.atomindex&&e?new Lh(this.atomindex,e):new Hh(bu(this.size),this)}getNormal(){return this.normal}getSize(e,t){return yu(this.size,e*t)}getIndex(){return this.index}getFilteredIndex(e,t){if(e&&this.atomindex){const n=new Nc(e),r=t.getAtomSet(n),i=[],a=this.atomindex,s=this.index,o=s.length,l=this.contour?2:3;let c=0;for(let e=0;e<o;e+=l){let t=!0;for(let n=0;n<l;n++){const i=a[s[e+n]];if(!r.get(i)){t=!1;break}}if(t)for(let t=0;t<l;t++,c++)i[c]=s[e+t]}return Gl(i,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function yf(e,t,n,r,i){var a=new Xh(e,t,n,r,i);this.getSurface=function(e,t,n,r,i,s=!1){const o=a.triangulate(e,t,n,i,s);if(t&&!i&&(ff(o.position,o.index,t,!0),o.normal=pf(o.position,o.index)),r&&(Ou(r,o.position),o.normal)){const e=df();hf(e,r),Fu(e,o.normal)}return o}}Object.assign(yf,{__deps:[ff,pf,Xh,Ou,Fu,df,hf]}),Kc.add("surf",(function(e,t){const n=e.data.args,r=e.data.params;if(n&&(self.volsurf=new yf(n[0],n[1],n[2],n[3],n[4])),r){const e=self.volsurf.getSurface(r.isolevel,r.smooth,r.box,r.matrix,r.contour,r.wrap),n=[e.position.buffer,e.index.buffer];e.normal&&n.push(e.normal.buffer),e.atomindex&&n.push(e.atomindex.buffer),t({sd:e,p:r},n)}}),[yf]);class vf{constructor(e,t,n,r,i,a,s){this.name=e,this.path=t,this.matrix=new _r,this.normalMatrix=new pn,this.inverseMatrix=new _r,this.center=new Vn,this.boundingBox=new Gn,this.setData(n,r,i,a,s)}get type(){return"Volume"}setData(e,t,n,r,i){this.nx=t||1,this.ny=n||1,this.nz=r||1,this.data=e||new Float32Array(1),this.setAtomindex(i),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(e,t,n,r){this._min=e,this._max=t,this._mean=n,this._rms=r}setMatrix(e){this.matrix.copy(e);const t=this.boundingBox,n=this.center,r=this.nx-1,i=this.ny-1,a=this.nz-1;t.makeEmpty(),t.expandByPoint(n.set(r,i,a)),t.expandByPoint(n.set(r,i,0)),t.expandByPoint(n.set(r,0,a)),t.expandByPoint(n.set(r,0,0)),t.expandByPoint(n.set(0,i,a)),t.expandByPoint(n.set(0,0,a)),t.expandByPoint(n.set(0,i,0)),t.expandByPoint(n.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);const s=this.matrix.elements,o=new Vn(s[0],s[1],s[2]),l=new Vn(s[4],s[5],s[6]),c=new Vn(s[8],s[9],s[10]),u=new Vn,d=this.normalMatrix.elements;u.crossVectors(l,c),d[0]=u.x,d[1]=u.y,d[2]=u.z,u.crossVectors(c,o),d[3]=u.x,d[4]=u.y,d[5]=u.z,u.crossVectors(o,l),d[6]=u.x,d[7]=u.y,d[8]=u.z,this.inverseMatrix.copy(this.matrix).invert()}setAtomindex(e){this.atomindex=e}getBox(e,t,n){return n||(n=new Gn),n.set(e,e),n.expandByScalar(t),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n}_getBox(e,t){if(!e||!t)return;this.__box||(this.__box=new Gn);const n=this.getBox(e,t,this.__box);return[n.min.toArray(),n.max.toArray()]}_makeSurface(e,t,n){const r=this.name+"@"+t.toPrecision(2),i=new _f(r,"",e);return i.info.isolevel=t,i.info.smooth=n,i.info.volume=this,i}getSurface(e,t,n,r,i,a=!1){e=isNaN(e)?this.getValueForSigma(2):e,t=Ol(t,0),void 0===this.volsurf&&(this.volsurf=new yf(this.data,this.nx,this.ny,this.nz,this.atomindex));const s=this._getBox(n,r),o=this.volsurf.getSurface(e,t,s,this.matrix.elements,i,a);return this._makeSurface(o,e,t)}getSurfaceWorker(e,t,n,r,i,a,s){if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){void 0===this.workerPool&&(this.workerPool=new ku("surf",2));const o={},l=this.workerPool.getNextWorker();0===l.postCount&&Object.assign(o,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(o,{params:{isolevel:e,smooth:t,box:this._getBox(n,r),matrix:this.matrix.elements,contour:i,wrap:a}}),l.post(o,void 0,(e=>{const t=e.data.sd,n=e.data.p;s(this._makeSurface(t,n.isolevel,n.smooth))}),(o=>{console.warn("Volume.getSurfaceWorker error - trying without worker",o);const l=this.getSurface(e,t,n,r,i,a);s(l)}))}else{const o=this.getSurface(e,t,n,r,i,a);s(o)}}getValueForSigma(e){return this.mean+Ol(e,2)*this.rms}getSigmaForValue(e){return(Ol(e,0)-this.mean)/this.rms}get position(){if(!this._position){const e=this.nz,t=this.ny,n=this.nx,r=new Float32Array(n*t*e*3);let i=0;for(let a=0;a<e;++a)for(let e=0;e<t;++e)for(let t=0;t<n;++t)r[i+0]=t,r[i+1]=e,r[i+2]=a,i+=3;Ou(this.matrix.elements,r),this._position=r}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(e){const t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];const n=Zc.getScheme(t),r=this.position.length/3,i=new Float32Array(3*r);for(let e=0;e<r;++e)n.volumeColorToArray(e,i,3*e);return i}getDataPicking(){const e=bu(this.position.length/3);return new Gh(e,this)}getDataSize(e,t){const n=this.data,r=this.position.length/3;let i;switch(e){case"value":case"deviation":i=new Float32Array(n);break;case"abs-value":i=new Float32Array(n);for(let e=0;e<r;++e)i[e]=Math.abs(i[e]);break;case"value-min":{i=new Float32Array(n);const e=this.min;for(let t=0;t<r;++t)i[t]-=e;break}default:i=yu(r,e)}if(1!==t)for(let e=0;e<r;++e)i[e]*=t;return i}get min(){return void 0===this._min&&(this._min=Eu(this.data)),this._min}get max(){return void 0===this._max&&(this._max=Mu(this.data)),this._max}get sum(){return void 0===this._sum&&(this._sum=Cu(this.data)),this._sum}get mean(){return void 0===this._mean&&(this._mean=Tu(this.data)),this._mean}get rms(){return void 0===this._rms&&(this._rms=function(e){const t=e.length;let n=0;for(let r=0;r<t;++r){const t=e[r];n+=t*t}return Math.sqrt(n/t)}(this.data)),this._rms}clone(){const e=new vf(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e}dispose(){this.workerPool&&this.workerPool.terminate()}}function bf(e){return"front"===e?0:"back"===e?1:2}tu.add("shader/Mesh.vert","#define STANDARD\nuniform float clipNear;\nuniform vec3 clipCenter;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#elif defined( NOLIGHT )\nvarying vec3 vColor;\n#else\n#include color_pars_vertex\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#endif\n#include common\nvoid main(){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#elif defined( NOLIGHT )\nvColor = color;\n#else\n#include color_vertex\n#include beginnormal_vertex\n#include defaultnormal_vertex\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#endif\n#include begin_vertex\n#include project_vertex\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),tu.add("shader/Mesh.frag","#define STANDARD\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\n#elif defined( NOLIGHT )\nvarying vec3 vColor;\n#else\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#elif defined( NOLIGHT )\ngl_FragColor = vec4( vColor, opacity );\n#else\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\n#include normal_fragment_begin\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n#include interior_fragment\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#include opaque_back_fragment\n#endif\n}");const xf={f:1,v2:2,v3:3,c:3};function wf(e,t){e.matrix.copy(t),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0}const Sf={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new Vn,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new _r,disablePicking:!1,sortParticles:!1,background:!1},Af={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class Mf{constructor(e,t={}){this.parameterTypes=Af,this.geometry=new Si,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new Oo,this.wireframeGroup=new Oo,this.pickingGroup=new Oo,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=Fl(t,this.defaultParameters),this.uniforms=qi.merge([ha.common,{fogColor:{value:new ai(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new ai(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new ai(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},ha.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const n=e.position||e.position1;this._positionDataSize=n?n.length/3:0,e.primitiveId||(e.primitiveId=bu(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()}get defaultParameters(){return Sf}set matrix(e){this.setMatrix(e)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(e){wf(this.group,e),wf(this.wireframeGroup,e),wf(this.pickingGroup,e)}initIndex(e){this.geometry.setIndex(new hi(e,1));const t=this.geometry.getIndex();t?t.setUsage(this.dynamic?Kt:Yt):Wc.error("Index is null")}makeMaterial(){const e=bf(this.parameters.side),t=new Xi({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;const n=new Xi({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});n.vertexColors=!0;const r=new Xi({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:0});r.vertexColors=!0,r.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,r.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=n,this.pickingMaterial=r,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const e=this.geometry,t=this.wireframeIndex,n=new Si;n.attributes=e.attributes,t&&(n.setIndex(new hi(t,1).setUsage(this.dynamic?Kt:Yt)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n}makeWireframeIndex(){const e=[];function t(t,n){if(t>n){const e=t;t=n,n=e}const r=e[t];return void 0===r?(e[t]=[n],!0):!r.includes(n)&&(r.push(n),!0)}const n=this.geometry,r=n.index;if(this.parameters.wireframe)if(r){const i=r.array;let a,s=i.length;n.drawRange.count!==1/0&&(s=n.drawRange.count),a=this.wireframeIndex&&this.wireframeIndex.length>2*s?this.wireframeIndex:Gl(2*s,n.attributes.position.count);let o=0;e.length=0;for(let e=0;e<s;e+=3){const n=i[e+0],r=i[e+1],s=i[e+2];t(n,r)&&(a[o+0]=n,a[o+1]=r,o+=2),t(r,s)&&(a[o+0]=r,a[o+1]=s,o+=2),t(s,n)&&(a[o+0]=s,a[o+1]=n,o+=2)}this.wireframeIndex=a,this.wireframeIndexCount=o,this.wireframeIndexVersion=this.indexVersion}else{const e=n.attributes.position.count;let t;t=this.wireframeIndex&&this.wireframeIndex.length>2*e?this.wireframeIndex:Gl(2*e,e);for(let n=0,r=0;n<e;n+=3)t[r+0]=n,t[r+1]=n+1,t[r+2]=n+1,t[r+3]=n+2,t[r+4]=n+2,t[r+5]=n,r+=6;this.wireframeIndex=t,this.wireframeIndexCount=2*e,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new hi(this.wireframeIndex,1).setUsage(this.dynamic?Kt:Yt));else{const e=this.wireframeGeometry.getIndex();if(!e)return void Wc.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e}_getMesh(e){this.material||this.makeMaterial();const t=this.geometry,n=this[e];let r;return r=this.isLine?new el(t,n):this.isPoint?new sl(t,n):new Vi(t,n),r.frustumCulled=!1,r.renderOrder=this.getRenderOrder(),r}getMesh(){return this._getMesh("material")}getWireframeMesh(){let e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),e=new el(this.wireframeGeometry,this.wireframeMaterial),e.frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(e,t){return function(e,t={}){let n=e+"|";for(const e in t)n+=e+":"+t[e];if(!hu[n]){const r=function(e){if(void 0===e)return"";const t=[];for(const n in e){const r=e[n];r&&t.push(`#define ${n} ${r}`)}return t.join("\n")+"\n"}(t);let i=tu.get(`shader/${e}`);if(!i)throw new Error(`empty shader, '${e}'`);i=i.replace(du,(function(e,t){const n=`shader/chunk/${t}.glsl`,r=tu.get(n)||da[t];if(!r)throw new Error(`empty chunk, '${t}'`);return r})),hu[n]=r+i}return hu[n]}(e,this.getDefines(t))}getVertexShader(e){return this.getShader(this.vertexShader,e)}getFragmentShader(e){return this.getShader(this.fragmentShader,e)}getDefines(e){const t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),"picking"===e?t.PICKING=1:(("background"===e||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t}getParameters(){return this.parameters}addUniforms(e){this.uniforms=qi.merge([this.uniforms,e]),this.pickingUniforms=qi.merge([this.pickingUniforms,e])}addAttributes(e){for(let t in e){let n;const r=e[t],i=this.attributeSize*xf[r.type];r.value?(i!==r.value.length&&Wc.error("attribute value has wrong length",t),n=r.value):n=$l("float32",i),this.geometry.setAttribute(t,new hi(n,xf[r.type]).setUsage(this.dynamic?Kt:Yt))}}updateRenderOrder(){const e=this.getRenderOrder();function t(t){t.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)}updateShader(){const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0}setParameters(e){const t=e,n=this.parameterTypes,r=this.parameters,i={},a={};let s=!1,o=!1;for(const e in t){const l=t[e];void 0!==l&&(r[e]=l,void 0!==n[e]&&(n[e].property&&(!0!==n[e].property?i[n[e].property]=l:i[e]=l),n[e].uniform&&(!0!==n[e].uniform?a[n[e].uniform]=l:a[e]=l),n[e].updateShader&&(s=!0),n[e].updateVisibility&&(o=!0),this.dynamic&&"wireframe"===e&&!0===l&&this.updateWireframeIndex(),"forceTransparent"===e&&(i.transparent=this.transparent),"matrix"===e&&(this.matrix=l)))}this.setProperties(i),this.setUniforms(a),s&&this.updateShader(),o&&this.setVisibility(this.visible)}setAttributes(e){const t=this.geometry,n=t.attributes;for(const r in e){if("picking"===r)continue;const i=e[r],a=i.length;if("index"===r){const e=t.getIndex();if(!e){Wc.error("Index is null");continue}t.setDrawRange(0,1/0),a>e.array.length?t.setIndex(new hi(i,1).setUsage(this.dynamic?Kt:Yt)):(e.set(i),e.needsUpdate=a>0,e.updateRange.count=a,t.setDrawRange(0,a)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const e=n[r];a>e.array.length?t.setAttribute(r,new hi(i,e.itemSize).setUsage(this.dynamic?Kt:Yt)):(n[r].set(i),n[r].needsUpdate=a>0,n[r].updateRange.count=a)}}}setUniforms(e){if(!e)return;const t=this.material.uniforms,n=this.wireframeMaterial.uniforms,r=this.pickingMaterial.uniforms;for(let i in e)"opacity"===i&&this.setProperties({transparent:this.transparent}),void 0!==t[i]&&(t[i].value.isVector3?t[i].value.copy(e[i]):t[i].value.set?t[i].value.set(e[i]):t[i].value=e[i]),void 0!==n[i]&&(n[i].value.isVector3?n[i].value.copy(e[i]):n[i].value.set?n[i].value.set(e[i]):n[i].value=e[i]),void 0!==r[i]&&(r[i].value.isVector3?r[i].value.copy(e[i]):r[i].value.set?r[i].value.set(e[i]):r[i].value=e[i])}setProperties(e){if(!e)return;const t=this.material,n=this.wireframeMaterial,r=this.pickingMaterial;for(const i in e){const a=i;let s=e[a];"transparent"===a?this.updateRenderOrder():"side"===a&&(s=bf(s)),t[a]=s,n[a]=s,r[a]=s}t.needsUpdate=!0,n.needsUpdate=!0,r.needsUpdate=!0}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var e={};for(var t in this)"group"!==t&&"wireframeGroup"!==t&&"pickingGroup"!=t&&"picking"!==t&&(e[t]=this[t]);return e}}class Ef extends Mf{constructor(e,t={}){super(e,t),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:e.normal}}),void 0===e.normal&&this.geometry.computeVertexNormals()}}class Cf extends Ef{constructor(){super(...arguments),this.isSurface=!0}}function Tf(e){e.visible=!0}function Pf(e){e.visible=!1}class If{constructor(e){this.group=new Oo,this.wireframeGroup=new Oo,this.pickingGroup=new Oo,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new Oo,this.wireframeGroup=new Oo,this.pickingGroup=new Oo,this.matrix=e.matrix;const t=e,n=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),n.makeMaterial(),n.picking=e.picking,n.geometry=e.geometry,n.wireframeGeometry=e.wireframeGeometry,n.setParameters(e.getParameters()),n.updateShader(),t.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=n}set matrix(e){Mf.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const e=Object.assign({},this.buffer.parameters);return e.side=this.side,e}getMesh(e){let t,n;return e?(n=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(n),this.setParameters({side:this.side}),(new Oo).add(n,t)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(e){this.buffer.setAttributes(e)}setParameters(e){"front"===(e=Object.assign({},e)).side?(this.frontMeshes.forEach(Tf),this.backMeshes.forEach(Pf)):"back"===e.side?(this.frontMeshes.forEach(Pf),this.backMeshes.forEach(Tf)):"double"===e.side&&(this.frontMeshes.forEach(Tf),this.backMeshes.forEach(Tf)),void 0!==e.side&&(this.side=e.side),delete e.side,void 0!==e.matrix&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),void 0!==e.wireframe&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e}}tu.add("shader/Line.vert","uniform float clipNear;\nuniform vec3 clipCenter;\nvarying vec3 vViewPosition;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#include color_pars_vertex\nvoid main(){\n#include color_vertex\n#include begin_vertex\n#include project_vertex\nvViewPosition = -mvPosition.xyz;\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),tu.add("shader/Line.frag","uniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec3 vViewPosition;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\ngl_FragColor = vec4( vColor, opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n}");class Rf extends Mf{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class kf extends Iu{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),e instanceof vf?(this.surface=void 0,this.volume=e):(this.surface=e,this.volume=void 0),this.boxCenter=new Vn,this.__boxCenter=new Vn,this.box=new Gn,this.__box=new Gn,this._position=new Vn,this.inverseMatrix=new _r,this.setBox=function(){this._position.copy(t.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}init(e){const t=e||{};t.colorScheme=Ol(t.colorScheme,"uniform"),t.colorValue=Ol(t.colorValue,14540253),this.isolevelType=Ol(t.isolevelType,"sigma"),this.isolevel=Ol(t.isolevel,2),this.negateIsolevel=Ol(t.negateIsolevel,!1),this.isolevelScroll=Ol(t.isolevelScroll,!1),this.smooth=Ol(t.smooth,0),this.background=Ol(t.background,!1),this.opaqueBack=Ol(t.opaqueBack,!0),this.boxSize=Ol(t.boxSize,0),this.colorVolume=Ol(t.colorVolume,void 0),this.contour=Ol(t.contour,!1),this.useWorker=Ol(t.useWorker,!0),this.wrap=Ol(t.wrap,!1),super.init(t),this.inverseMatrix.copy(this.matrix).invert(),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}prepare(e){if(this.volume){let t;if(t="sigma"===this.isolevelType?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(t*=-1),!this.surface||this.__isolevel!==t||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=t,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const n=t=>{this.surface=t,e()};this.useWorker?this.volume.getSurfaceWorker(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,n):n(this.volume.getSurface(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else e()}else e()}create(){const e={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let t;if(this.contour)t=new Rf(e,this.getBufferParams({wireframe:!1}));else{Object.assign(e,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const n=new Cf(e,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));t=new If(n)}this.bufferList.push(t)}update(e){if(0===this.bufferList.length)return;const t={};(e=e||{}).position&&(t.position=this.surface.getPosition()),e.color&&(t.color=this.surface.getColor(this.getColorParams())),e.index&&(t.index=this.surface.getIndex()),e.normal&&(t.normal=this.surface.getNormal()),this.bufferList.forEach((function(e){e.setAttributes(t)}))}setParameters(e,t,n){return e&&void 0!==e.isolevelType&&this.volume&&("value"===this.isolevelType&&"sigma"===e.isolevelType?this.isolevel=this.volume.getSigmaForValue(this.isolevel):"sigma"===this.isolevelType&&"value"===e.isolevelType&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=e.isolevelType),e&&e.boxCenter&&(this.boxCenter.copy(e.boxCenter),delete e.boxCenter),e&&e.wireframe&&(e.contour||void 0===e.contour&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),e.matrix&&this.inverseMatrix.copy(e.matrix).invert(),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),e&&void 0!==e.colorVolume&&t&&(t.color=!0),this.surface&&(void 0!==e.isolevel||void 0!==e.negateIsolevel||void 0!==e.smooth||void 0!==e.wrap||void 0!==e.boxSize||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class Df{static zoomScroll(e,t){e.trackballControls.zoom(t)}static clipNearScroll(e,t){const n=e.getParameters();e.setParameters({clipNear:n.clipNear+t/10})}static focusScroll(e,t){const n=e.getFocus(),r=Math.sign(t)*function(e,t,n){if(e>5)return e;const r=e/5;return(-4.6*r+9.4)*r*r+.2}((100-n)/10);e.setFocus(n+r)}static zoomFocusScroll(e,t){e.trackballControls.zoom(t);const n=e.viewer.camera.position.z;e.setFocus(100-Math.abs(n/8))}static isolevelScroll(e,t){const n=Math.sign(t)/10;e.eachRepresentation(((e,t)=>{if(e.repr instanceof kf){const t=e.getParameters();t.isolevelScroll&&e.setParameters({isolevel:t.isolevel+n})}}))}static panDrag(e,t,n){e.trackballControls.pan(t,n)}static rotateDrag(e,t,n){e.trackballControls.rotate(t,n)}static zRotateDrag(e,t,n){e.trackballControls.zRotate(t,n)}static zoomDrag(e,t,n){e.trackballControls.zoom((t+n)/-2)}static zoomFocusDrag(e,t,n){e.trackballControls.zoom((t+n)/-2);const r=e.viewer.camera.position.z;e.setFocus(100-Math.abs(r/8))}static panComponentDrag(e,t,n){e.trackballControls.panComponent(t,n)}static panAtomDrag(e,t,n){e.trackballControls.panAtom(t,n)}static rotateComponentDrag(e,t,n){e.trackballControls.rotateComponent(t,n)}static movePick(e,t){t&&e.animationControls.move(t.position.clone())}static tooltipPick(e,t){const n=e.tooltip;if(e.getParameters().tooltip&&t){const e=t.mouse.position;n.innerText=t.getLabel(),n.style.bottom=window.innerHeight-e.y+3+"px",n.style.left=e.x+3+"px",n.style.display="block"}else n.style.display="none"}static measurePick(e,t){if(t&&(t.atom||t.bond)){const e=t.atom||t.closestBondAtom;t.component.measurePick(e)}else e.measureClear()}}const Lf={default:[["scroll",Df.zoomScroll],["scroll-shift",Df.focusScroll],["scroll-ctrl",Df.isolevelScroll],["scroll-shift-ctrl",Df.zoomFocusScroll],["drag-left",Df.rotateDrag],["drag-right",Df.panDrag],["drag-ctrl-left",Df.panDrag],["drag-ctrl-right",Df.zRotateDrag],["drag-shift-left",Df.zoomDrag],["drag-middle",Df.zoomFocusDrag],["drag-ctrl-shift-right",Df.panComponentDrag],["drag-ctrl-shift-left",Df.rotateComponentDrag],["clickPick-right",Df.measurePick],["clickPick-ctrl-left",Df.measurePick],["clickPick-middle",Df.movePick],["clickPick-left",Df.movePick],["hoverPick",Df.tooltipPick]],pymol:[["drag-left",Df.rotateDrag],["drag-middle",Df.panDrag],["drag-right",Df.zoomDrag],["scroll",Df.focusScroll],["drag-shift-right",Df.focusScroll],["clickPick-ctrl+shift-middle",Df.movePick],["hoverPick",Df.tooltipPick]],coot:[["scroll",Df.isolevelScroll],["drag-left",Df.rotateDrag],["drag-middle",Df.panDrag],["drag-ctrl-left",Df.panDrag],["drag-right",Df.zoomFocusDrag],["drag-ctrl-right",Df.focusScroll],["clickPick-middle",Df.movePick],["hoverPick",Df.tooltipPick]],astexviewer:[["drag-left",Df.rotateDrag],["drag-ctrl-left",Df.panDrag],["drag-shift-left",Df.zoomDrag],["scroll",Df.focusScroll],["clickPick-middle",Df.movePick],["hoverPick",Df.tooltipPick]]};class Nf{constructor(e,t,n,r={}){this.component=e,this.position=t,this.offsetX=Ol(r.offsetX,0),this.offsetY=Ol(r.offsetY,0),this.visible=Ol(r.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new Vn,this._updateViewerPosition(),this._canvasPosition=new fn,this._cameraPosition=new Vn,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(e){const t=this.element.style.display;if("none"===t&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{const t=document.createElement("div");t.innerText=e,Object.assign(t.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(t)}this._clientRect=this.element.getBoundingClientRect(),"none"===t&&(this.element.style.display=t)}setVisibility(e){this.visible=e,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const e=this.element.style,t=this._canvasPosition,n=this._viewerPosition,r=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(e.display="none");e.display="block";const i=this._cameraPosition.length(),a=this.viewer.scene.fog;e.opacity=(1-nc(a.near,a.far,i)).toString(),e.zIndex=Math.round(100*(a.far-i)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,t),e.bottom=this.offsetX+t.y+r.height/2+"px",e.left=this.offsetY+t.x-r.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const Of=new _r,Ff=new Vn,Uf=new zn;class Bf{constructor(e){this.component=e,this.signals={changed:new Ll.Signal},this.stage=e.stage,this.viewer=e.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(e,t){Of.copy(this.viewer.rotationGroup.matrix).invert(),Ff.copy(Wl(e)).applyMatrix4(Of),Of.extractRotation(this.component.transform),Of.premultiply(this.viewer.rotationGroup.matrix),Of.invert(),Ff.copy(Wl(e)),Ff.applyMatrix4(Of),Of.makeRotationAxis(Ff,t),Uf.setFromRotationMatrix(Of),this.component.quaternion.premultiply(Uf),this.changed()}}const zf={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class Vf{constructor(e={}){this.max=10,this.type=Ol(e.type,"size"),this.scale=Ol(e.scale,1),this.size=Ol(e.size,1),this.data=Ol(e.data,{})}atomRadius(e){let t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":const n=e.sstruc;t="h"===n||"g"===n||"i"===n||"e"===n||"b"===n?.25:th.includes(e.atomname)?.4:.1;break;case"data":t=Ol(this.data[e.index],1);break;case"explicit":t=e.radius,null===t&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)}}Vf.types=zf;const Hf=new Vn(-1,-1,-1),$f=new _r;class Gf{constructor(e){const t=e.rows,n=t/3,r=new Yh(t,3),i=new Yh(3,3),a=new Yh(1,3),s=new Yh(3,3),o=new Yh(3,3),l=Jh(e);ef(e,l),Kh(r,e),Zh(i,r,r),rf(i,a,s,o);const c=new Vn(l[0],l[1],l[2]),u=new Vn(s.data[0],s.data[3],s.data[6]),d=new Vn(s.data[1],s.data[4],s.data[7]),h=new Vn(s.data[2],s.data[5],s.data[8]),f=u.clone().multiplyScalar(Math.sqrt(a.data[0]/n)),p=d.clone().multiplyScalar(Math.sqrt(a.data[1]/n)),m=h.clone().multiplyScalar(Math.sqrt(a.data[2]/n));this.begA=c.clone().sub(f),this.endA=c.clone().add(f),this.begB=c.clone().sub(p),this.endB=c.clone().add(p),this.begC=c.clone().sub(m),this.endC=c.clone().add(m),this.center=c,this.vecA=f,this.vecB=p,this.vecC=m,this.normVecA=u,this.normVecB=d,this.normVecC=h}getBasisMatrix(e=new _r){const t=e;return t.makeBasis(this.normVecB,this.normVecA,this.normVecC),t.determinant()<0&&t.scale(Hf),t}getRotationQuaternion(e=new zn){const t=e;return t.setFromRotationMatrix(this.getBasisMatrix($f)),t.invert()}getProjectedScaleForAtoms(e){let t=-1/0,n=-1/0,r=-1/0,i=-1/0,a=-1/0,s=-1/0;const o=new Vn,l=new Vn,c=this.center,u=this.normVecA,d=this.normVecB,h=this.normVecC;return e.eachAtom((function(e){Lu(o.copy(e),u,c);const f=l.subVectors(o,c).normalize().dot(u),p=o.distanceTo(c);f>0?p>t&&(t=p):p>n&&(n=p),Lu(o.copy(e),d,c);const m=l.subVectors(o,c).normalize().dot(d),g=o.distanceTo(c);m>0?g>r&&(r=g):g>i&&(i=g),Lu(o.copy(e),h,c);const _=l.subVectors(o,c).normalize().dot(h),y=o.distanceTo(c);_>0?y>a&&(a=y):y>s&&(s=y)})),{d1a:t,d2a:r,d3a:a,d1b:-n,d2b:-i,d3b:-s}}}class jf{constructor(e,t,n,r){this.volume=e,this.setFilter(t,n,r)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(e,t,n){return JSON.stringify([e,t,n])}setFilter(e,t,n){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=void 0===e||isNaN(e)?-1/0:e,t=Ol(t,1/0),n=Ol(n,!1);const r=this.volume.data,i=this.volume.position,a=this.volume.atomindex,s=this._getFilterHash(e,t,n);if(s!==this._filterHash){if(e===-1/0&&t===1/0)this.data=r,this.position=i,this.atomindex=a;else{const s=r.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*s),this._positionBuffer=new ArrayBuffer(3*s*4),a&&(this._atomindexBuffer=new ArrayBuffer(4*s)));const o=new Float32Array(this._dataBuffer),l=new Float32Array(this._positionBuffer);let c;a&&(c=new Uint32Array(this._atomindexBuffer));let u=0;for(let d=0;d<s;++d){const s=3*d,h=r[d];if(!n&&h>=e&&h<=t||n&&(h<e||h>t)){const e=3*u;o[u]=h,l[e+0]=i[s+0],l[e+1]=i[s+1],l[e+2]=i[s+2],a&&c&&(c[u]=a[d]),u+=1}}this.data=new Float32Array(this._dataBuffer,0,u),this.position=new Float32Array(this._positionBuffer,0,3*u),a&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,u))}this._filterHash=s}}}jf.prototype.getValueForSigma=vf.prototype.getValueForSigma,jf.prototype.getSigmaForValue=vf.prototype.getSigmaForValue,jf.prototype.getDataAtomindex=vf.prototype.getDataAtomindex,jf.prototype.getDataPosition=vf.prototype.getDataPosition,jf.prototype.getDataColor=vf.prototype.getDataColor,jf.prototype.getDataPicking=vf.prototype.getDataPicking,jf.prototype.getDataSize=vf.prototype.getDataSize;class Wf{constructor(e,t){const n=Md({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray}}class qf extends xd{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(e,t,n){this.growIfFull();const r=this.count,i=e.index,a=t.index;i<a?(this.atomIndex1[r]=i,this.atomIndex2[r]=a):(this.atomIndex2[r]=i,this.atomIndex1[r]=a),n&&(this.bondOrder[r]=n),this.count+=1}addBondIfConnected(e,t,n){return!!e.connectedTo(t)&&(this.addBond(e,t,n),!0)}}class Xf extends xd{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(e,t){this.altloc[e]=t.charCodeAt(0)}getAltloc(e){const t=this.altloc[e];return t?String.fromCharCode(t):""}}class Yf extends xd{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(e,t){this.sstruc[e]=t.charCodeAt(0)}getSstruc(e){const t=this.sstruc[e];return t?String.fromCharCode(t):""}setInscode(e,t){this.inscode[e]=t.charCodeAt(0)}getInscode(e){const t=this.inscode[e];return t?String.fromCharCode(t):""}}class Kf extends xd{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(e,t){const n=4*e;this.chainname[n]=t.charCodeAt(0),this.chainname[n+1]=t.charCodeAt(1),this.chainname[n+2]=t.charCodeAt(2),this.chainname[n+3]=t.charCodeAt(3)}getChainname(e){let t="";for(let n=0;n<4;++n){const r=this.chainname[4*e+n];if(!r)break;t+=String.fromCharCode(r)}return t}setChainid(e,t){const n=4*e;this.chainid[n]=t.charCodeAt(0),this.chainid[n+1]=t.charCodeAt(1),this.chainid[n+2]=t.charCodeAt(2),this.chainid[n+3]=t.charCodeAt(3)}getChainid(e){let t="";for(let n=0;n<4;++n){const r=this.chainid[4*e+n];if(!r)break;t+=String.fromCharCode(r)}return t}}class Zf extends xd{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class Qf{constructor(e){this.polymer=e,this.size=e.residueCount}getCenterIterator(e=0){const t=this.getPosition().center,n=t.length/3;let r=0,i=-1;const a=[new Vn,new Vn,new Vn,new Vn];return{size:n,next:function(){const e=this.get(i);return i+=1,e},get:function(i){i=Math.min(n-1,Math.max(0,i));const s=a[r%4],o=3*i;if(s.fromArray(t,o),e){const r=Math.min(e,i,n-i-1);for(let e=1;e<=r;++e){const n=3*e,i=(r+1-e)/(r+1);s.x+=i*t[o-n+0]+i*t[o+n+0],s.y+=i*t[o-n+1]+i*t[o+n+1],s.z+=i*t[o-n+2]+i*t[o+n+2]}s.x/=r+1,s.y/=r+1,s.z/=r+1}return r+=1,s},reset:function(){r=0,i=-1}}}getColor(e){const t=this.polymer,n=t.structure,r=t.residueCount,i=t.residueIndexStart,a=new Float32Array(3*r),s=e||{};s.structure=n;const o=Zc.getScheme(s),l=n.getResidueProxy(),c=n.getAtomProxy();for(let e=0;e<r;++e)l.index=i+e,c.index=l.traceAtomIndex,o.atomColorToArray(c,a,3*e);return{color:a}}getPicking(){const e=this.polymer,t=e.structure,n=e.residueCount,r=e.residueIndexStart,i=new Float32Array(n),a=t.getResidueProxy();for(let e=0;e<n;++e)a.index=r+e,i[e]=a.traceAtomIndex;return{picking:new Lh(i,t)}}getSize(e){const t=this.polymer,n=t.structure,r=t.residueCount,i=t.residueIndexStart,a=new Float32Array(r),s=new Vf(e),o=n.getResidueProxy(),l=n.getAtomProxy();for(let e=0;e<r;++e)o.index=i+e,l.index=o.traceAtomIndex,a[e]=s.atomRadius(l);return{size:a}}getPosition(){const e=this.polymer,t=e.structure,n=e.residueCount,r=n-3,i=new Float32Array(3*n),a=new Float32Array(3*n),s=new Float32Array(n),o=new Float32Array(n),l=new Float32Array(n),c=new Float32Array(n),u=new Float32Array(3*n),d=new Vn,h=new Vn,f=new Vn,p=new Vn,m=new Vn,g=new Vn,_=new Vn,y=new Vn,v=new Vn,b=new Vn,x=new Vn,w=new Vn(0,0,0),S="trace",A=t.getAtomProxy(),M=t.getAtomProxy(e.getAtomIndexByType(0,S)),E=t.getAtomProxy(e.getAtomIndexByType(1,S)),C=t.getAtomProxy(e.getAtomIndexByType(2,S));for(let t=0;t<r;++t){A.index=M.index,M.index=E.index,E.index=C.index,C.index=e.getAtomIndexByType(t+3,S);const n=3*t;d.subVectors(M,A),h.subVectors(E,M),f.subVectors(C,E),p.subVectors(d,h),m.subVectors(h,f),v.crossVectors(p,m).normalize(),v.toArray(a,n),t>0&&(s[t]=v.angleTo(b));const r=Math.cos(p.angleTo(m));c[t]=180/Math.PI*Math.acos(r);const y=p.length(),T=m.length();o[t]=Math.sqrt(T*y)/Math.max(2,2*(1-r)),l[t]=Math.abs(h.dot(v)),g.copy(p).multiplyScalar(o[t]/y),_.copy(m).multiplyScalar(o[t]/T),g.subVectors(M,g),_.subVectors(E,_),g.toArray(i,n+3),_.toArray(i,n+6),x.subVectors(A,w),x.toArray(u,n),b.copy(v),w.copy(g)}g.fromArray(i,3),_.fromArray(i,6),v.subVectors(g,_).normalize(),A.index=e.getAtomIndexByType(0,S),w.copy(A),y.copy(A),Lu(y,v,g),y.toArray(i,0),x.subVectors(w,g),x.toArray(u,0),g.fromArray(i,3*n-6),_.fromArray(i,3*n-9),v.subVectors(g,_).normalize(),A.index=e.getAtomIndexByType(n-1,S),w.copy(A),y.copy(A),Lu(y,v,g),y.toArray(i,3*n-3);for(let t=n-3;t<n;++t)g.fromArray(i,3*t),A.index=e.getAtomIndexByType(t,S),w.copy(A),x.subVectors(w,g),x.toArray(u,3*t);const T=new Float32Array(n),P=new Float32Array(n),I=new Float32Array(n),R=new Float32Array(n);T[1]=o[0],P[1]=c[0],I[1]=o[0];for(let e=2;e<n-2;++e)T[e]=.5*(o[e-2]+o[e-1]),P[e]=.5*(c[e-2]+c[e-1]),I[e]=.5*(l[e-2]+l[e-1]),g.fromArray(a,3*(e-2)),_.fromArray(a,3*(e-1)),R[e]=180/Math.PI*Math.acos(Math.cos(g.angleTo(_)));T[n-2]=o[n-4],P[n-2]=c[n-4],I[n-2]=l[n-4];const k=new Float32Array(3*n);Su(a,k,0,0,3),Su(a,k,0,3,3);for(let e=2;e<n-2;++e)g.fromArray(a,3*(e-2)),_.fromArray(a,3*(e-1)),v.addVectors(_,g).multiplyScalar(.5).normalize(),v.toArray(k,3*e);return Su(a,k,3*n-12,3*n-6,3),Su(a,k,3*n-12,3*n-3,3),{center:i,axis:k,bending:R,radius:T,rise:I,twist:P,resdir:u}}}class Jf{constructor(e){this.polymer=e,this.helixorient=new Qf(e),this.position=this.helixorient.getPosition()}getAxis(e,t,n,r,i){e=e||30,t=t||2.5,n=void 0!==n&&n;const a=this.polymer,s=a.structure,o=a.residueCount,l=a.residueIndexStart,c=this.position,u=r||{};u.structure=s;const d=Zc.getScheme(u),h=new Vf(i);let f=0,p=0;const m=[],g=[],_=[],y=[],v=[],b=[],x=[],w=[],S=[];let A,M,E=new Float32Array(3*o),C=new Float32Array(3*o);const T=new Vn,P=new Vn,I=s.getResidueProxy(),R=s.getResidueProxy(),k=s.getAtomProxy(),D=new Vn,L=new Vn;let N=!1;for(let r=0;r<o;++r)if(I.index=l+r,D.fromArray(c.center,3*r),r===o-1?N=!0:(R.index=l+r+1,L.fromArray(c.center,3*r+3),(n&&I.sstruc!==R.sstruc||D.distanceTo(L)>t||c.bending[r]>e)&&(N=!0)),N){if(r-f<4){f=r,N=!1;continue}k.index=I.traceAtomIndex,E=c.axis.subarray(3*f+3,3*r),C=c.center.subarray(3*f,3*r+3),A=Du(E).normalize(),M=Du(C),T.fromArray(C),Lu(T,A,M),P.fromArray(C,C.length-3),Lu(P,A,M),A.subVectors(P,T),A.toArray(m,p),M.toArray(g,p),T.toArray(_,p),P.toArray(y,p),d.atomColorToArray(k,v,p),b.push(k.index),x.push(h.atomRadius(k)),w.push(l+f),S.push(l+r+1-f),p+=3,f=r,N=!1}const O=new Float32Array(b);return{axis:new Float32Array(m),center:new Float32Array(g),begin:new Float32Array(_),end:new Float32Array(y),color:new Float32Array(v),picking:new Lh(O,s),size:new Float32Array(x),residueOffset:w,residueCount:S}}}class ep{constructor(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.bubbleUp(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}peek(){return this.content[0]}remove(e){const t=this.content.length;for(let n=0;n<t;n++)if(this.content[n]===e){const r=this.content.pop();return void(r&&n!==t-1&&(this.content[n]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(e){const t=this.content[e];for(;e>0;){const n=Math.floor((e+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}}sinkDown(e){const t=this.content.length,n=this.content[e],r=this.scoreFunction(n);let i=0,a=0;for(;;){const s=2*(e+1),o=s-1;let l=null;if(o<t){const e=this.content[o];i=this.scoreFunction(e),i<r&&(l=o)}if(s<t){const e=this.content[s];a=this.scoreFunction(e),a<(null===l?r:i)&&(l=s)}if(null===l)break;this.content[e]=this.content[l],this.content[l]=n,e=l}}}class tp{constructor(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;const n=e.length/3,r=new Uint32Array(n);for(let e=0;e<n;++e)r[e]=e;this.indices=r,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)}buildTree(e,t,n,r){e>this.maxDepth&&(this.maxDepth=e);const i=r-n;if(0===i)return-1;const a=4*this.currentNode,s=this.nodes;if(this.currentNode+=1,1===i)return s[a]=n,s[a+1]=-1,s[a+2]=-1,s[a+3]=t,a;const o=this.indices,l=this.points,c=n+Math.floor(i/2),u=e%3;let d,h,f,p,m,g=n,_=r-1;for(;_>g;){for(f=g+_>>1,p=l[3*o[f]+u],h=o[f],o[f]=o[_],o[_]=h,m=g,d=g;d<_;++d)l[3*o[d]+u]<p&&(h=o[m],o[m]=o[d],o[d]=h,++m);if(h=o[_],o[_]=o[m],o[m]=h,f=m,c===f)break;c<f?_=f-1:g=f+1}return s[a]=c,s[a+1]=this.buildTree(e+1,a,n,c),s[a+2]=this.buildTree(e+1,a,c+1,r),s[a+3]=t,a}getNodeDepth(e){const t=this.nodes[e+3];return-1===t?0:this.getNodeDepth(t)+1}nearest(e,t,n){const r=new ep((e=>-e[1])),i=this.nodes,a=this.points,s=this.indices,o=l=>{let c,u;const d=this.getNodeDepth(l)%3,h=3*s[i[l]],f=[a[h+0],a[h+1],a[h+2]],p=this.metric(e,f);function m(e,n){r.push([e,n]),r.size()>t&&r.pop()}const g=i[l+1],_=i[l+2];if(-1===_&&-1===g)return void((r.size()<t||p<r.peek()[1])&&p<=n&&m(l,p));c=-1===_?g:-1===g?_:e[d]<=a[h+d]?g:_,o(c),(r.size()<t||p<r.peek()[1])&&p<=n&&m(l,p);const y=[];for(let t=0;t<3;t+=1)y[t]=t===d?e[t]:a[h+t];const v=this.metric(y,f);(r.size()<t||Math.abs(v)<r.peek()[1])&&Math.abs(v)<=n&&(u=c===g?_:g,-1!==u&&o(u))};o(this.rootIndex);const l=[];for(let e=0,n=Math.min(r.size(),t);e<n;e+=1)l.push(r.content[e]);return l}verify(e,t=0){let n=1;if(void 0===e&&(e=this.rootIndex),-1===e)throw new Error("node is null");const r=t%3,i=this.nodes,a=this.points,s=this.indices,o=i[e+1],l=i[e+2];if(-1!==o){if(a[3*s[i[o]]+r]>a[3*s[i[e]]+r])throw new Error("left child is > parent!");n+=this.verify(o,t+1)}if(-1!==l){if(a[3*s[i[l]]+r]<a[3*s[i[e]]+r])throw new Error("right child is < parent!");n+=this.verify(l,t+1)}return n}}class np{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(e){this.atomStore.residueIndex[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(e){this.atomStore.x[this.index]=e}get y(){return this.atomStore.y[this.index]}set y(e){this.atomStore.y[this.index]=e}get z(){return this.atomStore.z[this.index]}set z(e){this.atomStore.z[this.index]=e}get serial(){return this.atomStore.serial[this.index]}set serial(e){this.atomStore.serial[this.index]=e}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(e){this.atomStore.bfactor[this.index]=e}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(e){this.atomStore.occupancy[this.index]=e}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(e){this.atomStore.setAltloc(this.index,e)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(e,t){t=t||this.structure._bp;const n=this.index,r=this.bondHash,i=r.indexArray,a=r.countArray[n],s=r.offsetArray[n];for(let n=0;n<a;++n)t.index=i[s+n],e(t)}eachBondedAtom(e,t){const n=t||this.structure._ap,r=this.index;this.eachBond((function(t){n.index=r!==t.atomIndex1?t.atomIndex1:t.atomIndex2,e(n)})),this.index=r}hasBondTo(e){let t=!1;return this.eachBondedAtom((function(n){e.index===n.index&&(t=!0)})),t}bondToElementCount(e){let t=0;const n=this.index;return this.eachBondedAtom((function(n){n.number===e&&(t+=1)})),this.index=n,t}hasBondToElement(e){return this.bondToElementCount(e)>0}isBackbone(){const e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return 3===e||4===e||5===e}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const e=this.residueType.backboneType;return 4===e||5===e||6===e}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return 1===this.residueType.hetero}isProtein(){return 3===this.residueType.moleculeType}isNucleic(){const e=this.residueType.moleculeType;return 4===e||5===e}isRna(){return 4===this.residueType.moleculeType}isDna(){return 5===this.residueType.moleculeType}isWater(){return 1===this.residueType.moleculeType}isIon(){return 2===this.residueType.moleculeType}isSaccharide(){return 6===this.residueType.moleculeType}isHelix(){return Nd.includes(this.sstruc)}isSheet(){return Od.includes(this.sstruc)}isTurn(){return Fd.includes(this.sstruc)&&this.isProtein()}isBonded(){return 0!==this.bondHash.countArray[this.index]}isRing(){return void 0!==this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]}isAromatic(){return 1===this.aromatic}isPolarHydrogen(){let e=!1;return 1!==this.number||(e=!this.hasBondToElement(6)),e}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(e){const t=this.atomStore,n=e.atomStore,r=this.index,i=e.index,a=t.x[r]-n.x[i],s=t.y[r]-n.y[i],o=t.z[r]-n.z[i],l=a*a+s*s+o*o;return Math.sqrt(l)}connectedTo(e){const t=this.atomStore,n=e.atomStore,r=this.index,i=e.index;if(t.altloc&&n.altloc){const e=t.altloc[r],a=n.altloc[i];if(0!==e&&0!==a&&32!==e&&32!==a&&e!==a)return!1}const a=t.x[r]-n.x[i],s=t.y[r]-n.y[i],o=t.z[r]-n.z[i],l=a*a+s*s+o*o;if(l<48&&this.isCg())return!0;if(isNaN(l))return!1;const c=this.covalent+e.covalent,u=c+.3,d=c-.5;return l<u*u&&l>d*d}positionFromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}positionToArray(e=[],t=0){const n=this.index,r=this.atomStore;return e[t+0]=r.x[n],e[t+1]=r.y[n],e[t+2]=r.z[n],e}positionToVector3(e){return void 0===e&&(e=new Vn),e.x=this.x,e.y=this.y,e.z=this.z,e}positionFromVector3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}positionAdd(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}positionSub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}getResidueBonds(e=!1){const t=this.residueAtomOffset,n=this.index-this.residueAtomOffset,r=this.residueType.getBonds(),i=r.atomIndices1,a=r.atomIndices2;let s,o,l,c;for(e||(c=[]),s=i.indexOf(n);-1!==s;){if(l=a[s]+t,!c)return l;c.push(l),s=i.indexOf(n,s+1)}for(o=a.indexOf(n);-1!==o;){if(l=i[o]+t,!c)return l;c.push(l),o=a.indexOf(n,o+1)}return c}qualifiedName(e=!1){var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),void 0!==this.resno&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t}clone(){return new np(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function rp(e,t){const n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function ip(e,t){return Math.sqrt(rp(e,t))}const ap=new Float32Array(3);class sp{constructor(e,t=!1){Xc&&Wc.time("Kdtree build");const n=t?rp:ip,r=new Float32Array(3*e.atomCount),i=new Uint32Array(e.atomCount);let a=0;e.eachAtom((function(e){r[a+0]=e.x,r[a+1]=e.y,r[a+2]=e.z,i[a/3]=e.index,a+=3})),this.atomIndices=i,this.points=r,this.kdtree=new tp(r,n),Xc&&Wc.timeEnd("Kdtree build")}nearest(e,t,n){e instanceof Vn?e.toArray(ap):e instanceof np&&e.positionToArray(ap);const r=this.kdtree.nearest(ap,t,n),i=this.kdtree.indices,a=this.kdtree.nodes,s=this.atomIndices,o=[];for(let e=0,t=r.length;e<t;++e){const t=r[e],n=t[0],l=t[1];o.push({index:s[i[a[n]]],distance:l})}return o}}const op={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},lp={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},cp=/^[1-9]$/;function up(e){let t="";return e.length>0&&(t=":"+Vl(e).join(" OR :")),new Nc(t)}class dp{constructor(e=""){this.name=e,this.partList=[]}get type(){return"Assembly"}addPart(e,t){const n=new hp(e,t);return this.partList.push(n),n}getAtomCount(e){return this.partList.reduce(((t,n)=>t+n.getAtomCount(e)),0)}getResidueCount(e){return this.partList.reduce(((t,n)=>t+n.getResidueCount(e)),0)}getInstanceCount(){let e=0;return this.partList.forEach((function(t){e+=t.matrixList.length})),e}isIdentity(e){if(1!==this.partList.length)return!1;const t=this.partList[0];if(1!==t.matrixList.length)return!1;if(!(new _r).equals(t.matrixList[0]))return!1;let n=[];return e.eachChain((function(e){n.push(e.chainname)})),n=Vl(n),t.chainList.length===n.length}getBoundingBox(e){const t=new Gn;return this.partList.forEach((function(n){const r=n.getBoundingBox(e);t.expandByPoint(r.min),t.expandByPoint(r.max)})),t}getCenter(e){return this.getBoundingBox(e).getCenter(new Vn)}getSelection(){let e=[];return this.partList.forEach((function(t){e=e.concat(t.chainList)})),up(e)}}class hp{constructor(e=[],t=[]){this.matrixList=e,this.chainList=t}get type(){return"AssemblyPart"}_getCount(e,t){let n=0;return e.eachChain((e=>{(0===this.chainList.length||this.chainList.includes(e.chainname))&&(n+=e[t])})),this.matrixList.length*n}getAtomCount(e){return this._getCount(e,"atomCount")}getResidueCount(e){return this._getCount(e,"residueCount")}getBoundingBox(e){const t=new Gn,n=new Gn,r=this.getSelection(),i=e.getBoundingBox(r);return this.matrixList.forEach((function(e){n.copy(i).applyMatrix4(e),t.expandByPoint(n.min),t.expandByPoint(n.max)})),t}getSelection(){return up(this.chainList)}getView(e){const t=this.getSelection();return t?e.getView(t):e}getInstanceList(){const e=[];for(let t=0,n=this.matrixList.length;t<n;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e}}class fp{constructor(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(e){var t,n;const r=this.structure.atomStore,i=this.structure.residueStore,a=this.structure.residueMap,s=null===(t=this.structure.chemCompMap)||void 0===t?void 0:t.dict[this.previousResname],o=i.atomCount[e],l=i.atomOffset[e],c=new Array(o);for(let e=0;e<o;++e)c[e]=r.atomTypeId[l+e];const u=null==s?void 0:s.chemCompType,d=s?null===(n=this.structure.chemCompMap)||void 0===n?void 0:n.getBonds(this.previousResname,c):void 0;i.residueTypeId[e]=a.add(this.previousResname,c,this.previousHetero,u,d)}addAtom(e,t,n,r,i,a,s,o){const l=this.structure.atomStore,c=this.structure.residueStore,u=this.structure.chainStore,d=this.structure.modelStore;let h=!1,f=!1,p=!1;this.currentModelindex!==e?(h=!0,f=!0,p=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(f=!0,p=!0,this.ci+=1,this.ri+=1):this.currentResno===i&&this.currentResname===r&&this.currentInscode===o||(p=!0,this.ri+=1),this.ai+=1,h&&(d.growIfFull(),d.chainOffset[this.mi]=this.ci,d.chainCount[this.mi]=0,d.count+=1,u.modelIndex[this.ci]=this.mi),f&&(u.growIfFull(),u.setChainname(this.ci,t),u.setChainid(this.ci,n),u.residueOffset[this.ci]=this.ri,u.residueCount[this.ci]=0,u.count+=1,u.modelIndex[this.ci]=this.mi,d.chainCount[this.mi]+=1,c.chainIndex[this.ri]=this.ci),p&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),c.growIfFull(),c.resno[this.ri]=i,void 0!==s&&(c.sstruc[this.ri]=s.charCodeAt(0)),void 0!==o&&(c.inscode[this.ri]=o.charCodeAt(0)),c.atomOffset[this.ri]=this.ai,c.atomCount[this.ri]=0,c.count+=1,c.chainIndex[this.ri]=this.ci,u.residueCount[this.ci]+=1),l.count+=1,l.residueIndex[this.ai]=this.ri,c.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=n,this.currentResname=r,this.currentResno=i,this.currentInscode=o,this.currentHetero=a}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function pp(e,t){if(!t)return;Xc&&Wc.time("assignSecondaryStructure");const n=[];e.eachModel((function(e){e.eachChain((function(e){n.push(e.chainname)}))}));const r=n.slice().sort(),i=[];r.forEach((function(e){i.push(n.indexOf(e))}));const a=t.helices.filter((function(e){return Bl(r,e[0])>=0}));a.sort((function(e,t){const n=e[0],a=t[0],s=e[1],o=t[1];if(n===a)return s===o?0:s<o?-1:1;{const e=Bl(r,n),t=Bl(r,a);return i[e]<i[t]?-1:1}}));const s=e.residueStore;e.eachModel((function(e){let t=0;const n=a.length;if(0===n)return;let r=a[t],i=!1,o=!1;e.eachChain((function(e){let l=!1;if(e.chainname===r[0]){const c=e.residueCount,u=e.residueOffset,d=u+c;for(let c=u;c<d;++c)if(s.resno[c]===r[1]&&s.getInscode(c)===r[2]&&(i=!0),i&&(s.sstruc[c]=r[6],s.resno[c]===r[4]&&s.getInscode(c)===r[5]&&(i=!1,t+=1,t<n?(c=u-1,r=a[t],l=e.chainname!==r[0]):o=!0)),l||o)return}}))}));const o=t.sheets.filter((function(e){return Bl(r,e[0])>=0}));o.sort((function(e,t){const n=e[0],a=t[0];if(n===a)return 0;const s=Bl(r,n),o=Bl(r,a);return i[s]<i[o]?-1:1}));const l="e".charCodeAt(0);e.eachModel((function(e){let t=0;const n=o.length;if(0===n)return;let r=o[t],i=!1,a=!1;e.eachChain((function(e){let c=!1;if(e.chainname===r[0]){const u=e.residueCount,d=e.residueOffset,h=d+u;for(let u=d;u<h;++u)if(s.resno[u]===r[1]&&s.getInscode(u)===r[2]&&(i=!0),i&&(s.sstruc[u]=l,s.resno[u]===r[4]&&s.getInscode(u)===r[5]&&(i=!1,t+=1,t<n?(u=d-1,r=o[t],c=e.chainname!==r[0]):a=!0)),c||a)return}}))})),Xc&&Wc.timeEnd("assignSecondaryStructure")}const mp=function(){const e=function(e,t,n,r){const i=e.structure,a=e.residueIndexStart,s=i.getResidueProxy(),o=i.getResidueProxy(),l=i.getAtomProxy(),c=i.getAtomProxy();for(let i=Math.max(0,t-2);i<=t;++i)for(let t=2;t<5;++t){if(i+t>=e.residueCount)continue;s.index=a+i,o.index=a+i+t,l.index=s.traceAtomIndex,c.index=o.traceAtomIndex;const u=l.distanceTo(c);if(Math.abs(u-n[t-2])>r)return!1}return!0},t=function(t,n){return e(t,n,[5.45,5.18,6.37],2.1)},n=function(t,n){return e(t,n,[6.1,10.4,13],1.42)};return function(e){Xc&&Wc.time("calculateSecondaryStructure"),e.eachPolymer((function(e){if(e.residueCount<4)return;if(e.isCg())!function(e){const t=e.residueStore,n=e.residueIndexStart,r=new Jf(e).position,i=new Vn,a=new Vn;for(let s=0,o=e.residueCount;s<o;++s){i.fromArray(r.center,3*s),a.fromArray(r.center,3*s+3);const e=i.distanceTo(a);e<2&&e>1&&r.bending[s]<20&&(t.sstruc[n+s]="h".charCodeAt(0),t.sstruc[n+s+1]="h".charCodeAt(0))}}(e);else{if(!e.isProtein())return;!function(e){const r=e.residueStore,i=e.residueIndexStart;for(let a=0,s=e.residueCount;a<s;++a){let s="c";t(e,a)?s="h":n(e,a)&&(s="e"),r.sstruc[i+a]=s.charCodeAt(0)}}(e)}let r,i=0;e.eachResidue((function(e){e.sstruc===r?i+=1:(1===i&&(e.index-=1,e.sstruc="c"),i=1,r=e.sstruc)}))})),Xc&&Wc.timeEnd("calculateSecondaryStructure")}}(),gp="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function _p(e){const t=gp.length;let n=e,r=0,i=gp[n%t];for(;n>=t;)n=Math.floor(n/t),i+=gp[n%t],r+=1;return r>=5&&Wc.warn("chainname overflow"),i}function yp(e,t=!1){Xc&&Wc.time("calculateChainnames");let n=!0;if(e.eachChain((function(e){e.chainname&&(n=!1)})),n){const n=e.modelStore,r=e.chainStore,i=e.residueStore,a=function(e,t,a,s){const o=r.count;for(let e=0;e<s;++e)i.chainIndex[a+e]=o;r.growIfFull(),r.modelIndex[o]=e,r.setChainname(o,t),r.setChainid(o,t),r.residueOffset[o]=a,r.residueCount[o]=s,r.count+=1,n.chainCount[e]+=1},s=e.getAtomProxy(),o=e.getAtomProxy();let l=0,c=0,u=0,d=0;const h=[];1===i.count?h.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):e.eachResidueN(2,(function(e,n){let r=!1;const a=e.backboneType,f=n.backboneType,p=Pd;d=e.index,e.modelIndex!==n.modelIndex||e.moleculeType!==n.moleculeType?r=!0:a!==p&&a===f&&(s.index=e.backboneEndAtomIndex,o.index=n.backboneStartAtomIndex,r=t?!s.hasBondTo(o):!s.connectedTo(o)),r||n.index!==i.count-1||(r=!0,d=n.index),r&&(h.push({mIndex:c,chainname:_p(l),rStart:u,rCount:d-u+1}),l+=1,e.modelIndex!==n.modelIndex&&(l=0,c+=1),n.index===i.count-1&&d!==n.index&&h.push({mIndex:c,chainname:_p(l),rStart:i.count-1,rCount:1}),u=n.index,d=n.index)})),r.count=0,n.chainCount.fill(0,0,n.count),n.chainOffset.fill(0,0,n.count),h.forEach((function(e){a(e.mIndex,e.chainname,e.rStart,e.rCount)}));let f=0;e.eachModel((function(e){n.chainOffset[e.index]=f,f+=n.chainCount[e.index]}))}Xc&&Wc.timeEnd("calculateChainnames")}function vp(e,t="all"){"none"!==t&&(Xc&&Wc.time("calculateBonds"),wp(e,!1,t),Sp(e),Xc&&Wc.timeEnd("calculateBonds"))}const bp={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function xp(e,t,n){return[t,n]=t<n?[t,n]:[n,t],Wd.includes(e)&&"C"===t&&"O"===n||Kd.includes(e)&&"OP1"===t&&"P"===n?2:bp[`${e}|${t}|${n}`]||1}function wp(e,t=!1,n="all"){Xc&&Wc.time("calculateBondsWithin");const r=e.bondStore,i=e.rungBondStore,a=e.getAtomSet(!1),s=e.getAtomProxy(),o=e.getAtomProxy(),l=e.getBondProxy(),c=t?null:function(e){Xc&&Wc.time("calculateAtomBondMap");var t=[];return e.eachBond((function(e){var n=e.atomIndex1,r=e.atomIndex2;void 0===t[n]&&(t[n]=[]),t[n][r]=e.index})),Xc&&Wc.timeEnd("calculateAtomBondMap"),t}(e);let u;t||"auto"!==n||(u=new Set,c.forEach(((e,t)=>{u.add(t),e.forEach((e=>{u.add(e)}))}))),e.eachResidue((function(e){if(!t&&c){const t=e.atomCount,i=e.atomOffset;if(t>500)return void Wc.warn("more than 500 atoms, skip residue for auto-bonding",e.qualifiedName());if("auto"===n&&e.hetero)for(let t=e.atomOffset;t<e.atomEnd;t++)if(u.has(t))return;const a=e.getBonds(),d=a.atomIndices1,h=a.atomIndices2,f=a.bondOrders,p=d.length;for(let t=0;t<p;++t){const n=d[t],a=h[t],u=n+i,p=a+i,m=c[u];void 0!==m&&void 0!==m[p]?(l.index=m[p],f[e.residueType.getBondIndex(n,a)]=l.bondOrder):(s.index=u,o.index=p,r.addBond(s,o,f[t]))}}const d=e.residueType.traceAtomIndex,h=e.residueType.rungEndAtomIndex;-1!==d&&-1!==h&&(s.index=e.traceAtomIndex,o.index=e.rungEndAtomIndex,i.addBond(s,o),a.set(s.index),a.set(o.index))})),e.atomSetDict.rung=a,Xc&&Wc.timeEnd("calculateBondsWithin")}function Sp(e,t=!1,n=!1){Xc&&Wc.time("calculateBondsBetween");const r=e.bondStore,i=e.backboneBondStore,a=e.getAtomSet(!1),s=e.getAtomProxy(),o=e.getAtomProxy();function l(e,l){const c=e.backboneType,u=l.backboneType;if(c!==Pd&&c===u){s.index=e.backboneEndAtomIndex,o.index=l.backboneStartAtomIndex;let c=!1,u=!1;n&&s.hasBondTo(o)?(c=!1,u=!0):s.connectedTo(o)&&(c=!t,u=!0),c&&r.addBond(s,o,1),u&&(s.index=e.traceAtomIndex,o.index=l.traceAtomIndex,i.addBond(s,o),a.set(s.index),a.set(o.index))}}0===i.count&&i.resize(e.residueStore.count),e.eachResidueN(2,l);const c=e.getResidueProxy(),u=e.getResidueProxy();if(e.eachChain((function(e){0!==e.residueCount&&(c.index=e.residueOffset,u.index=e.residueOffset+e.residueCount-1,l(u,c))})),e.atomSetDict.backbone=a,!t){Xc&&Wc.time("calculateBondsBetween inter");const t=e.spatialHash;e.eachResidue((function(e){e.backboneType!==Pd||e.isWater()||e.eachAtom((function(e){e.isMetal()||t.eachWithin(e.x,e.y,e.z,4,(function(t){o.index=t,e.modelIndex!==o.modelIndex||e.residueIndex===o.residueIndex||o.isMetal()||r.addBondIfConnected(e,o,1)}))}))})),Xc&&Wc.timeEnd("calculateBondsBetween inter")}Xc&&Wc.timeEnd("calculateBondsBetween")}function Ap(e){if(!e.unitcell)return;Xc&&Wc.time("buildUnitcellAssembly");const t=e.unitcell,n=e.center.clone().applyMatrix4(t.cartToFrac),r=n.clone().floor(),i=function(e){const t=lp[e],n={};if(void 0===t)return console.warn(`spacegroup '${e}' not found in symop library`),n;const r=[];for(let e=0,n=t.length;e<n;e+=3){const n=[];for(let r=0;r<3;++r)n.push(op[t[e+r]]);r.push(n)}return r.forEach((function(e){let t=0;const r=(new _r).set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),i=r.elements;n[e.toString()]=r,e.forEach((function(e){let n=!1,r=!1;for(let a=0,s=e.length;a<s;++a){const s=e[a];if("-"===s)n=!0;else if("+"===s)n=!1;else if("/"===s)r=!0;else if("X"===s)i[0+t]=n?-1:1;else if("Y"===s)i[4+t]=n?-1:1;else if("Z"===s)i[8+t]=n?-1:1;else if(cp.test(s)){const e=parseInt(s);r?i[12+t]/=e:i[12+t]=e}else Wc.warn(`getSymmetryOperations: unknown token '${s}'`)}t+=1}))})),n}(t.spacegroup),a=new Vn,s=new Vn;function o(e){const o=[];return Object.keys(i).forEach((function(l){const c=i[l].clone();a.copy(n).applyMatrix4(c).floor(),s.setFromMatrixPosition(c),s.sub(a),s.add(r),e&&s.add(e),c.setPosition(s),c.multiplyMatrices(t.fracToCart,c),c.multiply(t.cartToFrac),o.push(c)})),o}const l=new dp("UNITCELL"),c=o(),u=[];if(e.biomolDict.NCS){u.push(new _r,...e.biomolDict.NCS.partList[0].matrixList);const t=[];c.forEach((e=>{u.forEach((n=>{t.push(e.clone().multiply(n))}))})),l.addPart(t)}else l.addPart(c);const d=new Vn,h=new dp("SUPERCELL"),f=Array.prototype.concat.call(o(d.set(1,0,0)),o(d.set(0,1,0)),o(d.set(0,0,1)),o(d.set(-1,0,0)),o(d.set(0,-1,0)),o(d.set(0,0,-1)),o(d.set(1,1,0)),o(d.set(1,0,1)),o(d.set(0,1,1)),o(d.set(-1,-1,0)),o(d.set(-1,0,-1)),o(d.set(0,-1,-1)),o(d.set(1,-1,-1)),o(d.set(1,1,-1)),o(d.set(1,-1,1)),o(d.set(-1,1,1)),o(d.set(-1,-1,1)),o(d.set(-1,1,-1)),o(d.set(0,1,-1)),o(d.set(0,-1,1)),o(d.set(1,0,-1)),o(d.set(-1,0,1)),o(d.set(1,-1,0)),o(d.set(-1,1,0)),o(),o(d.set(1,1,1)),o(d.set(-1,-1,-1)));if(e.biomolDict.NCS){const e=[];f.forEach((function(t){u.forEach((function(n){e.push(t.clone().multiply(n))}))})),h.addPart(e)}else h.addPart(f);e.biomolDict.UNITCELL=l,e.biomolDict.SUPERCELL=h,Xc&&Wc.timeEnd("buildUnitcellAssembly")}const Mp=["H","C","O","N","S","P"],Ep=["NA","CL","FE"];function Cp(e){let t=e.toUpperCase(),n=0,r=0;for(let e=0;e<t.length;e++)if(t.charCodeAt(e)<65){if(r>0)break;++n}else r=e+1;(n>0||r<t.length)&&(t=t.substring(n,r));const i=t.length;if(0===i)return"";if(1===i)return t;if(2===i){if(-1!==Ep.indexOf(t))return t;if(-1!==Mp.indexOf(t[0]))return t[0];if(t in Ud)return t}return i>=3&&-1!==Mp.indexOf(t[0])?t[0]:""}function Tp(e){const t=e.bondHash,n=t.countArray,r=t.offsetArray,i=t.indexArray,a=e.getBondProxy();e.eachResidue((function(e){const t=e.residueType;if(void 0!==t.bonds)return;var s=e.atomOffset,o=[],l=[],c=[],u={};const d=s+e.atomCount;e.eachAtom((function(e){const t=e.index,h=r[t];for(let e=0,r=n[t];e<r;++e){a.index=i[h+e];let t=a.atomIndex1;if(t<s||t>=d)continue;let n=a.atomIndex2;if(n<s||n>=d)continue;if(t>n){const e=n;n=t,t=e}const r=t+"|"+n;void 0===u[r]&&(u[r]=!0,o.push(t-s),l.push(n-s),c.push(a.bondOrder))}})),t.bonds={atomIndices1:o,atomIndices2:l,bondOrders:c}}))}const Pp=[3,11,19,37,55,87],Ip=[4,12,20,38,56,88],Rp=[6,15,16,34],kp=[1,7,8,9,17,35,53],Dp=[2,10,18,36,54,86],Lp=[13,30,31,48,49,50,80,81,82,83,84,85,112],Np=[5,14,32,33,51,52,85],Op=[9,17,35,53,85];class Fp{constructor(e,t,n){this.structure=e,this.atomname=t,n=n||Cp(t),this.element=n,this.number=Ud[n]||0,this.vdw=Bd[this.number]||2,this.covalent=zd[this.number]||1.6}getDefaultValence(){const e=Vd[this.number];return e?e[0]:-1}getValenceList(){return Vd[this.number]||[]}getOuterShellElectronCount(){return Hd[this.number]||2}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return Np.includes(this.number)}isHalogen(){return Op.includes(this.number)}isDiatomicNonmetal(){return kp.includes(this.number)}isPolyatomicNonmetal(){return Rp.includes(this.number)}isAlkaliMetal(){return Pp.includes(this.number)}isAlkalineEarthMetal(){return Ip.includes(this.number)}isNobleGas(){return Dp.includes(this.number)}isTransitionMetal(){const e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108}isPostTransitionMetal(){return Lp.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}class Up{constructor(e){this.structure=e,this.dict={},this.list=[],this.structure=e}add(e,t){const n=function(e,t){return e+"|"+t}(e=e.toUpperCase(),t=t?t.toUpperCase():Cp(e));let r=this.dict[n];if(void 0===r){const i=new Fp(this.structure,e,t);r=this.list.length,this.dict[n]=r,this.list.push(i)}return r}get(e){return this.list[e]}}class Bp{constructor(e,t,n,r,i,a){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=n,this.hetero=r?1:0,this.chemCompType=i,this.bonds=a,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const s=nh[this.backboneType],o=nh[this.backboneStartType],l=nh[this.backboneEndType],c=this.getAtomIndexByName(s.trace);this.traceAtomIndex=Ol(c,-1);const u=this.getAtomIndexByName(s.direction1);this.direction1AtomIndex=Ol(u,-1);const d=this.getAtomIndexByName(s.direction2);this.direction2AtomIndex=Ol(d,-1);const h=this.getAtomIndexByName(o.backboneStart);this.backboneStartAtomIndex=Ol(h,-1);const f=this.getAtomIndexByName(l.backboneEnd);let p;this.backboneEndAtomIndex=Ol(f,-1),p=Yd.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=Ol(p,-1)}getBackboneIndexList(){const e=[];let t;switch(this.moleculeType){case 3:t=eh;break;case 4:case 5:t=th;break;default:return e}const n=this.structure.atomMap,r=this.atomTypeIdList;for(let i=0,a=this.atomCount;i<a;++i){const a=n.get(r[i]);t.includes(a.atomname)&&e.push(i)}return e}getMoleculeType(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0}getBackboneType(e){return this.hasProteinBackbone(e)?1:this.hasRnaBackbone(e)?2:this.hasDnaBackbone(e)?3:this.hasCgProteinBackbone(e)?4:this.hasCgRnaBackbone(e)?5:this.hasCgDnaBackbone(e)?6:Pd}isProtein(){return this.chemCompType?Id.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||Wd.includes(this.resname)}isCg(){const e=this.backboneType;return 4===e||5===e||6===e}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?Rd.includes(this.chemCompType):1!==this.hetero&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||qd.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?kd.includes(this.chemCompType):1!==this.hetero&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||Xd.includes(this.resname))}isHetero(){return 1===this.hetero}isIon(){return Qd.includes(this.resname)}isWater(){return Zd.includes(this.resname)}isSaccharide(){return this.chemCompType?Dd.includes(this.chemCompType):Jd.includes(this.resname)}isStandardAminoacid(){return Wd.includes(this.resname)}isStandardBase(){return Kd.includes(this.resname)}hasBackboneAtoms(e,t){const n=nh[t];return-1===e?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):0===e?this.hasAtomWithName(n.trace,n.direction1,n.direction2):1===e?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)}hasProteinBackbone(e){return this.isProtein()&&this.hasBackboneAtoms(e,1)}hasRnaBackbone(e){return this.isRna()&&this.hasBackboneAtoms(e,2)}hasDnaBackbone(e){return this.isDna()&&this.hasBackboneAtoms(e,3)}hasCgProteinBackbone(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,4)}hasCgRnaBackbone(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,5)}hasCgDnaBackbone(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,6)}hasBackbone(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)}getAtomIndexByName(e){const t=this.atomCount,n=this.structure.atomMap,r=this.atomTypeIdList;if(Array.isArray(e))for(let i=0;i<t;++i){const t=r[i];if(e.includes(n.get(t).atomname))return i}else for(let i=0;i<t;++i){const t=r[i];if(e===n.get(t).atomname)return i}}hasAtomWithName(...e){const t=e.length;for(let n=0;n<t;++n)if(void 0!==e[n]&&void 0===this.getAtomIndexByName(e[n]))return!1;return!0}getBonds(e){return void 0===this.bonds&&(this.bonds=function(e){const t=e.structure,n=t.getAtomProxy(),r=t.getAtomProxy(),i=e.atomCount,a=e.atomOffset,s=a+i-1,o=[],l=[],c=[];if(i>500)Xc&&Wc.warn("more than 500 atoms, skip residue for auto-bonding",e.qualifiedName());else if(i>50){const t=new sp(e,!0),i=e.isCg()?1.2:2.3;for(let e=a;e<s;++e){n.index=e;const s=n.covalent+i+.3,u=t.nearest(n,1/0,s*s),d=u.length;for(let e=0;e<d;++e)r.index=u[e].index,n.index<r.index&&n.connectedTo(r)&&(o.push(n.index-a),l.push(r.index-a),c.push(xp(n.resname,n.atomname,r.atomname)))}}else for(let e=a;e<s;++e){n.index=e;for(let t=e+1;t<=s;++t)r.index=t,n.connectedTo(r)&&(o.push(e-a),l.push(t-a),c.push(xp(n.resname,n.atomname,r.atomname)))}return{atomIndices1:o,atomIndices2:l,bondOrders:c}}(e)),this.bonds}getRings(){return void 0===this.rings&&this.calculateRings(),this.rings}getBondGraph(){return void 0===this.bondGraph&&this.calculateBondGraph(),this.bondGraph}getAromatic(e){return void 0===this.aromaticAtoms&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms}getAromaticRings(e){return void 0===this.aromaticRings&&this.calculateAromatic(e),this.aromaticRings}calculateBondGraph(){const e=this.bondGraph={},t=this.getBonds(),n=t.atomIndices1.length,r=t.atomIndices1,i=t.atomIndices2;for(let t=0;t<n;++t){const n=r[t],a=i[t];(e[n]=e[n]||[]).push(a),(e[a]=e[a]||[]).push(n)}}calculateRings(){const e=function(e,t){const n={count:t,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(Gp),right:new Int32Array(Gp),color:new Int32Array(t),currentColor:0,rings:[],atomRings:[],bonds:e};for(let e=0;e<t;e++)n.visited[e]=-1,n.pred[e]=-1;return n}(this.getBondGraph(),this.atomCount);for(let t=0;t<e.count;t++)e.visited[t]>=0||$p(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}}isAromatic(e){return this.aromaticAtoms=this.getAromatic(e),1===this.aromaticAtoms[e.index-e.residueAtomOffset]}calculateAromatic(e){const t=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,r=n.map((t=>function(e){if(e.some((e=>!zp.includes(e.number))))return!1;let t=0;const n=new Yh(3,e.length),r=n.data;return e.forEach((e=>{r[t+0]=e.x,r[t+1]=e.y,r[t+2]=e.z,t+=3})),new Gf(n).vecC.length()<Vp}(t.map((t=>this.structure.getAtomProxy(t+e.atomOffset)))))),i=this.aromaticRings=[];n.forEach(((e,n)=>{r[n]&&(i.push(e),e.forEach((e=>t[e]=1)))}))}assignBondReferenceAtomIndices(){const e=this.getBondGraph(),t=this.getRings(),n=t.atomRings,r=t.rings,i=this.bonds,a=i.atomIndices1,s=i.atomIndices2,o=i.bondOrders,l=this.bondReferenceAtomIndices,c=i.atomIndices1.length;l.length=0;for(let t=0;t<c;++t){if(o[t]<=1)continue;let i;const c=a[t],u=s[t],d=n[c],h=n[u];if(d&&h)for(let e=0;e<d.length;e++)if(-1!==h.indexOf(d[e])){i=r[d[e]];break}if(e[c].length>1)for(let n=0;n<e[c].length;++n){const r=e[c][n];if(r!==u&&(void 0===i||-1!==i.indexOf(r))){l[t]=r;break}}else if(e[u].length>1)for(let n=0;n<e[u].length;++n){const r=e[u][n];if(r!==c&&(void 0===i||-1!==i.indexOf(r))){l[t]=r;break}}}}getBondIndex(e,t){const n=this.bonds,r=n.atomIndices1,i=n.atomIndices2;let a=r.indexOf(e),s=i.indexOf(t);const o=s;for(;-1!==a;){for(;-1!==s;){if(a===s)return a;s=i.indexOf(t,s+1)}a=r.indexOf(e,a+1),s=o}}getBondReferenceAtomIndex(e,t){const n=this.getBondIndex(e,t);if(void 0!==n)return 0===this.bondReferenceAtomIndices.length&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]}}const zp=[5,6,7,8,14,15,16,32,33,50,51,83],Vp=.05;function Hp(e,t,n){if(n<t)return;const{pred:r,color:i,left:a,right:s}=e,o=++e.currentColor;let l=t;for(let e=0;e<Gp&&(i[l]=o,l=r[l],!(l<0));e++);let c=0,u=0,d=!1,h=0;l=n;for(let e=0;e<Gp;e++){if(i[l]===o){h=l,d=!0;break}if(s[u++]=l,l=r[l],l<0)break}if(!d)return;l=t;for(let e=0;e<Gp&&(a[c++]=l,h!==l)&&(l=r[l],!(l<0));e++);const f=c+u,p=new Array(f);let m=0;for(let e=0;e<c;e++)p[m++]=a[e];for(let e=u-1;e>=0;e--)p[m++]=s[e];const g=e.rings.length;for(let t=0;t<f;++t){const n=p[t];e.atomRings[n]?e.atomRings[n].push(g):e.atomRings[n]=[g]}e.rings.push(p)}function $p(e,t){const{bonds:n,visited:r,queue:i,pred:a}=e;r[t]=1,i[0]=t;let s=0,o=1;for(;s<o;){const t=i[s++],l=0;if(void 0===n[t])continue;const c=n[t].length;for(let s=l;s<c;s++){const l=n[t][s];r[l]>0?a[l]!==t&&a[t]!==l&&Hp(e,t,l):(r[l]=1,i[o++]=l,a[l]=t)}}}const Gp=4;class jp{constructor(e){this.structure=e,this.dict={},this.list=[]}add(e,t,n,r="",i){const a=function(e,t,n,r=""){return e+"|"+t.join(",")+"|"+(n?1:0)+"|"+r}(e=e.toUpperCase(),t,n,r);let s=this.dict[a];if(void 0===s){const o=new Bp(this.structure,e,t,n,r,i);s=this.list.length,this.dict[a]=s,this.list.push(o)}return s}get(e){return this.list[e]}}class Wp{constructor(e,t=0){this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new Vn,this._v13=new Vn,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(e){this.bondStore.atomIndex1[this.index]=e}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(e){this.bondStore.atomIndex2[this.index]=e}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(e){this.bondStore.bondOrder[this.index]=e}getOtherAtomIndex(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))}getReferenceAtomIndex(){const e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex!==t.residueIndex)return;const n=e.index-e.residueAtomOffset,r=t.index-t.residueAtomOffset,i=e.residueType.getBondReferenceAtomIndex(n,r);if(void 0!==i)return i+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}calculateShiftDir(e=new Vn){const t=this._ap1,n=this._ap2,r=this._ap3,i=this._v12,a=this._v13;t.index=this.atomIndex1,n.index=this.atomIndex2;const s=this.getReferenceAtomIndex();i.subVectors(t,n).normalize(),void 0!==s?(r.index=s,a.subVectors(t,r)):a.copy(t),a.normalize();let o=i.dot(a);return 1-Math.abs(o)<1e-5&&(a.set(1,0,0),o=i.dot(a),1-Math.abs(o)<1e-5&&(a.set(0,1,0),o=i.dot(a))),e.copy(a.sub(i.multiplyScalar(o))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new Wp(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class qp{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(e){this.residueStore.chainIndex[this.index]=e}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(e){this.residueStore.atomOffset[this.index]=e}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(e){this.residueStore.atomCount[this.index]=e}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(e){this.residueStore.resno[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(e){this.residueStore.setSstruc(this.index,e)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(e){this.residueStore.setInscode(this.index,e)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount}get y(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount}get z(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount}eachAtom(e,t){const n=this.atomCount,r=this.atomOffset,i=this.structure._ap,a=r+n;if(t&&t.atomOnlyTest){const n=t.atomOnlyTest;for(let t=r;t<a;++t)i.index=t,n(i)&&e(i)}else for(let t=r;t<a;++t)i.index=t,e(i)}positionToArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}isProtein(){return 3===this.residueType.moleculeType}isNucleic(){const e=this.residueType.moleculeType;return 4===e||5===e}isRna(){return 4===this.residueType.moleculeType}isDna(){return 5===this.residueType.moleculeType}isCg(){const e=this.residueType.backboneType;return 4===e||5===e||6===e}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return 3===e||4===e||5===e}}isHetero(){return 1===this.residueType.hetero}isWater(){return 1===this.residueType.moleculeType}isIon(){return 2===this.residueType.moleculeType}isSaccharide(){return 6===this.residueType.moleculeType}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return Nd.includes(this.sstruc)}isSheet(){return Od.includes(this.sstruc)}isTurn(){return Fd.includes(this.sstruc)&&this.isProtein()}getAtomType(e){return this.atomMap.get(this.atomStore.atomTypeId[e])}getResname1(){return jd[this.resname.toUpperCase()]||"X"}getBackboneType(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(e){let t=this.residueType.getAtomIndexByName(e);return void 0!==t&&(t+=this.atomOffset),t}hasAtomWithName(e){return this.residueType.hasAtomWithName(e)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const e=this.atomCount,t=this.atomOffset,n=new Array(e);for(let r=0;r<e;++r)n[r]=this.getAtomType(t+r).atomname;return n}connectedTo(e){const t=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!n)&&t.connectedTo(n)}getNextConnectedResidue(){const e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<e+t){const e=this.structure.getResidueProxy(n);if(this.connectedTo(e))return e}else if(n===e+t){const t=this.structure.getResidueProxy(e);if(this.connectedTo(t))return t}}getPreviousConnectedResidue(e){const t=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=t){const t=Ol(e,this.structure.getResidueProxy());if(t.index=n,t.connectedTo(this))return t}else if(n===t-1){const n=this.chainStore.residueCount[this.chainIndex],r=Ol(e,this.structure.getResidueProxy());if(r.index=t+n-1,r.connectedTo(this))return r}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(e=!1){let t="";return this.resname&&!e&&(t+="["+this.resname+"]"),void 0!==this.resno&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex,t}clone(){return new qp(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class Xp{constructor(e,t,n){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=n,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=n-t+1;const r=this.structure.getResidueProxy(this.residueIndexStart),i=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=void 0!==r.getPreviousConnectedResidue();const a=i.getNextConnectedResidue();this.isNextConnected=void 0!==a,this.isNextNextConnected=void 0!==a&&void 0!==a.getNextConnectedResidue(),this.isCyclic=i.connectedTo(r),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)}getAtomIndexByType(e,t){this.isCyclic?-1===e?e=this.residueCount-1:e===this.residueCount&&(e=0):(-1!==e||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));const n=this.__residueProxy;let r;switch(n.index=this.residueIndexStart+e,t){case"trace":r=n.traceAtomIndex;break;case"direction1":r=n.direction1AtomIndex;break;case"direction2":r=n.direction2AtomIndex;break;default:r=n.getAtomIndexByName(t)}return r}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}))}eachAtomN(e,t,n){const r=this.residueCount,i=new Array(e);for(let t=0;t<e;++t)i[t]=this.structure.getAtomProxy(this.getAtomIndexByType(t,n));t.apply(this,i);for(var a=e;a<r;++a){for(let t=1;t<e;++t)i[t-1].index=i[t].index;i[e-1].index=this.getAtomIndexByType(a,n),t.apply(this,i)}}eachResidue(e){const t=this.structure.getResidueProxy(),n=this.residueCount,r=this.residueIndexStart;for(let i=0;i<n;++i)t.index=r+i,e(t)}qualifiedName(){const e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()}}class Yp{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(e){this.chainStore.entityIndex[this.index]=e}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(e){this.chainStore.modelIndex[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(e){this.chainStore.residueOffset[this.index]=e}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(e){this.chainStore.residueCount[this.index]=e}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return 0===this.residueCount?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(e){this.chainStore.setChainname(this.index,e)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(e){this.chainStore.setChainid(this.index,e)}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){const n=this.residueCount,r=this.residueOffset,i=this.structure._rp,a=r+n;if(t&&t.test){const n=t.residueOnlyTest;if(n)for(let t=r;t<a;++t)i.index=t,n(i)&&e(i);else for(let t=r;t<a;++t)i.index=t,e(i)}else for(let t=r;t<a;++t)i.index=t,e(i)}eachResidueN(e,t){const n=this.residueCount,r=this.residueOffset,i=r+n;if(n<e)return;const a=new Array(e);for(let t=0;t<e;++t)a[t]=this.structure.getResidueProxy(r+t);t.apply(this,a);for(let n=r+e;n<i;++n){for(let t=0;t<e;++t)a[t].index+=1;t.apply(this,a)}}eachPolymer(e,t){let n=0,r=0;const i=t?t.residueOnlyTest:void 0,a=this.model.structure,s=this.residueCount,o=this.residueOffset,l=o+s,c=this.structure.getResidueProxy(),u=this.structure.getResidueProxy(o),d=this.structure.getAtomProxy(),h=this.structure.getAtomProxy();let f=!0;for(let t=o+1;t<l;++t){c.index=u.index,u.index=t;const s=f?c.backboneEndType:c.backboneType,o=u.backboneType;f&&(n=c.index,f=!1),r=u.index,s!==Pd&&s===o?(d.index=c.backboneEndAtomIndex,h.index=u.backboneStartAtomIndex,d&&h&&d.connectedTo(h)&&(!i||i(c)&&i(u))||(c.index-n>1&&e(new Xp(a,n,c.index)),n=r)):(s!==Pd&&c.index-n>1&&e(new Xp(a,n,c.index)),n=r)}r-n>1&&this.structure.getResidueProxy(n).backboneEndType&&e(new Xp(a,n,r))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new Yp(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class Kp{constructor(e,t=0){this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(e){this.modelStore.chainOffset[this.index]=e}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(e){this.modelStore.chainCount[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return 0===this.chainCount?0:this.residueEnd-this.residueOffset+1}get atomCount(){return 0===this.residueCount?0:this.atomEnd-this.atomOffset+1}eachAtom(e,t){this.eachChain((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){this.eachChain((function(n){n.eachResidue(e,t)}),t)}eachPolymer(e,t){if(t&&t.chainOnlyTest){const n=t.chainOnlyTest;this.eachChain((function(r){n(r)&&r.eachPolymer(e,t)}))}else this.eachChain((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){const n=this.chainCount,r=this.chainOffset,i=this.structure._cp,a=r+n;if(t&&t.test){const n=t.chainOnlyTest;if(n)for(let t=r;t<a;++t)i.index=t,n(i)&&e(i);else for(let t=r;t<a;++t)i.index=t,e(i)}else for(let t=r;t<a;++t)i.index=t,e(i)}qualifiedName(){return"/"+this.index}clone(){return new Kp(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class Zp{constructor(e="",t=""){this.signals={refreshed:new Ll.Signal},this.init(e,t)}init(e,t){this.name=e,this.path=t,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new qf(0),this.backboneBondStore=new qf(0),this.rungBondStore=new qf(0),this.atomStore=new Xf(0),this.residueStore=new Yf(0),this.chainStore=new Kf(0),this.modelStore=new Zf(0),this.atomMap=new Up(this),this.residueMap=new jp(this),this.chemCompMap=void 0,this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new Vn,this.boundingBox=new Gn,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new Vn),this.spatialHash=new bd(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new Wf(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let e in this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()}getBondProxy(e){return new Wp(this,e)}getAtomProxy(e){return new np(this,e)}getResidueProxy(e){return new qp(this,e)}getChainProxy(e){return new Yp(this,e)}getModelProxy(e){return new Kp(this,e)}getBondSet(){const e=this.bondStore.count,t=new Ad(e),n=this.atomSet;if(n)if(n.isAllSet())t.setAll();else if(n.isAllClear())t.clearAll();else{const r=this.getBondProxy();for(let i=0;i<e;++i)r.index=i,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getBackboneBondSet(){const e=this.backboneBondStore.count,t=new Ad(e),n=this.atomSetCache.__backbone;if(n){const r=this.getBondProxy();r.bondStore=this.backboneBondStore;for(let i=0;i<e;++i)r.index=i,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getRungBondSet(){const e=this.rungBondStore.count,t=new Ad(e),n=this.atomSetCache.__rung;if(n){const r=this.getBondProxy();r.bondStore=this.rungBondStore;for(let i=0;i<e;++i)r.index=i,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getAtomSet(e){const t=this.atomStore.count;if(void 0===e)return new Ad(t,!0);if(e instanceof Ad)return e;if(!0===e)return new Ad(t,!0);if(e&&e.test){const n=e.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(""===n)return new Ad(t,!0);{const r=new Ad(t);return this.eachAtom((function(e){r.set(e.index)}),e),this.atomSetCache[n]=r,r}}return!1===e?new Ad(t):new Ad(t,!0)}getAtomSetWithinSelection(e,t){const n=this.spatialHash,r=this.getAtomSet(!1),i=this.getAtomProxy();return n?(this.getAtomSet(e).forEach((function(e){i.index=e,n.within(i.x,i.y,i.z,t).forEach((function(e){r.set(e)}))})),r):r}getAtomSetWithinPoint(e,t){const n=e,r=this.getAtomSet(!1);return this.spatialHash?(this.spatialHash.within(n.x,n.y,n.z,t).forEach((function(e){r.set(e)})),r):r}getAtomSetWithinVolume(e,t,n,r,i){const a=new jf(e,n,r,i),s=a.getDataPosition(),o=s.length,l=a.matrix.getMaxScaleOnAxis(),c=this.getAtomSet(!1);if(!this.spatialHash)return c;for(let e=0;e<o;e+=3)this.spatialHash.within(s[e],s[e+1],s[e+2],l).forEach((function(e){c.set(e)}));return c}getAtomSetWithinGroup(e){const t=this.atomStore.residueIndex,n=this.getAtomSet(!1),r=this.getResidueProxy();return this.getAtomSet(e).forEach((function(e){r.index=t[e];for(let e=r.atomOffset;e<=r.atomEnd;++e)n.set(e)})),n}getSelection(){}getStructure(){return this}eachEntity(e,t){this.entityList.forEach((function(n){void 0!==t&&n.getEntityType()!==t||e(n)}))}eachBond(e,t){const n=this.getBondProxy();let r;if(t&&t.test&&(r=this.getBondSet(),this.bondSet&&r.intersection(this.bondSet)),r)r.forEach((function(t){n.index=t,e(n)}));else{const t=this.bondStore.count;for(let r=0;r<t;++r)n.index=r,e(n)}}eachAtom(e,t){if(t&&t.test)this.eachModel((function(n){n.eachAtom(e,t)}),t);else{const t=this.atomStore.count,n=this.getAtomProxy();for(let r=0;r<t;++r)n.index=r,e(n)}}eachResidue(e,t){if(t&&t.test){const n=this.modelStore.count,r=this.getModelProxy(),i=t.modelOnlyTest;if(i)for(let a=0;a<n;++a)r.index=a,i(r)&&r.eachResidue(e,t);else for(let i=0;i<n;++i)r.index=i,r.eachResidue(e,t)}else{const t=this.residueStore.count,n=this.getResidueProxy();for(let r=0;r<t;++r)n.index=r,e(n)}}eachResidueN(e,t){const n=this.residueStore.count;if(n<e)return;const r=new Array(e);for(let t=0;t<e;++t)r[t]=this.getResidueProxy(t);t.apply(this,r);for(let i=e;i<n;++i){for(let t=0;t<e;++t)r[t].index+=1;t.apply(this,r)}}eachPolymer(e,t){if(t&&t.modelOnlyTest){const n=t.modelOnlyTest;this.eachModel((function(r){n(r)&&r.eachPolymer(e,t)}))}else this.eachModel((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){if(t&&t.test)this.eachModel((function(n){n.eachChain(e,t)}));else{const t=this.chainStore.count,n=this.getChainProxy();for(let r=0;r<t;++r)n.index=r,e(n)}}eachModel(e,t){const n=this.modelStore.count,r=this.getModelProxy();if(t&&t.test){const i=t.modelOnlyTest;if(i)for(let t=0;t<n;++t)r.index=t,i(r)&&e(r);else for(let t=0;t<n;++t)r.index=t,e(r)}else for(let t=0;t<n;++t)r.index=t,e(r)}getAtomData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,r=Ol(t.atomSet,this.atomSet);let i,a;const s={},o=this.getAtomProxy(),l=r.getSize();n&&!n.position||(s.position=new Float32Array(3*l)),n&&!n.color||!t.colorParams||(s.color=new Float32Array(3*l),a=Zc.getScheme(t.colorParams)),n&&!n.picking||(s.picking=new Lh(new Float32Array(l),this.getStructure())),n&&!n.radius||(s.radius=new Float32Array(l),i=new Vf(t.radiusParams)),n&&!n.index||(s.index=new Uint32Array(l));const{position:c,color:u,picking:d,radius:h,index:f}=s;return r.forEach(((e,t)=>{const n=3*t;o.index=e,c&&o.positionToArray(c,n),u&&a.atomColorToArray(o,u,n),d&&(d.array[t]=e),h&&(h[t]=i.atomRadius(o)),f&&(f[t]=e)})),s}getBondData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,r=Ol(t.bondSet,this.bondSet),i=Ol(t.multipleBond,"off"),a="off"!==i,s="offset"===i,o=Ol(t.bondScale,.4),l=Ol(t.bondSpacing,1);let c,u;const d={},h=this.getBondProxy();t.bondStore&&(h.bondStore=t.bondStore);const f=this.getAtomProxy(),p=this.getAtomProxy();let m;if(a){const e=h.bondStore.bondOrder;m=0,r.forEach((function(t){m+=e[t]}))}else m=r.getSize();n&&!n.position||(d.position1=new Float32Array(3*m),d.position2=new Float32Array(3*m)),n&&!n.color||!t.colorParams||(d.color=new Float32Array(3*m),d.color2=new Float32Array(3*m),u=Zc.getScheme(t.colorParams)),n&&!n.picking||(d.picking=new Oh(new Float32Array(m),this.getStructure(),t.bondStore)),(!n||n.radius||a&&n.position)&&(c=new Vf(t.radiusParams)),n&&!n.radius||(d.radius=new Float32Array(m),t.radius2&&(d.radius2=new Float32Array(m)));const{position1:g,position2:_,color:y,color2:v,picking:b,radius:x,radius2:w}=d;let S,A,M,E,C,T,P=0;const I=new Vn,R=new Vn,k=new Vn;return r.forEach((e=>{if(A=3*P,h.index=e,f.index=h.atomIndex1,p.index=h.atomIndex2,E=h.bondOrder,g)if(a&&E>1){const e=c.atomRadius(f);T=e*o/(.5*E),h.calculateShiftDir(k),s?(C=2*l*e,k.multiplyScalar(C),k.negate(),R.subVectors(p,f).multiplyScalar(Math.max(.1,C/1.88)),f.positionToArray(g,A),p.positionToArray(_,A),E>=2&&(I.addVectors(f,k).add(R).toArray(g,A+3),I.addVectors(p,k).sub(R).toArray(_,A+3),E>=3&&(I.subVectors(f,k).add(R).toArray(g,A+6),I.subVectors(p,k).sub(R).toArray(_,A+6)))):(C=(l-o)*e,k.multiplyScalar(C),2===E?(I.addVectors(f,k).toArray(g,A),I.subVectors(f,k).toArray(g,A+3),I.addVectors(p,k).toArray(_,A),I.subVectors(p,k).toArray(_,A+3)):3===E?(f.positionToArray(g,A),I.addVectors(f,k).toArray(g,A+3),I.subVectors(f,k).toArray(g,A+6),p.positionToArray(_,A),I.addVectors(p,k).toArray(_,A+3),I.subVectors(p,k).toArray(_,A+6)):(f.positionToArray(g,A),p.positionToArray(_,A)))}else f.positionToArray(g,A),p.positionToArray(_,A);if(y&&v&&(u.bondColorToArray(h,1,y,A),u.bondColorToArray(h,0,v,A),a&&E>1))for(S=1;S<E;++S)M=3*S+A,Au(y,A,M,3),Au(v,A,M,3);if(b&&b.array&&(b.array[P]=e,a&&E>1))for(S=1;S<E;++S)b.array[P+S]=e;if(x&&(x[P]=c.atomRadius(f),a&&E>1))for(T=x[P]*o/(s?1:.5*E),S=s?1:0;S<E;++S)x[P+S]=T;if(w&&(w[P]=c.atomRadius(p),a&&E>1))for(T=w[P]*o/(s?1:.5*E),S=s?1:0;S<E;++S)w[P+S]=T;P+=a?E:1})),d}getBackboneAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)}getBackboneBondData(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)}getRungAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)}getRungBondData(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)}getBoundingBox(e,t){Xc&&Wc.time("getBoundingBox"),t=t||new Gn;let n=1/0,r=1/0,i=1/0,a=-1/0,s=-1/0,o=-1/0;return this.eachAtom((e=>{const t=e.x,l=e.y,c=e.z;t<n&&(n=t),l<r&&(r=l),c<i&&(i=c),t>a&&(a=t),l>s&&(s=l),c>o&&(o=c)}),e),t.min.set(n,r,i),t.max.set(a,s,o),Xc&&Wc.timeEnd("getBoundingBox"),t}getPrincipalAxes(e){Xc&&Wc.time("getPrincipalAxes");let t=0;const n=new Yh(3,this.atomCount),r=n.data;return this.eachAtom((e=>{r[t+0]=e.x,r[t+1]=e.y,r[t+2]=e.z,t+=3}),e),Xc&&Wc.timeEnd("getPrincipalAxes"),new Gf(n)}atomCenter(e){return e?this.getBoundingBox(e).getCenter(new Vn):this.center.clone()}hasCoords(){if(void 0===this._hasCoords){const e=this.atomStore;this._hasCoords=0!==Eu(e.x)||0!==Mu(e.x)||0!==Eu(e.y)||0!==Mu(e.y)||0!==Eu(e.z)||0!==Mu(e.z)||e.count/this.modelStore.count==1}return this._hasCoords}getSequence(e){const t=[],n=this.getResidueProxy();return this.eachAtom((function(e){n.index=e.residueIndex,e.index===n.traceAtomIndex&&t.push(n.getResname1())}),e),t}getAtomIndices(e){if(e&&e.string){const t=[];return this.eachAtom((function(e){t.push(e.index)}),e),new Uint32Array(t)}{const e={what:{index:!0}};return this.getAtomData(e).index}}getChainnameCount(e){const t=new Set;return this.eachChain((function(e){e.residueCount&&t.add(e.chainname)}),e),t.size}updatePosition(e,t=!0){let n=0;this.eachAtom((function(t){t.positionFromArray(e,n),n+=3}),void 0),this._hasCoords=void 0,t&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new bd(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const Qp=new Gn,Jp=[fd,cd,pd,hd,md,ud,ld,dd,_d,gd,yd,vd],em={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class tm{constructor(e="shape",t={}){this.boundingBox=new Gn,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=Fl(t,em),Jp.forEach((e=>{Object.keys(e.fields).forEach((t=>{this._primitiveData[e.getShapeKey(t)]=[]})),this._primitiveData[e.getShapeKey("name")]=[]}))}addBuffer(e){this.bufferList.push(e);const t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this}addMesh(e,t,n,r,i){let a;e=ql(e),t=ql(t),Array.isArray(n)&&(n=Gl(n,e.length)),r&&(r=ql(r)),a=void 0===r||0==r.length?{position:e,color:t,index:n}:{position:e,color:t,index:n,normal:r};const s=new Vh(this,Object.assign({serial:this.meshCount,name:i},a)),o=new Ef(Object.assign({picking:s},a));return this.bufferList.push(o),Qp.setFromArray(e),this.boundingBox.union(Qp),this.meshCount+=1,this}addSphere(e,t,n,r){return ld.objectToShape(this,{position:e,color:t,radius:n,name:r}),this}addEllipsoid(e,t,n,r,i,a){return md.objectToShape(this,{position:e,color:t,radius:n,majorAxis:r,minorAxis:i,name:a}),this}addTorus(e,t,n,r,i,a){return gd.objectToShape(this,{position:e,color:t,radius:n,majorAxis:r,minorAxis:i,name:a}),this}addCylinder(e,t,n,r,i){return hd.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:i}),this}addCone(e,t,n,r,i){return pd.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:i}),this}addArrow(e,t,n,r,i){return fd.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:i}),this}addBox(e,t,n,r,i,a){return cd.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:i,name:a}),this}addOctahedron(e,t,n,r,i,a){return ud.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:i,name:a}),this}addTetrahedron(e,t,n,r,i,a){return dd.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:i,name:a}),this}addText(e,t,n,r){return _d.objectToShape(this,{position:e,color:t,size:n,text:r}),this}addPoint(e,t,n){return yd.objectToShape(this,{position:e,color:t,name:n}),this}addWideline(e,t,n,r,i){return this.parameters.linewidth=r,vd.objectToShape(this,{position1:e,position2:t,color:n,name:i}),this}addLabel(e,t,n,r){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,n,r)}getBufferList(){const e=[];return Jp.forEach((t=>{this._primitiveData[t.getShapeKey("color")].length&&e.push(t.bufferFromShape(this,this.parameters))})),this.bufferList.concat(e)}dispose(){this.bufferList.forEach((function(e){e.dispose()})),this.bufferList.length=0,Jp.forEach((e=>{Object.keys(e.fields).forEach((t=>{this._primitiveData[e.getShapeKey(t)].length=0})),this._primitiveData[e.getShapeKey("name")].length=0}))}get center(){return this._center||(this._center=this.boundingBox.getCenter(new Vn)),this._center}get type(){return"Shape"}}class nm extends Iu{constructor(e,t,n){Array.isArray(e)||(e=[e]),super(e,t,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=e,this.init(n)}init(e){super.init(e),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e),e.setParameters(this.getBufferParams())})),this.setVisibility(this.visible),e()}}const rm=new _r,im=new pn;class am extends Ef{constructor(e,t={},n){super(function(e,t){const n=t.attributes.position.array,r=t.index?t.index.array:void 0,i=e.position.length/3,a=n.length/3,s=i*a,o=new Float32Array(3*s),l=new Float32Array(3*s),c=new Float32Array(3*s);let u;return r&&(u=Gl(i*r.length,s)),{position:o,color:c,index:u,normal:l,primitiveId:e.primitiveId||xu(i,a),picking:e.picking}}(e,n),t),this.updateNormals=!1;const r=n.attributes.position.array,i=n.attributes.normal.array,a=n.index?n.index.array:void 0;this.geoPosition=r,this.geoNormal=i,this.geoIndex=a,this.positionCount=e.position.length/3,this.geoPositionCount=r.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const s=this.geometry.attributes;if(this.meshPosition=s.position.array,this.meshColor=s.color.array,this.meshNormal=s.normal.array,this.setAttributes(e),a){const e=this.geometry.getIndex();if(!e)return void Wc.error("Index is null");this.meshIndex=e.array,this.makeIndex()}}setAttributes(e={},t=!1){const n=this.geometry.attributes;let r,i,a,s,o,l,c,u,d;const h=this.updateNormals;e.position&&(r=e.position,a=this.geoPosition,c=this.meshPosition,o=this.transformedGeoPosition,n.position.needsUpdate=!0,(h||t)&&(s=this.geoNormal,d=this.meshNormal,l=this.transformedGeoNormal,n.normal.needsUpdate=!0)),e.color&&(i=e.color,u=this.meshColor,n.color.needsUpdate=!0);const f=this.positionCount,p=this.geoPositionCount;for(let e=0;e<f;++e){let n,f;const m=e*p*3,g=3*e;if(r&&o&&c&&d&&a&&s&&(o.set(a),rm.makeTranslation(r[g],r[g+1],r[g+2]),this.applyPositionTransform(rm,e,g),Ou(rm.elements,o),c.set(o,m),h&&l?(l.set(s),im.getNormalMatrix(rm),Fu(im.elements,l),d.set(l,m)):t&&d.set(s,m)),i&&u)for(n=0;n<p;++n)f=m+3*n,u[f]=i[g],u[f+1]=i[g+1],u[f+2]=i[g+2]}}makeIndex(){const e=this.geoIndex,t=this.meshIndex;if(!e)return;const n=this.positionCount,r=this.geoPositionCount,i=e.length/3*3;for(let a=0;a<n;++a){const n=a*i,s=n+i;t.set(e,n);for(let e=n;e<s;++e)t[e]+=a*r}}}const sm=new Vn,om=Object.assign({sphereDetail:1},Sf);class lm extends am{constructor(e,t={}){super(e,t,new hl(1,Ol(t.sphereDetail,1))),this.setAttributes(e,!0)}get defaultParameters(){return om}applyPositionTransform(e,t){const n=this._radius[t];sm.set(n,n,n),e.scale(sm)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}tu.add("shader/SphereImpostor.vert","uniform mat4 projectionMatrixInverse;\nuniform float clipNear;\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\nattribute vec2 mapping;\nattribute float radius;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#endif\n#include matrix_scale\nconst mat4 D = mat4(\n1.0, 0.0, 0.0, 0.0,\n0.0, 1.0, 0.0, 0.0,\n0.0, 0.0, 1.0, 0.0,\n0.0, 0.0, 0.0, -1.0\n);\nmat4 transposeM( in mat4 inMatrix ) {\nvec4 i0 = inMatrix[0];\nvec4 i1 = inMatrix[1];\nvec4 i2 = inMatrix[2];\nvec4 i3 = inMatrix[3];\nmat4 outMatrix = mat4(\nvec4(i0.x, i1.x, i2.x, i3.x),\nvec4(i0.y, i1.y, i2.y, i3.y),\nvec4(i0.z, i1.z, i2.z, i3.z),\nvec4(i0.w, i1.w, i2.w, i3.w)\n);\nreturn outMatrix;\n}\nvoid ComputePointSizeAndPositionInClipCoordSphere(){\nvec2 xbc;\nvec2 ybc;\nmat4 T = mat4(\nradius, 0.0, 0.0, 0.0,\n0.0, radius, 0.0, 0.0,\n0.0, 0.0, radius, 0.0,\nposition.x, position.y, position.z, 1.0\n);\nmat4 R = transposeM( projectionMatrix * modelViewMatrix * T );\nfloat A = dot( R[ 3 ], D * R[ 3 ] );\nfloat B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );\nfloat C = dot( R[ 0 ], D * R[ 0 ] );\nxbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nxbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nfloat sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;\nA = dot( R[ 3 ], D * R[ 3 ] );\nB = -2.0 * dot( R[ 1 ], D * R[ 3 ] );\nC = dot( R[ 1 ], D * R[ 1 ] );\nybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nfloat sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;\ngl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );\ngl_Position.xy -= mapping * vec2( sx, sy );\ngl_Position.xy *= gl_Position.w;\n}\nvoid main(void){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\nvRadius = radius * matrixScale( modelViewMatrix );\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nmvPosition.z -= vRadius;\ngl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );\nComputePointSizeAndPositionInClipCoordSphere();\nvRadiusSq = vRadius * vRadius;\nvec4 vPoint4 = projectionMatrixInverse * gl_Position;\nvPoint = vPoint4.xyz / vPoint4.w;\nvPointViewPosition = -mvPosition.xyz / mvPosition.w;\n}"),tu.add("shader/SphereImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform mat4 projectionMatrix;\nuniform float ortho;\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool flag2 = false;\nbool interior = false;\nvec3 cameraPos;\nvec3 cameraNormal;\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nfloat calcClip( vec3 cameraPos ){\nreturn dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nbool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){\nvec3 cameraSpherePos = -vPointViewPosition;\ncameraSpherePos.z += vRadius;\nvec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );\nvec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );\nvec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );\nfloat B = dot( rayDirection, cameraSphereDir );\nfloat det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );\nif( det < 0.0 ){\ndiscard;\nreturn false;\n}\nfloat sqrtDet = sqrt( det );\nfloat posT = mix( B + sqrtDet, B + sqrtDet, ortho );\nfloat negT = mix( B - sqrtDet, sqrtDet - B, ortho );\ncameraPos = rayDirection * negT + rayOrigin;\n#ifdef NEAR_CLIP\nif( calcDepth( cameraPos ) <= 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\n}else if( calcClip( cameraPos ) > 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\nflag2 = true;\n}\n#else\nif( calcDepth( cameraPos ) <= 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\n}\n#endif\ncameraNormal = normalize( cameraPos - cameraSpherePos );\ncameraNormal *= float(!interior) * 2.0 - 1.0;\nreturn !interior;\n}\nvoid main(void){\nbool flag = Impostor( cameraPos, cameraNormal );\n#ifdef NEAR_CLIP\nif( calcClip( cameraPos ) > 0.0 )\ndiscard;\n#endif\ngl_FragDepthEXT = calcDepth( cameraPos );\nif( !flag ){\n#ifdef NEAR_CLIP\nif( flag2 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n}else if( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n#else\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n#endif\n}\nif (gl_FragDepthEXT < 0.0)\ndiscard;\nif (gl_FragDepthEXT > 1.0)\ndiscard;\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vNormal = cameraNormal;\nvec3 vViewPosition = -cameraPos;\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\n#include normal_fragment_begin\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");class cm extends Mf{constructor(e,t,n={}){super(t,n),this.index=Gl(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:e,value:null}}),this.setAttributes({primitiveId:bu(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(e){const t={};for(const n in e){const r=e[n];t[n]={type:r.type,value:null}}super.addAttributes(t)}getAttributeIndex(e){return 3*e*this.mappingSize}setAttributes(e){e&&!e.position&&e.position1&&e.position2&&(e.position=gu(e.position1,e.position2));const t=this.size,n=this.mappingSize,r=this.geometry.attributes;let i,a,s,o,l,c,u;for(const d in e)if("index"!==d&&"picking"!==d){a=e[d],i=r[d],s=i.itemSize,o=i.array;for(let e=0;e<t;++e){l=e*s,c=l*n;for(let e=0;e<n;++e){u=c+s*e;for(let e=0;e<s;++e)o[u+e]=a[l+e]}}i.needsUpdate=!0}}makeMapping(){const e=this.size,t=this.mapping,n=this.mappingSize,r=this.mappingItemSize,i=this.geometry.attributes.mapping.array;for(let a=0;a<e;a++)i.set(t,a*r*n)}makeIndex(){const e=this.size,t=this.mappingSize,n=this.mappingIndices,r=this.mappingIndicesSize,i=this.index;for(let a=0;a<e;a++){const e=a*r,s=a*t;i.set(n,e);for(let t=0;t<r;++t)i[e+t]+=s}}}const um=new Float32Array([-1,1,-1,-1,1,1,1,-1]),dm=new Uint16Array([0,1,2,1,3,2]);class hm extends cm{constructor(e,t={}){super("v2",e,t)}get mapping(){return um}get mappingIndices(){return dm}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}Object.assign({disableImpostor:!1},om);const fm=class{constructor(e,t){return new lm(e,t)}};function pm(e,t,n,r){const i=n-e,a=r-t;return Math.sqrt(i*i+a*a)}iu.add("sphere",fm),tu.add("shader/Point.vert","uniform float clipNear;\nuniform float clipRadius;\nuniform vec3 clipCenter;\nuniform float size;\nuniform float canvasHeight;\nuniform float pixelRatio;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\nvarying vec3 vViewPosition;\n#endif\n#include common\nvoid main(){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\n#include begin_vertex\n#include project_vertex\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );\n#else\ngl_PointSize = size * pixelRatio;\n#endif\n#ifndef PICKING\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n#include radiusclip_vertex\n}"),tu.add("shader/Point.frag","uniform vec3 diffuse;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include alphatest_pars_fragment\nvarying vec3 vViewPosition;\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\n#ifdef USE_MAP\nif( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )\ndiscard;\n#endif\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 outgoingLight = vec3( 0.0 );\nvec4 diffuseColor = vec4( diffuse, 1.0 );\n#ifdef USE_MAP\ndiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif\n#include color_fragment\n#include alphatest_fragment\noutgoingLight = diffuseColor.rgb;\ngl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const mm=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},Sf),gm=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{uniform:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},Af);class _m extends Mf{constructor(e,t={}){super(e,t),this.parameterTypes=gm,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null},alphaTest:{value:this.parameters.alphaTest}})}get defaultParameters(){return mm}makeMaterial(){super.makeMaterial(),this.makeTexture();const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.uniforms.map.value=this.tex,e.needsUpdate=!0,t.uniforms.map.value=this.tex,t.needsUpdate=!0,n.uniforms.map.value=this.tex,n.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=function(e){const t=e||{},n=Ol(t.width,256),r=Ol(t.height,256),i=[n/2,r/2],a=Math.min(n/2,r/2),s=Ol(t.delta,1/(a+1))*a;let o=0,l=0;const c=new Uint8Array(n*r*4);for(let e=0,t=c.length;e<t;e+=4){const t=1-nc(a-s,a,pm(o,l,i[0],i[1]));c[e]=255*t,c[e+1]=255*t,c[e+2]=255*t,c[e+3]=255*t,++o===n&&(o=0,l++)}const u=new Go(c,n,r);return u.needsUpdate=!0,u}({delta:this.parameters.edgeBleach})}getDefines(e){const t=super.getDefines(e);return this.parameters.sizeAttenuation&&(t.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(t.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(t.USE_ALPHATEST=1),t}setUniforms(e){e&&void 0!==e.edgeBleach&&(this.makeTexture(),e.map=this.tex),super.setUniforms(e)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}iu.add("point",_m);class ym extends Iu{constructor(e,t,n){super(e,t,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),e instanceof vf?(this.surface=void 0,this.volume=new jf(e)):(this.surface=e,this.volume=void 0),this.init(n)}init(e){var t=e||{};t.colorScheme=Ol(t.colorScheme,"uniform"),t.colorValue=Ol(t.colorValue,14540253),this.thresholdType=Ol(t.thresholdType,"sigma"),this.thresholdMin=Ol(t.thresholdMin,2),this.thresholdMax=Ol(t.thresholdMax,1/0),this.thresholdOut=Ol(t.thresholdOut,!1),this.dotType=Ol(t.dotType,"point"),this.radius=Ol(t.radius,.1),this.scale=Ol(t.scale,1),this.pointSize=Ol(t.pointSize,1),this.sizeAttenuation=Ol(t.sizeAttenuation,!0),this.sortParticles=Ol(t.sortParticles,!1),this.useTexture=Ol(t.useTexture,!1),this.alphaTest=Ol(t.alphaTest,.5),this.forceTransparent=Ol(t.forceTransparent,!1),this.edgeBleach=Ol(t.edgeBleach,0),super.init(t),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}create(){var e={};if(this.volume){var t,n,r=this.volume;"sigma"===this.thresholdType?(t=r.getValueForSigma(this.thresholdMin),n=r.getValueForSigma(this.thresholdMax)):(t=this.thresholdMin,n=this.thresholdMax),r.setFilter(t,n,this.thresholdOut),Object.assign(e,{position:r.getDataPosition(),color:r.getDataColor(this.getColorParams())}),"sphere"===this.dotType&&Object.assign(e,{radius:r.getDataSize(this.radius,this.scale),picking:r.getDataPicking()})}else{var i=this.surface;Object.assign(e,{position:i.getPosition(),color:i.getColor(this.getColorParams())}),"sphere"===this.dotType&&Object.assign(e,{radius:i.getSize(this.radius,this.scale),picking:i.getPicking()})}"sphere"===this.dotType?this.dotBuffer=new fm(e,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new _m(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(e={}){if(0===this.bufferList.length)return;const t={};e.color&&(this.volume?Object.assign(t,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(t,{color:this.surface.getColor(this.getColorParams())})),"sphere"===this.dotType&&(e.radius||e.scale)&&(this.volume?Object.assign(t,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(t,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(t)}setParameters(e,t={},n){return e&&void 0!==e.thresholdType&&this.volume instanceof vf&&("value"===this.thresholdType&&"sigma"===e.thresholdType?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):"sigma"===this.thresholdType&&"value"===e.thresholdType&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=e.thresholdType),e&&void 0!==e.radiusType&&("radius"===e.radiusType?this.radius=.1:this.radius=parseFloat(e.radiusType),t.radius=!0,"sphere"!==this.dotType||(n=!0)),e&&void 0!==e.radius&&(t.radius=!0,"sphere"!==this.dotType||(n=!0)),e&&void 0!==e.scale&&(t.scale=!0,"sphere"!==this.dotType||(n=!0)),super.setParameters(e,t,n),this}}tu.add("shader/Image.vert","uniform float clipRadius;\nuniform vec3 clipCenter;\nvarying vec2 vUv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nvoid main() {\n#include begin_vertex\n#include project_vertex\nvUv = uv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n}"),tu.add("shader/Image.frag","uniform sampler2D map;\nuniform float opacity;\nuniform vec2 mapSize;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec2 vUv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform sampler2D pickingMap;\nuniform float objectId;\n#else\n#include fog_pars_fragment\n#endif\n#if defined( CUBIC_INTERPOLATION )\n#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )\n#if defined( CATMULROM_FILTER )\nconst float B = 0.0;\nconst float C = 0.5;\n#elif defined( MITCHELL_FILTER )\nconst float B = 0.333;\nconst float C = 0.333;\n#endif\nfloat applyFilter( float x ){\nfloat f = x;\nif( f < 0.0 ){\nf = -f;\n}\nif( f < 1.0 ){\nreturn ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +\n( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +\n( 6.0 - 2.0 * B ) ) / 6.0;\n}else if( f >= 1.0 && f < 2.0 ){\nreturn ( ( -B - 6.0 * C ) * ( f * f * f )\n+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +\n( - ( 12.0 * B ) - 48.0 * C ) * f +\n8.0 * B + 24.0 * C ) / 6.0;\n}else{\nreturn 0.0;\n}\n}\n#elif defined( BSPLINE_FILTER )\nfloat applyFilter( float x ){\nfloat f = x;\nif( f < 0.0 ){\nf = -f;\n}\nif( f >= 0.0 && f <= 1.0 ){\nreturn ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );\n}else if( f > 1.0 && f <= 2.0 ){\nreturn 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );\n}\nreturn 1.0;\n}\n#else\nfloat applyFilter( float x ){\nreturn 1.0;\n}\n#endif\nvec4 biCubic( sampler2D tex, vec2 texCoord ){\nvec2 texelSize = 1.0 / mapSize;\ntexCoord -= texelSize / 2.0;\nvec4 nSum = vec4( 0.0 );\nfloat nDenom = 0.0;\nvec2 cell = fract( texCoord * mapSize );\nfor( float m = -1.0; m <= 2.0; ++m ){\nfor( float n = -1.0; n <= 2.0; ++n ){\nvec4 vecData = texture2D(\ntex, texCoord + texelSize * vec2( m, n )\n);\nfloat c = applyFilter( m - cell.x ) * applyFilter( -n + cell.y );\nnSum += vecData * c;\nnDenom += c;\n}\n}\nreturn nSum / nDenom;\n}\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( CUBIC_INTERPOLATION )\ngl_FragColor = biCubic( map, vUv );\n#else\ngl_FragColor = texture2D( map, vUv );\n#endif\n#if defined( PICKING )\nif( gl_FragColor.a < 0.3 )\ndiscard;\ngl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );\n#else\nif( gl_FragColor.a < 0.01 )\ndiscard;\ngl_FragColor.a *= opacity;\n#include fog_fragment\n#endif\n}");const vm=new Uint16Array([0,1,2,1,3,2]),bm=new Float32Array([0,1,0,0,1,1,1,0]),xm=Object.assign({filter:"nearest",forceTransparent:!0},Sf),wm=Object.assign({filter:{updateShader:!0,uniform:!0}},Af);class Sm extends Mf{constructor(e,t){super({position:e.position,index:vm,picking:e.picking},t),this.parameterTypes=wm,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:n,width:r,height:i}=e,a=new Go(n,r,i);a.flipY=!0,this.tex=a;const s=n.length,o=new Uint8Array(s);for(let e=0;e<s;e+=4){const t=e/4;o[e]=t>>16&255,o[e+1]=t>>8&255,o[e+2]=255&t}const l=new Go(o,r,i);l.flipY=!0,l.minFilter=ot,l.magFilter=ot,this.pickingTex=l,this.addUniforms({map:{value:a},pickingMap:{value:l},mapSize:{value:new fn(r,i)}}),this.geometry.setAttribute("uv",new hi(bm,2))}get defaultParameters(){return xm}getDefines(e){const t=super.getDefines(e),n=this.parameters.filter;return n.startsWith("cubic")&&(t.CUBIC_INTERPOLATION=1,n.endsWith("bspline")?t.BSPLINE_FILTER=1:n.endsWith("catmulrom")?t.CATMULROM_FILTER=1:n.endsWith("mitchell")&&(t.MITCHELL_FILTER=1)),t}updateTexture(){const e=this.tex,t=this.parameters.filter;t.startsWith("cubic")?(e.minFilter=ot,e.magFilter=ot):"linear"===t?(e.minFilter=ut,e.magFilter=ut):(e.minFilter=ot,e.magFilter=ot),e.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const e=this.material;e.uniforms.map.value=this.tex,e.blending=1,e.needsUpdate=!0;const t=this.wireframeMaterial;t.uniforms.map.value=this.tex,t.blending=1,t.needsUpdate=!0;const n=this.pickingMaterial;n.uniforms.map.value=this.tex,n.uniforms.pickingMap.value=this.pickingTex,n.blending=1,n.needsUpdate=!0}setUniforms(e){e&&void 0!==e.filter&&(this.updateTexture(),e.map=this.tex),super.setUniforms(e)}}class Am{constructor(e,t){const n=t||{};this.dimension=Ol(n.dimension,"x"),this.positionType=Ol(n.positionType,"percent"),this.position=Ol(n.position,30),this.thresholdType=Ol(n.thresholdType,"sigma"),this.thresholdMin=Ol(n.thresholdMin,-1/0),this.thresholdMax=Ol(n.thresholdMax,1/0),this.normalize=Ol(n.normalize,!1),this.volume=e}getPositionFromCoordinate(e){const t=this.dimension,n=this.volume,r=n.matrix,i=(new Vn).setFromMatrixPosition(r)[t],a=(new Vn).setFromMatrixScale(r)[t];let s;return s="x"===t?n.nx:"y"===t?n.ny:n.nz,Math.round(((e-i)/(s/100)+1)/a)}getData(e){e=e||{};const t=this.volume,n=t.data,r=t.matrix;let i;function a(e){return Math.round(e/100*(i-1))}function s(e,n,r,i){return 3*(r*t.ny*t.nx+n*t.nx+e)+i}i="coordinate"===this.positionType?this.getPositionFromCoordinate(this.position):this.position;const o=new Float32Array(12),l=new Vn;let c,u,d,h,f,p=0,m=0,g=0,_=t.nx,y=t.ny,v=t.nz;function b(e,t,n,i){l.set(e,t,n).applyMatrix4(r).toArray(o,i)}"x"===this.dimension?(d=a(t.nx),h=t.ny-1,f=t.nz-1,c=t.nz,u=t.ny,p=d,_=p+1,b(d,0,0,0),b(d,h,0,3),b(d,0,f,6),b(d,h,f,9)):"y"===this.dimension?(d=t.nx-1,h=a(t.ny),f=t.nz-1,c=t.nz,u=t.nx,m=h,y=m+1,b(0,h,0,0),b(d,h,0,3),b(0,h,f,6),b(d,h,f,9)):"z"===this.dimension&&(d=t.nx-1,h=t.ny-1,f=a(t.nz),c=t.nx,u=t.ny,g=f,v=g+1,b(0,0,f,0),b(0,h,f,3),b(d,0,f,6),b(d,h,f,9));let x=0,w=0;const S=new Uint8Array(c*u*4),A=new Float32Array(c*u);let M,E;"sigma"===this.thresholdType?(M=t.getValueForSigma(this.thresholdMin),E=t.getValueForSigma(this.thresholdMax)):(M=this.thresholdMin,E=this.thresholdMax);const C=Object.assign({},e.colorParams,{volume:t});this.normalize&&(C.domain=[0,1]);const T=Zc.getScheme(C),P=new Float32Array(3),I=T.getScale();let R,k=0,D=0;if(this.normalize){k=1/0,R=-1/0;for(let e=m;e<y;++e)for(let t=p;t<_;++t)for(let r=g;r<v;++r){const i=n[s(t,e,r,0)/3];i<k&&(k=i),i>R&&(R=i)}D=R-k}for(let e=m;e<y;++e)for(let t=p;t<_;++t)for(let r=g;r<v;++r){const i=s(t,e,r,0)/3;let a=n[i];this.normalize&&(a=(a-k)/D),T.colorToArray(I(a),P),S[x]=Math.round(255*P[0]),S[x+1]=Math.round(255*P[1]),S[x+2]=Math.round(255*P[2]),S[x+3]=a>M&&a<E?255:0,A[w]=i,++w,x+=4}const L=new jh(A,t);return{position:o,imageData:S,width:c,height:u,picking:L}}}class Mm extends Iu{constructor(e,t,n){super(e,t,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=e,this.init(n)}init(e){const t=this.volume,n=e||{};n.colorDomain=Ol(n.colorDomain,[t.min,t.max]),n.colorScheme=Ol(n.colorScheme,"value"),n.colorScale=Ol(n.colorScale,"Spectral"),this.colorScheme="value",this.dimension=Ol(n.dimension,"x"),this.filter=Ol(n.filter,"cubic-bspline"),this.positionType=Ol(n.positionType,"percent"),this.position=Ol(n.position,30),this.thresholdType=Ol(n.thresholdType,"sigma"),this.thresholdMin=Ol(n.thresholdMin,-1/0),this.thresholdMax=Ol(n.thresholdMax,1/0),this.normalize=Ol(n.normalize,!1),super.init(n),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}create(){const e=new Am(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),t=new Sm(e.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(t)}}function Em(e){Wc.error(`makeRepresentation: representation type ${e} unknown`)}const Cm={name:"some element",status:""};class Tm{constructor(e,t={}){this.stage=e,this.signals={statusChanged:new Ll.Signal,nameChanged:new Ll.Signal,disposed:new Ll.Signal},this.parameters=Fl(t,this.defaultParameters),this.uuid=Jl()}get defaultParameters(){return Cm}get name(){return this.parameters.name}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}dispose(){this.signals.disposed.dispatch()}}const Pm=Object.assign({visible:!0},Cm);class Im extends Tm{constructor(e,t,n={},r){super(e,Object.assign({name:t.type},n)),this.parent=r,this.signals=Object.assign({visibilityChanged:new Ll.Signal,parametersChanged:new Ll.Signal},this.signals),this.setRepresentation(t)}get defaultParameters(){return Pm}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(e){this._disposeRepresentation(),this.repr=e,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(e){return this.parameters.visible=e,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(e){return this.repr.update(e),this}build(e){return this.repr.build(e),this}setSelection(e){const t=this.repr;return t.setSelection&&t.setSelection(e),this}setParameters(e){return this.repr.setParameters(e),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(e){return this.repr.setColor(e),this}}const Rm=new _r,km=new Vn,Dm={name:"",status:"",visible:!0};class Lm{constructor(e,t,n={}){this.stage=e,this.object=t,this.signals={representationAdded:new Ll.Signal,representationRemoved:new Ll.Signal,visibilityChanged:new Ll.Signal,matrixChanged:new Ll.Signal,statusChanged:new Ll.Signal,nameChanged:new Ll.Signal,disposed:new Ll.Signal},this.reprList=[],this.annotationList=[],this.matrix=new _r,this.position=new Vn,this.quaternion=new zn,this.scale=new Vn(1,1,1),this.transform=new _r,this.parameters=Fl(n,this.defaultParameters),this.uuid=Jl(),this.viewer=e.viewer,this.controls=new Bf(this)}get defaultParameters(){return Dm}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this}setRotation(e){if(Array.isArray(e))if(3===e.length){const t=(new Cr).fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof Cr?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this}setScale(e){return this.scale.set(e,e,e),this.updateMatrix(),this}setTransform(e){return this.transform.copy(e),this.updateMatrix(),this}updateMatrix(){const e=this.getCenterUntransformed(km);this.matrix.makeTranslation(-e.x,-e.y,-e.z),Rm.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(Rm),Rm.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(Rm);const t=this.position;Rm.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(Rm),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach((e=>{e.setParameters({matrix:this.matrix})}))}addAnnotation(e,t,n){const r=new Nf(this,e,t,n);return this.annotationList.push(r),r}eachAnnotation(e){this.annotationList.slice().forEach(e)}removeAnnotation(e){const t=this.annotationList.indexOf(e);-1!==t&&(this.annotationList.splice(t,1),e.dispose())}removeAllAnnotations(){this.eachAnnotation((e=>e.dispose())),this.annotationList.length=0}_addRepresentation(e,t,n,r=!1){const i=n||{},a=this.stage.getParameters();i.matrix=this.matrix.clone(),i.quality=i.quality||a.quality,i.disableImpostor=Ol(i.disableImpostor,!a.impostor),i.useWorker=Ol(i.useWorker,a.workerDefault),i.visible=Ol(i.visible,!0);const s=Object.assign({},i,{visible:this.parameters.visible&&i.visible}),o=function(e,t,n,r){var i;if(Xc&&Wc.time("makeRepresentation "+e),t instanceof Zp){if(!(i=Jc.get(e)))return void Em(e)}else if(t instanceof _f)if("surface"===e)i=kf;else{if("dot"!==e)return void Em(e);i=ym}else if(t instanceof vf)if("surface"===e)i=kf;else if("dot"===e)i=ym;else{if("slice"!==e)return void Em(e);i=Mm}else if(t instanceof tm)i=nm,t=t.getBufferList();else{if("buffer"!==e)return void Wc.error("makeRepresentation: object "+t+" unknown");i=nm}const a=new i(t,n,r);return Xc&&Wc.timeEnd("makeRepresentation "+e),a}(e,t,this.viewer,s),l=new Im(this.stage,o,i,this);return r||(this.reprList.push(l),this.signals.representationAdded.dispatch(l)),l}addBufferRepresentation(e,t){return this._addRepresentation.call(this,"buffer",e,t)}hasRepresentation(e){return-1!==this.reprList.indexOf(e)}eachRepresentation(e){this.reprList.slice().forEach(e)}removeRepresentation(e){const t=this.reprList.indexOf(e);-1!==t&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))}updateRepresentations(e){this.reprList.forEach((t=>t.update(e))),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation((e=>e.dispose()))}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(e){return this.parameters.visible=e,this.eachRepresentation((e=>e.updateVisibility())),this.eachAnnotation((e=>e.updateVisibility())),this.signals.visibilityChanged.dispatch(e),this}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}getBox(...e){return this.getBoxUntransformed(...e).clone().applyMatrix4(this.matrix)}getCenter(...e){return this.getCenterUntransformed(...e).clone().applyMatrix4(this.matrix)}getZoom(...e){return this.stage.getZoomForBox(this.getBox(...e))}getBoxUntransformed(...e){return new Gn}getCenterUntransformed(...e){return this.getBoxUntransformed().getCenter(new Vn)}autoView(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),Ol(e,0))}}class Nm{constructor(e=[]){this.list=e;const t=e.length;for(let n=0;n<t;++n)e[n].signals.disposed.add(this._remove,this)}_remove(e){const t=this.list.indexOf(e);-1!==t&&this.list.splice(t,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(e){return this.list.forEach(e),this}dispose(){return this.forEach((e=>e.dispose()))}}class Om extends Nm{setParameters(e){return this.forEach((t=>t.setParameters(e)))}setVisibility(e){return this.forEach((t=>t.setVisibility(e)))}setSelection(e){return this.forEach((t=>t.setSelection(e)))}setColor(e){return this.forEach((t=>t.setColor(e)))}update(e){return this.forEach((t=>t.update(e)))}build(e){return this.forEach((t=>t.build(e)))}dispose(e){return this.forEach((e=>e.dispose()))}}const Fm=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},Cm);class Um extends Tm{constructor(e,t,n={}){super(e,Object.assign({name:t.name},n)),this.trajectory=t,this.signals=Object.assign(this.signals,{frameChanged:new Ll.Signal,playerChanged:new Ll.Signal,countChanged:new Ll.Signal,parametersChanged:new Ll.Signal}),t.signals.frameChanged.add((e=>{this.signals.frameChanged.dispatch(e)})),t.signals.playerChanged.add((e=>{this.signals.playerChanged.dispatch(e)})),t.signals.countChanged.add((e=>{this.signals.countChanged.dispatch(e)})),void 0!==n.initialFrame&&this.setFrame(n.initialFrame)}get defaultParameters(){return Fm}get type(){return"trajectory"}setFrame(e){this.trajectory.setFrame(e)}setParameters(e={}){this.trajectory.setParameters(e),this.signals.parametersChanged.dispatch(e)}dispose(){this.trajectory.dispose(),super.dispose()}}class Bm{constructor(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class zm{constructor(e,t){let n,r;if(this.A=new Yh(3,3),this.W=new Yh(1,3),this.U=new Yh(3,3),this.V=new Yh(3,3),this.VH=new Yh(3,3),this.R=new Yh(3,3),this.tmp=new Yh(3,3),this.c=new Yh(3,3),e instanceof Zp)n=e.atomCount;else{if(!(e instanceof Float32Array))return;n=e.length/3}if(t instanceof Zp)r=t.atomCount;else{if(!(t instanceof Float32Array))return;r=t.length/3}const i=Math.min(n,r),a=new Yh(3,i),s=new Yh(3,i);this.coords1t=new Yh(i,3),this.coords2t=new Yh(i,3),this.transformationMatrix=new _r,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,a,i,!1),this.prepCoords(t,s,i,!1),this._superpose(a,s)}_superpose(e,t){this.mean1=Jh(e),this.mean2=Jh(t),ef(e,this.mean1),ef(t,this.mean2),Kh(this.coords1t,e),Kh(this.coords2t,t),Zh(this.A,this.coords2t,this.coords1t),rf(this.A,this.W,this.U,this.V),function(e,t){const n=e.data,r=t.data,i=n[4],a=n[8],s=n[5],o=n[7],l=n[0],c=l*i,u=l*s,d=n[3],h=n[1],f=d*h,p=n[2],m=d*p,g=n[6],_=g*h,y=g*p,v=1/(c*a-u*o-f*a+m*o+_*s-y*i);r[0]=(i*a-s*o)*v,r[1]=-(h*a-p*o)*v,r[2]=-(-h*s+p*i)*v,r[3]=-(d*a-s*g)*v,r[4]=(l*a-y)*v,r[5]=-(u-m)*v,r[6]=-(-d*o+i*g)*v,r[7]=-(l*o-_)*v,r[8]=(c-f)*v}(this.V,this.VH),Qh(this.R,this.U,this.VH),function(e){const t=e.data;return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[3]*t[1]*t[8]+t[3]*t[2]*t[7]+t[6]*t[1]*t[5]-t[6]*t[2]*t[4]}(this.R)<0&&(Xc&&Wc.log("R not a right handed system"),Qh(this.tmp,this.c,this.VH),Qh(this.R,this.U,this.tmp));const n=new Yh(4,4),r=new Yh(4,4),i=new Yh(4,4),a=new Yh(4,4),s=new Yh(4,4),o=new Yh(4,4),l=this.R.data,c=this.mean1,u=this.mean2;a.data.set([1,0,0,-c[0],0,1,0,-c[1],0,0,1,-c[2],0,0,0,1]),s.data.set([l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1]),o.data.set([1,0,0,u[0],0,1,0,u[1],0,0,1,u[2],0,0,0,1]),Kh(r,a),Zh(n,s,r),Kh(i,n),Zh(r,o,i),Kh(n,r),this.transformationMatrix.elements=n.data}prepCoords(e,t,n,r){let i=0;const a=t.data;let s=3,o=3*n;if(r&&(o=4*n,s=4),e instanceof Zp)e.eachAtom((function(e){i<o&&(a[i+0]=e.x,a[i+1]=e.y,a[i+2]=e.z,r&&(a[i+3]=1),i+=s)}));else if(e instanceof Float32Array)for(;i<o;i+=s)i<o&&(a[i]=e[i],a[i+1]=e[i+1],a[i+2]=e[i+2],r&&(a[i+3]=1));else Wc.warn("prepCoords: input type unknown")}transform(e){let t;if(e instanceof Zp)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}const n=new Yh(4,t),r=new Yh(t,4);this.prepCoords(e,n,t,!0);const i=this.transformationMatrix,a=i.determinant();if(!a)return a;const s=new Yh(4,4);s.data=i.elements,function(e,t,n){let r=0,i=0,a=0,s=0,o=0,l=0,c=0,u=0;const d=t.cols,h=t.rows,f=n.cols,p=t.data,m=n.data,g=e.data;let _=0;for(;r<h;s+=d,r++)for(c=0,i=0;i<f;u++,c++,i++){for(l=c,o=s,_=0,a=0;a<d;o++,l+=f,a++)_+=p[o]*m[l];g[u]=_}}(r,n,s);let o=0;const l=r.data;if(e instanceof Zp){e.eachAtom((function(e){e.x=l[o],e.y=l[o+1],e.z=l[o+2],o+=4}));const t=new _r;t.copy(i).invert();const n=e.biomolDict;for(let e in n)n.hasOwnProperty(e)&&n[e].partList.forEach((function(e){e.matrixList.forEach((function(e){e.premultiply(i),e.multiply(t)}))}))}else if(e instanceof Float32Array){const n=4*t;for(;o<n;o+=4)e[o]=l[o],e[o+1]=l[o+1],e[o+2]=l[o+2]}else Wc.warn("transform: input type unknown");return this.transformationMatrix}}const Vm={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class Hm{constructor(e,t={}){this.signals={startedRunning:new Ll.Signal,haltedRunning:new Ll.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add((e=>{e!==this&&this.pause()}),this);const n=Ol(e.frameCount,1);this.traj=e,this.parameters=Fl(t,Vm),this.parameters.end=Math.min(Ol(t.end,n-1),n-1),this.parameters.step=Ol(t.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction="bounce"===this.parameters.direction?"forward":this.parameters.direction,e.signals.countChanged.add((e=>{this.parameters.end=Math.min(Ol(this.parameters.end,e-1),e-1)}),this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(e={}){(function(e,t){for(const n in t){const r=t[n];void 0!==r&&(e[n]=r)}})(this.parameters,e),void 0!==e.direction&&"bounce"!==this.parameters.direction&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/t,r=this.traj;if(r&&r.frameCount&&!r.inProgress&&e>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),1===this._currentStep&&(this._currentFrame=this._nextInterpolated()),r.hasFrame(this._currentFrame)){this._currentStep+=1;const e=this._currentStep/(this.parameters.interpolateStep+1),[t,n,i,a]=this._currentFrame;r.setFrameInterpolated(t,n,i,a,e,this.parameters.interpolateType),this._previousTime=this._currentTime}else r.loadFrame(this._currentFrame);else{const e=this._next();r.hasFrame(e)?(r.setFrame(e),this._previousTime=this._currentTime):r.loadFrame(e)}window.requestAnimationFrame(this._animate)}_next(){const e=this.parameters;let t;return t="forward"===this._direction?this.traj.currentFrame+e.step:this.traj.currentFrame-e.step,(t>e.end||t<e.start)&&("bounce"===e.direction&&("forward"===this._direction?this._direction="backward":this._direction="forward"),"once"===e.mode?(this.pause(),t="forward"===e.direction?e.end:"backward"===e.direction||"forward"===this._direction?e.start:e.end):"forward"===this._direction?(t=e.start,e.interpolateType&&(t=Math.min(e.end,t+e.step))):(t=e.end,e.interpolateType&&(t=Math.max(e.start,t-e.step)))),t}_nextInterpolated(){const e=this.parameters,t=this._next();let n,r,i;return"forward"===this._direction?(n=Math.max(e.start,t-e.step),r=Math.max(e.start,t-2*e.step),i=Math.max(e.start,t-3*e.step)):(n=Math.min(e.end,t+e.step),r=Math.min(e.end,t+2*e.step),i=Math.min(e.end,t+3*e.step)),[t,n,r,i]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const e=this.parameters,t=this.traj.currentFrame;let n=Math.ceil(t/e.step)*e.step;"forward"===e.direction&&t>=e.end?n=e.start:"backward"===e.direction&&t<=e.start&&(n=e.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}class $m{constructor(e,t,n={}){this.signals={countChanged:new Ll.Signal,frameChanged:new Ll.Signal,playerChanged:new Ll.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=Ol(n.deltaTime,0),this.timeOffset=Ol(n.timeOffset,0),this.centerPbc=Ol(n.centerPbc,!1),this.removePbc=Ol(n.removePbc,!1),this.removePeriodicity=Ol(n.removePeriodicity,!1),this.superpose=Ol(n.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new Nc(Ol(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add((()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}))}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new Hm(this))}_loadFrameCount(){}setStructure(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new Nc("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,(()=>this._saveInitialCoords()))}_saveStructureCoords(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position}setSelection(e){return this.selection.setString(e),this}_getIndices(e){let t=0;const n=e.test,r=[];return n&&this.structure.eachAtom((e=>{n(e)&&r.push(t),t+=1})),r}_makeSuperposeCoords(){const e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);const t=this.initialCoords,n=this.coords2;for(let r=0;r<e;r+=3){const e=3*this.selectionIndices[r/3];n[r+0]=t[e+0],n[r+1]=t[e+1],n[r+2]=t[e+2]}}_makeAtomIndices(){Wc.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(e={}){let t=!1;void 0!==e.centerPbc&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),void 0!==e.removePeriodicity&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),void 0!==e.removePbc&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),void 0!==e.superpose&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=Ol(e.deltaTime,this.deltaTime),this.timeOffset=Ol(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(e){return Array.isArray(e)?e.every((e=>!!this.frameCache[e])):!!this.frameCache[e]}setFrame(e,t){return void 0===e||(this.inProgress=!0,-1===e||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,(()=>{this._updateStructure(e),t&&t()}))),this}_interpolate(e,t,n,r,i,a){const s=this.frameCache;let o;o="spline"===a?function(e,t,n,r,i){const a=e.length,s=new Float32Array(a);for(let o=0;o<a;o+=3){const a=o+1,l=o+2;s[o]=tc(r[o],n[o],t[o],e[o],i,1),s[a]=tc(r[a],n[a],t[a],e[a],i,1),s[l]=tc(r[l],n[l],t[l],e[l],i,1)}return s}(s[e],s[t],s[n],s[r],i):function(e,t,n){const r=e.length,i=new Float32Array(r);for(let a=0;a<r;a+=3){const r=a+1,s=a+2;i[a]=ec(t[a],e[a],n),i[r]=ec(t[r],e[r],n),i[s]=ec(t[s],e[s],n)}return i}(s[e],s[t],i),this.structure.updatePosition(o),this._currentFrame=e,this.signals.frameChanged.dispatch(e)}setFrameInterpolated(e,t,n,r,i,a,s){if(void 0===e)return this;const o=this.frameCache,l=[];return o[r]||l.push(r),o[n]||l.push(n),o[t]||l.push(t),o[e]||l.push(e),l.length?this.loadFrame(l,(()=>{this._interpolate(e,t,n,r,i,a),s&&s()})):(this._interpolate(e,t,n,r,i,a),s&&s()),this}loadFrame(e,t){Array.isArray(e)?e.forEach((e=>{this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,(()=>{delete this.loadQueue[e]})))})):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,(()=>{delete this.loadQueue[e],t&&t()})))}_loadFrame(e,t){Wc.error("Trajectory._loadFrame not implemented",e,t)}_updateStructure(e){this._disposed?console.error("updateStructure: traj disposed"):(-1===e?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))}_doSuperpose(e){const t=3*this.selectionIndices.length,n=this.coords1,r=this.coords2;for(let r=0;r<t;r+=3){const t=3*this.selectionIndices[r/3];n[r+0]=e[t+0],n[r+1]=e[t+1],n[r+2]=e[t+2]}new zm(n,r).transform(e)}_process(e,t,n,r){if(this._setFrameCount(r),t){if(this.backboneIndices.length>0&&this.centerPbc){const e=[t[0],t[4],t[8]],r=function(e,t,n){return[mu(t,n[0],3,0,e),mu(t,n[1],3,1,e),mu(t,n[2],3,2,e)]}(this.backboneIndices,n,e);!function(e,t,n){if(0===n[0]||0===n[8]||0===n[4])return;const r=e.length,i=n[0],a=n[1],s=n[2],o=-t[0]+i+i/2,l=-t[1]+a+a/2,c=-t[2]+s+s/2;for(let t=0;t<r;t+=3)e[t+0]=(e[t+0]+o)%i,e[t+1]=(e[t+1]+l)%a,e[t+2]=(e[t+2]+c)%s}(n,r,e)}this.removePeriodicity&&function(e,t,n){if(0===t[0]||0===t[8]||0===t[4])return;const r=e.length;for(let i=3;i<r;i+=3)for(let r=0;r<3;++r){const a=(e[i+r]-n[r])/t[3*r+r];Math.abs(a)>.5&&(e[i+r]-=t[3*r+r]*Math.round(a))}}(n,t,function(e){return[Tu(e,3,0),Tu(e,3,1),Tu(e,3,2)]}(n)),this.removePbc&&function(e,t){if(0===t[0]||0===t[8]||0===t[4])return;const n=e.length;for(let r=3;r<n;r+=3)for(let n=0;n<3;++n){const i=e[r+n]-e[r-3+n];if(Math.abs(i)>.9*t[3*n+n])if(i>0)for(let i=0;i<3;++i)e[r+i]-=t[3*n+i];else for(let i=0;i<3;++i)e[r+i]+=t[3*n+i]}}(n,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[e]=n,this.boxCache[e]=t,this.frameCacheSize+=1}_setFrameCount(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(e){this.player=e,this.signals.playerChanged.dispatch(e)}getFrameTime(e){return this.timeOffset+e*this.deltaTime}}class Gm extends $m{constructor(e,t,n){const r=n||{};r.timeOffset=Ol(r.timeOffset,e.timeOffset),r.deltaTime=Ol(r.deltaTime,e.deltaTime),super("",t,r),this.name=e.name,this.path=e.path,this.frames=e.coordinates,this.boxes=e.boxes,this._init(t)}get type(){return"frames"}_makeAtomIndices(){"StructureView"===this.structure.type?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const r=this.frames[e];if(this.atomIndices){const e=this.atomIndices,t=e.length;n=new Float32Array(3*t);for(let i=0;i<t;++i){const t=3*i,a=3*e[i];n[t+0]=r[a+0],n[t+1]=r[a+1],n[t+2]=r[a+2]}}else n=new Float32Array(r);const i=this.boxes[e],a=this.frames.length;this._process(e,i,n,a),"function"==typeof t&&t()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class jm extends $m{constructor(e,t,n){super("",t,n),this._init(t)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const r=this.structure,i=r.frames[e];if(this.atomIndices){const e=this.atomIndices,t=e.length;n=new Float32Array(3*t);for(let r=0;r<t;++r){const t=3*r,a=3*e[r];n[t+0]=i[a+0],n[t+1]=i[a+1],n[t+2]=i[a+2]}}else n=new Float32Array(i);const a=r.boxes[e],s=r.frames.length;this._process(e,a,n,s),"function"==typeof t&&t()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class Wm extends $m{constructor(e,t,n){super(e,t,n),this._init(t)}get type(){return"remote"}_makeAtomIndices(){const e=[];if("StructureView"===this.structure.type){const t=this.structure.getAtomIndices(),n=t.length;let r=t[0],i=t[0];for(let a=1;a<n;++a){const n=t[a];i+1<n&&(e.push([r,i+1]),r=n),i=n}e.push([r,i+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){const n=new XMLHttpRequest,r=su.getFrameUrl(this.trajPath,e),i=su.getFrameParams(this.trajPath,this.atomIndices);n.open("POST",r,!0),n.responseType="arraybuffer",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.addEventListener("load",(()=>{const i=n.response;if(!i)return void Wc.error(`empty arrayBuffer for '${r}'`);const a=new Int32Array(i,0,1)[0],s=new Float32Array(i,8,9),o=new Float32Array(i,44);this._process(e,s,o,a),"function"==typeof t&&t()}),!1),n.send(i)}_loadFrameCount(){const e=new XMLHttpRequest,t=su.getCountUrl(this.trajPath);e.open("GET",t,!0),e.addEventListener("load",(()=>{this._setFrameCount(parseInt(e.response))}),!1),e.send()}}class qm extends $m{constructor(e,t,n){super("",t,n),this.requestCallback=e,this._init(t)}get type(){return"callback"}_makeAtomIndices(){const e=[];if("StructureView"===this.structure.type){const t=this.structure.getAtomIndices(),n=t.length;let r=t[0],i=t[0];for(let a=1;a<n;++a){const n=t[a];i+1<n&&(e.push([r,i+1]),r=n),i=n}e.push([r,i+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){this.requestCallback(((e,n,r,i)=>{this._process(e,n,r,i),"function"==typeof t&&t()}),e,this.atomIndices)}_loadFrameCount(){this.requestCallback((e=>this._setFrameCount(e)))}}Zp.prototype.getView=function(e){return new Xm(this,e)};class Xm extends Zp{constructor(e,t){super(),this.structure=e,this.selection=t,this.center=new Vn,this.boundingBox=new Gn,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(e){this.structure._hasCoords=e}refresh(){Xc&&Wc.time("StructureView.refresh"),this.atomSetCache={};const e=this.structure;if(this.selection.isAllSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=e.atomSet.clone(),this.bondSet=e.bondSet.clone();for(let e in this.atomSetDict){const t=this.atomSetDict[e];this.atomSetCache["__"+e]=t.clone()}this.atomCount=e.atomCount,this.bondCount=e.bondCount,this.boundingBox.copy(e.boundingBox),this.center.copy(e.center)}else if(this.selection.isNoneSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=new Ad(e.atomCount),this.bondSet=new Ad(e.bondCount);for(let t in this.atomSetDict)this.atomSetCache["__"+t]=new Ad(e.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),e.atomSet&&(this.atomSet=this.atomSet.intersection(e.atomSet)),this.bondSet=this.getBondSet();for(let e in this.atomSetDict){const t=this.atomSetDict[e];this.atomSetCache["__"+e]=t.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new Vn)}Xc&&Wc.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(e){this.selection=e,this.refresh()}getSelection(e){const t=[];e&&e.string&&t.push(e.string);const n=this.structure.getSelection();n&&n.string&&t.push(n.string),this.selection&&this.selection.string&&t.push(this.selection.string);let r="";return t.length>0&&(r=`( ${t.join(" ) AND ( ")} )`),new Nc(r)}getStructure(){return this.structure.getStructure()}eachBond(e,t){this.structure.eachBond(e,this.getSelection(t))}eachAtom(e,t){const n=this.getAtomProxy(),r=this.getAtomSet(t),i=this.atomStore.count;if(r.getSize()<i)r.forEach((function(t){n.index=t,e(n)}));else for(let t=0;t<i;++t)n.index=t,e(n)}eachResidue(e,t){this.structure.eachResidue(e,this.getSelection(t))}eachResidueN(e,t){console.error("StructureView.eachResidueN() not implemented")}eachChain(e,t){this.structure.eachChain(e,this.getSelection(t))}eachModel(e,t){this.structure.eachModel(e,this.getSelection(t))}getAtomSet(e,t=!1){let n=this.structure.getAtomSet(e);return!t&&this.atomSet&&(n=n.makeIntersection(this.atomSet)),n}getAtomIndices(e){return this.structure.getAtomIndices(this.getSelection(e))}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new Zp,delete this.atomSet,delete this.bondSet}}function Ym(e,t){let n,r=0;const i={};return t.forEach((function(t){n=0;const a={};t.forEach((function(t){a[e[n++]]=t})),i[e[r++]]=a})),i}const Km={blosum62:Ym("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:Ym("ACDEFGHIKLMNPQRSTVWY",[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]])};class Zm{constructor(e,t,n=-10,r=-1,i="blosum62"){this.seq1=e,this.seq2=t,this.gapPenalty=n,this.gapExtensionPenalty=r,i&&(this.substMatrix=Km[i])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(let t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(let e=0;e<=this.n;++e)this.S[e][0]=this.gap(0),this.H[e][0]=-1/0;for(let e=0;e<=this.m;++e)this.S[0][e]=this.gap(0),this.V[0][e]=-1/0;this.S[0][0]=0}gap(e){return this.gapPenalty+e*this.gapExtensionPenalty}makeScoreFn(){const e=this.seq1,t=this.seq2,n=this.substMatrix;return n?function(r,i){const a=e[r],s=t[i];try{return n[a][s]}catch(e){return-4}}:(Wc.warn("Alignment: no subst matrix"),function(n,r){return e[n]===t[r]?5:-3})}calc(){Xc&&Wc.time("Alignment.calc"),this.initMatrices();const e=this.gap(0),t=this.makeScoreFn(),n=this.gapExtensionPenalty,r=this.V,i=this.H,a=this.S,s=this.n,o=this.m;let l,c,u,d,h;for(let f=1;f<=s;++f){c=a[f-1],l=r[f-1],u=r[f],d=i[f],h=a[f];for(let r=1;r<=o;++r)u[r]=Math.max(c[r]+e,l[r]+n),d[r]=Math.max(h[r-1]+e,d[r-1]+n),h[r]=Math.max(c[r-1]+t(f-1,r-1),u[r],d[r])}Xc&&Wc.timeEnd("Alignment.calc"),Xc&&Wc.log(this.S,this.V,this.H)}trace(){Xc&&Wc.time("Alignment.trace"),this.ali1="",this.ali2="";const e=this.makeScoreFn();let t,n=this.n,r=this.m;for(this.S[n][r]>=this.V[n][r]?(t="S",this.score=this.S[n][r]):this.V[n][r]>=this.H[n][r]?(t="V",this.score=this.V[n][r]):(t="H",this.score=this.H[n][r]),Xc&&Wc.log("Alignment: SCORE",this.score),Xc&&Wc.log("Alignment: S, V, H",this.S[n][r],this.V[n][r],this.H[n][r]);n>0&&r>0;)"S"===t?this.S[n][r]===this.S[n-1][r-1]+e(n-1,r-1)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--n,--r,t="S"):this.S[n][r]===this.V[n][r]?t="V":this.S[n][r]===this.H[n][r]?t="H":(--n,--r):"V"===t?this.V[n][r]===this.V[n-1][r]+this.gapExtensionPenalty?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="V"):this.V[n][r]===this.S[n-1][r]+this.gap(0)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="S"):--n:"H"===t?this.H[n][r]===this.H[n][r-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r,t="H"):this.H[n][r]===this.S[n][r-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r,t="S"):--r:Wc.error("Alignment: no matrix");for(;n>0;)this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n;for(;r>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r;Xc&&Wc.timeEnd("Alignment.trace"),Xc&&Wc.log([this.ali1,this.ali2])}}const Qm=Object.assign({sele:"",defaultAssembly:""},Dm);class Jm extends Lm{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.structure=t,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new Ll.Signal,trajectoryRemoved:new Ll.Signal,defaultAssemblyChanged:new Ll.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=function(e){let t=0,n=0;const r=[];return{has:function(e){return-1!==r.indexOf(e)},get:function(e){return r[e]},push:function(e){r[t]=e,t=(4+t+1)%4,++n},get count(){return n},get data(){return r.slice(0,Math.min(n,4))},clear:function(){n=0,t=0,r.length=0}}}(),this.pickDict=function(){const e={};return{has:function(t){return void 0!==e[JSON.stringify(t)]},add:function(t,n){e[JSON.stringify(t)]=n},del:function(t){delete e[JSON.stringify(t)]},get values(){return Object.keys(e).map((t=>e[t]))}}}(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:qc.opacity,color:qc.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",qc,!0),this.angleRepresentation=this.addRepresentation("angle",qc,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",qc,!0),this.measureRepresentations=new Om([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add((()=>{this.updateRepresentations({position:!0})}))}get defaultParameters(){return Qm}get type(){return"structure"}initSelection(e){this.selection=new Nc(e),this.structureView=new Xm(this.structure,this.selection),this.selection.signals.stringChanged.add((()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()}))}setSelection(e){return this.parameters.sele=e,this.selection.setString(e),this}setDefaultAssembly(e){if(void 0===this.structure.biomolDict[e]&&(e=""),this.parameters.defaultAssembly!==e){const t={defaultAssembly:e};this.reprList.forEach((e=>e.setParameters(t))),this.measureRepresentations.setParameters(t),this.parameters.defaultAssembly=e,this.signals.defaultAssemblyChanged.dispatch(e)}return this}rebuildRepresentations(){this.reprList.forEach((e=>{e.build()})),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach((e=>{e.trajectory.setStructure(this.structureView)}))}updateRepresentations(e){super.updateRepresentations(e),this.measureRepresentations.update(e)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(e,t={},n=!1){t.defaultAssembly=this.parameters.defaultAssembly;const r=this._addRepresentation(e,this.structureView,t,n);return n||r.signals.parametersChanged.add((()=>this.measureUpdate())),r}addTrajectory(e="",t={}){const n=function(e,t,n){let r;return r=e&&e instanceof Bm?new Gm(e,t,n):!e&&t.frames?new jm(e,t,n):e&&"function"==typeof e?new qm(e,t,n):new Wm(e,t,n),r}(e,this.structureView,t),r=new Um(this.stage,n,t);return this.trajList.push(r),this.signals.trajectoryAdded.dispatch(r),r}removeTrajectory(e){const t=this.trajList.indexOf(e);-1!==t&&this.trajList.splice(t,1),e.dispose(),this.signals.trajectoryRemoved.dispatch(e)}dispose(){this.trajList.slice().forEach((e=>e.dispose())),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(e,t){"number"==typeof e&&(t=e,e=""),this.stage.animationControls.zoomMove(this.getCenter(e),this.getZoom(e),Ol(t,0))}getBoxUntransformed(e){let t;return t=e?this.structureView.getBoundingBox(new Nc(e)):this.structureView.boundingBox,t}getCenterUntransformed(e){return e&&"string"==typeof e?this.structure.atomCenter(new Nc(e)):this.structure.center}superpose(e,t,n,r){return function(e,t,n=!1,r="",i=""){let a,s,o,l,c;if(n){let n=e,u=t;r&&i&&(n=e.getView(new Nc(r)),u=t.getView(new Nc(i)));const d=n.getSequence(),h=u.getSequence(),f=new Zm(d.join(""),h.join(""));let p,m;f.calc(),f.trace(),a=0,s=0,o=f.ali1.length;const g=[],_=[];for(let e=0;e<o;++e){const t=f.ali1[e],n=f.ali2[e];p=0,m=0,"-"===t?_[s]=!1:(_[s]=!0,p=1),"-"===n?g[a]=!1:(g[a]=!0,m=1),a+=p,s+=m}const y=[],v=[],b=n.getAtomProxy(),x=u.getAtomProxy();a=0,n.eachResidue((function(e){void 0!==e.traceAtomIndex&&e.traceAtomIndex===e.getAtomIndexByName("CA")&&(g[a]&&(b.index=e.getAtomIndexByName("CA"),y.push(b.x,b.y,b.z)),a+=1)})),a=0,u.eachResidue((function(e){void 0!==e.traceAtomIndex&&e.traceAtomIndex===e.getAtomIndexByName("CA")&&(_[a]&&(x.index=e.getAtomIndexByName("CA"),v.push(x.x,x.y,x.z)),a+=1)})),l=new Float32Array(y),c=new Float32Array(v)}else l=e.getView(new Nc(`${r} and .CA`)),c=t.getView(new Nc(`${i} and .CA`));new zm(l,c).transform(e);e.refreshPosition()}(this.structureView,e.structureView,t,n,r),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(e){let t=0;const n=this.structure.getAtomProxy(e);return this.eachRepresentation((e=>{if(e.getVisibility()){const r=e.repr;t=Math.max(r.getAtomRadius(n),t)}})),t}measurePick(e){const t=this.pickBuffer.count;if(this.lastPick===e.index&&t>=1){if(t>1){const e=this.pickBuffer.data,n=this.pickBuffer.data.sort();this.pickDict.has(n)?this.pickDict.del(n):this.pickDict.add(n,e),2===t?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter((e=>2===e.length))}):3===t?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter((e=>3===e.length))}):4===t&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter((e=>4===e.length))})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(e.index)||this.pickBuffer.push(e.index),this.lastPick=e.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const e=this.measureData();this.distanceRepresentation.setParameters({atomPair:e.distance}),this.angleRepresentation.setParameters({atomTriple:e.angle}),this.dihedralRepresentation.setParameters({atomQuad:e.dihedral})}measureUpdate(){const e=this.pickBuffer.data,t={};e.forEach((e=>{const n=Math.max(.1,this.getMaxRepresentationRadius(e));t[e]=n*(2.3-nc(.1,2,n))})),this.spacefillRepresentation.setSelection(e.length?"@"+e.join(","):"none"),e.length&&this.spacefillRepresentation.setParameters({radiusData:t})}measureData(){const e=this.pickDict.values;return{distance:e.filter((e=>2===e.length)),angle:e.filter((e=>3===e.length)),dihedral:e.filter((e=>4===e.length))}}removeAllMeasurements(e){const t=this.pickDict,n=t.values,r=function(e){n.filter((t=>t.length===e)).forEach((e=>t.del(e.slice().sort())))};(!e||1&e)&&r(2),(!e||2&e)&&r(3),(!e||4&e)&&r(4),this.measureBuild()}removeMeasurement(e){this.pickDict.del(e.slice().sort()),this.measureBuild()}addMeasurement(e){if(e.length<2||e.length>4)return;const t=e.slice().sort();this.pickDict.has(t)||this.pickDict.add(t,e),this.measureBuild()}}ru.add("structure",Jm),ru.add("structureview",Jm);ru.add("surface",class extends Lm{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.surface=t}get type(){return"surface"}addRepresentation(e,t={}){return this._addRepresentation(e,this.surface,t)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}});function eg(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s}function tg(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))}ru.add("volume",class extends Lm{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.volume=t}get type(){return"volume"}addRepresentation(e,t={}){return this._addRepresentation(e,this.volume,t)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}),new Vn,ru.add("shape",class extends Lm{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.shape=t}get type(){return"shape"}addRepresentation(e,t={}){return this._addRepresentation(e,this.shape,t)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}),"function"==typeof SuppressedError&&SuppressedError;class ng extends sc{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=Ol(e.reverse,!0)),this.scalePerModel={},e.structure.eachModel((e=>{this.parameters.domain=[e.atomOffset,e.atomEnd],this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.index)}}eg([ac],ng.prototype,"atomColor",null),Zc.add("atomindex",ng);class rg extends sc{constructor(e){if(super(e),e.scale||(this.parameters.scale="OrRd"),!e.domain){let t,n=1/0,r=-1/0;e.sele&&(t=new Nc(e.sele)),e.structure.eachAtom((function(e){const t=e.bfactor;n=Math.min(n,t),r=Math.max(r,t)}),t),this.parameters.domain=[n,r]}this.bfactorScale=this.getScale()}atomColor(e){return this.bfactorScale(e.bfactor)}}eg([ac],rg.prototype,"atomColor",null),Zc.add("bfactor",rg);class ig extends sc{constructor(e){super(e),this.chainidDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{let t=0;const n={};e.eachChain((function(e){void 0===n[e.chainid]&&(n[e.chainid]=t,t+=1)})),this.parameters.domain=[0,t-1],this.chainidDictPerModel[e.index]=n,this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){const t=this.chainidDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainid])}}eg([ac],ig.prototype,"atomColor",null),Zc.add("chainid",ig);class ag extends sc{constructor(e){super(e),this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{this.parameters.domain=[e.chainOffset,e.chainEnd],this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.chainIndex)}}eg([ac],ag.prototype,"atomColor",null),Zc.add("chainindex",ag);class sg extends sc{constructor(e){super(e),this.chainnameDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{let t=0;const n={};e.eachChain((function(e){void 0===n[e.chainname]&&(n[e.chainname]=t,t+=1)})),this.parameters.domain=[0,t-1],this.chainnameDictPerModel[e.index]=n,this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){const t=this.chainnameDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainname])}}eg([ac],sg.prototype,"atomColor",null),Zc.add("chainname",sg);class og extends sc{constructor(e){super(e),this.rsrzDict={},this.rsccDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const t=e.structure.validation;t&&(this.rsrzDict=t.rsrzDict,this.rsccDict=t.rsccDict)}atomColor(e){let t=e.resno+"";e.inscode&&(t+="^"+e.inscode),e.chainname&&(t+=":"+e.chainname),t+="/"+e.modelIndex;const n=this.rsrzDict[t];if(void 0!==n)return this.rsrzScale(n);const r=this.rsccDict[t];return void 0!==r?this.rsccScale(r):9474192}}eg([ac],og.prototype,"atomColor",null),Zc.add("densityfit",og);const lg={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}};class cg extends sc{constructor(e){super(e),this.delta=new Vn,this.hCharges=[],e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(e.structure.atomCount);const t=[];e.structure.eachAtom((e=>{var n;if(this.charges[e.index]=(null!==(n=e).partialCharge?n.partialCharge:n.isProtein()&&(lg[n.resname]&&lg[n.resname][n.atomname]||lg.backbone[n.atomname])||0)*e.occupancy,"N"===e.atomname){if(e.bondCount>=3)return;if(e.bondToElementCount(1))return;const n=function(e,t=new Vn){let n=!1,r=!1,i=!1;return t.set(2*e.x,2*e.y,2*e.z),e.eachBondedAtom((function(e){if(!n)return"H"===e.atomname?(t.set(e.x,e.y,e.z),void(n=!0)):void(r||"CA"!==e.atomname?i||"C"!==e.atomname||(i=!0,t.sub(e)):(t.sub(e),r=!0))})),n?t:r&&i?(t.normalize(),t.multiplyScalar(1.04),t.add(e),t):void 0}(e);void 0!==n&&(t.push(n),this.hCharges.push(.25*e.occupancy))}}));const n=e.structure.getBoundingBox();n.expandByScalar(1.04),this.hStore=function(e){const t=e.length,n=new Float32Array(t),r=new Float32Array(t),i=new Float32Array(t);for(let t=0;t<e.length;t++){const a=e[t];n[t]=a.x,r[t]=a.y,i[t]=a.z}return{x:n,y:r,z:i,count:t}}(t),this.hHash=new bd(this.hStore,n),this.hash=new bd(e.structure.atomStore,n)}positionColor(e){const t=this.charges,n=this.hCharges;let r=0;return this.hash.eachWithin(e.x,e.y,e.z,12,((e,n)=>{const i=t[e];0!==i&&(r+=i/n)})),this.hHash.eachWithin(e.x,e.y,e.z,12,((e,t)=>{const i=n[e];0!==i&&(r+=i/t)})),this.scale(332*r)}}eg([ac],cg.prototype,"positionColor",null),Zc.add("electrostatic",cg);const ug={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120};class dg extends sc{constructor(e){e.value=Ol(e.value,ug.C),super(e)}atomColor(e){const t=e.element;return"C"===t?this.parameters.value:ug[t]||16777215}}eg([ac],dg.prototype,"atomColor",null),Zc.add("element",dg);class hg extends sc{constructor(e){super(e),e.scale||(this.parameters.scale="Spectral"),e.domain||(this.parameters.domain=[0,e.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(e){return this.entityindexScale(e.entityIndex)}}eg([ac],hg.prototype,"atomColor",null),Zc.add("entityindex",hg);class fg extends sc{atomColor(e){const t=e.entity;switch(t?t.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}}}eg([ac],fg.prototype,"atomColor",null),Zc.add("entitytype",fg);class pg extends sc{constructor(e){super(e),this.geoAtomDict={},this.geoDict={};const t=e.structure.validation;t&&(this.geoAtomDict=t.geoAtomDict,this.geoDict=t.geoDict)}atomColor(e){let t,n=e.resno+"";e.inscode&&(n+="^"+e.inscode),e.chainname&&(n+=":"+e.chainname),n+="/"+e.modelIndex;const r=this.geoAtomDict[n];var i;return void 0!==r?(i=r[e.atomname]||0,t=16843009*((i=(858993459&(i-=i>>1&1431655765))+(i>>2&858993459))+(i>>4)&252645135)>>24):t=this.geoDict[n]||0,0===t?2188972:1===t?16703627:2===t?16018755:t>=3?10813478:9474192}}eg([ac],pg.prototype,"atomColor",null),Zc.add("geoquality",pg);class mg extends sc{constructor(e){super(e),this.resHF={},e.scale||(this.parameters.scale="RdYlGn");for(const e in $d)this.resHF[e]=$d[e][0];if(this.defaultResidueHydrophobicity=Gd[0],!e.domain){let e=1/0,t=-1/0;for(const n in this.resHF){const r=this.resHF[n];e=Math.min(e,r),t=Math.max(t,r)}this.parameters.domain=[e,0,t]}this.hfScale=this.getScale()}atomColor(e){return this.hfScale(this.resHF[e.resname]||this.defaultResidueHydrophobicity)}}eg([ac],mg.prototype,"atomColor",null),Zc.add("hydrophobicity",mg);class gg extends sc{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow"),e.domain||(this.parameters.domain=[0,e.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(e){return this.modelindexScale(e.modelIndex)}}eg([ac],gg.prototype,"atomColor",null),Zc.add("modelindex",gg);class _g extends sc{atomColor(e){switch(e.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}}}eg([ac],_g.prototype,"atomColor",null),Zc.add("moleculetype",_g);class yg extends sc{constructor(e){super(e),e.scale||(this.parameters.scale="PuBu"),e.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(e){return this.occupancyScale(e.occupancy)}}eg([ac],yg.prototype,"atomColor",null),Zc.add("occupancy",yg);class vg extends sc{constructor(e){super(e),e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(e){return this.partialchargeScale(e.partialCharge||0)}}function bg(){return 16777215*Math.random()}eg([ac],vg.prototype,"atomColor",null),Zc.add("partialcharge",vg);class xg extends sc{atomColor(){return bg()}volumeColor(){return bg()}positionColor(){return bg()}}eg([ac],xg.prototype,"atomColor",null),eg([ac],xg.prototype,"volumeColor",null),eg([ac],xg.prototype,"positionColor",null),Zc.add("random",xg);class wg extends sc{constructor(e){super(e),this.rciDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const t=e.structure.validation;t&&(this.rciDict=t.rciDict)}atomColor(e){let t=`[${e.resname}]${e.resno}`;e.chainname&&(t+=":"+e.chainname);const n=this.rciDict[t];return void 0!==n?this.rciScale(n):9474192}}eg([ac],wg.prototype,"atomColor",null),Zc.add("randomcoilindex",wg);class Sg extends sc{constructor(e){super(e),this.scalePerChain={},e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=Ol(e.reverse,!0)),e.structure.eachChain((e=>{this.parameters.domain=[e.residueOffset,e.residueEnd],this.scalePerChain[e.index]=this.getScale()}))}atomColor(e){return this.scalePerChain[e.chainIndex](e.residueIndex)}}eg([ac],Sg.prototype,"atomColor",null),Zc.add("residueindex",Sg);const Ag={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723};class Mg extends sc{atomColor(e){return Ag[e.resname]||16711935}}eg([ac],Mg.prototype,"atomColor",null),Zc.add("resname",Mg);class Eg extends sc{constructor(e){super(e),this.residueProxy=e.structure.getResidueProxy()}atomColor(e){const t=e.sstruc,n=this.residueProxy;return"h"===t?16711808:"g"===t?10485888:"i"===t?6291584:"e"===t||"b"===t?16762880:"t"===t?6324479:(n.index=e.residueIndex,n.isDna()?11403518:n.isRna()?16580962:n.isSaccharide()?10921722:n.isProtein()||"s"===t||"l"===t?16777215:8421504)}}eg([ac],Eg.prototype,"atomColor",null),Zc.add("sstruc",Eg);class Cg extends sc{constructor(e){var t,n;super(e),e.scale||(this.parameters.scale="rwb"),this.atomData=null===(t=this.parameters.data)||void 0===t?void 0:t.atomData,this.bondData=null===(n=this.parameters.data)||void 0===n?void 0:n.bondData,this.scale=this.getScale(this.parameters)}atomColor(e){var t;const n=null===(t=this.atomData)||void 0===t?void 0:t[e.index];return void 0!==n?this.scale(n):this.parameters.value}bondColor(e,t){var n;const r=null===(n=this.bondData)||void 0===n?void 0:n[e.index];return void 0!==r?this.scale(r):this.atomProxy?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}eg([ac],Cg.prototype,"atomColor",null),eg([ac],Cg.prototype,"bondColor",null),Zc.add("structuredata",Cg);class Tg extends sc{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}eg([ac],Tg.prototype,"atomColor",null),eg([ac],Tg.prototype,"bondColor",null),eg([ac],Tg.prototype,"valueColor",null),eg([ac],Tg.prototype,"volumeColor",null),Zc.add("uniform",Tg);class Pg extends sc{constructor(e){super(e),this.valueScale=this.getScale()}volumeColor(e){return this.valueScale(this.parameters.volume.data[e])}}eg([ac],Pg.prototype,"volumeColor",null),Zc.add("value",Pg);class Ig extends sc{constructor(e){super(e),this.vec=new Vn,this.valueScale=this.getScale()}positionColor(e){const t=this.parameters.volume;if(!t||!t.inverseMatrix)return this.parameters.value;const n=this.vec,r=t.data,i=t.nx,a=t.ny,s=i*a;n.copy(e),n.applyMatrix4(t.inverseMatrix);const o=Math.floor(n.x),l=Math.floor(n.y),c=Math.floor(n.z),u=(c*a+l)*i+o,d=u+1,h=u+i,f=u+s,p=h+1,m=f+1,g=h+s,_=g+1,y=r[u],v=r[d],b=r[h],x=r[f],w=r[p],S=r[m],A=r[g],M=r[_],E=n.x-o,C=n.y-l,T=n.z-c,P=ec(y,v,E),I=ec(x,S,E),R=ec(b,w,E),k=ec(A,M,E),D=ec(P,R,C),L=ec(I,k,C),N=ec(D,L,T);return this.valueScale(N)}}eg([ac],Ig.prototype,"positionColor",null),Zc.add("volume",Ig);class Rg extends Iu{constructor(e,t,n){const r=n||{};if(super(e,t,r),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:Vf.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new Nc(r.sele),this.dataList=[],this.structure=e,this.structureView=this.structure.getView(this.selection),e.biomolDict){const t={default:"default","":e.unitcell?"AU":"FULL"};Object.keys(e.biomolDict).forEach((function(e){t[e]=e})),this.parameters.assembly={type:"select",options:t,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(e){const t=e||{};t.colorScheme=Ol(t.colorScheme,"element"),this.setRadius(t.radius,t),this.radiusType=Ol(t.radiusType,"vdw"),this.radiusData=Ol(t.radiusData,{}),this.radiusSize=Ol(t.radiusSize,1),this.radiusScale=Ol(t.radiusScale,1),this.assembly=Ol(t.assembly,"default"),this.defaultAssembly=Ol(t.defaultAssembly,""),"auto"===t.quality&&(t.quality=this.getQuality()),super.init(t),this.selection.signals.stringChanged.add((()=>{this.build()})),this.build()}setRadius(e,t){const n=Object.keys(zf);return"string"==typeof e&&n.includes(e.toLowerCase())?t.radiusType=e:void 0!==e&&(t.radiusType="size",t.radiusSize=e),this}getAssembly(){const e="default"===this.assembly?this.defaultAssembly:this.assembly;return this.structure.biomolDict[e]}getQuality(){let e;const t=this.structureView,n=this.getAssembly();return e=n?n.getAtomCount(t):t.atomCount,jc&&(e*=4),t.atomStore.count/t.residueStore.count<2&&(e*=10),e<15e3?"high":e<8e4?"medium":"low"}create(){if(0===this.structureView.atomCount)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const e=this.getAssembly();if(e)e.partList.forEach(((e,t)=>{const n=e.getView(this.structureView);if(0===n.atomCount)return;const r=this.createData(n,t);r&&(r.sview=n,r.instanceList=e.getInstanceList(),this.dataList.push(r))}));else{const e=this.createData(this.structureView,0);e&&(e.sview=this.structureView,this.dataList.push(e))}}update(e){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach((t=>{t.bufferList.length>0&&this.updateData(e,t)}),this):Object.assign(this.lazyProps.what,e)}updateData(e,t){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(e){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getBondParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getAtomRadius(e){return this.structureView.atomSet.isSet(e.index)?new Vf(this.getRadiusParams()).atomRadius(e):0}setSelection(e,t){return this.selection.setString(e,t),this}setParameters(e,t={},n=!1){const r=e||{};return this.setRadius(r.radius,r),void 0===r.radiusType&&void 0===r.radiusData&&void 0===r.radiusSize&&void 0===r.radiusScale||(t.radius=!0,n=!0),void 0!==r.defaultAssembly&&r.defaultAssembly!==this.defaultAssembly&&("default"===this.assembly&&void 0===r.assembly||"default"===r.assembly)&&(n=!0),super.setParameters(r,t,n),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(e){const t=this.viewer,n=this.bufferList;this.dataList.forEach((function(e){e.bufferList.forEach((function(r){n.push(r),t.add(r,e.instanceList)}))})),this.setVisibility(this.visible),e()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class kg extends Rg{constructor(e,t,n){super(e,t,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(e){const t=e||{};this.labelVisible=Ol(t.labelVisible,!0),this.labelSize=Ol(t.labelSize,2),this.labelColor=Ol(t.labelColor,16777215),this.labelFontFamily=Ol(t.labelFontFamily,"sans-serif"),this.labelFontStyle=Ol(t.labelFontstyle,"normal"),this.labelFontWeight=Ol(t.labelFontWeight,"bold"),this.labelsdf=Ol(t.labelsdf,"Chrome"===$c),this.labelXOffset=Ol(t.labelXOffset,0),this.labelYOffset=Ol(t.labelYOffset,0),this.labelZOffset=Ol(t.labelZOffset,.5),this.labelAttachment=Ol(t.labelAttachment,"bottom-left"),this.labelBorder=Ol(t.labelBorder,!1),this.labelBorderColor=Ol(t.labelBorderColor,"lightgrey"),this.labelBorderWidth=Ol(t.labelBorderWidth,.15),this.labelBackground=Ol(t.labelBackground,!1),this.labelBackgroundColor=Ol(t.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=Ol(t.labelBackgroundMargin,.5),this.labelBackgroundOpacity=Ol(t.labelBackgroundOpacity,1),this.labelFixedSize=Ol(t.labelFixedSize,!1),this.lineOpacity=Ol(t.lineOpacity,1),this.linewidth=Ol(t.linewidth,2),super.init(t)}update(e){e.position?this.build():super.update(e)}updateData(e,t){const n={};if(e&&!e.labelSize||Object.assign(n,{size:yu(this.n,this.labelSize)}),!e||e.labelColor){const e=new ai(this.labelColor);Object.assign(n,{color:vu(this.n,e.r,e.g,e.b)})}this.textBuffer.setAttributes(n)}setParameters(e,t={},n=!1){return e&&e.labelSize&&(t.labelSize=!0),e&&(e.labelColor||0===e.labelColor)&&(t.labelColor=!0,n=!0),super.setParameters(e,t,n),e&&void 0!==e.opacity&&this.textBuffer.setParameters({opacity:1}),e&&void 0!==e.labelVisible&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),t||this.viewer.requestRender(),this}getLabelBufferParams(e={}){return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},e,{opacity:1}))}getAtomRadius(){return 0}}function Dg(e,t){const n=e.getAtomProxy(),r=new Nc,i=t.length;if(0===i)return new Float32Array(0);const a=t[0].length,s=e.getAtomSet(),o=new Float32Array(i*a*3);let l=0;return t.forEach((function(t){let i=!1;for(let c=0;c<a;c++){const a=t[c];if("number"==typeof a&&Number.isInteger(a)){if(!s.get(a)){i=!0;break}n.index=a}else{r.setString(a);const t=e.getAtomIndices(r);if(!t.length){i=!0;break}n.index=t[0]}let u=l+3*c;o[u++]=n.x,o[u++]=n.y,o[u++]=n.z}i||(l+=3*a)})),o.subarray(0,l)}function Lg(e,t,n,r,i){const a=Math.cos(i),s=Math.sin(i);e[0]=t[0]+n[0]*a+r[0]*s,e[1]=t[1]+n[1]*a+r[1]*s,e[2]=t[2]+n[2]*a+r[2]*s}function Ng(e,t,n,r,i,a,s){for(let o=0;o<t;o++){for(let i=0;i<n;i++)r[i]=e[i*t+o];Og(r,i,a,s,n);for(let r=0;r<n;r++)e[r*t+o]=i[r]}for(let o=0;o<n;o++){for(let n=0;n<t;n++)r[n]=e[o*t+n];Og(r,i,a,s,t);for(let n=0;n<t;n++)e[o*t+n]=Math.sqrt(i[n])}}function Og(e,t,n,r,i){n[0]=0,r[0]=Number.MIN_SAFE_INTEGER,r[1]=Number.MAX_SAFE_INTEGER;for(let t=1,a=0;t<i;t++){let i=(e[t]+t*t-(e[n[a]]+n[a]*n[a]))/(2*t-2*n[a]);for(;i<=r[a];)a--,i=(e[t]+t*t-(e[n[a]]+n[a]*n[a]))/(2*t-2*n[a]);a++,n[a]=t,r[a]=i,r[a+1]=Number.MAX_SAFE_INTEGER}for(let a=0,s=0;a<i;a++){for(;r[s+1]<a;)s++;t[a]=(a-n[s])*(a-n[s])+e[n[s]]}}tu.add("shader/SDFFont.vert","uniform float clipNear;\nuniform float clipRadius;\nuniform vec3 clipCenter;\nuniform float xOffset;\nuniform float yOffset;\nuniform float zOffset;\nuniform bool ortho;\nuniform float canvasHeight;\nuniform float pixelRatio;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\nvarying vec2 texCoord;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#endif\nattribute vec2 mapping;\nattribute vec2 inputTexCoord;\nattribute float inputSize;\n#include matrix_scale\n#include common\nvoid main(void){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\ntexCoord = inputTexCoord;\nfloat scale = matrixScale( modelViewMatrix );\nfloat _xOffset = xOffset * scale;\nfloat _yOffset = yOffset * scale;\nfloat _zOffset = zOffset * scale;\nif( texCoord.x == 10.0 ){\n_zOffset -= 0.001;\n}\nvec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );\n#ifdef FIXED_SIZE\nif ( ortho ) {\nscale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;\n} else {\nscale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;\n}\n#endif\nvec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );\ncameraCornerPos.xy += mapping * inputSize * 0.01 * scale;\ncameraCornerPos.x += _xOffset;\ncameraCornerPos.y += _yOffset;\nif( ortho ){\ncameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;\n} else {\ncameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;\n}\ngl_Position = projectionMatrix * cameraCornerPos;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvViewPosition = -cameraCornerPos.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n#include radiusclip_vertex\n}"),tu.add("shader/SDFFont.frag","uniform sampler2D fontTexture;\nuniform float opacity;\nuniform bool showBorder;\nuniform vec3 borderColor;\nuniform float borderWidth;\nuniform vec3 backgroundColor;\nuniform float backgroundOpacity;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec3 vViewPosition;\nvarying vec2 texCoord;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\nconst vec3 vColor = vec3( 0.0 );\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#endif\nconst float gamma = 2.2 * 1.4142 / 128.0;\nconst float padding = 0.75;\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\nif( texCoord.x > 1.0 ){\ngl_FragColor = vec4( backgroundColor, backgroundOpacity );\n}else{\nfloat sdf = texture2D( fontTexture, texCoord ).a;\nif( showBorder ) sdf += borderWidth;\nfloat a = smoothstep(padding - gamma, padding + gamma, sdf);\nif( a < 0.2 ) discard;\na *= opacity;\nvec3 outgoingLight = vColor;\nif( showBorder && sdf < ( padding + borderWidth ) ){\noutgoingLight = borderColor;\n}\ngl_FragColor = vec4( outgoingLight, a );\n}\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const Fg={},Ug={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class Bg{constructor(e={}){this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=Fl(e,Ug);const t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;const n=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),r=this.maxWidth=t.width/4,i=this.canvas=document.createElement("canvas");i.width=r,i.height=n;const a=this.context=this.canvas.getContext("2d",{willReadFrequently:!0});a.font=`${t.style} ${t.variant} ${t.weight} ${t.size}px ${t.font}`,a.fillStyle="black",a.textAlign="left",a.textBaseline="bottom",a.lineJoin="round",this.gridOuter=new Float64Array(n*r),this.gridInner=new Float64Array(n*r),this.f=new Float64Array(Math.max(n,r)),this.d=new Float64Array(Math.max(n,r)),this.z=new Float64Array(Math.max(n,r)+1),this.v=new Int16Array(Math.max(n,r)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map(String.fromCharCode(65533));for(let e=32;e<=126;++e)this.map(String.fromCharCode(e));this.map(String.fromCharCode(176)),this.map(String.fromCharCode(8491)),this.texture=new ll(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(e){const t=this.parameters;return void 0===this.mapped[e]&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]}get(e){return this.mapped[e]||this.placeholder}draw(e){const t=this.parameters,n=this.lineHeight,r=t.outline,i=this.context,a=this.maxWidth,s=r,o=n-t.outline,l=i.measureText(e),c=Math.min(a,Math.ceil(l.width+2*s+1)),u=c*n;i.clearRect(0,0,c,n),i.fillText(e,s,o);const d=i.getImageData(0,0,c,n),h=d.data;for(let e=0;e<u;e++){const t=d.data[4*e+3]/255;this.gridOuter[e]=1===t?0:0===t?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-t),2),this.gridInner[e]=1===t?Number.MAX_SAFE_INTEGER:0===t?0:Math.pow(Math.max(0,t-.5),2)}Ng(this.gridOuter,c,n,this.f,this.d,this.v,this.z),Ng(this.gridInner,c,n,this.f,this.d,this.v,this.z);for(let e=0;e<u;e++){const t=this.gridOuter[e]-this.gridInner[e];h[4*e+3]=Math.max(0,Math.min(255,Math.round(255-255*(t/this.radius+this.cutoff))))}i.putImageData(d,0,0),this.scratchW=c,this.scratchH=n}}const zg=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},Sf),Vg=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},Af);function Hg(e,t){const n=e.position.length/3;let r=0;for(let t=0;t<n;++t)r+=e.text[t].length;return t.showBackground&&(r+=n),r}class $g extends hm{constructor(e,t={}){super({position:new Float32Array(3*Hg(e,t)),color:new Float32Array(3*Hg(e,t)),picking:new zh},t),this.parameterTypes=Vg,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=e.text,this.positionCount=e.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new ai(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new ai(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(e),this.makeTexture(),this.makeMapping()}get defaultParameters(){return zg}makeMaterial(){super.makeMaterial();const e=this.texture,t=this.material;t.transparent=!0,t.extensions.derivatives=!0,t.lights=!1,t.uniforms.fontTexture.value=e,t.needsUpdate=!0;const n=this.wireframeMaterial;n.transparent=!0,n.extensions.derivatives=!0,n.lights=!1,n.uniforms.fontTexture.value=e,n.needsUpdate=!0;const r=this.pickingMaterial;r.extensions.derivatives=!0,r.lights=!1,r.uniforms.fontTexture.value=e,r.needsUpdate=!0}setAttributes(e={}){let t,n,r,i,a,s;const o=this.text,l=this.geometry.attributes;e.position&&(t=e.position,i=l.position.array,l.position.needsUpdate=!0),e.size&&(n=e.size,a=l.inputSize.array,l.inputSize.needsUpdate=!0),e.color&&(r=e.color,s=l.color.array,l.color.needsUpdate=!0);const c=this.positionCount;let u,d,h,f,p,m=0;for(let e=0;e<c;++e)for(d=3*e,h=o[e],p=h.length,this.parameters.showBackground&&(p+=1),f=0;f<p;++f,++m)for(let o=0;o<4;o++)u=4*m*3+3*o,t&&(i[u]=t[d],i[u+1]=t[d+1],i[u+2]=t[d+2]),n&&(a[4*m+o]=n[e]),r&&(s[u]=r[d],s[u+1]=r[d+1],s[u+2]=r[d+2])}makeTexture(){this.textAtlas=function(e){const t=JSON.stringify(e);return void 0===Fg[t]&&(Fg[t]=new Bg(e)),Fg[t]}({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const e=this.textAtlas,t=this.text,n=this.parameters.attachment,r=e.lineHeight*this.parameters.backgroundMargin*.1-10,i=this.geometry.attributes,a=i.inputTexCoord.array,s=i.mapping.array,o=this.positionCount;let l,c,u,d,h,f,p,m,g=0;for(let i=0;i<o;++i){for(u=t[i],d=0,f=u.length,h=0;h<f;++h)l=e.get(u[h]),d+=l.w-2*e.parameters.outline;for(m=n.startsWith("top")?e.lineHeight/1.25:n.startsWith("middle")?e.lineHeight/2.5:0,p=n.endsWith("right")?d:n.endsWith("center")?d/2:0,p+=e.parameters.outline,m+=e.parameters.outline,this.parameters.showBackground&&(c=2*g*4,s[c+0]=-e.lineHeight/6-p-r,s[c+1]=e.lineHeight-m+r,s[c+2]=-e.lineHeight/6-p-r,s[c+3]=0-m-r,s[c+4]=d+e.lineHeight/6-p+2*e.parameters.outline+r,s[c+5]=e.lineHeight-m+r,s[c+6]=d+e.lineHeight/6-p+2*e.parameters.outline+r,s[c+7]=0-m-r,a[c+0]=10,a[c+2]=10,a[c+4]=10,a[c+6]=10,g+=1),d=0,h=0;h<f;++h,++g){l=e.get(u[h]),c=2*g*4,s[c+0]=d-p,s[c+1]=l.h-m,s[c+2]=d-p,s[c+3]=0-m,s[c+4]=d+l.w-p,s[c+5]=l.h-m,s[c+6]=d+l.w-p,s[c+7]=0-m;const t=e.parameters.width,n=e.parameters.height,r=[l.x/t,l.y/n,l.x/t,(l.y+l.h)/n,(l.x+l.w)/t,l.y/n,(l.x+l.w)/t,(l.y+l.h)/n];a.set(r,c),d+=l.w-2*e.parameters.outline}}i.inputTexCoord.needsUpdate=!0,i.mapping.needsUpdate=!0}getDefines(e){const t=super.getDefines(e);return this.parameters.fixedSize&&(t.FIXED_SIZE=1),t}setUniforms(e){!e||void 0===e.fontFamily&&void 0===e.fontStyle&&void 0===e.fontWeight&&void 0===e.fontSize||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,e.fontTexture=this.texture),super.setUniforms(e)}}iu.add("text",$g),tu.add("shader/WideLine.vert","\nuniform float clipNear;\nuniform vec3 clipCenter;\nuniform float linewidth;\nuniform vec2 resolution;\nuniform mat4 projectionMatrixInverse;\nattribute vec2 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor;\nvarying vec3 vColor2;\nvarying float flag;\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nvoid trimSegment( const in vec4 start, inout vec4 end ) {\nfloat a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;\nfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\nend.xyz = mix( start.xyz, end.xyz, alpha );\n}\nvoid main() {\nfloat aspect = resolution.x / resolution.y;\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nflag = mapping.y;\nvColor = color;\nvColor2 = color2;\n#endif\nvec4 start = modelViewMatrix * vec4( position1, 1.0 );\nvec4 end = modelViewMatrix * vec4( position2, 1.0 );\nbool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {\nif ( start.z < 0.0 && end.z >= 0.0 ) {\ntrimSegment( start, end );\n} else if ( end.z < 0.0 && start.z >= 0.0 ) {\ntrimSegment( end, start );\n}\n}\nvec4 clipStart = projectionMatrix * start;\nvec4 clipEnd = projectionMatrix * end;\nvec2 ndcStart = clipStart.xy / clipStart.w;\nvec2 ndcEnd = clipEnd.xy / clipEnd.w;\nvec2 dir = ndcEnd - ndcStart;\ndir.x *= aspect;\ndir = normalize( dir );\nvec2 offset = vec2( dir.y, - dir.x );\ndir.x /= aspect;\noffset.x /= aspect;\nif ( mapping.x < 0.0 ) offset *= - 1.0;\noffset *= linewidth;\noffset /= resolution.y;\nvec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;\noffset *= clip.w;\nclip.xy += offset;\ngl_Position = clip;\n#ifndef PICKING\nvViewPosition = ( projectionMatrixInverse * clip ).xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),tu.add("shader/WideLine.frag","uniform vec3 diffuse;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include fog_pars_fragment\nvarying vec3 vViewPosition;\nvarying vec3 vColor;\nvarying vec3 vColor2;\nvarying float flag;\n#endif\nvoid main() {\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 outgoingLight = vec3( 0.0 );\nvec4 diffuseColor = vec4( diffuse, 1.0 );\nif ( flag < 0.0 ) {\ndiffuseColor.rgb *= vColor;\n} else {\ndiffuseColor.rgb *= vColor2;\n}\n#include alphatest_fragment\noutgoingLight = diffuseColor.rgb;\ngl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const Gg=Object.assign({linewidth:2},Sf),jg=Object.assign({linewidth:{uniform:!0}},Af);class Wg extends hm{constructor(e,t={}){super(e,t),this.parameterTypes=jg,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!e.color2&&e.color&&(e.color2=e.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new fn},projectionMatrixInverse:{value:new _r}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Gg}setParameters(e){super.setParameters(e)}}iu.add("wideline",Wg),Jc.add("angle",class extends kg{constructor(e,t,n){super(e,t,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=Ol(t.side,"double"),t.opacity=Ol(t.opacity,.5),this.atomTriple=Ol(t.atomTriple,[]),this.arcVisible=Ol(t.arcVisible,!0),this.sectorVisible=Ol(t.sectorVisible,!0),this.vectorVisible=Ol(t.vectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomTriple.length)return;const t=function(e,t){return function(e){const t=[],n=e.length/9;for(let r=0;r<n;r++){let n=!0;for(let t=r;t<r+3;t+=3)e[t]===e[t+3]&&e[t+1]===e[t+4]&&e[t+2]===e[t+5]&&(n=!1);n&&t.push(r)}const r=new Float32Array(9*t.length);let i=0;return t.forEach((function(t){Su(e,r,9*t,9*i,9),i++})),r}(Dg(e,t))}(e,this.atomTriple),n=function(e,t={}){const n=Ol(t.angleStep,Math.PI/90),r=e.length/9,i=new Float32Array(r),a=new Float32Array(3*r),s=new Array(r),o=new Float32Array(6*r),l=new Float32Array(6*r),c=new Array(r),u=new Array(r),d=new Array(r);let h=0;const f=Bu(),p=Bu(),m=Bu(),g=Bu(),_=Bu(),y=Bu(),v=Bu(),b=Bu(),x=Bu();for(var w=0;w<r;w++){let t=9*w;Gu(f,e,t),Gu(p,e,t+3),Gu(m,e,t+6);let r=6*w;ju(f,o,r),ju(p,l,r),ju(p,o,r+3),ju(m,l,r+3),Hu(g,f,p),Hu(_,m,p),Ku(g,g),Ku(_,_),zu(y,g,_);const S=qu(y),A=Vu(g,_),M=i[w]=Math.atan2(S,A);s[w]=(pu*M).toFixed(1)+String.fromCharCode(176),0===qu(y)&&(y[0]=1,y[1]=0,y[2]=0),zu(v,y,g),Ku(v,v),Lg(b,p,g,v,M/2),ju(b,a,3*w);const E=Math.ceil(M/n),C=new Float32Array(9*E);d[w]=C;const T=new Float32Array(3*E),P=new Float32Array(3*E);c[w]=T,u[w]=P,$u(x,p,g);const I=function(e,t){const n=9*t,r=3*t;ju(p,C,n),ju(x,C,n+3),ju(x,T,r),Lg(x,p,g,v,e),ju(x,C,n+6),ju(x,P,r)};let R=0;for(let e=n;e<M;e+=n)I(e,R),R++;I(M,R),h+=E}const S=3*h,A=9*h,M=new Float32Array(S),E=new Float32Array(S),C=new Float32Array(A);let T=0,P=0;for(let e=0;e<r;e++){const t=c[e],n=u[e];Su(t,M,0,P,t.length),Su(n,E,0,P,n.length),P+=t.length;const r=d[e];Su(r,C,0,T,r.length),T+=r.length}return{labelPosition:a,labelText:s,vectorPosition1:o,vectorPosition2:l,arcPosition1:M,arcPosition2:E,sectorPosition:C}}(t),r=this.n=n.labelPosition.length/3,i=new ai(this.labelColor);this.textBuffer=new $g({position:n.labelPosition,size:yu(r,this.labelSize),color:vu(r,i.r,i.g,i.b),text:n.labelText},this.getLabelBufferParams());const a=new ai(this.colorValue);return this.vectorBuffer=new Wg(ad({position1:n.vectorPosition1,position2:n.vectorPosition2,color:vu(2*r,a.r,a.g,a.b),color2:vu(2*r,a.r,a.g,a.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=n.arcPosition1.length/3,this.arcBuffer=new Wg(ad({position1:n.arcPosition1,position2:n.arcPosition2,color:vu(this.arcLength,a.r,a.g,a.b),color2:vu(this.arcLength,a.r,a.g,a.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=n.sectorPosition.length/3,this.sectorBuffer=new Ef({position:n.sectorPosition,color:vu(this.sectorLength,a.r,a.g,a.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},r={},i={};if(e.color){const e=new ai(this.colorValue);Object.assign(n,{color:vu(2*this.n,e.r,e.g,e.b),color2:vu(2*this.n,e.r,e.g,e.b)}),Object.assign(r,{color:vu(this.arcLength,e.r,e.g,e.b),color2:vu(this.arcLength,e.r,e.g,e.b)}),Object.assign(i,{color:vu(this.sectorLength,e.r,e.g,e.b)})}this.vectorBuffer.setAttributes(n),this.arcBuffer.setAttributes(r),this.sectorBuffer.setAttributes(i)}setParameters(e){return super.setParameters(e,{},!1),!e||void 0===e.vectorVisible&&void 0===e.arcVisible&&void 0===e.sectorVisible||this.setVisibility(this.visible),e&&e.lineOpacity&&(this.vectorBuffer.setParameters({opacity:e.lineOpacity}),this.arcBuffer.setParameters({opacity:e.lineOpacity})),e&&void 0!==e.opacity&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),e&&e.linewidth&&(this.vectorBuffer.setParameters({linewidth:e.linewidth}),this.arcBuffer.setParameters({linewidth:e.linewidth})),this}setVisibility(e,t){return super.setVisibility(e,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}});const qg=new Vn,Xg=new Vn,Yg=new Vn,Kg=new Vn(0,1,0),Zg=Object.assign({radialSegments:1,openEnded:!0},Sf);function Qg(e={}){const t=Ol(e.radialSegments,10),n=Ol(e.openEnded,!0),r=(new _r).makeRotationX(Math.PI/2),i=new cl(1,1,1,t,1,n);return i.applyMatrix4(r),i}class Jg extends am{constructor(e,t={}){super(function(e,t={}){const n=Qg(t),r=e.position1.length,i=n.attributes.position.array.length/3,a=r/3,s=new Float32Array(2*a*i);return xu(a,i,0,s),xu(a,i,a*i,s),{position:new Float32Array(2*r),color:new Float32Array(2*r),primitiveId:s,picking:e.picking}}(e,t),t,Qg(t)),this.updateNormals=!0;const n=e.position1.length,r=e.radius.length;this.__center=new Float32Array(n),this._position=new Float32Array(2*n),this._color=new Float32Array(2*n),this._from=new Float32Array(2*n),this._to=new Float32Array(2*n),this._radius=new Float32Array(2*r),this.setAttributes(e,!0)}get defaultParameters(){return Zg}applyPositionTransform(e,t,n){Xg.fromArray(this._from,n),Yg.fromArray(this._to,n),e.lookAt(Xg,Yg,Kg);const r=this._radius[t];qg.set(r,r,Xg.distanceTo(Yg)),e.scale(qg)}setAttributes(e={},t){const n={};e.position1&&e.position2&&(gu(e.position1,e.position2,this.__center),gu(e.position1,this.__center,this._position),gu(this.__center,e.position2,this._position,e.position1.length),this._from.set(e.position1),this._from.set(this.__center,e.position1.length),this._to.set(this.__center),this._to.set(e.position2,this.__center.length),n.position=this._position),e.color&&e.color2&&(this._color.set(e.color),this._color.set(e.color2,e.color.length),n.color=this._color),e.radius&&(this._radius.set(e.radius),this._radius.set(e.radius,e.radius.length),n.radius=this._radius),super.setAttributes(n,t)}}tu.add("shader/CylinderImpostor.vert","\nattribute vec3 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\nattribute float radius;\nvarying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;\nvarying vec4 w;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#endif\nuniform mat4 modelViewMatrixInverse;\nuniform float ortho;\n#include matrix_scale\nvoid main(){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nvColor1 = color;\nvColor2 = color2;\n#endif\nbase_radius.w = radius * matrixScale( modelViewMatrix );\nvec3 center = position;\nvec3 dir = normalize( position2 - position1 );\nfloat ext = length( position2 - position1 ) / 2.0;\nvec3 cam_dir;\nif( ortho == 0.0 ){\ncam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;\n}else{\ncam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;\n}\ncam_dir = normalize( cam_dir );\nvec3 ldir;\nfloat b = dot( cam_dir, dir );\nend_b.w = b;\nif( b < 0.0 )\nldir = -ext * dir;\nelse\nldir = ext * dir;\nvec3 left = radius * normalize( cross( cam_dir, ldir ) );\nvec3 up = radius * normalize( cross( left, ldir ) );\naxis = normalize( normalMatrix * ldir );\nU = normalize( normalMatrix * up );\nV = normalize( normalMatrix * left );\nvec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );\nbase_radius.xyz = base4.xyz / base4.w;\nvec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );\nend_b.xyz = end4.xyz / end4.w;\nw = modelViewMatrix * vec4(\ncenter + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0\n);\ngl_Position = projectionMatrix * w;\ngl_Position.z = 0.99;\n}"),tu.add("shader/CylinderImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform mat4 projectionMatrix;\nuniform float ortho;\nvarying vec3 axis;\nvarying vec4 base_radius;\nvarying vec4 end_b;\nvarying vec3 U;\nvarying vec3 V;\nvarying vec4 w;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#include common\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool interior = false;\nfloat distSq3( vec3 v3a, vec3 v3b ){\nreturn (\n( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +\n( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +\n( v3a.z - v3b.z ) * ( v3a.z - v3b.z )\n);\n}\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nfloat calcClip( vec3 cameraPos ){\nreturn dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nvoid main(){\nvec3 ray_target = w.xyz / w.w;\nvec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;\nvec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);\nvec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);\nmat3 basis = mat3( U, V, axis );\nvec3 diff = ray_target - 0.5 * (base + end);\nvec3 P = diff * basis;\nfloat dz = dot( axis, ray_direction );\nfloat radius2 = vRadius*vRadius;\nvec3 D = vec3(dot(U, ray_direction),\ndot(V, ray_direction),\ndz);\nfloat a0 = P.x*P.x + P.y*P.y - radius2;\nfloat a1 = P.x*D.x + P.y*D.y;\nfloat a2 = D.x*D.x + D.y*D.y;\nfloat d = a1*a1 - a0*a2;\nif (d < 0.0) {\ndiscard;\n}\nfloat dist = (-a1 + sqrt(d)) / a2;\nvec3 surface_point = ray_target + dist * ray_direction;\nvec3 base_to_surface = surface_point - base;\nvec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );\nfloat base_cap_test = dot( base_to_surface, axis );\nfloat end_cap_test = dot((surface_point - end), axis);\n#ifndef CAP\nvec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\nvec3 tmp_point2 = new_point2 - base;\n#endif\nif (base_cap_test < 0.0) {\nfloat dNV;\nfloat near;\nvec3 front_point;\nif ( ortho == 1.0 ) {\nfront_point = ray_target;\n} else {\ndNV = dot(-axis, ray_direction);\nnear = dot(-axis, (base)) / dNV;\nfront_point = ray_direction * near + ray_origin;\n}\nif (dot(front_point - base, front_point-base) > radius2) {\ndiscard;\n}\n#ifdef CAP\nsurface_point = front_point;\n_normal = axis;\n#else\nsurface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\ndNV = dot(-axis, ray_direction);\nnear = dot(axis, end) / dNV;\nnew_point2 = ray_direction * near + ray_origin;\nif (dot(new_point2 - end, new_point2-base) < radius2) {\ndiscard;\n}\ninterior = true;\n#endif\n}\nif( end_cap_test > 0.0 )\n{\nfloat dNV;\nfloat near;\nvec3 end_point;\nif ( ortho == 1.0 ) {\nend_point = ray_target;\n} else {\ndNV = dot(axis, ray_direction);\nif (dNV < 0.0) {\ndiscard;\n}\nnear = dot(axis, end) / dNV;\nend_point = ray_direction * near + ray_origin;\n}\nif( dot(end_point - end, end_point-base) > radius2 ) {\ndiscard;\n}\n#ifdef CAP\nsurface_point = end_point;\n_normal = axis;\n#else\nsurface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\ndNV = dot(-axis, ray_direction);\nnear = dot(-axis, (base)) / dNV;\nnew_point2 = ray_direction * near + ray_origin;\nif (dot(new_point2 - base, new_point2-base) < radius2) {\ndiscard;\n}\ninterior = true;\n#endif\n}\ngl_FragDepthEXT = calcDepth( surface_point );\n#ifdef NEAR_CLIP\nif( calcClip( surface_point ) > 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\nif( calcClip( surface_point ) > 0.0 ) {\ndiscard;\n}\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n}\n}else if( gl_FragDepthEXT <= 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n}\n#else\nif( gl_FragDepthEXT <= 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n}\n#endif\nif (gl_FragDepthEXT < 0.0) {\ndiscard;\n}\nif (gl_FragDepthEXT > 1.0) {\ndiscard;\n}\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vViewPosition = -surface_point;\nvec3 vNormal = _normal;\nvec3 vColor;\nif( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){\nif( b < 0.0 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\n}else{\nif( b > 0.0 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\n}\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\nvec3 normal = normalize( vNormal );\nvec3 nonPerturbedNormal = normal;\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);const e_=Object.assign({openEnded:!1},Sf);Object.assign({openEnded:{updateShader:!0}},Af);Object.assign({disableImpostor:!1},Zg,e_);const t_=class{constructor(e,t={}){return!e.color2&&e.color&&(e.color2=e.color),new Jg(e,t)}};iu.add("cylinder",t_),Jc.add("axes",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};t.radiusSize=Ol(t.radiusSize,.5),t.colorValue=Ol(t.colorValue,"lightgreen"),t.useInteriorColor=Ol(t.useInteriorColor,!0),this.showAxes=Ol(t.showAxes,!0),this.showBox=Ol(t.showBox,!1),super.init(t)}getPrincipalAxes(){let e;const t=this.getAssembly();return t&&(e=t.partList[0].getSelection()),this.structureView.getPrincipalAxes(e)}getAxesData(e){const t=this.getPrincipalAxes(),n=new ai(this.colorValue);let r=0,i=0;this.showAxes&&(r+=6,i+=3),this.showBox&&(r+=8,i+=12);const a=new Float32Array(3*r),s=vu(r,n.r,n.g,n.b),o=yu(r,this.radiusSize),l=new Float32Array(3*i),c=new Float32Array(3*i),u=vu(i,n.r,n.g,n.b),d=yu(i,this.radiusSize);let h=0;if(this.showAxes){const e=function(e,t){e.toArray(a,2*h),t.toArray(a,2*h+3),e.toArray(l,h),t.toArray(c,h),h+=3};e(t.begA,t.endA),e(t.begB,t.endB),e(t.begC,t.endC)}if(this.showBox){const n=new Vn,{d1a:r,d2a:i,d3a:s,d1b:o,d2b:u,d3b:d}=t.getProjectedScaleForAtoms(e);let f=2*h;const p=function(e,r,i){n.copy(t.center).addScaledVector(t.normVecA,e).addScaledVector(t.normVecB,r).addScaledVector(t.normVecC,i),n.toArray(a,f),f+=3};p(r,i,s),p(r,i,d),p(r,u,d),p(r,u,s),p(o,u,d),p(o,u,s),p(o,i,s),p(o,i,d);let m=h;const g=function(e,t){n.fromArray(a,2*h+3*e).toArray(l,m),n.fromArray(a,2*h+3*t).toArray(c,m),m+=3};g(0,1),g(0,3),g(0,6),g(1,2),g(1,7),g(2,3),g(2,4),g(3,5),g(4,5),g(4,7),g(5,6),g(6,7)}const f=new Nh(t);return{vertex:{position:a,color:s,radius:o,picking:f},edge:{position1:l,position2:c,color:u,color2:u,radius:d,picking:f}}}create(){const e=this.getAxesData(this.structureView);this.sphereBuffer=new fm(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new t_(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=this.getAxesData(t.sview),r={},i={};e&&!e.position||(Object.assign(r,{position:n.vertex.position}),Object.assign(i,{position1:n.edge.position1,position2:n.edge.position2})),e&&!e.color||(Object.assign(r,{color:n.vertex.color}),Object.assign(i,{color:n.edge.color,color2:n.edge.color})),e&&!e.radius||(Object.assign(r,{radius:n.vertex.radius}),Object.assign(i,{radius:n.edge.radius})),this.sphereBuffer.setAttributes(r),this.cylinderBuffer.setAttributes(i)}});class n_ extends Rg{constructor(e,t,n){super(e,t,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusType=Ol(t.radiusType,"size"),t.radiusSize=Ol(t.radiusSize,.15),t.useInteriorColor=Ol(t.useInteriorColor,!0),this.aspectRatio=Ol(t.aspectRatio,2),this.lineOnly=Ol(t.lineOnly,!1),this.cylinderOnly=Ol(t.cylinderOnly,!1),this.multipleBond=Ol(t.multipleBond,"off"),this.bondSpacing=Ol(t.bondSpacing,1),this.bondScale=Ol(t.bondScale,.4),this.linewidth=Ol(t.linewidth,2),super.init(t)}getAtomRadius(e){return this.aspectRatio*super.getAtomRadius(e)}getAtomParams(e,t){var n=super.getAtomParams(e,t);return n.radiusParams.scale*=this.aspectRatio,n}getAtomData(e,t,n){return e.getAtomData(this.getAtomParams(t,n))}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},t),super.getBondParams(e,t)}getBondData(e,t,n){return e.getBondData(this.getBondParams(t,n))}createData(e){const t=[];if(this.lineOnly)this.lineBuffer=new Wg(this.getBondData(e,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),t.push(this.lineBuffer);else{const n=new t_(this.getBondData(e),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(t.push(n),!this.cylinderOnly){const n=new fm(this.getAtomData(e),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));t.push(n)}}return{bufferList:t}}updateData(e,t){"off"!==this.multipleBond&&e&&e.radius&&(e.position=!0);const n=this.getBondData(t.sview,e);if(this.lineOnly){const r={};e&&!e.position||Object.assign(r,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(r,{color:n.color,color2:n.color2}),t.bufferList[0].setAttributes(r)}else{var r={};if(e&&!e.position||Object.assign(r,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(r,{color:n.color,color2:n.color2}),e&&!e.radius||Object.assign(r,{radius:n.radius}),t.bufferList[0].setAttributes(r),!this.cylinderOnly){var i=this.getAtomData(t.sview,e),a={};e&&!e.position||Object.assign(a,{position:i.position}),e&&!e.color||Object.assign(a,{color:i.color}),e&&!e.radius||Object.assign(a,{radius:i.radius}),t.bufferList[1].setAttributes(a)}}}setParameters(e={}){let t=!1;const n={};return(e.aspectRatio||e.bondSpacing||e.bondScale)&&(Object.assign(n,{radius:!0}),t=!0),super.setParameters(e,n,t),this}}Jc.add("ball+stick",n_),Jc.add("backbone",class extends n_{constructor(e,t,n){super(e,t,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}init(e){var t=e||{};t.aspectRatio=Ol(t.aspectRatio,1),t.radiusSize=Ol(t.radiusSize,.25),super.init(t)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}getAtomData(e,t,n){return e.getBackboneAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){return e.getBackboneBondData(this.getBondParams(t,n))}}),Jc.add("base",class extends n_{constructor(e,t,n){super(e,t,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){let t=e||{};t.aspectRatio=Ol(t.aspectRatio,1),t.radiusSize=Ol(t.radiusSize,.3),super.init(t)}getAtomData(e,t,n){return e.getRungAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){let r=this.getBondParams(t,n);return Object.assign(r.colorParams,{rung:!0}),e.getRungBondData(r)}});class r_{constructor(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new Vn,this.vec2=new Vn,this.vDir=new Vn,this.vTan=new Vn,this.vNorm=new Vn,this.vBin=new Vn,this.m2=Math.ceil(this.m/2)}interpolateToArr(e,t,n,r,i,a,s){a[s+0]=tc(e.x,t.x,n.x,r.x,i,this.tension),a[s+1]=tc(e.y,t.y,n.y,r.y,i,this.tension),a[s+2]=tc(e.z,t.z,n.z,r.z,i,this.tension)}interpolateToVec(e,t,n,r,i,a){a.x=tc(e.x,t.x,n.x,r.x,i,this.tension),a.y=tc(e.y,t.y,n.y,r.y,i,this.tension),a.z=tc(e.z,t.z,n.z,r.z,i,this.tension)}interpolatePosition(e,t,n,r,i,a){for(var s=0;s<this.m;++s){var o=a+3*s,l=this.dt*s;this.interpolateToArr(e,t,n,r,l,i,o)}}interpolateTangent(e,t,n,r,i,a){for(var s=0;s<this.m;++s){var o=this.dt*s,l=o-this.delta,c=o+this.delta,u=a+3*s;l<0&&(l=0),c>1&&(c=1),this.interpolateToVec(e,t,n,r,l,this.vec1),this.interpolateToVec(e,t,n,r,c,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(i,u)}}vectorSubdivide(e,t,n,r,i){let a,s=t.next(),o=t.next(),l=t.next();const c=t.size,u=c-1;let d=r||0;for(let r=0;r<u;++r)a=s,s=o,o=l,l=t.next(),e.apply(this,[a,s,o,l,n,d]),d+=3*this.m;i&&(a=t.get(c-2),s=t.get(c-1),o=t.get(0),l=t.get(1),e.apply(this,[a,s,o,l,n,d]),d+=3*this.m)}getPosition(e,t,n,r){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,n,r);var i=e.size-1,a=i*this.m*3;r&&(a+=3*this.m);var s=e.get(r?0:i);t[a]=s.x,t[a+1]=s.y,t[a+2]=s.z}getTangent(e,t,n,r){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,n,r);let i=(e.size-1)*this.m*3;r&&(i+=3*this.m),Su(t,t,i-3,i,3)}interpolateNormalDir(e,t,n,r,i,a,s,o,l,c,u,d,h){for(let f=0;f<this.m;++f){let p=d+3*f;h&&(p+=3*this.m2);const m=this.dt*f;this.interpolateToVec(e,t,n,r,m,this.vec1),this.interpolateToVec(i,a,s,o,m,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(l,p),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(u,p),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(c,p)}}interpolateNormal(e,t,n,r,i){for(var a=0;a<this.m;++a){var s=i+3*a;e.copy(this.vNorm),this.vTan.fromArray(t,s),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(r,s),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,s)}}getNormal(e,t,n,r,i,a){this.vNorm.set(0,0,1);const s=e-1;let o=i||0;for(var l=0;l<s;++l)this.interpolateNormal(this.vDir,t,n,r,o),o+=3*this.m;a&&(this.interpolateNormal(this.vDir,t,n,r,o),o+=3*this.m),this.vBin.toArray(r,o),this.vNorm.toArray(n,o)}getNormalDir(e,t,n,r,i,a,s,o){e.reset(),t.reset();const l=new Vn,c=new Vn,u=new Vn,d=new Vn,h=new Vn,f=(new Vn).copy(e.next()),p=(new Vn).copy(e.next()),m=(new Vn).copy(e.next()),g=new Vn,_=(new Vn).copy(t.next()),y=(new Vn).copy(t.next()),v=(new Vn).copy(t.next());this.vNorm.set(0,0,1);let b=e.size,x=b-1,w=a||0;for(var S=0;S<x;++S)h.copy(f),f.copy(p),p.copy(m),m.copy(e.next()),g.copy(_),_.copy(y),y.copy(v),v.copy(t.next()),0===S?(l.subVectors(g,h),c.subVectors(_,f),l.dot(c)<0&&(c.multiplyScalar(-1),_.addVectors(f,c)),u.subVectors(y,p),c.dot(u)<0&&(u.multiplyScalar(-1),y.addVectors(p,u))):u.copy(d),d.subVectors(v,m),u.dot(d)<0&&(d.multiplyScalar(-1),v.addVectors(m,d)),this.interpolateNormalDir(h,f,p,m,g,_,y,v,n,r,i,w,o),w+=3*this.m;if(s&&(h.copy(e.get(b-2)),f.copy(e.get(b-1)),p.copy(e.get(0)),m.copy(e.get(1)),g.copy(t.get(b-2)),_.copy(t.get(b-1)),y.copy(t.get(0)),v.copy(t.get(1)),u.copy(d),d.subVectors(v,m),u.dot(d)<0&&(d.multiplyScalar(-1),v.addVectors(m,d)),this.interpolateNormalDir(h,f,p,m,g,_,y,v,n,r,i,w,o),w+=3*this.m),o){this.vBin.fromArray(i,3*this.m2),this.vNorm.fromArray(r,3*this.m2);for(var A=0;A<this.m2;++A)this.vBin.toArray(i,3*A),this.vNorm.toArray(r,3*A)}else this.vBin.toArray(i,w),this.vNorm.toArray(r,w)}interpolateColor(e,t,n,r,i){var a,s;for(a=0;a<this.m2;++a)s=i+3*a,n.apply(this,[e,r,s]);for(a=this.m2;a<this.m;++a)s=i+3*a,n.apply(this,[t,r,s])}getColor(e,t,n,r,i){let a;e.reset(),e.next();let s=e.next();for(var o=e.size,l=o-1,c=r||0,u=0;u<l;++u)a=s,s=e.next(),this.interpolateColor(a,s,t,n,c),c+=3*this.m;i&&(a=e.get(o-1),s=e.get(0),this.interpolateColor(a,s,t,n,c),c+=3*this.m),n[c]=n[c-3],n[c+1]=n[c-2],n[c+2]=n[c-1]}interpolatePicking(e,t,n,r,i){var a;for(a=0;a<this.m2;++a)r[i+a]=n.apply(this,[e]);for(a=this.m2;a<this.m;++a)r[i+a]=n.apply(this,[t])}getPicking(e,t,n,r,i){let a;e.reset(),e.next();let s=e.next();const o=e.size,l=o-1;let c=r||0;for(var u=0;u<l;++u)a=s,s=e.next(),this.interpolatePicking(a,s,t,n,c),c+=this.m;i&&(a=e.get(o-1),s=e.get(0),this.interpolatePicking(a,s,t,n,c),c+=this.m),n[c]=n[c-1]}interpolateSize(e,t,n,r,i){const a=n.apply(this,[e]),s=n.apply(this,[t]);for(let e=0;e<this.m;++e){let t=e/this.m;r[i+e]=(1-t)*a+t*s}}getSize(e,t,n,r,i){let a;e.reset(),e.next();let s=e.next();const o=e.size,l=o-1;let c=r||0;for(var u=0;u<l;++u)a=s,s=e.next(),this.interpolateSize(a,s,t,n,c),c+=this.m;i&&(a=e.get(o-1),s=e.get(0),this.interpolateSize(a,s,t,n,c),c+=this.m),n[c]=n[c-1]}}class i_{constructor(e,t){this.polymer=e,this.size=e.residueCount;var n=t||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new r_(this.subdiv,this.tension)}getAtomIterator(e,t){const n=this.polymer,r=n.structure,i=n.residueCount;let a=0,s=-1;const o=[r.getAtomProxy(),r.getAtomProxy(),r.getAtomProxy(),r.getAtomProxy()],l=[new Vn,new Vn,new Vn,new Vn];var c=r.getAtomProxy(),u=r.getAtomProxy();function d(r){var s=o[a%4];if(s.index=n.getAtomIndexByType(r,e),t&&r>0&&r<i&&"e"===s.sstruc){var d=l[a%4];return c.index=n.getAtomIndexByType(r+1,e),u.index=n.getAtomIndexByType(r-1,e),d.addVectors(c,u).add(s).add(s).multiplyScalar(.25),a+=1,d}return a+=1,s}return{size:i,next:function(){var e=d(s);return s+=1,e},get:d,reset:function(){a=0,s=-1}}}getSubdividedColor(e){var t=this.subdiv,n=this.polymer,r=(n.residueCount-1)*t*3+3;n.isCyclic&&(r+=3*t);var i=new Float32Array(r),a=this.getAtomIterator("trace"),s=e||{};s.structure=n.structure;var o=Zc.getScheme(s);return this.interpolator.getColor(a,(function(e,t,n){o.atomColorToArray(e,t,n)}),i,0,n.isCyclic),{color:i}}getSubdividedPicking(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e+1;t.isCyclic&&(n+=e);var r=t.structure,i=this.getAtomIterator("trace"),a=new Float32Array(n);return this.interpolator.getPicking(i,(function(e){return e.index}),a,0,t.isCyclic),{picking:new Lh(a,r)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}}getSubdividedSize(e){var t=this.subdiv,n=this.polymer,r=(n.residueCount-1)*t+1;n.isCyclic&&(r+=t);var i=new Float32Array(r),a=this.getAtomIterator("trace"),s=new Vf(e);return this.interpolator.getSize(a,(function(e){return s.atomRadius(e)}),i,0,n.isCyclic),{size:i}}getPosition(){const e=this.subdiv,t=this.polymer;let n=(t.residueCount-1)*e*3+3;t.isCyclic&&(n+=3*e);const r=new Float32Array(n),i=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(i,r,0,t.isCyclic),r}getTangent(){const e=this.subdiv,t=this.polymer;let n=(this.size-1)*e*3+3;t.isCyclic&&(n+=3*e);const r=new Float32Array(n),i=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(i,r,0,t.isCyclic),r}getNormals(e){const t=this.subdiv,n=this.polymer,r=n.isProtein(),i=this.size;let a=(i-1)*t*3+3;n.isCyclic&&(a+=3*t);const s=new Float32Array(a),o=new Float32Array(a);if(this.directional&&!this.polymer.isCg()){const t=this.getAtomIterator("direction1"),i=this.getAtomIterator("direction2");this.interpolator.getNormalDir(t,i,e,s,o,0,n.isCyclic,r)}else this.interpolator.getNormal(i,e,s,o,0,n.isCyclic);return{normal:s,binormal:o}}}const a_=new Vn,s_=new Vn,o_=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},Sf);class l_ extends Ef{constructor(e,t={}){super(function(e,t={}){const n=Ol(t.radialSegments,4),r=Ol(t.capped,!1),i=r?n:0,a=r?n-2:0,s=e.position.length/3,o=s*n*3+2*i*3,l=2*(s-1)*n*3+2*a*3;return{position:new Float32Array(o),color:new Float32Array(o),index:Gl(l,o/3),normal:new Float32Array(o),picking:e.picking}}(e,t),t),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=e.position.length/3,e.primitiveId=bu(this.size2),this.setAttributes(e),this.makeIndex()}get defaultParameters(){return o_}setAttributes(e={}){const t=this.parameters.aspectRatio,n=this.size2,r=n-1,i=this.parameters.radialSegments,a=this.geometry.attributes;let s,o,l,c,u,d,h,f,p,m,g,_,y;e.position&&(s=e.position,o=e.normal,l=e.binormal,c=e.tangent,d=e.size,f=a.position.array,m=a.normal.array,a.position.needsUpdate=!0,a.normal.needsUpdate=!0),e.color&&(u=e.color,p=a.color.array,a.color.needsUpdate=!0),e.primitiveId&&(h=e.primitiveId,g=a.primitiveId.array,a.primitiveId.needsUpdate=!0);let v=0,b=0,x=0,w=0,S=0,A=0,M=0,E=0,C=0,T=0;const P=[],I=[],R=[],k=[],D=[],L=[];if(s)for(let e=0;e<i;++e){const n=e/i*2*Math.PI;P[e]=t*Math.cos(n),I[e]=Math.sin(n),R[e]=t*Math.cos(n-.01),k[e]=Math.sin(n-.01),D[e]=t*Math.cos(n+.01),L[e]=Math.sin(n+.01)}for(let e=0;e<n;++e){_=3*e,y=_*i,s&&c&&o&&l&&d&&(a_.set(c[_],c[_+1],c[_+2]),b=o[_],x=o[_+1],w=o[_+2],S=l[_],A=l[_+1],M=l[_+2],E=s[_],C=s[_+1],T=s[_+2],v=d[e]);for(let t=0;t<i;++t){const n=y+3*t;if(s){const e=-v*P[t],r=v*I[t],i=-v*R[t],a=v*k[t],s=-v*D[t],o=v*L[t];f[n]=E+e*b+r*S,f[n+1]=C+e*x+r*A,f[n+2]=T+e*w+r*M,s_.set(s*b+o*S-(i*b+a*S),s*x+o*A-(i*x+a*A),s*w+o*M-(i*w+a*M)).cross(a_),m[n]=s_.x,m[n+1]=s_.y,m[n+2]=s_.z}u&&(p[n]=u[_],p[n+1]=u[_+1],p[n+2]=u[_+2]),h&&(g[e*i+t]=h[e])}}_=0,y=3*n*i;for(let e=0;e<i;++e){const t=_+3*e,r=y+3*e;s&&c&&(f[r]=f[t],f[r+1]=f[t+1],f[r+2]=f[t+2],m[r]=c[_],m[r+1]=c[_+1],m[r+2]=c[_+2]),u&&(p[r]=p[t],p[r+1]=p[t+1],p[r+2]=p[t+2]),h&&(g[n*i+e]=g[0+e])}_=3*(n-1)*i,y=3*(n+1)*i;for(let e=0;e<i;++e){const t=_+3*e,a=y+3*e;s&&c&&(f[a]=f[t],f[a+1]=f[t+1],f[a+2]=f[t+2],m[a]=c[3*r],m[a+1]=c[3*r+1],m[a+2]=c[3*r+2]),u&&(p[a]=p[t],p[a+1]=p[t+1],p[a+2]=p[t+2]),h&&(g[(n+1)*i+e]=g[(n-1)*i+e])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void Wc.error("Index is null");const t=e.array,n=this.size2,r=n-1,i=this.capTriangles,a=this.parameters.radialSegments,s=this.parameters.radialSegments+1;let o,l;for(let e=0;e<r;++e){const n=e*a*3*2,r=e*a,i=(e+1)*a;for(let e=0;e<a;++e)l=n+3*e*2,t[l]=r+e,t[l+1]=r+(e+1)%a,t[l+2]=i+e,t[l+3]=i+e,t[l+4]=r+(e+1)%a,t[l+5]=i+(e+1)%a}const c=[0];for(let e=1;e<s/2;++e)c.push(e),a-e!==e&&c.push(a-e);l=r*a*3*2,o=n*a;for(let e=0;e<c.length-2;++e)e%2==0?(t[l+3*e+0]=o+c[e+0],t[l+3*e+1]=o+c[e+1],t[l+3*e+2]=o+c[e+2]):(t[l+3*e+0]=o+c[e+2],t[l+3*e+1]=o+c[e+1],t[l+3*e+2]=o+c[e+0]);l=r*a*3*2+3*i,o=n*a+a;for(let e=0;e<c.length-2;++e)e%2==0?(t[l+3*e+0]=o+c[e+0],t[l+3*e+1]=o+c[e+1],t[l+3*e+2]=o+c[e+2]):(t[l+3*e+0]=o+c[e+2],t[l+3*e+1]=o+c[e+1],t[l+3*e+2]=o+c[e+0])}}class c_ extends Rg{constructor(e,t,n){super(e,t,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.colorScheme=Ol(t.colorScheme,"chainname"),t.colorScale=Ol(t.colorScale,"RdYlBu"),t.radiusType=Ol(t.radiusType,"sstruc"),t.radiusScale=Ol(t.radiusScale,.7),t.useInteriorColor=Ol(t.useInteriorColor,!0),this.aspectRatio=Ol(t.aspectRatio,5),this.tension=Ol(t.tension,NaN),this.capped=Ol(t.capped,!0),this.smoothSheet=Ol(t.smoothSheet,!1),"low"===t.quality?(this.subdiv=3,this.radialSegments=6):"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=Ol(t.subdiv,6),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:1!==this.aspectRatio,smoothSheet:this.smoothSheet},e)}getSpline(e){return new i_(e,this.getSplineParams())}getAspectRatio(e){return e.isCg()?1:this.aspectRatio}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){let t=[],n=[];return this.structure.eachPolymer((e=>{if(e.residueCount<4)return;n.push(e);const r=this.getSpline(e),i=this.getAspectRatio(e),a=r.getSubdividedPosition(),s=r.getSubdividedOrientation(),o=r.getSubdividedColor(this.getColorParams()),l=r.getSubdividedPicking(),c=r.getSubdividedSize(this.getRadiusParams());t.push(new l_(Object.assign({},a,s,o,l,c),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:i,capped:this.capped})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){Xc&&Wc.time(this.type+" repr update"),e=e||{};for(var n=0,r=t.polymerList.length;n<r;++n){var i={},a=t.polymerList[n],s=this.getSpline(a),o=this.getAspectRatio(a);if(Object.assign(t.bufferList[n],{aspectRatio:o}),e.position||e.radius){var l=s.getSubdividedPosition(),c=s.getSubdividedOrientation(),u=s.getSubdividedSize(this.getRadiusParams(o));i.position=l.position,i.normal=c.normal,i.binormal=c.binormal,i.tangent=c.tangent,i.size=u.size}if(e.color){var d=s.getSubdividedColor(this.getColorParams());i.color=d.color}if(e.picking){var h=s.getSubdividedPicking();i.picking=h.picking}t.bufferList[n].setAttributes(i)}Xc&&Wc.timeEnd(this.type+" repr update")}setParameters(e){var t={};return e&&e.aspectRatio&&(t.radius=!0),e&&e.tension&&(t.position=!0),super.setParameters(e,t,!1),this}}function u_(e,t){function n(e,t){return t in e}const r=Object.assign({},e);for(const e in r)n(r,e)&&n(t,e)&&(r[e]=Ol(t[e],r[e]));return r}function d_(e,t){const n=new ai(e),r=new Float32Array(3*t);return vu(t,n.r,n.g,n.b,r),r}function h_(e){const t=e.atomPositions,n=e.histogram360Scaled,r=n.length<=180?360:2*n.length,i={triangles:new Float32Array(3*r*3),triangleColors:d_(e.opaqueMiddleDiscColor,3*r)},a={triangles:new Float32Array(3*n.length*3),triangleColors:d_(e.frontHistogramColor,3*n.length)},s={triangles:new Float32Array(3*n.length*3),triangleColors:d_(e.backHistogramColor,3*n.length)},o={startPoints:new Float32Array(3*n.length),endPoints:new Float32Array(3*n.length),startColors:d_(e.histogramBinBorderColor,n.length),endColors:d_(e.histogramBinBorderColor,n.length)},l={startPoints:new Float32Array(3*n.length),endPoints:new Float32Array(3*n.length),startColors:d_(e.histogramBinBorderColor,n.length),endColors:d_(e.histogramBinBorderColor,n.length)},c={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:d_(e.adjacentBondArrowColor,n.length),endColors:d_(e.adjacentBondArrowColor,n.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:d_(e.distantBondArrowColor,n.length),endColors:d_(e.distantBondArrowColor,n.length)},d=Bu(),h=Bu(),f=Bu(),p=Bu(),m=Bu(),g=Bu(),_=Bu(),y=Bu(),v=Bu(),b=Bu(),x=Bu(),w=Bu(),S=Bu(),A=Bu(),M=Bu(),E=Bu(),C=[d,h,f,p];for(let e=0;e<C.length;e++)Gu(C[e],t,3*e);if(Hu(m,d,h),Hu(g,f,h),Hu(y,p,f),0===qu(g))return;if(Yu(M,g,.5),$u(v,h,M),Ku(m,m),Ku(g,g),Ku(y,y),td(_,g),Yu(M,_,Vu(_,m)),Hu(b,m,M),Yu(M,g,Vu(g,y)),Hu(x,y,M),0===qu(b)||0===qu(x))return;Ku(b,b),Ku(x,x);const T=Math.acos(Vu(b,x));zu(w,_,b),zu(S,g,x),Ku(w,w),Ku(S,S);let P=T;Vu(w,x)<0&&(P=-T),$u(A,v,b);const I=Math.max.apply(null,n),R=2*Math.PI/n.length;function k(e,t,r,i,a){const s=3*t*3;ju(v,e,s);const o=Number(n[t])/I;Yu(M,r,o),Yu(E,i,o),Lg(A,v,M,E,t*a),ju(A,e,s+3),Lg(A,v,M,E,(t+1)*a),ju(A,e,s+6)}function D(e,t,r,i,a){Su(v,c.startPoints,0,3*r,v.length),Lg(M,v,i,a,0+0*R),Su(M,c.endPoints,0,3*r,v.length),Su(v,u.startPoints,0,3*r,v.length),Lg(M,v,i,a,P),Su(M,u.endPoints,0,3*r,v.length);for(let e=0;e<n.length;e++)Su(v,t.startPoints,0,3*e,v.length),Lg(M,v,i,a,0+R*e),Su(M,t.endPoints,0,3*e,M.length);for(let t=0;t<n.length;t++)k(e.triangles,t,i,a,R)}const L=2*Math.PI/r;for(let e=0;e<r;e++){const t=3*e*3;ju(v,i.triangles,t),Lg(A,v,b,w,e*L),ju(A,i.triangles,t+3),Lg(A,v,b,w,(e+1)*L),ju(A,i.triangles,t+6)}return Yu(M,g,-.01),$u(v,v,M),D(a,o,0,b,w),Yu(M,g,.02),$u(v,v,M),D(s,l,1,x,S),{opaqueMiddleDisc:i,frontHistogram:a,backHistogram:s,frontHistogramBinBorders:o,backHistogramBinBorders:l,adjacentBondArrows:c,distantBondArrows:u}}function f_(e){return e.position.length/3*2*3}Jc.add("cartoon",c_),Jc.add("contact",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusSize=Ol(t.radiusSize,.05),t.useInteriorColor=Ol(t.useInteriorColor,!0),this.hydrogenBond=Ol(t.hydrogenBond,!0),this.weakHydrogenBond=Ol(t.weakHydrogenBond,!1),this.waterHydrogenBond=Ol(t.waterHydrogenBond,!1),this.backboneHydrogenBond=Ol(t.backboneHydrogenBond,!1),this.hydrophobic=Ol(t.hydrophobic,!1),this.halogenBond=Ol(t.halogenBond,!0),this.ionicInteraction=Ol(t.ionicInteraction,!0),this.metalCoordination=Ol(t.metalCoordination,!0),this.cationPi=Ol(t.cationPi,!0),this.piStacking=Ol(t.piStacking,!0),this.filterSele=Ol(t.filterSele,""),this.labelVisible=Ol(t.labelVisible,!1),this.labelFixedSize=Ol(t.labelFixedSize,!1),this.labelSize=Ol(t.labelSize,2),this.labelUnit=Ol(t.labelUnit,""),this.maxHydrophobicDist=Ol(t.maxHydrophobicDist,4),this.maxHbondDist=Ol(t.maxHbondDist,3.5),this.maxHbondSulfurDist=Ol(t.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=Ol(t.maxHbondAccAngle,45),this.maxHbondDonAngle=Ol(t.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=Ol(t.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=Ol(t.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=Ol(t.maxPiStackingDist,5.5),this.maxPiStackingOffset=Ol(t.maxPiStackingOffset,2),this.maxPiStackingAngle=Ol(t.maxPiStackingAngle,30),this.maxCationPiDist=Ol(t.maxCationPiDist,6),this.maxCationPiOffset=Ol(t.maxCationPiOffset,2),this.maxIonicDist=Ol(t.maxIonicDist,5),this.maxHalogenBondDist=Ol(t.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=Ol(t.maxHalogenBondAngle,30),this.maxMetalDist=Ol(t.maxMetalDist,3),this.refineSaltBridges=Ol(t.refineSaltBridges,!0),this.masterModelIndex=Ol(t.masterModelIndex,-1),this.lineOfSightDistFactor=Ol(t.lineOfSightDistFactor,1),super.init(t)}getAtomRadius(){return 0}getContactData(e){const t={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},n={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return function(e,t,n){const r=Fl(n,Ih),i=[];r.hydrogenBond&&i.push(4),r.hydrophobic&&i.push(6),r.halogenBond&&i.push(5),r.ionicInteraction&&i.push(1),r.metalCoordination&&i.push(7),r.cationPi&&i.push(2),r.piStacking&&i.push(3),r.weakHydrogenBond&&i.push(8),r.waterHydrogenBond&&i.push(9),r.backboneHydrogenBond&&i.push(10);const{features:a,contactSet:s,contactStore:o}=e,{centers:l,atomSets:c}=a,{x:u,y:d,z:h}=l,{index1:f,index2:p,type:m}=o,g=[],_=[],y=[],v=[],b=[];let x;return r.filterSele&&(x=Array.isArray(r.filterSele)?r.filterSele.map((e=>t.getAtomSet(new Nc(e)))):t.getAtomSet(new Nc(r.filterSele))),s.forEach((e=>{const t=m[e];if(!i.includes(t))return;if(x){const t=c[f[e]][0],n=c[p[e]][0];if(Array.isArray(x)){if(!(x[0].isSet(t)&&x[1].isSet(n)||x[1].isSet(t)&&x[0].isSet(n)))return}else if(!x.isSet(t)&&!x.isSet(n))return}const n=f[e],a=p[e];g.push(u[n],d[n],h[n]),_.push(u[a],d[a],h[a]),y.push(...function(e){switch(e){case 4:case 9:case 10:return Rh.setHex(2851770).toArray();case 6:return Rh.setHex(8421504).toArray();case 5:return Rh.setHex(4259775).toArray();case 1:return Rh.setHex(15779860).toArray();case 7:return Rh.setHex(9191577).toArray();case 2:return Rh.setHex(16744448).toArray();case 3:return Rh.setHex(9220966).toArray();case 8:return Rh.setHex(12967404).toArray();default:return Rh.setHex(13421772).toArray()}}(t)),v.push(r.radius),b.push(e)})),{position1:new Float32Array(g),position2:new Float32Array(_),color:new Float32Array(y),color2:new Float32Array(y),radius:new Float32Array(v),picking:new Fh(b,e,t)}}(function(e,t=Eh){const n=function(e){const{types:t,centers:n}=e;return{features:e,spatialHash:new bd(n),contactStore:new wd,featureSet:new Ad(t.length,!1)}}(function(e){const t={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return Xc&&Wc.time("calculateFeatures"),function(e,t){const{charge:n}=lh(e.data),r={};e.eachResidue((e=>{if(uh.includes(e.resname)){const n=Ed(1);e.eachAtom((e=>{7===e.number&&e.isSidechain()&&Cd(n,e)})),Td(t,n)}else Wd.includes(e.resname)||e.isNucleic()||(e.eachAtom((e=>{let n=!1;const i=Ed(1);!function(e){let t=0;return 6===e.number&&3===e.bondCount&&3===e.bondToElementCount(7)&&e.eachBondedAtom((e=>{e.bondCount-e.bondToElementCount(1)==1&&++t})),2===t}(e)?function(e){let t=0;return 6===e.number&&3===e.bondCount&&2===e.bondToElementCount(7)&&1===e.bondToElementCount(6)&&e.eachBondedAtom((e=>{e.bondCount-e.bondToElementCount(1)==1&&++t})),2===t}(e)&&(i.group=9,n=!0):(i.group=8,n=!0),n&&(e.eachBondedAtom((e=>{7===e.number&&(r[e.index]=!0,Cd(i,e))})),Td(t,i))})),e.eachAtom((e=>{const i=Ed(1);n[e.index]>0&&(r[e.index]||(Cd(i,e),Td(t,i)))})))}))}(e,t),function(e,t){const{charge:n}=lh(e.data),r={};e.eachResidue((e=>{if(dh.includes(e.resname)){const n=Ed(2);e.eachAtom((e=>{8===e.number&&e.isSidechain()&&Cd(n,e)})),Td(t,n)}else if(Kd.includes(e.resname)){const n=Ed(2);e.eachAtom((e=>{ch(e)&&(n.group=6,e.eachBondedAtom((e=>{8===e.number&&Cd(n,e)})),Td(t,n))}))}else Wd.includes(e.resname)||Kd.includes(e.resname)||(e.eachAtom((e=>{let n=!1;const i=Ed(2);!function(e){return 16===e.number&&3===e.bondToElementCount(8)}(e)?ch(e)?(i.group=6,n=!0):function(e){return 16===e.number&&4===e.bondToElementCount(8)}(e)?(i.group=5,n=!0):function(e){let t=0;return 6===e.number&&2===e.bondToElementCount(8)&&1===e.bondToElementCount(6)&&e.eachBondedAtom((e=>{8===e.number&&e.bondCount-e.bondToElementCount(1)==1&&++t})),2===t}(e)&&(i.group=10,n=!0):(i.group=4,n=!0),n&&(e.eachBondedAtom((e=>{8===e.number&&(r[e.index]=!0,Cd(i,e))})),Td(t,i))})),e.eachAtom((e=>{const i=Ed(2);n[e.index]<0&&(r[e.index]||(Cd(i,e),Td(t,i)))})))}))}(e,t),function(e,t){const n=e.getAtomProxy();e.eachResidue((e=>{const r=e.getAromaticRings();if(r){const i=e.atomOffset;r.forEach((e=>{const r=Ed(3);e.forEach((e=>{n.index=e+i,Cd(r,n)})),Td(t,r)}))}}))}(e,t),function(e,t){const{charge:n,implicitH:r,idealGeometry:i}=lh(e.data);e.eachAtom((e=>{const a=Ed(5),s=e.number;if(8===s)Cd(a,e),Td(t,a);else if(7===s){if(mh(e))Cd(a,e),Td(t,a);else if(n[e.index]<1){const n=e.bondCount+r[e.index],s=i[e.index];(4===s&&n<4||3===s&&n<3||2===s&&n<2)&&(Cd(a,e),Td(t,a))}}else 16===s&&("CYS"!==e.resname&&"MET"!==e.resname&&-1!==e.formalCharge||(Cd(a,e),Td(t,a)))}))}(e,t),function(e,t){const{totalH:n}=lh(e.data);e.eachAtom((e=>{const r=Ed(4),i=e.number;(mh(e)||n[e.index]>0&&(7===i||8===i||16===i))&&(Cd(r,e),Td(t,r))}))}(e,t),function(e,t){const{totalH:n}=lh(e.data);e.eachAtom((e=>{if(6===e.number&&n[e.index]>0&&(e.bondToElementCount(7)>0||e.bondToElementCount(8)>0||function(e){if(!e.isAromatic())return!1;const t=e.residueType.getRings();if(!t)return!1;let n=!1;return t.rings.forEach((t=>{n||t.some((t=>e.index-e.residueAtomOffset===t))&&(n=t.some((t=>{const n=e.residueType.atomTypeIdList[t],r=e.atomMap.get(n).number;return 7===r||8===r})))})),n}(e))){const n=Ed(9);Cd(n,e),Td(t,n)}}))}(e,t),function(e,t){e.eachAtom((e=>{let n=!1,r=!1;const i=Wd.includes(e.resname),a=Kd.includes(e.resname);if(i||a?i?8===e.number?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(e.resname)&&e.isSidechain()||e.isBackbone())&&(n=!0,r=!0):16===e.number&&"CYS"===e.resname?(n=!0,r=!0):7===e.number&&"HIS"===e.resname&&e.isSidechain()&&(n=!0):a&&(8===e.number&&e.isBackbone()?(n=!0,r=!0):["N3","N4","N7"].includes(e.atomname)?n=!0:["O2","O4","O6"].includes(e.atomname)&&(n=!0,r=!0)):e.isHalogen()||8===e.number||16===e.number?(n=!0,r=!0):7===e.number&&(n=!0),n){const n=Ed(11);Cd(n,e),Td(t,n)}if(r){const n=Ed(10);Cd(n,e),Td(t,n)}}))}(e,t),function(e,t){e.eachAtom((e=>{if(e.isTransitionMetal()||30===e.number||48===e.number){const n=Ed(12);Cd(n,e),Td(t,n)}else if(yh.includes(e.number)){const n=Ed(13);Cd(n,e),Td(t,n)}}))}(e,t),function(e,t){e.eachAtom((e=>{const n=Ed(8);let r=!1;6===e.number?(r=!0,e.eachBondedAtom((e=>{const t=e.number;6!==t&&1!==t&&(r=!1)}))):9===e.number&&(r=!0),r&&(Cd(n,e),Td(t,n))}))}(e,t),function(e,t){e.eachAtom((e=>{if(xh.includes(e.number)){let n=!1;if(e.eachBondedAtom((e=>{wh.includes(e.number)&&(n=!0)})),n){const n=Ed(7);Cd(n,e),Td(t,n)}}}))}(e,t),function(e,t){e.eachAtom((e=>{if(bh.includes(e.number)&&1===e.bondToElementCount(6)){const n=Ed(6);Cd(n,e),Td(t,n)}}))}(e,t),Xc&&Wc.timeEnd("calculateFeatures"),t}(e));Xc&&Wc.time("calculateContacts"),function(e,t,n={}){const r=Ol(n.maxIonicDist,Eh.maxIonicDist),i=Ol(n.maxPiStackingDist,Eh.maxPiStackingDist),a=Ol(n.maxPiStackingOffset,Eh.maxPiStackingOffset),s=Ol(n.maxPiStackingAngle,Eh.maxPiStackingAngle),o=Ol(n.maxCationPiDist,Eh.maxCationPiDist),l=Ol(n.maxCationPiOffset,Eh.maxCationPiOffset),c=Ol(n.masterModelIndex,Eh.masterModelIndex),u=Math.max(r+2,i,o),d=i*i,h=o*o,{features:f,spatialHash:p,contactStore:m,featureSet:g}=t,{types:_,centers:y,atomSets:v}=f,{x:b,y:x,z:w}=y,S=_.length,A=e.atomStore.x,M=e.atomStore.y,E=e.atomStore.z,C=e.getAtomProxy(),T=e.getAtomProxy(),P=function(e,t,n){const r=e.length,i=t.length;for(let a=0;a<r;++a){C.index=e[a];for(let e=0;e<i;++e)if(T.index=t[e],C.distanceTo(T)<=n)return!0}return!1},I=new Vn,R=new Vn,k=new Vn,D=new Vn,L=new Vn,N=new Vn,O=new Vn,F=function(e,t){I.set(A[e[0]],M[e[0]],E[e[0]]),R.set(A[e[1]],M[e[1]],E[e[1]]),k.set(A[e[2]],M[e[2]],E[e[2]]),D.subVectors(I,R),L.subVectors(I,k),t.crossVectors(D,L)},U=function(e,t,n){return I.set(b[e],x[e],w[e]),R.set(b[t],x[t],w[t]),I.sub(R).projectOnPlane(n).add(R).distanceTo(R)},B=function(e,t,n){g.setBits(e,t),m.addContact(e,t,n)};for(let e=0;e<S;++e)p.eachWithin(b[e],x[e],w[e],u,((t,n)=>{if(t<=e)return;if(C.index=v[e][0],T.index=v[t][0],Th(C,T,c))return;const i=_[e],o=_[t];if(hh(i,o))P(v[e],v[t],r)&&B(e,t,1);else if(fh(i,o)){if(n<=d){F(v[e],N),F(v[t],O);const n=57.29578*N.angleTo(O);Math.min(U(e,t,O),U(t,e,N))<=a&&(n<=s||n>=180-s||n<=s+90&&n>=90-s)&&B(e,t,3)}}else if(ph(i,o)&&n<=h){const[n,r]=3===i?[e,t]:[t,e];F(v[n],N),U(r,n,N)<=l&&B(n,r,2)}}))}(e,n,t),function(e,t,n={}){const r=Ol(n.maxHbondDist,Eh.maxHbondDist),i=Ol(n.maxHbondSulfurDist,Eh.maxHbondSulfurDist),a=Kl(Ol(n.maxHbondAccAngle,Eh.maxHbondAccAngle)),s=Kl(Ol(n.maxHbondDonAngle,Eh.maxHbondDonAngle)),o=Kl(Ol(n.maxHbondAccPlaneAngle,Eh.maxHbondAccPlaneAngle)),l=Kl(Ol(n.maxHbondDonPlaneAngle,Eh.maxHbondDonPlaneAngle)),c=Ol(n.masterModelIndex,Eh.masterModelIndex),u=Math.max(r,i),d=r*r,{features:h,spatialHash:f,contactStore:p,featureSet:m}=t,{types:g,centers:_,atomSets:y}=h,{x:v,y:b,z:x}=_,w=g.length,{idealGeometry:S}=lh(e.data),A=e.getAtomProxy(),M=e.getAtomProxy();for(let e=0;e<w;++e)f.eachWithin(v[e],b[e],x[e],u,((t,n)=>{if(t<=e)return;const r=g[e],i=g[t],u=_h(r,i);if(!u&&!gh(r,i))return;const[h,f]=5===i?[e,t]:[t,e];if(A.index=y[h][0],M.index=y[f][0],M.index===A.index)return;if(Th(A,M,c))return;if(16!==A.number&&16!==M.number&&n>d)return;if(A.connectedTo(M))return;const _=sh(A,M),v=ah.get(S[A.index])||Kl(120);if(_.some((e=>Math.abs(v-e)>s)))return;if(3===S[A.index]){const e=oh(A,M);if(void 0!==e&&e>l)return}const b=sh(M,A),x=ah.get(S[M.index])||Kl(120);if(b.some((e=>x-e>a)))return;if(3===S[M.index]){const e=oh(M,A);if(void 0!==e&&e>o)return}m.setBits(h,f);const w=u?8:function(e,t){return e.isWater()&&t.isWater()}(E=A,C=M)?9:function(e,t){return e.isBackbone()&&t.isBackbone()}(E,C)?10:4;var E,C;p.addContact(h,f,w)}))}(e,n,t),function(e,t,n={}){const r=Ol(n.maxMetalDist,Eh.maxMetalDist),i=Ol(n.masterModelIndex,Eh.masterModelIndex),{features:a,spatialHash:s,contactStore:o,featureSet:l}=t,{types:c,centers:u,atomSets:d}=a,{x:h,y:f,z:p}=u,m=c.length,g=e.getAtomProxy(),_=e.getAtomProxy();for(let e=0;e<m;++e)s.eachWithin(h[e],f[e],p[e],r,((t,n)=>{if(t<=e)return;if(g.index=d[e][0],_.index=d[t][0],Th(g,_,i))return;const r=g.isMetal(),a=_.isMetal();if(!r&&!a)return;const[s,u]=r?[c[e],c[t]]:[c[t],c[e]];vh(s,u)&&(l.setBits(e,t),o.addContact(e,t,7))}))}(e,n,t),function(e,t,n={}){const r=Ol(n.maxHydrophobicDist,Eh.maxHydrophobicDist),i=Ol(n.masterModelIndex,Eh.masterModelIndex),{features:a,spatialHash:s,contactStore:o,featureSet:l}=t,{types:c,centers:u,atomSets:d}=a,{x:h,y:f,z:p}=u,m=c.length,g=e.getAtomProxy(),_=e.getAtomProxy();for(let e=0;e<m;++e)s.eachWithin(h[e],f[e],p[e],r,((t,n)=>{var r,a;t<=e||(g.index=d[e][0],_.index=d[t][0],Th(g,_,i)||9===g.number&&9===_.number||g.connectedTo(_)||(r=c[e],a=c[t],8===r&&8===a&&(l.setBits(e,t),o.addContact(e,t,6))))}))}(e,n,t),function(e,t,n={}){const r=Ol(n.maxHalogenBondDist,Eh.maxHalogenBondDist),i=Kl(Ol(n.maxHalogenBondAngle,Eh.maxHalogenBondAngle)),a=Ol(n.masterModelIndex,Eh.masterModelIndex),{features:s,spatialHash:o,contactStore:l,featureSet:c}=t,{types:u,centers:d,atomSets:h}=s,{x:f,y:p,z:m}=d,g=u.length,_=e.getAtomProxy(),y=e.getAtomProxy();for(let e=0;e<g;++e)o.eachWithin(f[e],p[e],m[e],r,((t,n)=>{if(t<=e)return;if(_.index=h[e][0],y.index=h[t][0],Th(_,y,a))return;if(r=u[e],s=u[t],!(7===r&&6===s||6===r&&7===s))return;var r,s;const[o,d]=6===u[e]?[_,y]:[y,_],f=sh(o,d);if(1!==f.length)return;if(Sh-f[0]>i)return;const p=sh(d,o);0!==p.length&&(p.some((e=>Ah-e>i))||(c.setBits(e,t),l.addContact(e,t,5)))}))}(e,n,t);const r=function(e){const{index1:t,index2:n,count:r}=e.contactStore,i=Md({nodeArray1:t,nodeArray2:n,edgeCount:r,nodeCount:e.featureSet.length}),a=new Ad(e.contactStore.count,!0);return Object.assign({adjacencyList:i,contactSet:a},e)}(n);return function(e,t,n={}){Xc&&Wc.time("refineLineOfSight");const r=Ol(n.lineOfSightDistFactor,Eh.lineOfSightDistFactor),i=Ol(n.masterModelIndex,Eh.masterModelIndex),a=e.spatialHash,{contactSet:s,contactStore:o,features:l}=t,{index1:c,index2:u}=o,{centers:d,atomSets:h}=l,{x:f,y:p,z:m}=d,g=e.getAtomProxy(),_=e.getAtomProxy(),y=e.getAtomProxy(),v=new Vn,b=new Vn,x=3*r,w=r*r;s.forEach((e=>{v.set(f[c[e]],p[c[e]],m[c[e]]),b.set(f[u[e]],p[u[e]],m[u[e]]);const t=(v.x+b.x)/2,n=(v.y+b.y)/2,r=(v.z+b.z)/2,o=h[c[e]],l=h[u[e]];g.index=o[0],_.index=l[0],a.eachWithin(t,n,r,x,((t,n)=>{y.index=t,1!==y.number&&y.vdw*y.vdw*w>n&&!Mh(g,y,i)&&!Mh(_,y,i)&&!o.includes(t)&&!l.includes(t)&&v.distanceToSquared(y)>1&&b.distanceToSquared(y)>1&&(s.clear(e),Xc&&Wc.log("removing",g.qualifiedName(),_.qualifiedName(),"because",y.qualifiedName()))}))})),Xc&&Wc.timeEnd("refineLineOfSight")}(e,r,t),function(e,t){const{contactSet:n,contactStore:r,features:i}=t,{type:a,index1:s,index2:o}=r,{atomSets:l}=i,c=e.getAtomProxy(),u=e.getAtomProxy(),d={},h=function(e,t,r){const[i,a]=d[r]||[1/0,-1];e<i?(-1!==a&&n.clear(a),d[r]=[e,t]):n.clear(t)};n.forEach((e=>{if(6!==a[e])return;c.index=l[s[e]][0],u.index=l[o[e]][0];const t=c.distanceTo(u);h(t,e,`${c.index}|${u.residueIndex}`),h(t,e,`${u.index}|${c.residueIndex}`)}))}(e,r),t.refineSaltBridges&&function(e,t){const{contactSet:n,contactStore:r,features:i}=t,{type:a,index1:s,index2:o}=r,{atomSets:l}=i,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{1===a[e]&&(l[s[e]].forEach((t=>u(t,e))),l[o[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(!function(e){return 4===e||9===e||10===e}(a[e]))return;const t=c[l[s[e]][0]],r=c[l[o[e]][0]];if(!t||!r)return;const i=t.length;for(let a=0;a<i;++a)if(r.includes(t[a]))return void n.clear(e)}))}(0,r),function(e,t){const{contactSet:n,contactStore:r,features:i}=t,{type:a,index1:s,index2:o}=r,{atomSets:l}=i,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{3===a[e]&&(l[s[e]].forEach((t=>u(t,e))),l[o[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(6!==a[e]&&2!==a[e])return;const t=c[l[s[e]][0]],r=c[l[o[e]][0]];if(!t||!r)return;const i=t.length;for(let a=0;a<i;++a)if(r.includes(t[a]))return void n.clear(e)}))}(0,r),function(e,t){const{contactSet:n,contactStore:r,features:i}=t,{type:a,index1:s,index2:o}=r,{atomSets:l}=i,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{1===a[e]&&(l[s[e]].forEach((t=>u(t,e))),l[o[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(7!==a[e])return;const t=c[l[s[e]][0]],r=c[l[o[e]][0]];if(!t||!r)return;const i=t.length;for(let e=0;e<i;++e)if(r.includes(t[e]))return void n.clear(t[e])}))}(0,r),Xc&&Wc.timeEnd("calculateContacts"),r}(e,t),e,n)}createData(e){const t=this.getContactData(e),n=[new t_(rd(t),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const e={size:this.labelSize,unit:this.labelUnit};n.push(new $g(function(e,t){const n=gu(e.position1,e.position2),r=[],i=_u(e.position1,e.position2),a=i.length/3;for(let e=0;e<a;e++){const n=3*e,a=Math.sqrt(Math.pow(i[n],2)+Math.pow(i[n+1],2)+Math.pow(i[n+2],2));switch(t.unit){case"angstrom":r[e]=a.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":r[e]=(a/10).toFixed(2)+" nm";break;default:r[e]=a.toFixed(2)}}return{position:n,size:yu(n.length/3,t.size),color:e.color,text:r}}(t,e),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:n}}}),Jc.add("dihedral",class extends kg{constructor(e,t,n){super(e,t,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=Ol(t.side,"double"),t.opacity=Ol(t.opacity,.5),this.atomQuad=Ol(t.atomQuad,[]),this.extendLine=Ol(t.extendLine,!0),this.lineVisible=Ol(t.lineVisible,!0),this.planeVisible=Ol(t.planeVisible,!0),this.sectorVisible=Ol(t.sectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomQuad.length)return;const t=function(e,t={}){const n=Ol(t.angleStep,Math.PI/90),r=e.length,i=e.length/12,a=new Float32Array(i),s=new Float32Array(3*i),o=new Array(i),l=new Array(i),c=new Array(i),u=new Array(i),d=new Array(i);let h=0,f=0,p=0;const m=Bu(),g=Bu(),_=Bu(),y=Bu(),v=Bu(),b=Bu(),x=Bu(),w=Bu(),S=Bu(),A=Bu(),M=Bu(),E=Bu(),C=Bu(),T=Bu(),P=Bu();let I=0;for(var R=0;R<r;R+=12){if(Gu(m,e,R),Gu(g,e,R+3),Gu(_,e,R+6),Gu(y,e,R+9),Hu(v,m,g),Hu(b,_,g),0===qu(b))continue;Hu(x,y,_),Yu(w,b,.5),$u(S,g,w),Ku(v,v),Ku(b,b),Ku(x,x),Hu(w,m,S);const r=Vu(w,b)>0;Hu(w,y,S);const i=Vu(w,b)<0;if(Yu(w,b,Vu(b,v)),Hu(A,v,w),Yu(w,b,Vu(b,x)),Hu(M,x,w),0===qu(A)||0===qu(M))continue;Ku(A,A),Ku(M,M);const k=a[I]=nd(A,M);o[I]=(pu*k).toFixed(1)+String.fromCharCode(176),zu(T,A,b),Ku(T,T),Vu(T,M)<0&&td(T,T),Lg(w,S,A,T,k/2),ju(w,s,3*I);const D=Math.ceil(k/n),L=D+(t.extendLine?4:2),N=t.extendLine?36:0,O=new Float32Array(3*L),F=new Float32Array(3*L),U=new Float32Array(9*D),B=new Float32Array(N);l[I]=O,c[I]=F,u[I]=U,d[I]=B,t.extendLine&&(r?(Hu(w,m,_),Ku(w,w),Yu(E,w,1/Vu(A,w)),$u(E,E,_)):(Yu(E,v,1/Vu(A,v)),$u(E,E,g)),i?(Hu(w,y,g),Ku(w,w),Yu(C,w,1/Vu(M,w)),$u(C,C,g)):(Yu(C,x,1/Vu(M,x)),$u(C,C,_))),$u(P,S,A);let z=0;t.extendLine?(ju(m,O,z),ju(E,F,z),z+=3,ju(E,O,z),ju(P,F,z),z+=3,ju(E,B,0),ju(P,B,3),ju(r?_:g,B,6),ju(r?_:g,B,9),ju(P,B,12),ju(S,B,15)):(ju(S,O,z),ju(P,F,z),z+=3);const V=function(e,t){const n=9*t;ju(S,U,n),ju(P,U,n+3),ju(P,O,z),Lg(P,S,A,T,e),ju(P,U,n+6),ju(P,F,z),z+=3};let H=0;for(let e=n;e<k;e+=n)V(e,H++);V(k,H++),t.extendLine?(ju(P,O,3*(L-2)),ju(C,F,3*(L-2)),ju(C,O,3*(L-1)),ju(y,F,3*(L-1)),ju(C,B,18),ju(P,B,21),ju(i?g:_,B,24),ju(i?g:_,B,27),ju(P,B,30),ju(S,B,33)):(ju(P,O,z),ju(S,F,z),z+=3),h+=3*L,f+=9*D,p+=N,I+=1}const k=I,D=new Float32Array(h),L=new Float32Array(h),N=new Float32Array(f),O=new Float32Array(p);let F=0,U=0,B=0;for(let e=0;e<k;e++){const t=l[e],n=c[e],r=u[e],i=d[e];Su(t,D,0,F,t.length),Su(n,L,0,F,n.length),Su(r,N,0,U,r.length),Su(i,O,0,B,i.length),F+=t.length,U+=r.length,B+=i.length}return{labelPosition:s.subarray(0,3*k),labelText:o.slice(0,k),linePosition1:D,linePosition2:L,planePosition:O,sectorPosition:N}}(Dg(e,this.atomQuad),{extendLine:this.extendLine}),n=this.n=t.labelText.length,r=new ai(this.labelColor);this.textBuffer=new $g({position:t.labelPosition,size:yu(n,this.labelSize),color:vu(n,r.r,r.g,r.b),text:t.labelText},this.getLabelBufferParams());const i=new ai(this.colorValue);this.lineLength=t.linePosition1.length/3;const a=vu(this.lineLength,i.r,i.g,i.b);return this.lineBuffer=new Wg(ad({position1:t.linePosition1,position2:t.linePosition2,color:a,color2:a}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=t.planePosition.length/3,this.planeBuffer=new Ef({position:t.planePosition,color:vu(this.planeLength,i.r,i.g,i.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new Ef({position:t.sectorPosition,color:vu(this.sectorLength,i.r,i.g,i.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},r={},i={};if(e.color){const e=new ai(this.colorValue);Object.assign(n,{color:vu(this.lineLength,e.r,e.g,e.b),color2:vu(this.lineLength,e.r,e.g,e.b)}),Object.assign(r,{color:vu(this.planeLength,e.r,e.g,e.b)}),Object.assign(i,{color:vu(this.sectorLength,e.r,e.g,e.b)})}this.lineBuffer.setAttributes(n),this.planeBuffer.setAttributes(r),this.sectorBuffer.setAttributes(i)}setParameters(e){return super.setParameters(e,{},!1),!e||void 0===e.lineVisible&&void 0===e.sectorVisible&&void 0===e.planeVisible||this.setVisibility(this.visible),e&&e.lineOpacity&&this.lineBuffer.setParameters({opacity:e.lineOpacity}),e&&void 0!==e.opacity&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.lineBuffer.setParameters({linewidth:e.linewidth}),this}setVisibility(e,t){return super.setVisibility(e,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}),Jc.add("dihedral-histogram",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(n)}init(e){const t=e||{},n=u_({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},t);Object.assign(this,n);const r=u_({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},t);Object.assign(this,r),this.histogramsData.forEach((e=>{const t=u_(n,e);Object.assign(e,t)})),t.side=Ol(t.side,"double"),t.opacity=Ol(t.opacity,.5),t.radiusType=Ol(t.radiusType,"size"),t.radiusSize=Ol(t.radiusSize,.15),super.init(t)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(e){if(!e.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach((t=>t.atomPositions=Dg(e,[t.atomQuad])));const t=this.scaleBinToSectorArea?function(e){return Math.sqrt(e)}:function(e){return e};function n(e){const t=e.map((e=>e.length)),n=new Float32Array(Cu(t));let r=0;for(let t=0;t<e.length;t++)n.set(e[t],r),r+=e[t].length;return n}function r(e,t){return new Wg({position1:n(e.map((e=>e.startPoints))),position2:n(e.map((e=>e.endPoints))),color:n(e.map((e=>e.startColors))),color2:n(e.map((e=>e.endColors)))},t)}function i(e,t){return new Ef({position:n(e.map((e=>e.triangles))),color:n(e.map((e=>e.triangleColors)))},t)}this.histogramsData.forEach((e=>e.histogram360Scaled=e.histogram360.map(t)));const a=[];for(let e=0;e<this.histogramsData.length;e++){let t,n=this.histogramsData[e];n.histogram360.length>=3&&(t=h_(n)),void 0!==t&&a.push(t)}return this.frontHistogramBinBordersBuffer=r(a.map((e=>e.frontHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=r(a.map((e=>e.backHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=r(a.map((e=>e.adjacentBondArrows)),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=r(a.map((e=>e.distantBondArrows)),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=i(a.map((e=>e.opaqueMiddleDisc)),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=i(a.map((e=>e.frontHistogram)),this.getHistogramBufferParameters()),this.backHistogramBuffer=i(a.map((e=>e.backHistogram)),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(e){return super.setParameters(e,{},!1),e&&void 0!==e.histogramBinBorderVisible&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),t||this.viewer.requestRender(),this}}),Jc.add("distance",class extends kg{constructor(e,t,n){super(e,t,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.linewidth=Ol(t.linewidth,5),t.radiusType=Ol(t.radiusType,"size"),t.radiusSize=Ol(t.radiusSize,.2),this.labelUnit=Ol(t.labelUnit,""),this.useCylinder=Ol(t.useCylinder,!1),this.atomPair=Ol(t.atomPair,[]),super.init(t)}getDistanceData(e,t){let n=t.length;const r=new Array(n);let i=new Float32Array(3*n);const a=new Nc,s=new Nc,o=new qf,l=e.getAtomProxy(),c=e.getAtomProxy();let u=0;const d=e.getAtomSet();t.forEach(((t,n)=>{let h=t[0],f=t[1];if("number"==typeof h&&Number.isInteger(h)&&"number"==typeof f&&Number.isInteger(f)){if(!d.get(h)||!d.get(f))return void(u+=1);l.index=h,c.index=f}else{a.setString(h),s.setString(f);var p=e.getAtomIndices(a),m=e.getAtomIndices(s);if(!p.length||!m.length)return void(u+=1);l.index=p[0],c.index=m[0]}o.addBond(l,c,1),n-=u;var g=l.distanceTo(c);switch(this.labelUnit){case"angstrom":r[n]=g.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":r[n]=(g/10).toFixed(2)+" nm";break;default:r[n]=g.toFixed(2)}var _=3*n;i[_+0]=(l.x+c.x)/2,i[_+1]=(l.y+c.y)/2,i[_+2]=(l.z+c.z)/2})),u>0&&(n-=u,i=i.subarray(0,3*n));var h=new Ad(o.count,!0);return{text:r,position:i,bondSet:h,bondStore:o}}getBondData(e,t,n){const r=e.getBondData(this.getBondParams(t,n));return r.picking&&(r.picking=new Bh(r.picking.array,r.picking.structure,n.bondStore)),r}createData(e){if(!e.atomCount||!this.atomPair.length)return;const t=this.atomPair.length,n=new ai(this.labelColor),r=this.getDistanceData(e,this.atomPair);this.textBuffer=new $g({position:r.position,size:yu(t,this.labelSize),color:vu(t,n.r,n.g,n.b),text:r.text},this.getLabelBufferParams());const i={bondSet:r.bondSet,bondStore:r.bondStore},a=this.getBondData(e,{position:!0,color:!0,picking:!0,radius:this.useCylinder},i);return this.useCylinder?this.distanceBuffer=new t_(a,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new Wg(id(a),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:r.bondSet,bondStore:r.bondStore,position:r.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(e,t){super.updateData(e,t);const n={bondSet:t.bondSet,bondStore:t.bondStore},r=this.getBondData(t.sview,e,n),i={};e&&!e.color||Object.assign(i,{color:r.color,color2:r.color2}),e&&!e.radius||Object.assign(i,{radius:r.radius}),this.distanceBuffer.setAttributes(i)}setParameters(e){return super.setParameters(e,{},!1),this.useCylinder||(e&&e.lineOpacity&&this.distanceBuffer.setParameters({opacity:e.lineOpacity}),e&&void 0!==e.opacity&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.distanceBuffer.setParameters({linewidth:e.linewidth})),this}});const p_=Object.assign({scale:1,color:"grey"},Sf);class m_ extends Mf{constructor(e,t={}){super({position:new Float32Array(f_(e)),color:new Float32Array(f_(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const n=new ai(this.parameters.color),r=this.geometry.attributes;vu(f_(e)/3,n.r,n.g,n.b,r.color.array),this.setAttributes(e)}get defaultParameters(){return p_}setAttributes(e={}){const t=this.geometry.attributes;let n,r,i;e.position&&e.vector&&(n=e.position,r=e.vector,i=t.position.array,t.position.needsUpdate=!0);const a=this.size/2,s=this.parameters.scale;if(n&&r)for(let e=0;e<a;e++){const t=2*e*3,a=3*e;i[t+0]=n[a+0],i[t+1]=n[a+1],i[t+2]=n[a+2],i[t+3]=n[a+0]+r[a+0]*s,i[t+4]=n[a+1]+r[a+1]*s,i[t+5]=n[a+2]+r[a+2]*s}}}Jc.add("helixorient",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){const t=e||{};t.colorScheme=Ol(t.colorScheme,"sstruc"),t.radiusType=Ol(t.radiusType,"size"),t.radiusSize=Ol(t.radiusSize,.15),t.radiusScale=Ol(t.radiusScale,1),t.useInteriorColor=Ol(t.useInteriorColor,!0),super.init(t)}createData(e){const t=[],n=[];return this.structure.eachPolymer((e=>{if(e.residueCount<4)return;n.push(e);const r=new Qf(e),i=r.getPosition(),a=r.getColor(this.getColorParams()),s=r.getSize(this.getRadiusParams()),o=r.getPicking();t.push(new fm({position:i.center,color:a.color,radius:s.size,picking:o.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new m_({position:i.center,vector:i.axis},this.getBufferParams({color:"skyblue",scale:1})),new m_({position:i.center,vector:i.resdir},this.getBufferParams({color:"lightgreen",scale:1})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){Xc&&Wc.time(this.type+" repr update"),e=e||{};for(let n=0,r=t.polymerList.length;n<r;++n){const r=3*n,i={},a=t.polymerList[n],s=new Qf(a);if(e.position){const e=s.getPosition();Object.assign(i,{position:e.center}),t.bufferList[r+1].setAttributes({position:e.center,vector:e.axis}),t.bufferList[r+2].setAttributes({position:e.center,vector:e.resdir})}t.bufferList[r].setAttributes(i)}Xc&&Wc.timeEnd(this.type+" repr update")}});class g_ extends n_{constructor(e,t,n){super(e,t,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,super.init(t)}}Jc.add("licorice",g_),tu.add("shader/HyperballStickImpostor.vert","\nattribute vec3 mapping;\nattribute float radius;\nattribute float radius2;\nattribute vec3 position1;\nattribute vec3 position2;\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#endif\nuniform float shrink;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewProjectionMatrixInverse;\nvoid main(){\nvRadius = radius;\nvRadius2 = radius2;\nvec4 spaceposition;\nvec3 position_atom1;\nvec3 position_atom2;\nvec4 vertex_position;\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nvColor1 = color;\nvColor2 = color2;\n#endif\nfloat radius1 = radius;\nposition_atom1 = position1;\nposition_atom2 = position2;\nfloat distance = distance( position_atom1, position_atom2 );\nspaceposition.z = mapping.z * distance;\nif (radius1 > radius2) {\nspaceposition.y = mapping.y * 1.5 * radius1;\nspaceposition.x = mapping.x * 1.5 * radius1;\n} else {\nspaceposition.y = mapping.y * 1.5 * radius2;\nspaceposition.x = mapping.x * 1.5 * radius2;\n}\nspaceposition.w = 1.0;\nvec4 e3 = vec4( 1.0 );\nvec3 e1, e1_temp, e2, e2_temp;\ne3.xyz = normalize(position_atom1-position_atom2);\nif (e3.z == 0.0) { e3.z = 0.0000000000001;}\nif ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}\nif ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}\nif ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}\nvec4 focus = vec4( 1.0 );\nfocus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +\n( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));\nfocus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +\n( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));\nfocus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +\n( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));\ne1.x = 1.0;\ne1.y = 1.0;\ne1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\ne1_temp = e1 - focus.xyz;\ne1 = normalize(e1_temp);\ne2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;\ne2 = normalize(e2_temp);\nmat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );\nvertex_position.xyz = R * spaceposition.xyz;\nvertex_position.w = 1.0;\nvertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;\nvertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;\nvertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;\ngl_Position = modelViewProjectionMatrix * vertex_position;\nvec4 i_near, i_far;\nvec4 near = gl_Position;\nnear.z = 0.0 ;\nnear = modelViewProjectionMatrixInverse * near;\ni_near = near;\nvec4 far = gl_Position;\nfar.z = far.w ;\ni_far = modelViewProjectionMatrixInverse * far;\nprime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );\nprime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );\nfloat Rsquare = (radius1*radius1/shrink) - (\n(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +\n(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +\n(position_atom1.z - focus.z)*(position_atom1.z - focus.z)\n);\nfocus.w = Rsquare;\nmatrix_near = mat4( i_near, i_far, focus, e3 );\ngl_Position.z = 1.0;\n}"),tu.add("shader/HyperballStickImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform float shrink;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrixInverseTranspose;\nuniform mat4 projectionMatrix;\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#include common\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool interior = false;\nfloat calcClip( vec4 cameraPos ){\nreturn dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nfloat calcClip( vec3 cameraPos ){\nreturn calcClip( vec4( cameraPos, 1.0 ) );\n}\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nstruct Ray {\nvec3 origin ;\nvec3 direction ;\n};\nbool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){\nfloat a = x3.x;\nfloat b = x3.y;\nfloat c = x3.z;\nfloat d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;\nfloat l = a*M.x+b*M.y+c*M.z+d;\nif (l<0.0) {return true;}\nelse{return false;}\n}\nvec3 isect_surf(Ray r, mat4 matrix_coef){\nvec4 direction = vec4(r.direction, 0.0);\nvec4 origin = vec4(r.origin, 1.0);\nfloat a = dot(direction,(matrix_coef*direction));\nfloat b = dot(origin,(matrix_coef*direction));\nfloat c = dot(origin,(matrix_coef*origin));\nfloat delta =b*b-a*c;\ngl_FragColor.a = 1.0;\nif (delta<0.0){\ndiscard;\n}\nfloat t1 =(-b-sqrt(delta))/a;\nreturn r.origin+t1*r.direction;\n}\nvec3 isect_surf2(Ray r, mat4 matrix_coef){\nvec4 direction = vec4(r.direction, 0.0);\nvec4 origin = vec4(r.origin, 1.0);\nfloat a = dot(direction,(matrix_coef*direction));\nfloat b = dot(origin,(matrix_coef*direction));\nfloat c = dot(origin,(matrix_coef*origin));\nfloat delta =b*b-a*c;\ngl_FragColor.a = 1.0;\nif (delta<0.0){\ndiscard;\n}\nfloat t2 =(-b+sqrt(delta))/a;\nreturn r.origin+t2*r.direction;\n}\nRay primary_ray(vec4 near1, vec4 far1){\nvec3 near=near1.xyz/near1.w;\nvec3 far=far1.xyz/far1.w;\nreturn Ray(near,far-near);\n}\nfloat update_z_buffer(vec3 M, mat4 ModelViewP){\nfloat depth1;\nvec4 Ms=(ModelViewP*vec4(M,1.0));\nreturn depth1=(1.0+Ms.z/Ms.w)/2.0;\n}\nvoid main(){\nfloat radius = max( vRadius, vRadius2 );\nvec4 i_near, i_far, focus;\nvec3 e3, e1, e1_temp, e2;\ni_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);\ni_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);\nfocus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);\ne3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);\ne1.x = 1.0;\ne1.y = 1.0;\ne1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\ne1_temp = e1 - focus.xyz;\ne1 = normalize(e1_temp);\ne2 = normalize(cross(e1,e3));\nvec4 equation = focus;\nfloat shrinkfactor = shrink;\nfloat t1 = -1.0/(1.0-shrinkfactor);\nfloat t2 = 1.0/(shrinkfactor);\nvec4 colonne1, colonne2, colonne3, colonne4;\nmat4 mat;\nvec3 equation1 = vec3(t2,t2,t1);\nfloat A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;\nfloat A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;\nfloat A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;\nfloat A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;\nfloat A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;\nfloat A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;\nfloat A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;\nfloat A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;\nfloat A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;\nfloat A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;\nfloat A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;\nfloat A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;\nfloat A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;\ncolonne1 = vec4(A11,A21,A31,A41);\ncolonne2 = vec4(A21,A22,A32,A42);\ncolonne3 = vec4(A31,A32,A33,A43);\ncolonne4 = vec4(A41,A42,A43,A44);\nmat = mat4(colonne1,colonne2,colonne3,colonne4);\nRay ray = primary_ray(i_near,i_far) ;\nvec3 M;\nM = isect_surf(ray, mat);\nif (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\nvec4 M1 = vec4(M,1.0);\nvec4 M2 = mat*M1;\nvec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\n#ifdef NEAR_CLIP\nif( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){\nM = isect_surf2(ray, mat);\nif( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )\ndiscard;\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );\n}\n}else if( gl_FragDepthEXT <= 0.0 ){\nM = isect_surf2(ray, mat);\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n}\n}\n#else\nif( gl_FragDepthEXT <= 0.0 ){\nM = isect_surf2(ray, mat);\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n}\n}\n#endif\nif (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\nif (gl_FragDepthEXT < 0.0)\ndiscard;\nif (gl_FragDepthEXT > 1.0)\ndiscard;\nfloat distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /\ndistance(prime2.xyz,prime1.xyz);\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;\nvec3 vNormal = _normal;\nvec3 vColor;\nif( distance_ratio>0.5 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\nvec3 normal = normalize( vNormal );\nvec3 nonPerturbedNormal = normal;\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);const __=Object.assign({shrink:.14},Sf);Object.assign({shrink:{uniform:!0}},Af);Object.assign({disableImpostor:!1},Zg,__);const y_=class{constructor(e,t={}){return e.radius=function(e,t){const n=e.length,r=new Float32Array(n);for(let i=0;i<n;i++)r[i]=Math.min(e[i],t[i]);return r}(e.radius,e.radius2),new Jg(e,t)}};Jc.add("hyperball",class extends g_{constructor(e,t,n){super(e,t,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){var t=e||{};t.radiusScale=Ol(t.radiusScale,.2),t.radiusType=Ol(t.radiusType,"vdw"),t.useInteriorColor=Ol(t.useInteriorColor,!0),this.shrink=Ol(t.shrink,.12),super.init(t)}getBondParams(e,t){return e&&!e.radius||(t=Object.assign({radius2:!0},t)),super.getBondParams(e,t)}createData(e){var t=new fm(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*e.bondCount),{bufferList:[t,new y_(e.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams()),r=t.sview.getBondData(this.getBondParams()),i={},a={};if(!e||e.position){Object.assign(i,{position:n.position});var s=r.position1,o=r.position2;Object.assign(a,{position:gu(s,o,this.__center),position1:s,position2:o})}e&&!e.color||(Object.assign(i,{color:n.color}),Object.assign(a,{color:r.color,color2:r.color2})),e&&!e.radius||(Object.assign(i,{radius:n.radius}),Object.assign(a,{radius:r.radius,radius2:r.radius2})),t.bufferList[0].setAttributes(i),t.bufferList[1].setAttributes(a)}});class v_{constructor(e,t={},n=""){this.type=e,this.text=t,this.format=n,this.errorLogged=!1}atomLabel(e){let t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t=`${e.index}`;break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t=`${e.serial}`;break;case"element":t=e.element;break;case"atom":t=`${e.atomname}|${e.index}`;break;case"resname":t=e.resname;break;case"resno":t=`${e.resno}`;break;case"res":t=`${jd[e.resname.toUpperCase()]||e.resname}${e.resno}`;break;case"residue":const n=jd[e.resname.toUpperCase()];t=n&&!e.inscode?`${n}${e.resno}`:`[${e.resname}]${e.resno}${e.inscode}`;break;case"text":t=this.text[e.index];break;case"format":try{t=(0,Nl.sprintf)(this.format,e)}catch(e){this.errorLogged||(this.errorLogged=!0,console.log(e.message))}break;default:t=e.qualifiedName()}return void 0===t?"":t}}function b_(e){const t=e.getAtomSet(),n=e.getBondSet(),r=e.getBondProxy();return n.forEach((function(e){r.index=e,t.clear(r.atomIndex1),t.clear(r.atomIndex2)})),t}function x_(e,t,n,r,i){const a=new(r=r||Int32Array)(e*t*n*(i=i||1));function s(e,r,a){return((e*t+r)*n+a)*i}return{data:a,index:s,set:function(e,t,n,...r){const o=s(e,t,n);for(let e=0;e<i;++e)a[o+e]=r[e]},toArray:function(e,t,n,r=[],o=0){const l=s(e,t,n);for(let e=0;e<i;++e)r[o+e]=a[l+e]},fromArray:function(e,t,n,r,o=0){const l=s(e,t,n);for(let e=0;e<i;++e)a[l+e]=r[o+e]},copy:function(e){a.set(e.data)}}}function w_(e,t,n){var r=mf(t),i=Nu(e);0===e.length&&(i[0].set([0,0,0]),i[1].set([0,0,0]));var a,s,o,l,c,u,d,h,f,p,m,g,_,y,v,b=i[0],x=i[1];function w(e,t,n,i,w){a=t||1.4,s=n||2,g=w||!0;var S=0;for(var A in r)S=Math.max(S,A);var M=gf(b,x,S,s,e?a:0);l=M.dim[0],c=M.dim[1],u=M.dim[2],d=M.matrix,h=M.tran,s=M.scaleFactor,f={},p={},C(e),m=a*s,o=i||a/s,_=new Uint8Array(l*c*u),e&&(y=new Float64Array(l*c*u)),g&&(v=new Int32Array(l*c*u))}var S=1,A=2,M=4,E=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function C(e){var t,n,i,o,l,c,u,d,h,m;for(var g in r)if(t=parseFloat(g),!f[g]){for(c=(u=e?(t+a)*s+.5:t*s+.5)*u,d=Math.floor(u)+1,h=new Int32Array(d*d),m=0,n=0;n<d;++n)for(i=0;i<d;++i)(o=n*n+i*i)>c?h[m]=-1:(l=Math.sqrt(c-o),h[m]=Math.floor(l)),++m;p[g]=d,f[g]=h}}function T(n){var r,i,a,o,d,m,y,b,x,w,A,M,E,C,T,P,I,R,k=3*n,D=n;r=Math.floor(.5+s*(e[k]+h[0])),i=Math.floor(.5+s*(e[k+1]+h[1])),a=Math.floor(.5+s*(e[k+2]+h[2]));var L,N=t[D],O=f[N],F=0,U=c*u,B=p[N];for(w=0;w<B;++w)for(A=0;A<B;++A){if(-1!==(L=O[F]))for(P=-1;P<2;++P)for(I=-1;I<2;++I)for(R=-1;R<2;++R)if(0!==P&&0!==I&&0!==R)for(y=P*w,x=R*A,M=0;M<=L;++M)if(C=i+(b=M*I),T=a+x,!((E=r+y)<0||C<0||T<0||E>=l||C>=c||T>=u)){var z=E*U+C*u+T;if(g)if(_[z]&S){if(_[z]&S){var V=v[z];V!==k&&y*y+b*b+x*x<(o=r+y-Math.floor(.5+s*(e[V]+h[0])))*o+(d=i+b-Math.floor(.5+s*(e[V+1]+h[1])))*d+(m=a+x-Math.floor(.5+s*(e[V+2]+h[2])))*m&&(v[z]=n)}}else _[z]|=S,v[z]=n;else _[z]|=S}F++}}function P(n){var r,i,a,o,d,m,y,b,x,w,S,M,E,C,T,P,I,R,k,D=3*n,L=n,N=0;r=Math.floor(.5+s*(e[D]+h[0])),i=Math.floor(.5+s*(e[D+1]+h[1])),a=Math.floor(.5+s*(e[D+2]+h[2]));var O=t[L],F=c*u;for(E=0,k=p[O];E<k;++E)for(C=0;C<k;++C){if(-1!==f[O][N])for(P=-1;P<2;++P)for(I=-1;I<2;++I)for(R=-1;R<2;++R)if(0!==P&&0!==I&&0!==R)for(y=P*E,x=R*C,T=0;T<=f[O][N];++T)if(S=i+(b=T*I),M=a+x,!((w=r+y)<0||S<0||M<0||w>=l||S>=c||M>=u)){var U=w*F+S*u+M;if(_[U]&A){if(g){var B=v[U];y*y+b*b+x*x<(o=Math.floor(.5+s*(e[B]+h[0])))*o+(d=Math.floor(.5+s*(e[B+1]+h[1])))*d+(m=Math.floor(.5+s*(e[B+2]+h[2])))*m&&(v[U]=n)}}else _[U]|=A,g&&(v[U]=n)}N++}}function I(){var e,t,n,r;console.time("EDTSurface fastdistancemap");var i,a=x_(l,c,u,Uint16Array,3),s=c*u,d=m*m,h=0;for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)_[i=e*s+t*u+n]&=~A,_[i]&S&&_[i]&M&&(a.set(e,t,n,e,t,n),y[i]=0,_[i]|=A,h+=1);var f=new Int32Array(3*h),p=0,b=new Int32Array(3*h),x=0;for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)_[i=e*s+t*u+n]&M&&(f[p]=e,f[p+1]=t,f[p+2]=n,p+=3,_[i]&=~M);do{for(x=R(f,a,p,b),p=0,e=0,r=x;e<r;e+=3)i=s*b[e]+u*b[e+1]+b[e+2],_[i]&=~M,y[i]<=1.0404*d&&(f[p]=b[e],f[p+1]=b[e+1],f[p+2]=b[e+2],p+=3)}while(p>0);var w,E=o*o,C=new Uint16Array(3);for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)_[i=e*s+t*u+n]&=~M,_[i]&S&&(_[i]&A&&!(_[i]&A&&y[i]>=E)||(_[i]|=M,g&&_[i]&A&&(a.toArray(e,t,n,C),w=C[0]*s+C[1]*u+C[2],v[i]=v[w])));console.timeEnd("EDTSurface fastdistancemap")}function R(e,t,n,r){var i,a,s,o,d,h,f,p,m,g,v,b,x=new Uint16Array(3),w=0;if(0===n)return w;var C=-1,T=-1,P=-1,I=c*u;for(f=0,m=n;f<m;f+=3)for(i=e[f],a=e[f+1],s=e[f+2],t.toArray(i,a,s,x),p=0;p<6;++p)C=i+(b=E[p])[0],T=a+b[1],P=s+b[2],C<l&&C>-1&&T<c&&T>-1&&P<u&&P>-1&&(_[v=C*I+u*T+P]&S&&!(_[v]&A)?(t.fromArray(C,T,P,x),g=(o=C-x[0])*o+(d=T-x[1])*d+(h=P-x[2])*h,y[v]=g,_[v]|=A,_[v]|=M,r[w]=C,r[w+1]=T,r[w+2]=P,w+=3):_[v]&S&&_[v]&A&&(g=(o=C-x[0])*o+(d=T-x[1])*d+(h=P-x[2])*h)<y[v]&&(t.fromArray(C,T,P,x),y[v]=g,_[v]&M||(_[v]|=M,r[w]=C,r[w+1]=T,r[w+2]=P,w+=3)));for(f=0,m=n;f<m;f+=3)for(i=e[f],a=e[f+1],s=e[f+2],t.toArray(i,a,s,x),p=6;p<18;p++)C=i+(b=E[p])[0],T=a+b[1],P=s+b[2],C<l&&C>-1&&T<c&&T>-1&&P<u&&P>-1&&(_[v=C*I+u*T+P]&S&&!(_[v]&A)?(t.fromArray(C,T,P,x),g=(o=C-x[0])*o+(d=T-x[1])*d+(h=P-x[2])*h,y[v]=g,_[v]|=A,_[v]|=M,r[w]=C,r[w+1]=T,r[w+2]=P,w+=3):_[v]&S&&_[v]&A&&(g=(o=C-x[0])*o+(d=T-x[1])*d+(h=P-x[2])*h)<y[v]&&(t.fromArray(C,T,P,x),y[v]=g,_[v]&M||(_[v]|=M,r[w]=C,r[w+1]=T,r[w+2]=P,w+=3)));for(f=0,m=n;f<m;f+=3)for(i=e[f],a=e[f+1],s=e[f+2],t.toArray(i,a,s,x),p=18;p<26;p++)C=i+(b=E[p])[0],T=a+b[1],P=s+b[2],C<l&&C>-1&&T<c&&T>-1&&P<u&&P>-1&&(_[v=C*I+u*T+P]&S&&!(_[v]&A)?(t.fromArray(C,T,P,x),g=(o=C-x[0])*o+(d=T-x[1])*d+(h=P-x[2])*h,y[v]=g,_[v]|=A,_[v]|=M,r[w]=C,r[w+1]=T,r[w+2]=P,w+=3):_[v]&S&&_[v]&A&&(g=(o=C-x[0])*o+(d=T-x[1])*d+(h=P-x[2])*h)<y[v]&&(t.fromArray(C,T,P,x),y[v]=g,_[v]&M||(_[v]|=M,r[w]=C,r[w+1]=T,r[w+2]=P,w+=3)));return w}this.getVolume=function(t,r,i,a,s){console.time("EDTSurface.getVolume");var o="vws"!==t;w(o,r,i,a,s),function(t){var n,r;for(console.time("EDTSurface fillvoxels"),n=0,r=_.length;n<r;++n)_[n]=0,t&&(y[n]=-1),g&&(v[n]=-1);for(n=0,r=e.length/3;n<r;++n)T(n);for(n=0,r=_.length;n<r;++n)_[n]&S&&(_[n]|=A);console.timeEnd("EDTSurface fillvoxels")}(o),function(){var e,t,n,r=c*u;for(e=0;e<l;++e)for(t=0;t<u;++t)for(n=0;n<c;++n){var i=e*r+n*u+t;if(_[i]&S)for(var a=0;a<26;){var s=e+E[a][0],o=t+E[a][2],d=n+E[a][1];if(s>-1&&s<l&&d>-1&&d<c&&o>-1&&o<u&&!(_[s*r+d*u+o]&S)){_[i]|=M;break}a++}}}(),"ms"!==t&&"ses"!==t||I(),"ses"===t&&(C(!1),function(){var t,n;for(t=0,n=_.length;t<n;++t)_[t]&=~A;for(t=0,n=e.length/3;t<n;++t)P(t)}()),function(e){var t,n=_.length;if("vws"===e)for(t=0;t<n;++t)_[t]&=~M,_[t]=_[t]&A?1:0;else if("ms"===e)for(t=0;t<n;++t)_[t]&=~A,_[t]&M&&(_[t]|=A),_[t]&=~M,_[t]=_[t]&A?1:0;else if("ses"===e)for(t=0;t<n;++t)_[t]&M&&_[t]&A?_[t]&=~M:_[t]&M&&!(_[t]&A)&&(_[t]|=A),_[t]=_[t]&A?1:0;else if("sas"===e)for(t=0;t<n;++t)_[t]&=~M,_[t]=_[t]&A?1:0}(t);for(var d=0,h=v.length;d<h;++d)v[d]=n[v[d]];return console.timeEnd("EDTSurface.getVolume"),{data:_,nx:u,ny:c,nz:l,atomindex:v}},this.getSurface=function(e,t,n,r,i,a,s){var o=this.getVolume(e,t,n,r,i);return new yf(o.data,o.nx,o.ny,o.nz,o.atomindex).getSurface(1,a,void 0,d,s)}}function S_(e,t,n,r,i,a,s){s=Math.max(.1,s);var o=e.length,l=i[0],c=i[1],u=i[2],d=a[0],h=a[1],f=a[2];function p(e,t){return Math.floor((e-t)/s)}for(var m,g,_,y=p(d,l)+1,v=p(h,c)+1,b=p(f,u)+1,x=y*v*b,w=v*b,S=[],A=0;A<o;A++){var M=(m=e[A],g=t[A],_=n[A],(p(m,l)*v+p(g,c))*b+p(_,u));void 0===S[M]?S[M]=[A]:S[M].push(A)}var E=new Uint32Array(x),C=new Uint16Array(x),T=new Uint32Array(o),P=0,I=0;for(A=0;A<x;A++){var R=E[A]=P,k=S[A];if(void 0!==k)for(var D=0;D<k.length;D++)T[P]=k[D],P++;var L=P-R;C[A]=L,L>I&&(I=L)}return{neighbourListLength:27*I+1,withinRadii:function(i,a,s,o,d){for(var h=0,f=p(i,l),m=p(a,c),g=p(s,u),_=Math.max(0,f-1),x=Math.max(0,m-1),S=Math.max(0,g-1),A=Math.min(y,f+2),M=Math.min(v,m+2),P=Math.min(b,g+2),I=_;I<A;++I)for(var R=I*w,k=x;k<M;++k)for(var D=k*b,L=S;L<P;++L)for(var N=R+D+L,O=E[N],F=O+C[N],U=O;U<F;U++){var B=T[U],z=e[B]-i,V=t[B]-a,H=n[B]-s,$=r[B]+o;z*z+V*V+H*H<=$*$&&(d[h++]=T[U])}d[h]=-1}}}function A_(e,t,n){const r=t.length,i=new Float32Array(r),a=new Float32Array(r),s=new Float32Array(r);for(let t=0;t<r;t++){const n=3*t;i[t]=e[n],a[t]=e[n+1],s[t]=e[n+2]}let o=Nu(e);0===e.length&&(o[0].set([0,0,0]),o[1].set([0,0,0]));const l=o[0],c=o[1];let u,d,h,f,p,m,g,_,y,v,b,x,w,S,A,M,E,C,T=-1;const P=new Float32Array([0,0,0]),I=new Float32Array([0,0,0]),R=new Float32Array([0,0,0]),k=new Float32Array([0,0,0]);let D;function L(e,n,o,P){f=Ol(e,1.4),p=Ol(n,2),m=Ol(o,!0),g=Ol(P,30),u=new Float32Array(r),d=new Float32Array(r);for(let e=0;e<u.length;++e){var I=t[e]+f;u[e]=I,d[e]=I*I}h=0;for(let e=0;e<u.length;++e)u[e]>h&&(h=u[e]);!function(){const e=gf(l,c,h,p,0);p=e.scaleFactor,_=e.dim,y=e.matrix,D=Math.max(5,2+Math.floor(f*p)),v=yu(_[0]*_[1]*_[2],-1001),b=new Int32Array(v.length),x=new Float32Array(_[0]),w=new Float32Array(_[1]),S=new Float32Array(_[2]),N(x,l[0],1/p),N(w,l[1],1/p),N(S,l[2],1/p)}(),function(){var e=0,t=2*Math.PI/g;M=new Float32Array(g),A=new Float32Array(g);for(var n=0;n<g;n++)M[n]=Math.cos(e),A[n]=Math.sin(e),e+=t}(),E=S_(i,a,s,u,l,c,2.01*h),C=new Int32Array(E.neighbourListLength),T=-1}function N(e,t,n){for(let r=0;r<e.length;r++)e[r]=t+n*r}function O(e,t,n,r,i){let a;if(-1!==T){if(a=T,a!==r&&a!==i&&F(a,e,t,n))return a;T=-1}var s=0;for(a=C[s];a>=0;){if(a!==r&&a!==i&&F(a,e,t,n))return T=a,a;a=C[++s]}return T=-1,-1}function F(t,n,r,i){var a=3*t,s=d[t],o=e[a]-n,l=e[a+1]-r,c=e[a+2]-i;return o*o+l*l+c*c<s}function U(e,t){var n=u[e],r=u[t],o=P[0]=i[t]-i[e],c=P[1]=a[t]-a[e],d=P[2]=s[t]-s[e],h=o*o+c*c+d*d,f=Math.sqrt(h),y=n*((n*n+f*f-r*r)/(2*n*f));Ku(P,P),function(e,t){e[0]=e[1]=e[2]=1,0!==t[0]?e[0]=(t[1]+t[2])/-t[0]:0!==t[1]?e[1]=(t[0]+t[2])/-t[1]:0!==t[2]&&(e[2]=(t[0]+t[1])/-t[2])}(R,P),Ku(R,R),zu(k,P,R),Ku(k,k);var E=Math.sqrt(n*n-y*y);Yu(R,R,E),Yu(k,k,E),Yu(P,P,y),I[0]=P[0]+i[e],I[1]=P[1]+a[e],I[2]=P[2]+s[e],T=-1;for(var C=D,L=0;L<g;L++){var N=M[L],F=A[L],U=I[0]+N*R[0]+F*k[0],B=I[1]+N*R[1]+F*k[1],z=I[2]+N*R[2]+F*k[2];if(-1===O(U,B,z,e,t))for(var V=Math.floor(p*(U-l[0])),H=Math.floor(p*(B-l[1])),$=Math.floor(p*(z-l[2])),G=Math.max(0,V-C),j=Math.max(0,H-C),W=Math.max(0,$-C),q=Math.min(_[0],V+C+2),X=Math.min(_[1],H+C+2),Y=Math.min(_[2],$+C+2),K=G;K<q;K++){o=U-x[K];for(var Z=_[1]*_[2]*K,Q=j;Q<X;Q++)for(var J=o*o+(c=B-w[Q])*c,ee=Z+_[2]*Q,te=W;te<Y;te++){h=J+(d=z-S[te])*d;var ne=te+ee,re=v[ne];if(re>0&&h<re*re&&(v[ne]=Math.sqrt(h),m)){const n=o*P[0]+c*P[1]+d*P[2];b[ne]=n<0?t:e}}}}}function B(e,t,o){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),L(e,t,o),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),function(){for(var e=0;e<r;e++){var t=i[e],n=a[e],o=s[e],c=u[e],h=d[e];E.withinRadii(t,n,o,c,C);for(var f=Math.ceil(c*p),g=Math.floor(p*(t-l[0])),y=Math.floor(p*(n-l[1])),A=Math.floor(p*(o-l[2])),M=Math.max(0,g-f),T=Math.max(0,y-f),P=Math.max(0,A-f),I=Math.min(_[0],g+f+2),R=Math.min(_[1],y+f+2),k=Math.min(_[2],A+f+2),D=M;D<I;D++)for(var L=x[D]-t,N=_[1]*_[2]*D,F=T;F<R;F++)for(var U=w[F]-n,B=L*L+U*U,z=N+_[2]*F,V=P;V<k;V++){var H=S[V]-o,$=B+H*H;if($<h){var G=V+z;v[G]<0&&(v[G]=-v[G]);var j=Math.sqrt($),W=c/j,q=L*W,X=U*W,Y=H*W;if(-1===O(q+=t,X+=n,Y+=o,e,-1)){var K=c-j;K<v[G]&&(v[G]=K,m&&(b[G]=e))}}}}}(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),function(){for(var e=0;e<r;e++){E.withinRadii(i[e],a[e],s[e],u[e],C);for(var t=0,n=C[t];n>=0;)e<n&&U(e,n),n=C[++t]}}(),console.timeEnd("AVSurface.projectTorii"),function(){for(var e=0;e<v.length;e++)v[e]<0&&(v[e]=0)}(),function(){for(var e=0;e<b.length;e++)b[e]=n[b[e]]}(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(e,t,n,r,i,a,s){return B(t,n,i),new yf(v,_[2],_[1],_[0],b).getSurface(t,!1,void 0,y,s)}}v_.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"},Jc.add("label",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:v_.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}init(e){const t=e||{};this.labelType=Ol(t.labelType,"res"),this.labelText=Ol(t.labelText,{}),this.labelFormat=Ol(t.labelFormat,""),this.labelGrouping=Ol(t.labelGrouping,"atom"),this.fontFamily=Ol(t.fontFamily,"sans-serif"),this.fontStyle=Ol(t.fontStyle,"normal"),this.fontWeight=Ol(t.fontWeight,"bold"),this.xOffset=Ol(t.xOffset,0),this.yOffset=Ol(t.yOffset,0),this.zOffset=Ol(t.zOffset,.5),this.attachment=Ol(t.attachment,"bottom-left"),this.showBorder=Ol(t.showBorder,!1),this.borderColor=Ol(t.borderColor,"lightgrey"),this.borderWidth=Ol(t.borderWidth,.15),this.showBackground=Ol(t.showBackground,!1),this.backgroundColor=Ol(t.backgroundColor,"lightgrey"),this.backgroundMargin=Ol(t.backgroundMargin,.5),this.backgroundOpacity=Ol(t.backgroundOpacity,1),this.fixedSize=Ol(t.fixedSize,!1),super.init(t)}getTextData(e,t){const n=this.getAtomParams(t),r=new v_(this.labelType,this.labelText,this.labelFormat);let i,a,s,o,l,c,u;if("atom"===this.labelGrouping){const l=e.getAtomData(n);i=l.position,a=l.radius,s=l.color,t&&!t.text||(o=[],e.eachAtom((e=>o.push(r.atomLabel(e)))))}else if("residue"===this.labelGrouping){t&&!t.position||(l=[]),t&&!t.color||(u=[]),t&&!t.radius||(c=[]),t&&!t.text||(o=[]),n.colorParams&&(n.colorParams.structure=e.getStructure());const d=Zc.getScheme(n.colorParams),h=new Vf(n.radiusParams),f=e.getAtomProxy();let p=0;e.eachResidue((e=>{const n=3*p;e.isProtein()||e.isNucleic()?(f.index=e.traceAtomIndex,t&&!t.position||f.positionToArray(l,n)):(f.index=e.atomOffset,t&&!t.position||e.positionToArray(l,n)),t&&!t.color||d.atomColorToArray(f,u,n),t&&!t.radius||(c[p]=h.atomRadius(f)),t&&!t.text||o.push(r.atomLabel(f)),++p})),t&&!t.position||(i=new Float32Array(l)),t&&!t.color||(s=new Float32Array(u)),t&&!t.radius||(a=new Float32Array(c))}return{position:i,size:a,color:s,text:o}}createData(e){return{bufferList:[new $g(this.getTextData(e,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(e,t){t.bufferList[0].setAttributes(this.getTextData(t.sview,e))}getAtomRadius(){return 0}}),Jc.add("line",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.multipleBond=Ol(t.multipleBond,"off"),this.bondSpacing=Ol(t.bondSpacing,1),this.linewidth=Ol(t.linewidth,2),this.lines=Ol(t.lines,!0),this.crosses=Ol(t.crosses,"lone"),this.crossSize=Ol(t.crossSize,.4),super.init(t)}getAtomRadius(e){return.1}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},t),super.getBondParams(e,t)}_crossData(e,t){if(e&&!e.position&&!e.color)return;const n={};"lone"===this.crosses&&Object.assign(n,{atomSet:b_(t)});const r=t.getAtomData(this.getAtomParams(e,n)),i={},a=r.position,s=r.color,o=r.picking,l=(a||s).length,c=3*l;let u=new Float32Array(0),d=new Float32Array(0),h=new Float32Array(0),f=new Float32Array(0),p=0,m=new Float32Array(0);e&&!e.position||(u=i.position1=new Float32Array(c),d=i.position2=new Float32Array(c),p=this.crossSize/2),e&&!e.color||(h=i.color=new Float32Array(c),f=i.color2=new Float32Array(c)),e&&!e.picking||(m=new Float32Array(3*r.picking.array.length));for(let t=0;t<l;t++){const n=3*t,r=3*n;if(!e||e.position){const e=a[n],t=a[n+1],i=a[n+2];u[r]=e-p,u[r+1]=t,u[r+2]=i,d[r]=e+p,d[r+1]=t,d[r+2]=i,u[r+3]=e,u[r+4]=t-p,u[r+5]=i,d[r+3]=e,d[r+4]=t+p,d[r+5]=i,u[r+6]=e,u[r+7]=t,u[r+8]=i-p,d[r+6]=e,d[r+7]=t,d[r+8]=i+p}if(!e||e.color){const e=r+9;for(let t=r;t<e;t+=3)h[t]=f[t]=s[n],h[t+1]=f[t+1]=s[n+1],h[t+2]=f[t+2]=s[n+2]}e&&!e.picking||(m[n]=m[n+1]=m[n+2]=o.array[t])}return e&&!e.picking||(i.picking=new Lh(m,o.structure)),i}createData(e){const t={position:!0,color:!0,picking:!0},n=[];if(this.lines){const r=e.getBondData(this.getBondParams(t)),i=new Wg(r,this.getBufferParams({linewidth:this.linewidth}));n.push(i)}if("off"!==this.crosses){const r=new Wg(this._crossData(t,e),this.getBufferParams({linewidth:this.linewidth}));n.push(r)}return{bufferList:n}}updateData(e,t){let n=0;if(this.lines){const r=t.sview.getBondData(this.getBondParams(e)),i={};e&&!e.position||Object.assign(i,{position1:r.position1,position2:r.position2}),e&&!e.color||Object.assign(i,{color:r.color,color2:r.color2}),t.bufferList[n++].setAttributes(i)}if("off"!==this.crosses){const r=this._crossData(e,t.sview),i={};e&&!e.position||Object.assign(i,{position1:r.position1,position2:r.position2}),e&&!e.color||Object.assign(i,{color:r.color,color2:r.color2}),t.bufferList[n++].setAttributes(i)}}setParameters(e){var t={};return e&&(e.bondSpacing||e.crossSize)&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}),Object.assign(w_,{__deps:[gf,mf,yf,Nu,x_]}),Object.assign(A_,{__deps:[gf,yf,yu,Nu,Yu,zu,Ku,S_,Ol]}),Kc.add("molsurf",(function(e,t){const n=e.data.args,r=e.data.params;if(n&&r){const e=new("av"===r.type?A_:w_)(n.coordList,n.radiusList,n.indexList).getSurface(r.type,r.probeRadius,r.scaleFactor,r.cutoff,!0,r.smooth,r.contour),i=[e.position.buffer,e.index.buffer];e.normal&&i.push(e.normal.buffer),e.atomindex&&i.push(e.atomindex.buffer),t({sd:e,p:r},i)}}),[w_,A_]);class M_{constructor(e){this.structure=e}_getAtomData(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:Ol(e.radiusParams,{type:"vdw",scale:1})})}_makeSurface(e,t){var n=new _f(t.name,"",e);return n.info.type=t.type,n.info.probeRadius=t.probeRadius,n.info.scaleFactor=t.scaleFactor,n.info.smooth=t.smooth,n.info.cutoff=t.cutoff,n}getSurface(e){const t=e||{},n=this._getAtomData(e),r=n.position,i=n.radius,a=n.index,s=new("av"===t.type?A_:w_)(r,i,a).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(s,t)}getSurfaceWorker(e,t){const n=Object.assign({},e);if(window.hasOwnProperty("Worker")){void 0===this.worker&&(this.worker=new Ru("molsurf"));const r=this._getAtomData(e),i=r.position,a=r.radius,s=r.index,o={args:{coordList:i,radiusList:a,indexList:s},params:n},l=[i.buffer,a.buffer,s.buffer];this.worker.post(o,l,(e=>{t(this._makeSurface(e.data.sd,n))}),(e=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",e),this.worker.terminate(),this.worker=void 0;const r=this.getSurface(n);t(r)}))}else{const e=this.getSurface(n);t(e)}}dispose(){this.worker&&this.worker.terminate()}}Jc.add("surface",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add((()=>{this.__forceNewMolsurf=!0})),this.toBePrepared=!0,this.init(n)}init(e){const t=e||{};t.colorScheme=Ol(t.colorScheme,"uniform"),t.colorValue=Ol(t.colorValue,14540253),t.disablePicking=Ol(t.disablePicking,!0),this.surfaceType=Ol(t.surfaceType,"ms"),this.probeRadius=Ol(t.probeRadius,1.4),this.smooth=Ol(t.smooth,2),this.scaleFactor=Ol(t.scaleFactor,2),this.cutoff=Ol(t.cutoff,0),this.contour=Ol(t.contour,!1),this.background=Ol(t.background,!1),this.opaqueBack=Ol(t.opaqueBack,!0),this.filterSele=Ol(t.filterSele,""),this.colorVolume=Ol(t.colorVolume,void 0),this.useWorker=Ol(t.useWorker,!0),super.init(e)}prepareData(e,t,n){let r=this.__infoList[t];if(r||(r={},this.__infoList[t]=r),r.molsurf&&r.sele===e.selection.string)n(t);else{if(this.filterSele){const r=e.structure.getView(new Nc(this.filterSele)),i=r.boundingBox.getSize(new Vn),a=Math.max(i.x,i.y,i.z),s=e.getAtomSetWithinPoint(r.center,a/2+6);if(0===(e=e.getView(new Nc(e.getAtomSetWithinSelection(s,3).toSeleString()))).atomCount)return void n(t)}r.sele=e.selection.string,r.molsurf=new M_(e);const i=this.getSurfaceParams(),a=e=>{r.surface=e,n(t)};this.useWorker?r.molsurf.getSurfaceWorker(i,a):a(r.molsurf.getSurface(i))}}prepare(e){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach((e=>{e&&e.molsurf&&e.molsurf.dispose()})),this.__infoList.length=0),0===this.structureView.atomCount)return void e();const t=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,e()},n="default"===this.assembly?this.defaultAssembly:this.assembly,r=this.structure.biomolDict[n];r?r.partList.forEach(((e,n)=>{const i=e.getView(this.structureView);this.prepareData(i,n,(e=>{e===r.partList.length-1&&t()}))})):this.prepareData(this.structureView,0,t)}createData(e,t){const n=this.__infoList[t],r=n.surface;if(!r)return;const i={position:r.getPosition(),color:r.getColor(this.getColorParams()),index:r.getFilteredIndex(this.filterSele,e)},a=[];if(r.contour){const e=new Rf(i,this.getBufferParams({wireframe:!1}));a.push(e)}else{Object.assign(i,{normal:r.getNormal(),picking:r.getPicking(e.getStructure())});const t=new Cf(i,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if("double"==this.getBufferParams().side){const e=new If(t);a.push(e)}else a.push(t)}return{bufferList:a,info:n}}updateData(e,t){const n={};if(e.position||e.radius)return this.__forceNewMolsurf=!0,void this.build();e.color&&(n.color=t.info.surface.getColor(this.getColorParams())),e.index&&(n.index=t.info.surface.getFilteredIndex(this.filterSele,t.sview)),t.bufferList[0].setAttributes(n)}setParameters(e,t={},n){return e&&e.filterSele&&(t.index=!0),e&&void 0!==e.colorVolume&&(t.color=!0),e&&e.wireframe&&(e.contour||void 0===e.contour&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),this}getSurfaceParams(e={}){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},e)}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach((e=>{e&&e.molsurf&&e.molsurf.dispose()})),this.__infoList.length=0,super.dispose()}}),Jc.add("point",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.pointSize=Ol(t.pointSize,1),this.sizeAttenuation=Ol(t.sizeAttenuation,!0),this.sortParticles=Ol(t.sortParticles,!1),this.useTexture=Ol(t.useTexture,!1),this.alphaTest=Ol(t.alphaTest,.5),this.forceTransparent=Ol(t.forceTransparent,!1),this.edgeBleach=Ol(t.edgeBleach,0),super.init(t)}createData(e){var t=e.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new _m(t,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),r={};e&&!e.position||Object.assign(r,{position:n.position}),e&&!e.color||Object.assign(r,{color:n.color}),t.bufferList[0].setAttributes(r)}getAtomRadius(){return.1}}),tu.add("shader/Ribbon.vert","#define STANDARD\nuniform float clipNear;\nuniform vec3 clipCenter;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nattribute vec3 dir;\nattribute float size;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#endif\n#include common\nvoid main(void){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#include beginnormal_vertex\n#include defaultnormal_vertex\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#endif\n#include begin_vertex\ntransformed += normalize( dir ) * size;\n#include project_vertex\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}");const E_=new Uint16Array([0,1,2,1,3,2]);function C_(e){return 4*(e.position.length/3-1)*3}class T_ extends Ef{constructor(e,t={}){super({position:new Float32Array(C_(e)),color:new Float32Array(C_(e)),index:Gl(C_(e),C_(e)/3),normal:new Float32Array(C_(e)),picking:e.picking},t),this.vertexShader="Ribbon.vert";const n=e.position.length/3-1,r=4*n,i=3*r;this.addAttributes({dir:{type:"v3",value:new Float32Array(i)}}),this.addAttributes({size:{type:"f",value:new Float32Array(r)}}),e.primitiveId=bu(n),this.setAttributes(e),this.makeIndex()}setAttributes(e={}){const t=this.size/4,n=this.geometry.attributes;let r,i,a,s,o,l,c,u,d,h,f,p,m,g,_,y,v,b,x;e.position&&(r=e.position,c=n.position.array,n.position.needsUpdate=!0),e.normal&&(i=e.normal,u=n.normal.array,n.normal.needsUpdate=!0),e.size&&(a=e.size,d=n.size.array,n.size.needsUpdate=!0),e.dir&&(s=e.dir,h=n.dir.array,n.dir.needsUpdate=!0),e.color&&(o=e.color,f=n.color.array,n.color.needsUpdate=!0),e.primitiveId&&(l=e.primitiveId,p=n.primitiveId.array,n.primitiveId.needsUpdate=!0);let w=a?a[0]:null;for(m=0;m<t;++m){for(b=3*m,_=3*m*4,v=4*m,r&&(c[_]=c[_+3]=r[b],c[_+1]=c[_+4]=r[b+1],c[_+2]=c[_+5]=r[b+2],c[_+6]=c[_+9]=r[b+3],c[_+7]=c[_+10]=r[b+4],c[_+8]=c[_+11]=r[b+5]),i&&(u[_]=u[_+3]=-i[b],u[_+1]=u[_+4]=-i[b+1],u[_+2]=u[_+5]=-i[b+2],u[_+6]=u[_+9]=-i[b+3],u[_+7]=u[_+10]=-i[b+4],u[_+8]=u[_+11]=-i[b+5]),g=0;g<4;++g)y=_+3*g,o&&(f[y]=o[b],f[y+1]=o[b+1],f[y+2]=o[b+2]),l&&(p[v+g]=l[m]);a&&(x=a[m],w!==a[m]?(d[v]=w,d[v+1]=w,d[v+2]=x,d[v+3]=x):(d[v]=x,d[v+1]=x,d[v+2]=x,d[v+3]=x),w=x),s&&(h[_]=s[b],h[_+1]=s[b+1],h[_+2]=s[b+2],h[_+3]=-s[b],h[_+4]=-s[b+1],h[_+5]=-s[b+2],h[_+6]=s[b+3],h[_+7]=s[b+4],h[_+8]=s[b+5],h[_+9]=-s[b+3],h[_+10]=-s[b+4],h[_+11]=-s[b+5])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void Wc.error("Index is null");const t=e.array,n=t.length/4/3;for(let e=0;e<n;++e){const n=6*e,r=4*e;t.set(E_,n);for(let e=0;e<6;++e)t[n+e]+=r}}}function P_(e){return 3*(e.position.length/3-1)*2}Jc.add("ribbon",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=Ol(t.colorScheme,"chainname"),t.colorScale=Ol(t.colorScale,"RdYlBu"),t.radiusType=Ol(t.radiusType,"sstruc"),t.radiusScale=Ol(t.radiusScale,4),"low"===t.quality?this.subdiv=3:"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=Ol(t.subdiv,6),this.tension=Ol(t.tension,NaN),this.smoothSheet=Ol(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){var t=[],n=[];return this.structure.eachPolymer((e=>{if(!(e.residueCount<4)){n.push(e);var r=new i_(e,this.getSplineParams()),i=r.getSubdividedPosition(),a=r.getSubdividedOrientation(),s=r.getSubdividedColor(this.getColorParams()),o=r.getSubdividedPicking(),l=r.getSubdividedSize(this.getRadiusParams());t.push(new T_({position:i.position,normal:a.binormal,dir:a.normal,color:s.color,size:l.size,picking:o.picking},this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,r=t.polymerList.length;for(n=0;n<r;++n){var i={},a=new i_(t.polymerList[n],this.getSplineParams());if(e.position){var s=a.getSubdividedPosition(),o=a.getSubdividedOrientation();Object.assign(i,{position:s.position,normal:o.binormal,dir:o.normal})}if(e.radius||e.scale){var l=a.getSubdividedSize(this.getRadiusParams());Object.assign(i,{size:l.size})}if(e.color){var c=a.getSubdividedColor(this.getColorParams());Object.assign(i,{color:c.color})}t.bufferList[n].setAttributes(i)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}),Jc.add("rocket",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){let t=e||{};t.colorScheme=Ol(t.colorScheme,"sstruc"),t.radiusSize=Ol(t.radiusSize,1.5),t.radiusScale=Ol(t.radiusScale,1),t.openEnded=Ol(t.openEnded,!1),t.useInteriorColor=Ol(t.useInteriorColor,!0),this.localAngle=Ol(t.localAngle,30),this.centerDist=Ol(t.centerDist,2.5),this.ssBorder=Ol(t.ssBorder,!1),super.init(t)}createData(e){let t=0;const n=[],r=[];this.structure.eachPolymer((e=>{if(e.residueCount<4||e.isNucleic())return;const i=new Jf(e),a=i.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t+=a.size.length,n.push(a),r.push(i)}),e.getSelection());const i={begin:new Float32Array(3*t),end:new Float32Array(3*t),size:new Float32Array(t),color:new Float32Array(3*t),picking:{}};let a=new Float32Array(t),s=0;return n.forEach((function(e){i.begin.set(e.begin,3*s),i.end.set(e.end,3*s),i.size.set(e.size,s),i.color.set(e.color,3*s),a.set(e.picking.array,s),s+=e.size.length})),t&&(i.picking=new Lh(a,e.getStructure())),{bufferList:[new t_({position1:i.begin,position2:i.end,color:i.color,color2:i.color,radius:i.size,picking:i.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:n,helixbundleList:r,axisData:i}}updateData(e,t){if((e=e||{}).position)this.build();else{var n={};if(e.color||e.radius){var r=0;t.helixbundleList.forEach((n=>{var i=n.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e.color&&t.axisData.color.set(i.color,3*r),(e.radius||e.scale)&&t.axisData.size.set(i.size,r),r+=i.size.length})),e.color&&Object.assign(n,{color:t.axisData.color,color2:t.axisData.color}),(e.radius||e.scale)&&Object.assign(n,{radius:t.axisData.size})}t.bufferList[0].setAttributes(n)}}}),Jc.add("rope",class extends c_{constructor(e,t,n){super(e,t,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(e){var t=e||{};t.aspectRatio=1,t.tension=Ol(t.tension,.5),t.radiusScale=Ol(t.radiusScale,5),t.smoothSheet=!1,this.smooth=Ol(t.smooth,2),super.init(t)}getSpline(e){var t=new Qf(e);return new i_(e,this.getSplineParams({directional:!1,positionIterator:t.getCenterIterator(this.smooth)}))}}),Jc.add("spacefill",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.useInteriorColor=Ol(t.useInteriorColor,!0),super.init(t)}createData(e){return{bufferList:[new fm(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),r={};e&&!e.position||Object.assign(r,{position:n.position}),e&&!e.color||Object.assign(r,{color:n.color}),e&&!e.radius||Object.assign(r,{radius:n.radius}),t.bufferList[0].setAttributes(r)}});class I_ extends Mf{constructor(e,t={}){super({position:new Float32Array(P_(e)),color:new Float32Array(P_(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(e)}setAttributes(e){let t,n,r,i;const a=this.geometry.attributes;if(e.position&&(t=e.position,r=a.position.array,a.position.needsUpdate=!0),e.color&&(n=e.color,i=a.color.array,a.color.needsUpdate=!0),!t&&!n)return void Wc.warn("TraceBuffer.prototype.setAttributes no data");let s,o;const l=this.size-1;for(let e=0;e<l;++e)s=3*e,o=3*e*2,t&&(r[o]=t[s],r[o+1]=t[s+1],r[o+2]=t[s+2],r[o+3]=t[s+3],r[o+4]=t[s+4],r[o+5]=t[s+5]),n&&(i[o]=n[s],i[o+1]=n[s+1],i[o+2]=n[s+2],i[o+3]=n[s+3],i[o+4]=n[s+4],i[o+5]=n[s+5])}}Jc.add("trace",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=Ol(t.colorScheme,"chainname"),t.colorScale=Ol(t.colorScale,"RdYlBu"),"low"===t.quality?this.subdiv=3:"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=Ol(t.subdiv,6),this.tension=Ol(t.tension,NaN),this.smoothSheet=Ol(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?.1:0}createData(e){var t=[],n=[];return this.structure.eachPolymer((e=>{if(!(e.residueCount<4)){n.push(e);var r=new i_(e,this.getSplineParams()),i=r.getSubdividedPosition(),a=r.getSubdividedColor(this.getColorParams());t.push(new I_(Object.assign({},i,a),this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,r=t.polymerList.length;for(n=0;n<r;++n){var i={},a=new i_(t.polymerList[n],this.getSplineParams());if(e.position){var s=a.getSubdividedPosition();Object.assign(i,{position:s.position})}if(e.color){var o=a.getSubdividedColor(this.getColorParams());Object.assign(i,{color:o.color})}t.bufferList[n].setAttributes(i)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}),Jc.add("tube",class extends c_{constructor(e,t,n){super(e,t,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,t.radiusScale=Ol(t.radiusScale,2),"low"===t.quality&&(this.radialSegments=5),super.init(t)}getSplineParams(){return super.getSplineParams({directional:!1})}}),Jc.add("unitcell",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};let n=.5;this.structure.unitcell&&(n=Math.cbrt(this.structure.unitcell.volume)/200),t.radiusSize=Ol(t.radiusSize,n),t.colorValue=Ol(t.colorValue,"orange"),t.useInteriorColor=Ol(t.useInteriorColor,!0),super.init(t)}getUnitcellData(e){return e.unitcell.getData(e)}create(){const e=this.structureView.getStructure();if(!e.unitcell)return;const t=this.getUnitcellData(e);this.sphereBuffer=new fm(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new t_(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=t.sview.getStructure();if(!n.unitcell)return;const r=this.getUnitcellData(n),i={},a={};e&&!e.position||(Object.assign(i,{position:r.vertex.position}),Object.assign(a,{position1:r.edge.position1,position2:r.edge.position2})),e&&!e.color||(Object.assign(i,{color:r.vertex.color}),Object.assign(a,{color:r.edge.color,color2:r.edge.color2})),e&&!e.radius||(Object.assign(i,{radius:r.vertex.radius}),Object.assign(a,{radius:r.edge.radius})),this.sphereBuffer.setAttributes(i),this.cylinderBuffer.setAttributes(a)}}),Jc.add("validation",class extends Rg{constructor(e,t,n){super(e,t,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}init(e){const t=e||{};t.colorValue=Ol(t.colorValue,"#f0027f"),t.useInteriorColor=Ol(t.useInteriorColor,!0),super.init(t)}createData(e){if(!e.validation)return;const t=e.validation.getClashData({structure:e,color:this.colorValue});return{bufferList:[new t_(t,this.getBufferParams({openEnded:!1}))]}}});const R_=new Vn,k_=new Vn,D_=new Vn,L_=new Vn(0,1,0),N_=Object.assign({radialSegments:60,openEnded:!1},Sf);class O_ extends am{constructor(e,t={}){super({position:new Float32Array(e.position1.length),color:e.color,picking:e.picking},t,function(e={}){const t=new ul(1,1,Ol(e.radialSegments,60),1,Ol(e.openEnded,!1));return t.applyMatrix4((new _r).makeRotationX(-Math.PI/2)),t}(t)),this.updateNormals=!0,this._position=new Float32Array(e.position1.length),this.setAttributes(e,!0)}get defaultParameters(){return N_}applyPositionTransform(e,t,n){k_.fromArray(this._position1,n),D_.fromArray(this._position2,n),e.lookAt(k_,D_,L_);const r=this._radius[t];R_.set(r,r,k_.distanceTo(D_)),e.scale(R_)}setAttributes(e={},t){e.position1&&e.position2&&(gu(e.position1,e.position2,this._position),this._position1=e.position1,this._position2=e.position2,e.position=this._position),e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}iu.add("cone",O_);class F_{constructor(e=[]){this.geometryList=e}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new Gn,this.geometryList.forEach((e=>{e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox)}))}}const U_=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},Sf);iu.add("arrow",class{constructor(e,t={}){this.group=new Oo,this.wireframeGroup=new Oo,this.pickingGroup=new Oo,this.visible=!0,this.parameters=Fl(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);const n=this.makeAttributes(e),r={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new t_(n.cylinder,r),this.coneBuffer=new O_(n.cone,r),this.geometry=new F_([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=Ol(t.matrix,new _r),this.picking=e.picking}get defaultParameters(){return U_}set matrix(e){Mf.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(e={}){const t=this.splitPosition,n=this.cylinderRadius,r=this.parameters.aspectRatio;let i,a;const s={},o={};if(e.radius){for(i=0,a=n.length;i<a;++i)n[i]=e.radius[i]/r;s.radius=n,o.radius=e.radius}if(e.position1&&e.position2){const l=new Vn,c=new Vn,u=new Vn,d=new Vn;for(i=0,a=t.length;i<a;i+=3){l.fromArray(e.position1,i),c.fromArray(e.position2,i),u.subVectors(l,c);const a=u.length(),s=n[i/3]*r*2,o=Math.min(a,s);u.setLength(o),d.copy(c).add(u),d.toArray(t,i)}s.position1=e.position1,s.position2=t,o.position1=t,o.position2=e.position2}return e.color&&(s.color=e.color,s.color2=e.color,o.color=e.color),{cylinder:s,cone:o}}getMesh(){return(new Oo).add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return(new Oo).add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return(new Oo).add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(e={}){const t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)}setParameters(e={}){(e=Object.assign({},e))&&void 0!==e.matrix&&(this.matrix=e.matrix),delete e.matrix,e&&void 0!==e.wireframe&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)}setVisibility(e){Mf.prototype.setVisibility.call(this,e)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}});const B_=new Vn,z_=new Vn,V_=new Vn,H_=new Vn(0,0,0);iu.add("box",class extends am{constructor(e,t={}){super(e,t,new $i(1,1,1)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){z_.fromArray(this._heightAxis,n),V_.fromArray(this._depthAxis,n),e.lookAt(H_,z_,V_),B_.set(this._size[t],V_.length(),z_.length()),e.scale(B_)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}});const $_=new Vn,G_=new Vn,j_=new Vn,W_=new Vn(0,0,0),q_=Object.assign({sphereDetail:2},Sf);iu.add("ellipsoid",class extends am{constructor(e,t={}){super(e,t,new hl(1,Ol(t.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return q_}applyPositionTransform(e,t,n){G_.fromArray(this._majorAxis,n),j_.fromArray(this._minorAxis,n),e.lookAt(W_,G_,j_),$_.set(this._radius[t],j_.length(),G_.length()),e.scale($_)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}});const X_=new Vn,Y_=new Vn,K_=new Vn,Z_=new Vn(0,0,0);iu.add("octahedron",class extends am{constructor(e,t={}){super(e,t,new fl(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){Y_.fromArray(this._heightAxis,n),K_.fromArray(this._depthAxis,n),e.lookAt(Z_,Y_,K_),X_.set(this._size[t],K_.length(),Y_.length()),e.scale(X_)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}});const Q_=new Vn,J_=new Vn,ey=new Vn,ty=new Vn(0,0,0);iu.add("tetrahedron",class extends am{constructor(e,t={}){super(e,t,new pl(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){J_.fromArray(this._heightAxis,n),ey.fromArray(this._depthAxis,n),e.lookAt(ty,J_,ey),Q_.set(this._size[t],ey.length(),J_.length()),e.scale(Q_)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}});const ny=new Vn,ry=new Vn,iy=new Vn,ay=new Vn(0,0,0),sy=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},Sf);function oy(e,t){return{start:t&&void 0!==t.start?Math.max(Math.min(t.start,e-1),0):0,end:t&&void 0!==t.end?Math.min(t.end,e):e}}function ly(e,t){const n=t&&void 0!==t.array?t.array:Array,{start:r,end:i}=oy(e,t);return{array:new n(i-r),start:r,end:i}}function cy(e,t,n){const{array:r,start:i}=ly(e,n);return function(e,t,n){for(let r=0,i=t.length;r<i;r++)t[r]=e(n+r);return t}(t,r,i)}function uy(e){return!!e.buffer&&"number"==typeof e.byteLength&&"number"==typeof e.BYTES_PER_ELEMENT}function dy(e,t){const{constructor:n,buffer:r,length:i,byteOffset:a,BYTES_PER_ELEMENT:s}=e,{start:o,end:l}=oy(i,t);return 0===o&&l===i?e:new n(r,a+s*o,Math.min(i,l-o))}iu.add("torus",class extends am{constructor(e,t={}){super(e,t,new ml(1,Ol(t.radiusRatio,.2),Ol(t.radialSegments,16),Ol(t.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return sy}applyPositionTransform(e,t,n){ry.fromArray(this._majorAxis,n),iy.fromArray(this._minorAxis,n),e.lookAt(ay,ry,iy);const r=this._radius[t];ny.set(r,r,r),e.scale(ny)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}});const hy=1e-6;function fy(e,t,n){return Math.abs(e-t)<=n}function py(e,t,n){return Math.max(t,Math.min(n,e))}function my(e,t,n,r,i,a){const s=(n-e)*a,o=(r-t)*a,l=i*i;return(2*t-2*n+s+o)*(i*l)+(-3*t+3*n-2*s-o)*l+s*i+t}function gy(e,t,n,r){const i=1-r;return i*i*e+2*i*r*t+r*r*n}const _y=isFinite;function yy(){return yy.zero()}!function(e){function t(){const e=[.1,0,0];return e[0]=0,e}function n(e,n,r){const i=t();return i[0]=e,i[1]=n,i[2]=r,i}function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function i(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function a(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function s(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function o(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function l(e){const t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function c(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function u(e,t){const n=t[0],r=t[1],i=t[2];let a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function d(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function h(e,t,n){const r=t[0],i=t[1],a=t[2],s=n[0],o=n[1],l=n[2];return e[0]=i*l-a*o,e[1]=a*s-r*l,e[2]=r*o-i*s,e}e.zero=t,e.clone=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.isFinite=function(e){return _y(e[0])&&_y(e[1])&&_y(e[2])},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])},e.setNaN=function(e){return e[0]=NaN,e[1]=NaN,e[2]=NaN,e},e.fromObj=function(e){return n(e.x,e.y,e.z)},e.toObj=function(e){return{x:e[0],y:e[1],z:e[2]}},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t},e.create=n,e.ofArray=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},e.copy=r,e.add=i,e.sub=a,e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.scale=s,e.scaleAndAdd=o,e.scaleAndSub=function(e,t,n,r){return e[0]=t[0]-n[0]*r,e[1]=t[1]-n[1]*r,e[2]=t[2]-n[2]*r,e},e.addScalar=function(e,t,n){return e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n,e},e.subScalar=function(e,t,n){return e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},e.trunc=function(e,t){return e[0]=Math.trunc(t[0]),e[1]=Math.trunc(t[1]),e[2]=Math.trunc(t[2]),e},e.abs=function(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e},e.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},e.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},e.clamp=function(e,t,n,r){return e[0]=Math.max(n[0],Math.min(r[0],t[0])),e[1]=Math.max(n[1],Math.min(r[1],t[1])),e[2]=Math.max(n[2],Math.min(r[2],t[2])),e},e.distance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},e.squaredDistance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},e.magnitude=function(e){const t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},e.squaredMagnitude=l,e.setMagnitude=function(e,t,n){return s(e,u(e,t),n)},e.negate=c,e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},e.normalize=u,e.dot=d,e.cross=h,e.lerp=function(e,t,n,r){const i=t[0],a=t[1],s=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=s+r*(n[2]-s),e};const f=t();function p(e,t){const n=Math.sqrt(l(e)*l(t));if(0===n)return Math.PI/2;const r=d(e,t)/n;return Math.acos(py(r,-1,1))}e.slerp=function(e,t,n,r){const a=py(d(t,n),-1,1),l=Math.acos(a)*r;return o(f,n,t,-a),u(f,f),i(e,s(e,t,Math.cos(l)),s(f,f,Math.sin(l)))},e.hermite=function(e,t,n,r,i,a){const s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,c=s*(a-1),u=s*(3-2*a);return e[0]=t[0]*o+n[0]*l+r[0]*c+i[0]*u,e[1]=t[1]*o+n[1]*l+r[1]*c+i[1]*u,e[2]=t[2]*o+n[2]*l+r[2]*c+i[2]*u,e},e.bezier=function(e,t,n,r,i,a){const s=1-a,o=s*s,l=a*a,c=o*s,u=3*a*o,d=3*l*s,h=l*a;return e[0]=t[0]*c+n[0]*u+r[0]*d+i[0]*h,e[1]=t[1]*c+n[1]*u+r[1]*d+i[1]*h,e[2]=t[2]*c+n[2]*u+r[2]*d+i[2]*h,e},e.quadraticBezier=function(e,t,n,r,i){return e[0]=gy(t[0],n[0],r[0],i),e[1]=gy(t[1],n[1],r[1],i),e[2]=gy(t[2],n[2],r[2],i),e},e.spline=function(e,t,n,r,i,a,s){return e[0]=my(t[0],n[0],r[0],i[0],a,s),e[1]=my(t[1],n[1],r[1],i[1],a,s),e[2]=my(t[2],n[2],r[2],i[2],a,s),e},e.random=function(e,t){const n=2*Math.random()*Math.PI,r=2*Math.random()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},e.transformMat4=function(e,t,n){const r=t[0],i=t[1],a=t[2],s=1/(n[3]*r+n[7]*i+n[11]*a+n[15]||1);return e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])*s,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])*s,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])*s,e},e.transformDirection=function(e,t,n){const r=t[0],i=t[1],a=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*a,e[1]=n[1]*r+n[5]*i+n[9]*a,e[2]=n[2]*r+n[6]*i+n[10]*a,u(e,e)},e.transformMat4Offset=function(e,t,n,r,i,a){const s=t[0+i],o=t[1+i],l=t[2+i],c=1/(n[3+a]*s+n[7+a]*o+n[11+a]*l+n[15+a]||1);return e[0+r]=(n[0+a]*s+n[4+a]*o+n[8+a]*l+n[12+a])*c,e[1+r]=(n[1+a]*s+n[5+a]*o+n[9+a]*l+n[13+a])*c,e[2+r]=(n[2+a]*s+n[6+a]*o+n[10+a]*l+n[14+a])*c,e},e.transformDirectionOffset=function(e,t,n,r,i,a){const s=t[0+i],o=t[1+i],l=t[2+i];e[0+r]=n[0+a]*s+n[4+a]*o+n[8+a]*l,e[1+r]=n[1+a]*s+n[5+a]*o+n[9+a]*l,e[2+r]=n[2+a]*s+n[6+a]*o+n[10+a]*l;const c=Math.hypot(e[0+r],e[1+r],e[2+r]);return c>0&&(e[0+r]/=c,e[1+r]/=c,e[2+r]/=c),e},e.transformMat3=function(e,t,n){const r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e},e.transformQuat=function(e,t,n){const r=t[0],i=t[1],a=t[2],s=n[0],o=n[1],l=n[2],c=n[3],u=c*r+o*a-l*i,d=c*i+l*r-s*a,h=c*a+s*i-o*r,f=-s*r-o*i-l*a;return e[0]=u*c+f*-s+d*-l-h*-o,e[1]=d*c+f*-o+h*-s-u*-l,e[2]=h*c+f*-l+u*-o-d*-s,e},e.angle=p;const m=t(),g=t(),_=t(),y=t(),v=t(),b=t(),x=t();e.dihedralAngle=function(e,t,n,r){a(m,e,t),a(g,n,t),a(_,t,n),a(y,r,n),h(v,m,g),h(b,_,y);const i=p(v,b);return h(x,v,b),d(g,x)>0?i:-i},e.directionFromSpherical=function(t,n,r,i){return e.set(t,i*Math.cos(r)*Math.sin(n),i*Math.sin(r)*Math.sin(n),i*Math.cos(n))},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.equals=function(e,t){const n=e[0],r=e[1],i=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(n-a)<=hy*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=hy*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=hy*Math.max(1,Math.abs(i),Math.abs(o))};const w=t();e.makeRotation=function(t,n,r){const i=p(n,r);if(Math.abs(i)<1e-4)return xy.setIdentity(t);if(Math.abs(i-Math.PI)<hy)return xy.fromScaling(t,e.negUnit);const a=h(w,n,r);return xy.fromRotation(t,i,a)},e.isZero=function(e){return 0===e[0]&&0===e[1]&&0===e[2]},e.projectPointOnVector=function(e,t,n,r){return a(e,t,r),i(e,s(e,n,d(n,e)/l(n)),r)};const S=t();function A(e,t,n){return s(e,n,d(n,t)/l(n))}e.projectPointOnPlane=function(e,t,n,r){return u(S,n),a(e,t,r),a(e,t,s(S,S,d(e,S)))},e.projectOnVector=A;const M=t();e.projectOnPlane=function(e,t,n){return A(M,t,n),a(e,t,M)},e.orthogonalize=function(e,t,n){return u(e,h(e,h(e,t,n),t))},e.matchDirection=function(e,t,n){return d(t,n)>0?r(e,t):c(e,r(e,t)),e};const E=t(),C=t();e.triangleNormal=function(e,t,n,r){return a(E,n,t),a(C,r,t),u(e,h(e,E,C))},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}]`},e.origin=n(0,0,0),e.unit=n(1,1,1),e.negUnit=n(-1,-1,-1),e.unitX=n(1,0,0),e.unitY=n(0,1,0),e.unitZ=n(0,0,1),e.negUnitX=n(-1,0,0),e.negUnitY=n(0,-1,0),e.negUnitZ=n(0,0,-1)}(yy||(yy={}));const vy=Math.PI/180;function by(e){return e*vy}function xy(){return xy.zero()}function wy(){return wy.zero()}function Sy(){return Sy.zero()}function Ay(){return Ay.zero()}function My(e){throw new Error("unreachable")}function Ey(){return Ey.zero()}var Cy,Ty,Py,Iy;function Ry(e,t,n){let r=t,i=0,a=1;for(45===e.charCodeAt(r)?(a=-1,++r):43===e.charCodeAt(r)&&++r;r<n;r++){const t=e.charCodeAt(r)-48;if(t>9||t<0)return a*i|0;i=10*i+t|0}return a*i}function ky(e,t,n,r){return 43===t.charCodeAt(n)&&n++,e*Math.pow(10,Ry(t,n,r))}function Dy(e,t,n){let r=t,i=1,a=0,s=0,o=1;for(45===e.charCodeAt(r)?(i=-1,++r):43===e.charCodeAt(r)&&++r;r<n;){let t=e.charCodeAt(r)-48;if(!(t>=0&&t<10)){if(-2===t){for(++r;r<n;){if(t=e.charCodeAt(r)-48,!(t>=0&&t<10))return 53===t||21===t?ky(i*(a+s/o),e,r+1,n):i*(a+s/o);s=10*s+t,o*=10,++r}return i*(a+s/o)}if(53===t||21===t)return ky(i*a,e,r+1,n);break}a=10*a+t,++r}return i*a}function Ly(e,t,n,r){return{schema:n,__array:void 0,isDefined:0===r,rowCount:t,value:t=>e,valueKind:e=>r,toArray:n=>{const{array:r}=ly(t,n);for(let t=0,n=r.length;t<n;t++)r[t]=e;return r},areValuesEqual:(e,t)=>!0}}function Ny({value:e,valueKind:t,areValuesEqual:n,rowCount:r,schema:i}){return{schema:i,__array:void 0,isDefined:!0,rowCount:r,value:e,valueKind:t||(e=>0),toArray:t=>{const{array:n,start:i}=ly(r,t);for(let t=0,r=n.length;t<r;t++)n[t]=e(t+i);return n},areValuesEqual:n||((t,n)=>e(t)===e(n))}}function Oy({array:e,schema:t,valueKind:n}){const r=e.length,i=t.T,a="str"===t.valueType?"lowercase"===t.transform?t=>{const n=e[t];return"string"==typeof n?n.toLowerCase():`${null!=n?n:i}`.toLowerCase()}:"uppercase"===t.transform?t=>{const n=e[t];return"string"==typeof n?n.toUpperCase():`${null!=n?n:i}`.toUpperCase()}:t=>{const n=e[t];return"string"==typeof n?n:`${null!=n?n:i}`}:t=>e[t],s=uy(e);return{schema:t,__array:e,isDefined:!0,rowCount:r,value:a,valueKind:n||(e=>0),toArray:"str"===t.valueType?"lowercase"===t.transform?t=>{const{start:n,end:a}=oy(r,t),s=new(t&&void 0!==t.array?t.array:e.constructor)(a-n);for(let t=0,r=a-n;t<r;t++){const r=e[n+t];s[t]="string"==typeof r?r.toLowerCase():`${null!=r?r:i}`.toLowerCase()}return s}:"uppercase"===t.transform?t=>{const{start:n,end:a}=oy(r,t),s=new(t&&void 0!==t.array?t.array:e.constructor)(a-n);for(let t=0,r=a-n;t<r;t++){const r=e[n+t];s[t]="string"==typeof r?r.toUpperCase():`${null!=r?r:i}`.toUpperCase()}return s}:t=>{const{start:n,end:a}=oy(r,t),s=new(t&&void 0!==t.array?t.array:e.constructor)(a-n);for(let t=0,r=a-n;t<r;t++){const r=e[n+t];s[t]="string"==typeof r?r:`${null!=r?r:i}`}return s}:s?t=>dy(e,t):t=>{const{start:n,end:i}=oy(r,t);if(0===n&&i===e.length)return e;const a=new(t&&void 0!==t.array?t.array:e.constructor)(i-n);for(let t=0,r=i-n;t<r;t++)a[t]=e[n+t];return a},areValuesEqual:(t,n)=>e[t]===e[n]}}function Fy(e,t,n){return e[t]-e[n]}function Uy(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function By(e,t,n,r){const i=n+r>>1;return t(e,n,r)>0?t(e,n,i)>0?t(e,i,r)>0?i:r:n:t(e,r,i)>0?t(e,i,n)>0?i:n:r}function zy(e,t,n){const{cmp:r,swap:i,data:a,parts:s}=e;let o=t+1,l=n;for(i(a,t,By(a,r,t,n));r(a,l,t)>0;)--l;for(let e=t+1;e<=l;e++){const n=r(a,e,t);if(n>0){for(i(a,e,l),--l;r(a,l,t)>0;)--l;e--}else 0===n&&(i(a,e,o),o++)}for(let e=t;e<o;e++)i(a,e,t+l-e);s[0]=l-o+t+1,s[1]=l}function Vy({data:e,cmp:t,swap:n},r,i){for(let a=r+1;a<=i;a++){let i=a-1;for(;i>=r&&t(e,i,i+1)>0;)n(e,i,i+1),i-=1}}function Hy(e,t,n){const{parts:r}=e;for(;t<n;){if(n-t<16)return void Vy(e,t,n);zy(e,t,n);const i=r[0],a=r[1];i-t<n-a?(Hy(e,t,i-1),t=a+1):(Hy(e,a+1,n),n=i-1)}}function $y(e,t,n,r){let i=n+1,a=r;Uy(e,n,By(e,Fy,n,r));const s=e[n];for(;e[a]>s;)--a;for(let t=n+1;t<=a;t++){const n=e[t];if(n>s){for(Uy(e,t,a),--a;e[a]>s;)--a;t--}else n===s&&(Uy(e,t,i),++i)}for(let t=n;t<i;t++)Uy(e,t,n+a-t);t[0]=a-i+n+1,t[1]=a}function Gy(e,t,n){for(let r=t+1;r<=n;r++){const n=e[r];let i=r-1;for(;i>=t&&e[i]>n;)e[i+1]=e[i],i-=1;e[i+1]=n}}function jy(e,t,n,r){for(;n<r;){if(r-n<16)return void Gy(e,n,r);$y(e,t,n,r);const i=t[0],a=t[1];i-n<r-a?(jy(e,t,n,i-1),n=a+1):(jy(e,t,a+1,r),r=i-1)}}function Wy(e,t=Fy){return function(e,t,n,r=Fy){return r===Fy?jy(e,[0,0],t,n-1):Hy({data:e,cmp:r,swap:Uy,parts:[0,0]},t,n-1),e}(e,0,e.length,t)}!function(e){function t(){const e=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return e[0]=0,e}function n(){const e=t();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i(e){for(let t=0;t<16;t++)e[t]=0;return e}e.zero=t,e.identity=n,e.setIdentity=r,e.setZero=i,e.ofRows=function(e){const n=t();for(let t=0;t<4;t++){const r=e[t];for(let e=0;e<4;e++)n[4*e+t]=r[e]}return n};const a=n();function s(e,t,n){for(let r=0;r<16;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0}function o(e,t,n,r){e[4*n+t]=r}function l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function c(e,t){const n=t[0]+t[5]+t[10];let r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function u(e,t){const n=t[0],r=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=n*o-r*s,v=n*l-i*s,b=n*c-a*s,x=r*l-i*o,w=r*c-a*o,S=i*c-a*l,A=u*m-d*p,M=u*g-h*p,E=u*_-f*p,C=d*g-h*m,T=d*_-f*m,P=h*_-f*g;let I=y*P-v*T+b*C+x*E-w*M+S*A;return!!I&&(I=1/I,e[0]=(o*P-l*T+c*C)*I,e[1]=(i*T-r*P-a*C)*I,e[2]=(m*S-g*w+_*x)*I,e[3]=(h*w-d*S-f*x)*I,e[4]=(l*E-s*P-c*M)*I,e[5]=(n*P-i*E+a*M)*I,e[6]=(g*b-p*S-_*v)*I,e[7]=(u*S-h*b+f*v)*I,e[8]=(s*T-o*E+c*A)*I,e[9]=(r*E-n*T-a*A)*I,e[10]=(p*w-m*b+_*y)*I,e[11]=(d*b-u*w-f*y)*I,e[12]=(o*M-s*C-l*A)*I,e[13]=(n*C-r*M+i*A)*I,e[14]=(m*v-p*x-g*y)*I,e[15]=(u*x-d*v+h*y)*I,!0)}function d(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15];let v=n[0],b=n[1],x=n[2],w=n[3];return e[0]=v*r+b*o+x*d+w*m,e[1]=v*i+b*l+x*h+w*g,e[2]=v*a+b*c+x*f+w*_,e[3]=v*s+b*u+x*p+w*y,v=n[4],b=n[5],x=n[6],w=n[7],e[4]=v*r+b*o+x*d+w*m,e[5]=v*i+b*l+x*h+w*g,e[6]=v*a+b*c+x*f+w*_,e[7]=v*s+b*u+x*p+w*y,v=n[8],b=n[9],x=n[10],w=n[11],e[8]=v*r+b*o+x*d+w*m,e[9]=v*i+b*l+x*h+w*g,e[10]=v*a+b*c+x*f+w*_,e[11]=v*s+b*u+x*p+w*y,v=n[12],b=n[13],x=n[14],w=n[15],e[12]=v*r+b*o+x*d+w*m,e[13]=v*i+b*l+x*h+w*g,e[14]=v*a+b*c+x*f+w*_,e[15]=v*s+b*u+x*p+w*y,e}function h(e,t,n){let i=n[0],a=n[1],s=n[2],o=Math.sqrt(i*i+a*a+s*s);if(Math.abs(o)<hy)return r(e);o=1/o,i*=o,a*=o,s*=o;const l=Math.sin(t),c=Math.cos(t),u=1-c;return e[0]=i*i*u+c,e[1]=a*i*u+s*l,e[2]=s*i*u-a*l,e[3]=0,e[4]=i*a*u-s*l,e[5]=a*a*u+c,e[6]=s*a*u+i*l,e[7]=0,e[8]=i*s*u+a*l,e[9]=a*s*u-i*l,e[10]=s*s*u+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.isIdentity=function(e,t){return s(e,a,void 0===t?hy:t)},e.hasNaN=function(e){for(let t=0;t<16;t++)if(isNaN(e[t]))return!0;return!1},e.areEqual=s,e.setValue=o,e.getValue=function(e,t,n){return e[4*n+t]},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t[n+9]=e[9],t[n+10]=e[10],t[n+11]=e[11],t[n+12]=e[12],t[n+13]=e[13],t[n+14]=e[14],t[n+15]=e[15],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e[9]=t[n+9],e[10]=t[n+10],e[11]=t[n+11],e[12]=t[n+12],e[13]=t[n+13],e[14]=t[n+14],e[15]=t[n+15],e},e.fromBasis=function(e,t,n,r){return i(e),o(e,0,0,t[0]),o(e,1,0,t[1]),o(e,2,0,t[2]),o(e,0,1,n[0]),o(e,1,1,n[1]),o(e,2,1,n[2]),o(e,0,2,r[0]),o(e,1,2,r[1]),o(e,2,2,r[2]),o(e,3,3,1),e},e.copy=l,e.clone=function(e){return l(t(),e)},e.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},e.getScaling=function(e,t){const n=t[0],r=t[1],i=t[2],a=t[4],s=t[5],o=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(a*a+s*s+o*o),e[2]=Math.sqrt(l*l+c*c+u*u),e},e.getRotation=c,e.extractRotation=function(e,t){const n=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=1/Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),i=1/Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]);return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=0,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=0,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.transpose=function(e,t){if(e===t){const n=t[1],r=t[2],i=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.tryInvert=u,e.invert=function(e,t){return u(e,t)||console.warn("non-invertible matrix.",t),e},e.mul=d,e.mulOffset=function(e,t,n,r,i,a){const s=t[0+i],o=t[1+i],l=t[2+i],c=t[3+i],u=t[4+i],d=t[5+i],h=t[6+i],f=t[7+i],p=t[8+i],m=t[9+i],g=t[10+i],_=t[11+i],y=t[12+i],v=t[13+i],b=t[14+i],x=t[15+i];let w=n[0+a],S=n[1+a],A=n[2+a],M=n[3+a];return e[0+r]=w*s+S*u+A*p+M*y,e[1+r]=w*o+S*d+A*m+M*v,e[2+r]=w*l+S*h+A*g+M*b,e[3+r]=w*c+S*f+A*_+M*x,w=n[4+a],S=n[5+a],A=n[6+a],M=n[7+a],e[4+r]=w*s+S*u+A*p+M*y,e[5+r]=w*o+S*d+A*m+M*v,e[6+r]=w*l+S*h+A*g+M*b,e[7+r]=w*c+S*f+A*_+M*x,w=n[8+a],S=n[9+a],A=n[10+a],M=n[11+a],e[8+r]=w*s+S*u+A*p+M*y,e[9+r]=w*o+S*d+A*m+M*v,e[10+r]=w*l+S*h+A*g+M*b,e[11+r]=w*c+S*f+A*_+M*x,w=n[12+a],S=n[13+a],A=n[14+a],M=n[15+a],e[12+r]=w*s+S*u+A*p+M*y,e[13+r]=w*o+S*d+A*m+M*v,e[14+r]=w*l+S*h+A*g+M*b,e[15+r]=w*c+S*f+A*_+M*x,e},e.mul3=function(e,t,n,r){return d(e,d(e,t,n),r)},e.translate=function(e,t,n){const r=n[0],i=n[1],a=n[2];let s,o,l,c,u,d,h,f,p,m,g,_;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(s=t[0],o=t[1],l=t[2],c=t[3],u=t[4],d=t[5],h=t[6],f=t[7],p=t[8],m=t[9],g=t[10],_=t[11],e[0]=s,e[1]=o,e[2]=l,e[3]=c,e[4]=u,e[5]=d,e[6]=h,e[7]=f,e[8]=p,e[9]=m,e[10]=g,e[11]=_,e[12]=s*r+u*i+p*a+t[12],e[13]=o*r+d*i+m*a+t[13],e[14]=l*r+h*i+g*a+t[14],e[15]=c*r+f*i+_*a+t[15]),e},e.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},e.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},e.setAxes=function(e,t,n,r){return e[0]=n[0],e[4]=n[1],e[8]=n[2],e[1]=r[0],e[5]=r[1],e[9]=r[2],e[2]=t[0],e[6]=t[1],e[10]=t[2],e},e.rotate=function(e,t,r,i){let a=i[0],s=i[1],o=i[2],l=Math.sqrt(a*a+s*s+o*o);if(Math.abs(l)<hy)return n();l=1/l,a*=l,s*=l,o*=l;const c=Math.sin(r),u=Math.cos(r),d=1-u,h=t[0],f=t[1],p=t[2],m=t[3],g=t[4],_=t[5],y=t[6],v=t[7],b=t[8],x=t[9],w=t[10],S=t[11],A=a*a*d+u,M=s*a*d+o*c,E=o*a*d-s*c,C=a*s*d-o*c,T=s*s*d+u,P=o*s*d+a*c,I=a*o*d+s*c,R=s*o*d-a*c,k=o*o*d+u;return e[0]=h*A+g*M+b*E,e[1]=f*A+_*M+x*E,e[2]=p*A+y*M+w*E,e[3]=m*A+v*M+S*E,e[4]=h*C+g*T+b*P,e[5]=f*C+_*T+x*P,e[6]=p*C+y*T+w*P,e[7]=m*C+v*T+S*P,e[8]=h*I+g*R+b*k,e[9]=f*I+_*R+x*k,e[10]=p*I+y*R+w*k,e[11]=m*I+v*R+S*k,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},e.fromRotation=h,e.scale=function(e,t,n){const r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scaleUniformly=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromUniformScaling=function(e,t){return e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromMat3=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e},e.compose=function(e,t,n,r){const[i,a,s,o]=n,l=i+i,c=a+a,u=s+s,d=i*l,h=i*c,f=i*u,p=a*c,m=a*u,g=s*u,_=o*l,y=o*c,v=o*u,[b,x,w]=r;return e[0]=(1-(p+g))*b,e[1]=(h+v)*b,e[2]=(f-y)*b,e[3]=0,e[4]=(h-v)*x,e[5]=(1-(d+g))*x,e[6]=(m+_)*x,e[7]=0,e[8]=(f+y)*w,e[9]=(m-_)*w,e[10]=(1-(d+p))*w,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e};const f=[0,0,0],p=t();function m(e){const t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],f=e[12],p=e[13],m=e[14],g=e[15];return(t*s-n*a)*(d*g-h*m)-(t*o-r*a)*(u*g-h*p)+(t*l-i*a)*(u*m-d*p)+(n*o-r*s)*(c*g-h*f)-(n*l-i*s)*(c*m-d*f)+(r*l-i*o)*(c*p-u*f)}e.decompose=function(e,t,n,r){let i=yy.magnitude(yy.set(f,e[0],e[1],e[2]));const a=yy.magnitude(yy.set(f,e[4],e[5],e[6])),s=yy.magnitude(yy.set(f,e[8],e[9],e[10]));m(e)<0&&(i=-i),t[0]=e[12],t[1]=e[13],t[2]=e[14],l(p,e);const o=1/i,u=1/a,d=1/s;return p[0]*=o,p[1]*=o,p[2]*=o,p[4]*=u,p[5]*=u,p[6]*=u,p[8]*=d,p[9]*=d,p[10]*=d,c(n,p),r[0]=i,r[1]=a,r[2]=s,e},e.makeTable=function(e){let t="";for(let n=0;n<4;n++){for(let r=0;r<4;r++)t+=e[4*r+n].toString(),r<3&&(t+=" ");n<3&&(t+="\n")}return t},e.determinant=m,e.isRotationAndTranslation=function(e,t){return function(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11];return!!(fy(e[15],1,t)&&fy(a,0,t)&&fy(c,0,t)&&fy(f,0,t))&&!!fy(Math.abs(n*(o*h-l*d)-r*(s*h-l*u)+i*(s*d-o*u)),1,t)}(e,void 0!==t?t:hy)},e.isTranslationAndUniformScaling=function(e,t){return function(e,t){const n=e[0];return fy(e[1],0,t)&&fy(e[2],0,t)&&fy(e[3],0,t)&&fy(e[4],0,t)&&fy(e[5],n,t)&&fy(e[6],0,t)&&fy(e[7],0,t)&&fy(e[8],0,t)&&fy(e[9],0,t)&&fy(e[10],n,t)&&fy(e[11],0,t)&&fy(e[15],1,t)}(e,void 0!==t?t:hy)},e.fromQuat=function(e,t){const n=t[0],r=t[1],i=t[2],a=t[3],s=n+n,o=r+r,l=i+i,c=n*s,u=r*s,d=r*o,h=i*s,f=i*o,p=i*l,m=a*s,g=a*o,_=a*l;return e[0]=1-d-p,e[1]=u+_,e[2]=h-g,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=f+m,e[7]=0,e[8]=h+g,e[9]=f-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromEuler=function(e,t,n){const r=t[0],i=t[1],a=t[2],s=Math.cos(r),o=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(a),d=Math.sin(a);if("XYZ"===n){const t=s*u,n=s*d,r=o*u,i=o*d;e[0]=l*u,e[4]=-l*d,e[8]=c,e[1]=n+r*c,e[5]=t-i*c,e[9]=-o*l,e[2]=i-t*c,e[6]=r+n*c,e[10]=s*l}else if("YXZ"===n){const t=l*u,n=l*d,r=c*u,i=c*d;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*c,e[1]=s*d,e[5]=s*u,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*l}else if("ZXY"===n){const t=l*u,n=l*d,r=c*u,i=c*d;e[0]=t-i*o,e[4]=-s*d,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*u,e[9]=i-t*o,e[2]=-s*c,e[6]=o,e[10]=s*l}else if("ZYX"===n){const t=s*u,n=s*d,r=o*u,i=o*d;e[0]=l*u,e[4]=r*c-n,e[8]=t*c+i,e[1]=l*d,e[5]=i*c+t,e[9]=n*c-r,e[2]=-c,e[6]=o*l,e[10]=s*l}else if("YZX"===n){const t=s*l,n=s*c,r=o*l,i=o*c;e[0]=l*u,e[4]=i-t*d,e[8]=r*d+n,e[1]=d,e[5]=s*u,e[9]=-o*u,e[2]=-c*u,e[6]=n*d+r,e[10]=t-i*d}else if("XZY"===n){const t=s*l,n=s*c,r=o*l,i=o*c;e[0]=l*u,e[4]=-d,e[8]=c*u,e[1]=t*d+i,e[5]=s*u,e[9]=n*d-r,e[2]=r*d-n,e[6]=o*u,e[10]=i*d+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.perspective=function(e,t,n,r,i,a,s){const o=2*a/(n-t),l=2*a/(r-i),c=(n+t)/(n-t),u=(r+i)/(r-i),d=-(s+a)/(s-a),h=-2*s*a/(s-a);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=c,e[9]=u,e[10]=d,e[11]=-1,e[12]=0,e[13]=0,e[14]=h,e[15]=0,e},e.ortho=function(e,t,n,r,i,a,s){const o=1/(n-t),l=1/(r-i),c=1/(s-a),u=(n+t)*o,d=(r+i)*l,h=(s+a)*c;return e[0]=2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=-2*c,e[11]=0,e[12]=-u,e[13]=-d,e[14]=-h,e[15]=1,e},e.lookAt=function(e,t,n,i){let a,s,o,l,c,u,d,h,f,p;const m=t[0],g=t[1],_=t[2],y=i[0],v=i[1],b=i[2],x=n[0],w=n[1],S=n[2];return Math.abs(m-x)<hy&&Math.abs(g-w)<hy&&Math.abs(_-S)<hy?r(e):(d=m-x,h=g-w,f=_-S,p=1/Math.sqrt(d*d+h*h+f*f),d*=p,h*=p,f*=p,a=v*f-b*h,s=b*d-y*f,o=y*h-v*d,p=Math.sqrt(a*a+s*s+o*o),p?(p=1/p,a*=p,s*=p,o*=p):(a=0,s=0,o=0),l=h*o-f*s,c=f*a-d*o,u=d*s-h*a,p=Math.sqrt(l*l+c*c+u*u),p?(p=1/p,l*=p,c*=p,u*=p):(l=0,c=0,u=0),e[0]=a,e[1]=l,e[2]=d,e[3]=0,e[4]=s,e[5]=c,e[6]=h,e[7]=0,e[8]=o,e[9]=u,e[10]=f,e[11]=0,e[12]=-(a*m+s*g+o*_),e[13]=-(l*m+c*g+u*_),e[14]=-(d*m+h*g+f*_),e[15]=1,e)},e.targetTo=function(e,t,n,r){const i=t[0],a=t[1],s=t[2],o=r[0],l=r[1],c=r[2];let u=i-n[0],d=a-n[1],h=s-n[2],f=u*u+d*d+h*h;f>0&&(f=1/Math.sqrt(f),u*=f,d*=f,h*=f);let p=l*h-c*d,m=c*u-o*h,g=o*d-l*u;return f=p*p+m*m+g*g,f>0&&(f=1/Math.sqrt(f),p*=f,m*=f,g*=f),e[0]=p,e[1]=m,e[2]=g,e[3]=0,e[4]=d*g-h*m,e[5]=h*p-u*g,e[6]=u*m-d*p,e[7]=0,e[8]=u,e[9]=d,e[10]=h,e[11]=0,e[12]=i,e[13]=a,e[14]=s,e[15]=1,e},e.fromPermutation=function(e,t){i(e);for(let n=0;n<4;n++)o(e,n,t[n],1);return e},e.getMaxScaleOnAxis=function(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))};const g=[1,0,0],_=[0,1,0],y=[0,0,1];e.rotX90=h(t(),by(90),g),e.rotX180=h(t(),by(180),g),e.rotY90=h(t(),by(90),_),e.rotY180=h(t(),by(180),_),e.rotY270=h(t(),by(270),_),e.rotZ90=h(t(),by(90),y),e.rotZ180=h(t(),by(180),y),e.rotXY90=d(t(),e.rotX90,e.rotY90),e.rotZY90=d(t(),e.rotZ90,e.rotY90),e.rotZYZ90=d(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=d(t(),e.rotZ90,e.rotX180),e.rotY90Z180=d(t(),e.rotY90,e.rotZ180),e.id=n()}(xy||(xy={})),function(e){function t(){const e=[.1,0,0,0,0,0,0,0,0];return e[0]=0,e}function n(){const e=t();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}e.zero=t,e.identity=n,e.setIdentity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e},e.fromColumns=function(e,t,n,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=n[0],e[4]=n[1],e[5]=n[2],e[6]=r[0],e[7]=r[1],e[8]=r[2],e},e.fromMat4=r;const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];e.fromEuler=function(e,t,n){return xy.fromEuler(i,t,n),r(e,i)},e.create=function(e,n,r,i,a,s,o,l,c){const u=t();return u[0]=e,u[1]=n,u[2]=r,u[3]=i,u[4]=a,u[5]=s,u[6]=o,u[7]=l,u[8]=c,u};const a=n();function s(e,t,n){for(let r=0;r<9;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function l(e,t){if(e===t){const n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function c(e,t){const n=t[0],r=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],d=u*s-o*c,h=-u*a+o*l,f=c*a-s*l;let p=n*d+r*h+i*f;return p?(p=1/p,e[0]=d*p,e[1]=(-u*r+i*c)*p,e[2]=(o*r-i*s)*p,e[3]=h*p,e[4]=(u*n-i*l)*p,e[5]=(-o*n+i*a)*p,e[6]=f*p,e[7]=(-c*n+r*l)*p,e[8]=(s*n-r*a)*p,e):(console.warn("non-invertible matrix.",t),e)}function u(e){const t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*(c*a-s*l)+n*(-c*i+s*o)+r*(l*i-a*o)}function d(e){return e[0]+e[4]+e[8]}function h(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function f(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}e.isIdentity=function(e,t){return s(e,a,void 0===t?hy:t)},e.hasNaN=function(e){for(let t=0;t<9;t++)if(isNaN(e[t]))return!0;return!1},e.clone=function(e){return o(t(),e)},e.areEqual=s,e.setValue=function(e,t,n,r){e[3*n+t]=r},e.getValue=function(e,t,n){return e[3*n+t]},e.copy=o,e.transpose=l,e.invert=c,e.symmtricFromUpper=function(e,t){return e===t?(e[3]=t[1],e[6]=t[2],e[7]=t[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[1],e[4]=t[4],e[5]=t[5],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},e.symmtricFromLower=function(e,t){return e===t?(e[1]=t[3],e[2]=t[6],e[5]=t[7]):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[3],e[4]=t[4],e[5]=t[7],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},e.determinant=u,e.trace=d,e.sub=h,e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},e.mul=function(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=n[0],f=n[1],p=n[2],m=n[3],g=n[4],_=n[5],y=n[6],v=n[7],b=n[8];return e[0]=h*r+f*s+p*c,e[1]=h*i+f*o+p*u,e[2]=h*a+f*l+p*d,e[3]=m*r+g*s+_*c,e[4]=m*i+g*o+_*u,e[5]=m*a+g*l+_*d,e[6]=y*r+v*s+b*c,e[7]=y*i+v*o+b*u,e[8]=y*a+v*l+b*d,e},e.subScalar=function(e,t,n){return e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n,e[3]=t[3]-n,e[4]=t[4]-n,e[5]=t[5]-n,e[6]=t[6]-n,e[7]=t[7]-n,e[8]=t[8]-n,e},e.addScalar=function(e,t,n){return e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n,e[3]=t[3]+n,e[4]=t[4]+n,e[5]=t[5]+n,e[6]=t[6]+n,e[7]=t[7]+n,e[8]=t[8]+n,e},e.mulScalar=f;const p=Math.PI/3,m=t();e.symmetricEigenvalues=function(t,n){const r=n[1]*n[1]+n[2]*n[2]+n[5]*n[5];if(0===r)t[0]=n[0],t[1]=n[4],t[2]=n[8];else{const i=d(n)/3,a=n[0]-i,s=n[4]-i,o=n[8]-i,l=a*a+s*s+o*o+2*r,c=Math.sqrt(l/6);f(m,e.Identity,i),h(m,n,m),f(m,m,1/c);const g=u(m)/2,_=g<=-1?p:g>=1?0:Math.acos(g)/3;t[0]=i+2*c*Math.cos(_),t[2]=i+2*c*Math.cos(_+2*p),t[1]=3*i-t[0]-t[2]}return t};const g=[.1,0,0],_=[.1,0,0],y=[.1,0,0],v=[.1,0,0],b=[.1,0,0],x=[.1,0,0];e.eigenvector=function(e,t,n){yy.set(g,t[0]-n,t[1],t[2]),yy.set(_,t[1],t[4]-n,t[5]),yy.set(y,t[2],t[5],t[8]-n),yy.cross(v,g,_),yy.cross(b,g,y),yy.cross(x,_,y);const r=yy.dot(v,v),i=yy.dot(b,b),a=yy.dot(x,x);let s=r,o=0;return i>s&&(s=i,o=1),a>s&&(o=2),0===o?yy.scale(e,v,1/Math.sqrt(r)):1===o?yy.scale(e,b,1/Math.sqrt(i)):yy.scale(e,x,1/Math.sqrt(a)),e},e.directionTransform=function(e,t){return r(e,t),c(e,e),l(e,e),e},e.Identity=n(),e.innerProduct=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[4]*t[4]+e[5]*t[5]+e[6]*t[6]+e[7]*t[7]+e[8]*t[8]}}(wy||(wy={})),function(e){function t(){const e=[.1,0];return e[0]=0,e}e.zero=t,e.clone=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n},e.create=function(e,n){const r=t();return r[0]=e,r[1]=n,r},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},e.set=function(e,t,n){return e[0]=t,e[1]=n,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},e.sub=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},e.distance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},e.squaredDistance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},e.magnitude=function(e){const t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},e.squaredMagnitude=function(e){const t=e[0],n=e[1];return t*t+n*n},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},e.areEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)}}]`}}(Sy||(Sy={})),function(e){function t(){const e=[.1,0,0,0];return e[0]=0,e}function n(e,t){return e[0]=t.center[0],e[1]=t.center[1],e[2]=t.center[2],e[3]=t.radius,e}e.zero=t,e.clone=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},e.create=function(e,n,r,i){const a=t();return a[0]=e,a[1]=n,a[2]=r,a[3]=i,a},e.fromSphere=n,e.ofSphere=function(e){return n(t(),e)},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e},e.toVec3Array=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2]},e.fromVec3Array=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=0,e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},e.distance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+a*a)},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[4]=t[4]*n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},e.squaredDistance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a},e.norm=function(e){const t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},e.squaredNorm=function(e){const t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},e.transformMat4=function(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*s,e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.equals=function(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],s=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=hy*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=hy*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-l)<=hy*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-c)<=hy*Math.max(1,Math.abs(a),Math.abs(c))},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}  ${e[3].toPrecision(t)}]`}}(Ay||(Ay={})),function(e){function t(){const e=[.1,0,0,0];return e[0]=0,e}function n(){const e=t();return e[3]=1,e}function r(e,t,n){n*=.5;const r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function i(e,t,n,r){const i=t[0],a=t[1],s=t[2],o=t[3];let l,c,u,d,h,f=n[0],p=n[1],m=n[2],g=n[3];return c=i*f+a*p+s*m+o*g,c<0&&(c=-c,f=-f,p=-p,m=-m,g=-g),1-c>1e-6?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-r)*l)/u,h=Math.sin(r*l)/u):(d=1-r,h=r),e[0]=d*i+h*f,e[1]=d*a+h*p,e[2]=d*s+h*m,e[3]=d*o+h*g,e}function a(e,t){const n=t[0]+t[4]+t[8];let r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const i=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*a+a]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*i+a]-t[3*a+i])*r,e[i]=(t[3*i+n]+t[3*n+i])*r,e[a]=(t[3*a+n]+t[3*n+a])*r}return e}e.zero=t,e.identity=n,e.setIdentity=function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])},e.create=function(e,t,r,i){const a=n();return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},e.setAxisAngle=r,e.getAxisAngle=function(e,t){const n=2*Math.acos(t[3]),r=Math.sin(n/2);return 0!==r?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n},e.multiply=function(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*u+s*o+i*c-a*l,e[1]=i*u+s*l+a*o-r*c,e[2]=a*u+s*c+r*l-i*o,e[3]=s*u-r*o-i*l-a*c,e},e.rotateX=function(e,t,n){n*=.5;const r=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=r*l+s*o,e[1]=i*l+a*o,e[2]=a*l-i*o,e[3]=s*l-r*o,e},e.rotateY=function(e,t,n){n*=.5;const r=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=r*l-a*o,e[1]=i*l+s*o,e[2]=a*l+r*o,e[3]=s*l-i*o,e},e.rotateZ=function(e,t,n){n*=.5;const r=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*o,e[1]=i*l-r*o,e[2]=a*l+s*o,e[3]=s*l-a*o,e},e.calculateW=function(e,t){const n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},e.slerp=i,e.invert=function(e,t){const n=t[0],r=t[1],i=t[2],a=t[3],s=n*n+r*r+i*i+a*a,o=s?1/s:0;return e[0]=-n*o,e[1]=-r*o,e[2]=-i*o,e[3]=a*o,e},e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.fromMat3=a,e.fromEuler=function(e,t,n){const[r,i,a]=t,s=Math.cos(r/2),o=Math.cos(i/2),l=Math.cos(a/2),c=Math.sin(r/2),u=Math.sin(i/2),d=Math.sin(a/2);switch(n){case"XYZ":e[0]=c*o*l+s*u*d,e[1]=s*u*l-c*o*d,e[2]=s*o*d+c*u*l,e[3]=s*o*l-c*u*d;break;case"YXZ":e[0]=c*o*l+s*u*d,e[1]=s*u*l-c*o*d,e[2]=s*o*d-c*u*l,e[3]=s*o*l+c*u*d;break;case"ZXY":e[0]=c*o*l-s*u*d,e[1]=s*u*l+c*o*d,e[2]=s*o*d+c*u*l,e[3]=s*o*l-c*u*d;break;case"ZYX":e[0]=c*o*l-s*u*d,e[1]=s*u*l+c*o*d,e[2]=s*o*d-c*u*l,e[3]=s*o*l+c*u*d;break;case"YZX":e[0]=c*o*l+s*u*d,e[1]=s*u*l+c*o*d,e[2]=s*o*d-c*u*l,e[3]=s*o*l-c*u*d;break;case"XZY":e[0]=c*o*l-s*u*d,e[1]=s*u*l-c*o*d,e[2]=s*o*d+c*u*l,e[3]=s*o*l+c*u*d;break;default:My()}return e};const s=[0,0,0];function o(e,t){const n=t[0],r=t[1],i=t[2],a=t[3];let s=n*n+r*r+i*i+a*a;return s>0&&(s=1/Math.sqrt(s),e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=a*s),e}e.fromUnitVec3=function(e,t,n){let r=yy.dot(t,n)+1;return r<hy?(r=0,Math.abs(t[0])>Math.abs(t[2])?yy.set(s,-t[1],t[0],0):yy.set(s,0,-t[2],t[1])):yy.cross(s,t,n),e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=r,o(e,e),e},e.clone=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.equals=function(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],s=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=hy*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=hy*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-l)<=hy*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-c)<=hy*Math.max(1,Math.abs(a),Math.abs(c))},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},e.normalize=o;const l=[0,0,0],c=[1,0,0],u=[0,1,0];e.rotationTo=function(e,t,n){const i=yy.dot(t,n);return i<-.999999?(yy.cross(l,c,t),yy.magnitude(l)<1e-6&&yy.cross(l,u,t),yy.normalize(l,l),r(e,l,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(yy.cross(l,t,n),e[0]=l[0],e[1]=l[1],e[2]=l[2],e[3]=1+i,o(e,e))};const d=t(),h=t();e.sqlerp=function(e,t,n,r,a,s){return i(d,t,a,s),i(h,n,r,s),i(e,d,h,2*s*(1-s)),e};const f=[0,0,0,0,0,0,0,0,0];e.setAxes=function(e,t,n,r){return f[0]=n[0],f[3]=n[1],f[6]=n[2],f[1]=r[0],f[4]=r[1],f[7]=r[2],f[2]=-t[0],f[5]=-t[1],f[8]=-t[2],o(e,a(e,f))},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}  ${e[3].toPrecision(t)}]`},e.Identity=n()}(Ey||(Ey={})),function(e){function t(e,t,i){const a=function(e,t,n){const r=[];for(let e=0;e<t.length;e++)r[e]=t[t.length-e-1];const i=[1];for(let t=1;t<e.length;t++)i[t]=e[r[t-1]];return{dimensions:e,axisOrderFastToSlow:r,axisOrderSlowToFast:t,accessDimensions:i,defaultCtor:n||Float64Array}}(e,t,i),{get:s,set:o,add:l,dataOffset:c,getCoords:u}=n(a);return{rank:e.length,dimensions:e,axisOrderSlowToFast:t,create:r(a),get:s,set:o,add:l,dataOffset:c,getCoords:u}}function n(e){const{dimensions:t,axisOrderFastToSlow:n}=e;switch(t.length){case 1:return{get:(e,t)=>e[t],set:(e,t,n)=>e[t]=n,add:(e,t,n)=>e[t]+=n,dataOffset:e=>e,getCoords:(e,t)=>(t[0]=e,t)};case 2:if(0===n[0]&&1===n[1]){const e=t[0];return{get:(t,n,r)=>t[r*e+n],set:(t,n,r,i)=>t[r*e+n]=i,add:(t,n,r,i)=>t[r*e+n]+=i,dataOffset:(t,n)=>n*e+t,getCoords:(t,n)=>(n[0]=t%e,n[1]=Math.floor(t/e),n)}}if(1===n[0]&&0===n[1]){const e=t[1];return{get:(t,n,r)=>t[n*e+r],set:(t,n,r,i)=>t[n*e+r]=i,add:(t,n,r,i)=>t[n*e+r]+=i,dataOffset:(t,n)=>t*e+n,getCoords:(t,n)=>(n[0]=Math.floor(t/e),n[1]=t%e,n)}}throw new Error("bad axis order");case 3:if(0===n[0]&&1===n[1]&&2===n[2]){const e=t[0],n=t[1],r=e*n;return{get:(t,n,i,a)=>t[n+i*e+a*r],set:(t,n,i,a,s)=>t[n+i*e+a*r]=s,add:(t,n,i,a,s)=>t[n+i*e+a*r]+=s,dataOffset:(t,n,i)=>t+n*e+i*r,getCoords:(t,r)=>{const i=Math.floor(t/e);return r[0]=t%e,r[1]=i%n,r[2]=Math.floor(i/n),r}}}if(0===n[0]&&2===n[1]&&1===n[2]){const e=t[0],n=t[2],r=e*n;return{get:(t,n,i,a)=>t[n+a*e+i*r],set:(t,n,i,a,s)=>t[n+a*e+i*r]=s,add:(t,n,i,a,s)=>t[n+a*e+i*r]+=s,dataOffset:(t,n,i)=>t+i*e+n*r,getCoords:(t,r)=>{const i=Math.floor(t/e);return r[0]=t%e,r[1]=Math.floor(i/n),r[2]=i%n,r}}}if(1===n[0]&&0===n[1]&&2===n[2]){const e=t[1],n=t[0],r=e*n;return{get:(t,n,i,a)=>t[i+n*e+a*r],set:(t,n,i,a,s)=>t[i+n*e+a*r]=s,add:(t,n,i,a,s)=>t[i+n*e+a*r]+=s,dataOffset:(t,n,i)=>n+t*e+i*r,getCoords:(t,r)=>{const i=Math.floor(t/e);return r[0]=i%n,r[1]=t%e,r[2]=Math.floor(i/n),r}}}if(1===n[0]&&2===n[1]&&0===n[2]){const e=t[1],n=t[2],r=e*n;return{get:(t,n,i,a)=>t[i+a*e+n*r],set:(t,n,i,a,s)=>t[i+a*e+n*r]=s,add:(t,n,i,a,s)=>t[i+a*e+n*r]+=s,dataOffset:(t,n,i)=>n+i*e+t*r,getCoords:(t,r)=>{const i=Math.floor(t/e);return r[0]=Math.floor(i/n),r[1]=t%e,r[2]=i%n,r}}}if(2===n[0]&&0===n[1]&&1===n[2]){const e=t[2],n=t[0],r=e*n;return{get:(t,n,i,a)=>t[a+n*e+i*r],set:(t,n,i,a,s)=>t[a+n*e+i*r]=s,add:(t,n,i,a,s)=>t[a+n*e+i*r]+=s,dataOffset:(t,n,i)=>i+t*e+n*r,getCoords:(t,r)=>{const i=Math.floor(t/e);return r[0]=i%n,r[1]=Math.floor(i/n),r[2]=t%e,r}}}if(2===n[0]&&1===n[1]&&0===n[2]){const e=t[2],n=t[1],r=e*n;return{get:(t,n,i,a)=>t[a+i*e+n*r],set:(t,n,i,a,s)=>t[a+i*e+n*r]=s,add:(t,n,i,a,s)=>t[a+i*e+n*r]+=s,dataOffset:(t,n,i)=>i+n*e+t*r,getCoords:(t,r)=>{const i=Math.floor(t/e);return r[0]=Math.floor(i/n),r[1]=i%n,r[2]=t%e,r}}}throw new Error("bad axis order");default:return{get:(t,...n)=>t[i(e,n)],set:(t,...n)=>t[i(e,n)]=n[n.length-1],add:(t,...n)=>t[i(e,n)]+=n[n.length-1],dataOffset:(...t)=>i(e,t),getCoords:(t,n)=>function(e,t,n){const{dimensions:r,axisOrderFastToSlow:i}=e,a=r.length;let s=t;for(let e=0;e<a;e++){const t=r[i[e]];n[i[e]]=s%t,s=Math.floor(s/t)}return n[i[a+1]]=s,n}(e,t,n)}}}function r(e){const{dimensions:t}=e;let n=1;for(let e=0,r=t.length;e<r;e++)n*=t[e];return t=>new(t||e.defaultCtor)(n)}function i(e,t){const{accessDimensions:n,axisOrderFastToSlow:r}=e,i=n.length-1;let a=n[i]*t[r[i]];for(let e=i-1;e>=0;e--)a=(a+t[r[e]])*n[e];return a}function a(e,t){const n=[];for(let r=0;r<e.length;r++)n[r]=e[t[r]];return n}e.create=function(e,t){return{space:e,data:t}},e.Space=t,e.Data1=function(e){return e},e.Vector=function(e,n){return t([e],[0],n)},e.ColumnMajorMatrix=function(e,n,r){return t([e,n],[1,0],r)},e.RowMajorMatrix=function(e,n,r){return t([e,n],[0,1],r)},e.toMat4=function(e,t,n){if(2!==t.rank)throw new Error("Invalid tensor rank");const r=Math.min(4,t.dimensions[0]),i=Math.min(4,t.dimensions[1]);for(let a=0;a<r;a++)for(let r=0;r<i;r++)xy.setValue(e,a,r,t.get(n,a,r));return e},e.toMat3=function(e,t,n){if(2!==t.rank)throw new Error("Invalid tensor rank");const r=Math.min(3,t.dimensions[0]),i=Math.min(3,t.dimensions[1]);for(let a=0;a<r;a++)for(let r=0;r<i;r++)wy.setValue(e,a,r,t.get(n,a,r));return e},e.toVec3=function(e,t,n){if(1!==t.rank)throw new Error("Invalid tensor rank");const r=Math.min(3,t.dimensions[0]);for(let t=0;t<r;t++)e[t]=n[t];return e},e.toVec4=function(e,t,n){if(1!==t.rank)throw new Error("Invalid tensor rank");const r=Math.min(4,t.dimensions[0]);for(let t=0;t<r;t++)e[t]=n[t];return e},e.areEqualExact=function(e,t){const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0},e.invertAxisOrder=function(e){const t=[];for(let n=0;n<e.length;n++)t[n]=e[e.length-n-1];return t},e.convertToCanonicalAxisIndicesFastToSlow=function(e){const t=new Int32Array(e.length);for(let n=0;n<e.length;n++)t[e[n]]=n;return e=>a(e,t)},e.convertToCanonicalAxisIndicesSlowToFast=function(e){const t=new Int32Array(e.length);for(let n=0;n<e.length;n++)t[e[e.length-n-1]]=n;return e=>a(e,t)}}(Cy||(Cy={})),function(e){let t;function n(e,t){return Ly(t.T,e,t,1)}function r(e){return Ny(e)}!function(e){function t(t,n=e.float){return{"@type":"tensor",T:t.create(),space:t,valueType:"tensor",baseType:n}}e.str={"@type":"str",T:"",valueType:"str"},e.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},e.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},e.int={"@type":"int",T:0,valueType:"int"},e.coord={"@type":"coord",T:0,valueType:"float"},e.float={"@type":"float",T:0,valueType:"float"},e.Str=function(e){var t;return{"@type":"str",T:null!==(t=null==e?void 0:e.defaultValue)&&void 0!==t?t:"",transform:null==e?void 0:e.transform,valueType:"str"}},e.Int=function(e=0){return{"@type":"int",T:e,valueType:"int"}},e.Float=function(e=0){return{"@type":"float",T:e,valueType:"float"}},e.Tensor=t,e.Vector=function(n,r=e.float){return t(Cy.Vector(n,"int"===r["@type"]?Int32Array:Float64Array),r)},e.Matrix=function(n,r,i=e.float){return t(Cy.ColumnMajorMatrix(n,r,"int"===i["@type"]?Int32Array:Float64Array),i)},e.Aliased=function(e){return e},e.List=function(e,t,n=[]){return{"@type":"list",T:n,separator:e,itemParse:t,valueType:"list"}}}(t=e.Schema||(e.Schema={})),e.is=function(e){return!!e&&!!e.schema&&!!e.value},e.ValueKind={Present:0,NotPresent:1,Unknown:2},e.Undefined=n,e.ofConst=function(e,t,n){return Ly(e,t,n,0)},e.ofLambda=r,e.range=function(e,n){return r({value:t=>t+e,rowCount:Math.max(n-e+1,0),schema:t.int})},e.ofArray=function(e){return Oy(e)},e.ofIntArray=function(e){return Oy({array:e,schema:t.int})},e.ofFloatArray=function(e){return Oy({array:e,schema:t.float})},e.ofStringArray=function(e){return Oy({array:e,schema:t.str})},e.ofStringAliasArray=function(e){return Oy({array:e,schema:t.Aliased(t.str)})},e.ofStringListArray=function(e,n=","){return Oy({array:e,schema:t.List(n,(e=>e))})},e.ofIntTokens=function(e){const{count:n,data:r,indices:i}=e;return Ny({value:e=>Ry(r,i[2*e],i[2*e+1])||0,rowCount:n,schema:t.int})},e.ofFloatTokens=function(e){const{count:n,data:r,indices:i}=e;return Ny({value:e=>Dy(r,i[2*e],i[2*e+1])||0,rowCount:n,schema:t.float})},e.ofStringTokens=function(e){const{count:n,data:r,indices:i}=e;return Ny({value:e=>{const t=r.substring(i[2*e],i[2*e+1]);return"."===t||"?"===t?"":t},rowCount:n,schema:t.str})},e.window=function(e,t,n){return function(e,t,n){return e.isDefined?0===t&&n===e.rowCount?e:e.__array&&uy(e.__array)?function(e,t,n){const r=dy(e.__array,{start:t,end:n}),i=e.valueKind;return Oy({array:r,schema:e.schema,valueKind:e=>i(t+e)})}(e,t,n):function(e,t,n){const r=e.value,i=e.valueKind,a=e.areValuesEqual,s=0===t?r:e=>r(e+t),o=n-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:s,valueKind:0===t?i:e=>i(e+t),toArray:e=>{const{array:n}=ly(o,e);for(let e=0,i=n.length;e<i;e++)n[e]=r(e+t);return n},areValuesEqual:0===t?a:(e,n)=>a(e+t,n+t)}}(e,t,n):Ty.Undefined(n-t,e.schema)}(e,t,n)},e.view=function(e,t,n=!0){return function(e,t,n){return 0===e.rowCount||n&&function(e,t){if(e.length!==t)return!1;for(let t=0,n=e.length;t<n;t++)if(e[t]!==t)return!1;return!0}(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?function(e,t){const n=e.__array,r=new n.constructor(t.length);for(let e=0,i=t.length;e<i;e++)r[e]=n[t[e]];const i=e.valueKind;return Oy({array:r,schema:e.schema,valueKind:e=>i(t[e])})}(e,t):function(e,t){const n=e.value,r=e.valueKind,i=e.areValuesEqual,a=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:a,value:e=>n(t[e]),valueKind:e=>r(t[e]),toArray:e=>{const{array:r}=ly(a,e);for(let e=0,i=r.length;e<i;e++)r[e]=n(t[e]);return r},areValuesEqual:(e,n)=>i(t[e],t[n])}}(e,t)}(e,t,n)},e.createFirstIndexMap=function(e){return function(e){const t=new Map;for(let n=0,r=e.rowCount;n<r;n++){const r=e.value(n);t.has(r)||t.set(e.value(n),n)}return t}(e)},e.createIndexer=function(e){return function(e){const t=new Map;for(let n=0,r=e.rowCount;n<r;n++){const r=e.value(n);t.has(r)||t.set(e.value(n),n)}return e=>t.has(e)?t.get(e):-1}(e)},e.mapToArray=function(e,t,n){return function(e,t,n){const r=new n(e.rowCount);for(let n=0,i=e.rowCount;n<i;n++)r[n]=t(e.value(n));return r}(e,t,n||Array)},e.areEqual=function(e,t){return function(e,t){return e===t||e.rowCount===t.rowCount&&e.isDefined===t.isDefined&&e.schema.valueType===t.schema.valueType&&(e.__array&&t.__array?function(e,t){const n=e.__array,r=t.__array;for(let t=0,i=e.rowCount;t<i;t++)if(n[t]!==r[t])return!1;return!0}(e,t):function(e,t){const n=e.value,r=t.value;for(let t=0,i=e.rowCount;t<i;t++)if(n(t)!==r(t))return!1;return!0}(e,t))}(e,t)},e.indicesOf=function(e,t){return function(e,t){const n=[],r=e.value;for(let i=0,a=e.rowCount;i<a;i++)t(r(i))&&(n[n.length]=i);return n}(e,t)},e.asArrayColumn=function(e,t){return e.__array?e:e.isDefined?Oy({array:e.toArray({array:t}),schema:e.schema,valueKind:e.valueKind}):n(e.rowCount,e.schema)},e.copyToArray=function(e,t,n=0){if(!e.isDefined)return;const r=e.__array;if(r)for(let e=0,i=r.length;e<i;e++)t[n+e]=r[e];else for(let r=0,i=e.rowCount;r<i;r++)t[n+r]=e.value(r)},e.isIdentity=function(e){for(let t=0,n=e.rowCount;t<n;t++)if(t!==e.value(t))return!1;return!0}}(Ty||(Ty={})),function(e){e.create=function(e){return e},e.has=function(e,t){return!!(e&t)},e.hasAll=function(e,t){return!!t&&(e&t)===t}}(Py||(Py={})),function(e){e.create=function(e=512){return{current:[],offset:0,capacity:e,chunks:[]}},e.getString=function(e){return e.chunks.length?(e.offset>0&&(e.chunks[e.chunks.length]=e.current.length===e.offset?e.current.join(""):e.current.slice(0,e.offset).join("")),e.chunks.join("")):e.current.length===e.offset?e.current.join(""):e.current.splice(0,e.offset).join("")},e.getSize=function(e){let t=0;for(const n of e.chunks)t+=n.length;for(let n=0;n<e.offset;n++)t+=e.current[n].length;return t},e.getChunks=function(e){return e.offset>0&&(e.current.length===e.offset?e.chunks[e.chunks.length]=e.current.join(""):e.chunks[e.chunks.length]=e.current.slice(0,e.offset).join(""),e.offset=0),e.chunks};const t=[];function n(e,n){n>0&&r(e,t[n])}function r(e,t){e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(""),e.offset=0),e.current[e.offset++]=t}!function(){let e="";for(let n=0;n<512;n++)t[n]=e,e+=" "}(),e.newline=function(e){r(e,"\n")},e.whitespace=n,e.whitespace1=function(e){r(e," ")},e.write=function(e,t){t&&(e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(""),e.offset=0),e.current[e.offset++]=t)},e.writeSafe=r,e.writePadLeft=function(e,t,i){t?(n(e,i-t.length),r(e,t)):n(e,i)},e.writePadRight=function(e,t,i){if(!t)return void n(e,i);const a=i-t.length;r(e,t),n(e,a)},e.writeInteger=function(e,t){r(e,""+t)},e.writeIntegerAndSpace=function(e,t){r(e,t+" ")},e.writeIntegerPadLeft=function(e,t,i){const a=""+t;n(e,i-a.length),r(e,a)},e.writeIntegerPadRight=function(e,t,i){const a=""+t,s=i-a.length;r(e,a),n(e,s)},e.writeFloat=function(e,t,n){r(e,""+Math.round(n*t)/n)},e.writeFloatPadLeft=function(e,t,i,a){const s=""+Math.round(i*t)/i;n(e,a-s.length),r(e,s)},e.writeFloatPadRight=function(e,t,i,a){const s=""+Math.round(i*t)/i,o=a-s.length;r(e,s),n(e,o)}}(Iy||(Iy={}));const qy=function(){if("undefined"!=typeof window&&window.performance){const e=window.performance;return()=>e.now()}return"undefined"!=typeof process&&"undefined"!==process.hrtime&&"function"==typeof process.hrtime?()=>{const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();var Xy,Yy,Ky;function Zy(e,t){return e-t}function Qy(e=0,t=Number.MAX_SAFE_INTEGER){let n=e;return()=>{const e=n;return n=(n+1)%t,e}}!function(e){const t="undefined"!=typeof btoa?btoa:e=>Buffer.from(e).toString("base64"),n=[];e.create22=function(){let e=+new Date+qy();for(let t=0;t<16;t++)n[t]=String.fromCharCode((e+255*Math.random())%255|0),e=Math.floor(e/255);return t(n.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},e.createv4=function(){let e=+new Date+qy();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},e.is=function(e){return"string"==typeof e}}(Xy||(Xy={})),function(e){class t{has(e){return!1}forEach(e,t){return t}constructor(){this.size=0}}class n{has(e){return e===this.idx}forEach(e,t){return e(this.idx,t),t}constructor(e){this.idx=e,this.size=1}}class r{has(e){return e<this.length&&!!this.mask[e]}_forEach(e,t){for(let n=0;n<this.length;n++)this.mask[n]&&e(n,t)}forEach(e,t){return this._forEach(e,t),t}constructor(e,t){this.mask=e,this.size=t,this.length=e.length}}class i{has(e){return!0}_forEach(e,t){for(let n=0;n<this.size;n++)e(n,t)}forEach(e,t){return this._forEach(e,t),t}constructor(e){this.size=e}}class a{has(e){return this.set.has(e)}_forEach(e,t){for(const n of this.flatten())e(n,t)}flatten(){if(this._flat)return this._flat;const e=new Int32Array(this.size);let t=0;return this.set.forEach((n=>e[t++]=n)),function(e){Array.prototype.sort.call(e,Zy)}(e),this._flat=e,this._flat}forEach(e,t){return this._forEach(e,t),t}constructor(e){this.set=e,this._flat=void 0,this.size=e.size}}function s(e){return new a(e)}function o(e,t){return new r(e,t)}e.always=function(e){return new i(e)},e.never=new t,e.ofSet=s,e.singleton=function(e){return new n(e)},e.ofUniqueIndices=function(e){const s=e.length;if(0===s)return new t;if(1===s)return new n(e[0]);let o=0;for(const t of e)t>o&&(o=t);if(s===o)return new i(s);if(s/o<1/12){const t=new Set;for(const n of e)t.add(n);return new a(t)}const l=new Int8Array(o+1);for(const t of e)l[t]=1;return new r(l,e.length)},e.ofMask=o,e.hasAny=function(e,t){for(const n of t)if(e.has(n))return!0;return!1},e.complement=function(e,t){let n=0,r=0;if(t.forEach((t=>{e.has(t)||(n++,t>r&&(r=t))})),n/r<1/12){const n=new Set;return t.forEach((t=>{e.has(t)||n.add(t)})),s(n)}{const i=new Uint8Array(r+1);return t.forEach((t=>{e.has(t)||(i[t]=1)})),o(i,n)}}}(Yy||(Yy={})),function(e){e.create=function(e){return{ref:e}},e.set=function(e,t){return e.ref=t,e}}(Ky||(Ky={}));const Jy=Qy(0,2147483647);var ev,tv,nv,rv,iv;function av(e){const{data:t,indices:n}=e;return function(e,r){const i=n[2*e],a=n[2*r],s=n[2*e+1]-i;if(s!==n[2*r+1]-a)return!1;for(let e=0;e<s;e++)if(t.charCodeAt(e+i)!==t.charCodeAt(e+a))return!1;return!0}}function sv(e,t){return{name:t,blocks:e}}function ov(e,t,n,r=[]){return{categoryNames:e,header:n,categories:t,saveFrames:r,getField(e){const[n,r]=e.split(".");return t[n].getField(r||"")}}}function lv(e,t,n,r){return{rowCount:t,name:e,fieldNames:[...n],getField:e=>r[e]}}!function(e){e.create=function(e,t){return{id:Jy(),version:0,value:e,metadata:t}},e.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}}(ev||(ev={})),function(e){function t(e,t){return Ky.set(e,ev.withValue(e.ref,t))}e.create=function(e,t){return Ky.create(ev.create(e,t))},e.update=t,e.set=function(e,t){return Ky.set(e,t)},e.updateIfChanged=function(e,n){return e.ref.value!==n?t(e,n):e}}(tv||(tv={})),function(e){function t(e,t,n){const r=Object.create(null),i=Object.keys(t);r._rowCount=n.length,r._columns=i,r._schema=t;for(const t of i)r[t]=Ty.view(e[t],n);return r}function n(e,t){const n=Object.create(null),{_columns:r}=e;for(let i=0;i<r.length;i++){const a=r[i];n[a]=e[a].value(t)}return n}e.is=function(e){return e&&"number"==typeof e._rowCount&&!!e._columns&&!!e._schema},e.pickColumns=function(e,t,n={}){const r=Object.create(null),i=Object.keys(e);r._rowCount=t._rowCount,r._columns=i,r._schema=e;for(const e of i)if(t[e])r[e]=t[e];else{if(!n[e])throw Error(`Cannot find column '${e}'.`);r[e]=n[e]}return r},e.ofColumns=function(e,t){const n=Object.keys(t);return{_rowCount:t[n[0]].rowCount,_columns:n,_schema:e,...t}},e.ofPartialColumns=function(e,t,n){const r=Object.create(null),i=Object.keys(e);r._rowCount=n,r._columns=i,r._schema=e;for(const a of i)r[a]=a in t?t[a]:Ty.Undefined(n,e[a]);return r},e.ofUndefinedColumns=function(e,t){const n=Object.create(null),r=Object.keys(e);n._rowCount=t,n._columns=r,n._schema=e;for(const i of r)n[i]=Ty.Undefined(t,e[i]);return n},e.ofRows=function(e,t){const n=Object.create(null),r=t.length,i=Object.keys(e);n._rowCount=r,n._columns=i,n._schema=e;for(const a of i)n[a]=Ty.ofLambda({rowCount:r,schema:e[a],value:e=>t[e][a],valueKind:e=>void 0===t[e][a]?1:0});return n},e.ofArrays=function(e,t){var n;const r=Object.create(null),i=Object.keys(e);r._rowCount=0,r._columns=i,r._schema=e;for(const a of i)void 0!==t[a]?(r[a]=Ty.ofArray({array:t[a],schema:e[a]}),r._rowCount=null===(n=t[a])||void 0===n?void 0:n.length):r[a]=Ty.Undefined(r._rowCount,e[a]);return r},e.view=t,e.pick=function(e,n,r){const i=[];for(let t=0,n=e._rowCount;t<n;++t)r(t)&&i.push(t);return t(e,n,i)},e.window=function(e,t,n,r){if(0===n&&r===e._rowCount)return e;const i=Object.create(null),a=Object.keys(t);i._rowCount=r-n,i._columns=a,i._schema=t;for(const t of a)i[t]=Ty.window(e[t],n,r);return i},e.concat=function(e,t){const n=Object.create(null),r=Object.keys(t);n._rowCount=0;for(const t of e)n._rowCount+=t._rowCount;const i={};for(const e of r)i[e]=new Array(n._rowCount);n._columns=r,n._schema=t;let a=0;for(const t of e){for(const e of r)Ty.copyToArray(t[e],i[e],a);a+=t._rowCount}for(const e of r)n[e]=Ty.ofArray({array:i[e],schema:t[e]});return n},e.columnToArray=function(e,t,n){e[t]=Ty.asArrayColumn(e[t],n)},e.sort=function(e,t){const n=new Int32Array(e._rowCount);for(let e=0,t=n.length;e<t;e++)n[e]=e;Wy(n,((e,n,r)=>t(n,r)));let r=!0;for(let e=0,t=n.length;e<t;e++)if(n[e]!==e){r=!1;break}if(r)return e;const i=Object.create(null);i._rowCount=e._rowCount,i._columns=e._columns,i._schema=e._schema;for(const t of e._columns)i[t]=Ty.view(e[t],n,!1);return i},e.areEqual=function(e,t){if(e._rowCount!==t._rowCount)return!1;if(e._columns.length!==t._columns.length)return!1;for(const n of e._columns)if(!t[n])return!1;for(const n of e._columns)if(!Ty.areEqual(e[n],t[n]))return!1;return!0},e.getRow=n,e.pickRow=function(e,t){for(let r=0,i=e._rowCount;r<i;++r)if(t(r))return n(e,r)},e.getRows=function(e){const t=[],{_rowCount:r}=e;for(let i=0;i<r;i++)t[i]=n(e,i);return t},e.toArrays=function(e){const t={},{_columns:n}=e;for(let r=0;r<n.length;r++){const i=n[r];t[i]=e[i].toArray()}return t},e.formatToString=function(e){const t=Iy.create(),{_columns:n,_rowCount:r}=e;let i=1;Iy.write(t,"|");for(let e=0;e<n.length;e++)Iy.write(t,n[e]),Iy.write(t,"|"),i+=n[e].length+1;Iy.newline(t),Iy.write(t,new Array(i+1).join("-")),Iy.newline(t);for(let i=0;i<r;i++){Iy.write(t,"|");for(let r=0;r<n.length;r++){const a=e[n[r]];0===a.valueKind(i)?(Iy.write(t,a.value(i)),Iy.write(t,"|")):Iy.write(t,".|")}Iy.newline(t)}return Iy.getString(t)}}(nv||(nv={})),function(e){e.ofTables=function(e,t,n){const r=Object.keys(n),i=Object.create(null),a=[];i._name=e,i._tableNames=a,i._schema=t;for(const e of r)nv.is(n[e])&&(i[e]=n[e],a[a.length]=e);return i},e.getTablesAsRows=function(e){const t={};for(const n of e._tableNames)t[n]=nv.getRows(e[n]);return t}}(rv||(rv={})),function(e){function t(e,t){const n=Object.keys(t);return{rowCount:n.length>0?t[n[0]].rowCount:0,name:e,fieldNames:n,getField:e=>t[e]}}e.empty=function(e){return{rowCount:0,name:e,fieldNames:[],getField(e){}}},e.ofFields=t,e.ofTable=function(e,n){const r={};for(const e of n._columns)r[e]=iv.ofColumn(n[e]);return t(e,r)}}(lv||(lv={})),function(e){function t(e){const t=e.length,n=t=>{const n=e[t];return n&&"."!==n&&"?"!==n?n:""},r=t=>{const n=e[t];return Ry(n,0,n.length)||0},i=t=>{const n=e[t];return Dy(n,0,n.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:r,float:i,valueKind:t=>{const n=e[t],r=n.length;if(r>1)return 0;if(0===r)return 1;const i=n.charCodeAt(0);return 46===i?1:63===i?2:0},areValuesEqual:(t,n)=>e[t]===e[n],toStringArray:r=>r?cy(t,n,r):e,toIntArray:e=>cy(t,r,e),toFloatArray:e=>cy(t,i,e)}}function n(e){const{rowCount:t,valueKind:n,areValuesEqual:r,isDefined:i}=e;let a,s,o;switch(e.schema.valueType){case"float":case"int":a=t=>""+e.value(t),s=e.value,o=e.value;break;case"str":a=e.value,s=t=>{const n=e.value(t);return Ry(n,0,n.length)||0},o=t=>{const n=e.value(t);return Dy(n,0,n.length)||0};break;case"list":const{separator:t}=e.schema;a=n=>e.value(n).join(t),s=e=>NaN,o=e=>NaN;break;default:throw new Error(`unsupported valueType '${e.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:i,rowCount:t,str:a,int:s,float:o,valueKind:n,areValuesEqual:r,toStringArray:e=>cy(t,a,e),toIntArray:e=>cy(t,s,e),toFloatArray:e=>cy(t,o,e)}}e.ofString=function(e){return t([e])},e.ofStrings=t,e.ofNumbers=function(e){const t=e.length,n=t=>""+e[t],r=t=>e[t],i=n=>!n||n.array&&e instanceof n.array?e:cy(t,r,n);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:r,float:r,valueKind:e=>0,areValuesEqual:(t,n)=>e[t]===e[n],toStringArray:e=>cy(t,n,e),toIntArray:i,toFloatArray:i}},e.ofTokens=function(e){const{data:t,indices:n,count:r}=e,i=e=>{const r=t.substring(n[2*e],n[2*e+1]);return"."===r||"?"===r?"":r},a=e=>Ry(t,n[2*e],n[2*e+1])||0,s=e=>Dy(t,n[2*e],n[2*e+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:r,str:i,int:a,float:s,valueKind:e=>{const r=n[2*e],i=n[2*e+1]-r;if(i>1)return 0;if(0===i)return 1;const a=t.charCodeAt(r);return 46===a?1:63===a?2:0},areValuesEqual:av(e),toStringArray:e=>cy(r,i,e),toIntArray:e=>cy(r,a,e),toFloatArray:e=>cy(r,s,e)}},e.ofColumn=n,e.ofUndefined=function(e,t){return n(Ty.Undefined(e,t))}}(iv||(iv={}));const cv="undefined"!=typeof setImmediate?"undefined"!=typeof window?{setImmediate:(e,...t)=>window.setImmediate(e,...t),clearImmediate:e=>window.clearImmediate(e)}:{setImmediate,clearImmediate}:function(){const e=function(){const e="undefined"!=typeof window&&window,t="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,n=void 0!==i.g&&i.g;return e||n||t}(),t={},n="undefined"!=typeof document?document:void 0;let r,a=1;function s(e){delete t[e]}function o(e){const n=t[e];s(e),function(e){const t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(n)}return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?r=function(e){process.nextTick((function(){o(e)}))}:function(){if(e&&e.postMessage&&!e.importScripts){let t=!0;const n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){const t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&o(+n.data.slice(t.length))};window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent("onmessage",n),r=function(e){window.postMessage(t+e,"*")}}():"undefined"!=typeof MessageChannel?function(){const e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},r=function(t){e.port2.postMessage(t)}}():n&&"onreadystatechange"in n.createElement("script")?function(){const e=n.documentElement;r=function(t){let r=n.createElement("script");r.onreadystatechange=function(){o(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():r=function(e){setTimeout(o,0,e)},{setImmediate:function(e,...n){"function"!=typeof e&&(e=new Function(""+e));const i={callback:e,args:n};return t[a]=i,r(a),a++},clearImmediate:s}}();function uv(e){cv.setImmediate(e)}cv.setImmediate,cv.clearImmediate;!function(){try{return!0}catch(e){return!1}}(),function(){try{const e=process.env.DEBUG;return"*"===e||"molstar"===e}catch(e){return!1}}();const dv="undefined"!=typeof performance&&!!performance.mark&&performance.measure&&!1;var hv;function fv(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function pv(e){return t=>{e.abortRequested=!0,e.reason=t||e.reason}}function mv(e){return{progress:{...e.progress},children:e.children.map(mv)}}function gv(e){return e.progress.canAbort&&e.children.every(gv)}async function _v(e,t){hv.markStart(e),t.node.progress.startedTime=qy();try{const n=await e.f(t);return hv.markEnd(e),hv.measure(e),t.info.abortToken.abortRequested&&yv(t.info),n}catch(n){throw Sv.isAbort(n)&&(t.isAborted=!0,t.node.children.length>0&&await new Promise((e=>{t.onChildrenFinished=e})),e.onAbort&&e.onAbort()),n}}function yv(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,vv(e.root),bv(e,qy())),Sv.Aborted(e.abortToken.reason)}function vv(e){const t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(const t of e.children)vv(t)}function bv(e,t){e.lastNotified=t;const n=function(e){return{root:mv(e.root),canAbort:gv(e.root),requestAbort:e.tryAbort}}(e);e.observer(n)}!function(e){function t(e){return`startTask${e.id}`}function n(e){return`endTask${e.id}`}e.markStart=function(e){dv&&performance.mark(t(e))},e.markEnd=function(e){dv&&performance.mark(n(e))},e.measure=function(e){dv&&performance.measure(` ${e.name}`,t(e),n(e))}}(hv||(hv={}));class xv{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,yv(this.info))}get shouldUpdate(){return this.checkAborted(),qy()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;const t=this.node.progress;"string"==typeof e?(t.message=e,t.isIndeterminate=!0):(void 0!==e.canAbort&&(t.canAbort=e.canAbort),void 0!==e.message&&(t.message=e.message),void 0!==e.current&&(t.current=e.current),void 0!==e.max&&(t.max=e.max),t.isIndeterminate=void 0===t.current||void 0===t.max,void 0!==e.isIndeterminate&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=qy(),this.updateProgress(e),!t)return bv(this.info,this.lastUpdatedTime),this.checkAborted(),new Promise(uv)}async runChild(e,t){this.updateProgress(t);const n={progress:fv(e),children:[]},r=this.node.children;r.push(n);const i=new xv(this.info,n);try{return await _v(e,i)}catch(e){if(Sv.isAbort(e)&&this.isAborted)return;throw e}finally{const e=r.indexOf(n);if(e>=0){for(let t=e,n=r.length-1;t<n;t++)r[t]=r[t+1];r.pop()}0===r.length&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}}const wv=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(e,t){}};var Sv,Av,Mv,Ev,Cv,Tv;async function Pv(e,t,n,r,i){let a=Math.max(t,0),s=0,o=0;if(e.isSynchronous)return r(Number.MAX_SAFE_INTEGER,n),n;let l=qy(),c=0,u=0;for(;(c=r(a,n))>0;){s+=c;const t=qy()-l;u+=t,o+=t,e.shouldUpdate&&(await i(e,n,s),a=Math.round(u*s/o)+1,l=qy(),u=0)}return e.shouldUpdate&&await i(e,n,s),n}function Iv(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function Rv(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position}function kv(e){return!(e.length-e.position<2)&&39===e.data.charCodeAt(e.position+1)&&39===e.data.charCodeAt(e.position+2)}function Dv(e,t,n){let r;const i=n-t,a=e.tokenStart-t,s=e.tokenEnd-e.tokenStart;if(s<i)return!1;for(r=t;r<n;++r)if(e.data.charCodeAt(r)!==e.data.charCodeAt(r+a))return!1;return i===s||46===e.data.charCodeAt(r+a)}function Lv(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return t;return t}function Nv(e,t){return e.data.substring(e.tokenStart,t)}function Ov(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function Fv(e){const t=function(e){let t=10;for(;e.position<e.length;){const n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:13!==t&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t}(e);if(e.position>=e.length)return void(e.tokenType=6);e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;const n=e.data.charCodeAt(e.position);switch(n){case 35:!function(e){for(;e.position<e.length;){const t=e.data.charCodeAt(e.position);if(10===t||13===t)return;++e.position}}(e),e.tokenType=5;break;case 39:if(kv(e)){!function(e){for(e.position+=3;e.position<e.length;){if(39===e.data.charCodeAt(e.position)&&kv(e))return e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,void(e.position+=3);++e.position}e.tokenEnd=e.position}(e),e.tokenType=3;break}case 34:!function(e,t){let n,r;for(++e.position;e.position<e.length;)if(r=e.data.charCodeAt(e.position),r===t)switch(n=e.data.charCodeAt(e.position+1),n){case 9:case 10:case 13:case 32:return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;default:if(void 0===n)return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;++e.position}else{if(10===r||13===r)return void(e.tokenEnd=e.position);++e.position}e.tokenEnd=e.position}(e,n),e.tokenType=3;break;case 59:10===t||13===t?function(e){let t,n=59,r=e.position+1;for(;r<e.length;){if(t=e.data.charCodeAt(r),59===t&&(10===n||13===n)){for(e.position=r+1,e.tokenStart++,r--,t=e.data.charCodeAt(r);10===t||13===t;)r--,t=e.data.charCodeAt(r);return e.tokenEnd=r+1,void(e.isEscaped=!0)}(13===t||10===t&&13!==n)&&e.lineNumber++,n=t,++r}e.position=r}(e):Rv(e),e.tokenType=3;break;default:e.isImportGet?function(e){for(;e.position<e.length;){if(93===e.data.charCodeAt(e.position))return++e.position,e.tokenEnd=e.position,void(e.isImportGet=!1);++e.position}}(e):Rv(e),e.isEscaped?e.tokenType=3:95===e.data.charCodeAt(e.tokenStart)?(e.inSaveFrame&&function(e){return e.tokenEnd-e.tokenStart==11&&105===e.data.charCodeAt(e.tokenStart+1)&&109===e.data.charCodeAt(e.tokenStart+2)&&112===e.data.charCodeAt(e.tokenStart+3)&&111===e.data.charCodeAt(e.tokenStart+4)&&114===e.data.charCodeAt(e.tokenStart+5)&&116===e.data.charCodeAt(e.tokenStart+6)&&46===e.data.charCodeAt(e.tokenStart+7)&&103===e.data.charCodeAt(e.tokenStart+8)&&101===e.data.charCodeAt(e.tokenStart+9)&&116===e.data.charCodeAt(e.tokenStart+10)}(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&95===e.data.charCodeAt(e.tokenStart+4)?function(e){let t=e.data.charCodeAt(e.tokenStart);return!(68!==t&&100!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t||(t=e.data.charCodeAt(e.tokenStart+2),84!==t&&116!==t||(t=e.data.charCodeAt(e.tokenStart+3),65!==t&&97!==t))))}(e)?e.tokenType=0:function(e){let t=e.data.charCodeAt(e.tokenStart);return!(83!==t&&115!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t||(t=e.data.charCodeAt(e.tokenStart+2),86!==t&&118!==t||(t=e.data.charCodeAt(e.tokenStart+3),69!==t&&101!==t))))}(e)?e.tokenType=1:function(e){if(e.tokenEnd-e.tokenStart!=5)return!1;let t=e.data.charCodeAt(e.tokenStart);return!(76!==t&&108!==t||(t=e.data.charCodeAt(e.tokenStart+1),79!==t&&111!==t||(t=e.data.charCodeAt(e.tokenStart+2),79!==t&&111!==t||(t=e.data.charCodeAt(e.tokenStart+3),80!==t&&112!==t))))}(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3}}function Uv(e){for(Fv(e);5===e.tokenType;)Fv(e)}function Bv(){return{categoryNames:[],categoryData:Object.create(null)}}function zv(e,t){const n=Object.create(null);for(const r of e){const e=t[r];n[r]=lv(e.name,e.rowCount,e.fieldNames,e.fields)}return n}function Vv(e,t,n){return ov(e.categoryNames,zv(e.categoryNames,e.categoryData),t,n)}function Hv(e,t){return ov(e.categoryNames,zv(e.categoryNames,e.categoryData),t)}function $v(e,t,n,r,i){if(t in e.categoryData){const n=e.categoryData[t];n.fieldNames.push(...r),Object.assign(n.fields,i)}else e.categoryData[t]={name:t,rowCount:n,fieldNames:r,fields:i},e.categoryNames.push(t)}function Gv(e,t){const n=e.tokenStart,r=Lv(e),i=Nv(e,r),a=Object.create(null),s=[];let o=!0;for(;o;){if(4!==e.tokenType||!Dv(e,n,r)){o=!1;break}const t=Ov(e).substring(i.length+1);if(Uv(e),3!==e.tokenType)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};a[t]=iv.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),s[s.length]=t,Uv(e)}return $v(t,i.substr(1),1,s,a),{hasError:!1,errorLine:0,errorMessage:""}}function jv(e,t){const{tokenizer:n,tokens:r,fieldCount:i}=t;let a=t.tokenCount,s=0;for(;3===n.tokenType&&s<e;)Ev.add(r[a++%i],n.tokenStart,n.tokenEnd),Uv(n),s++;return t.tokenCount=a,s}function Wv(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}async function qv(e,t){const n=e.lineNumber;Uv(e);const r=Nv(e,Lv(e)),i=function(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return!1;return!0}(e),a=[];for(;4===e.tokenType;)a[a.length]=i?Ov(e):Ov(e).substring(r.length+1),Uv(e);const s="_atom_site"===r?e.data.length/100|0:32,o=[],l=a.length;for(let t=0;t<l;t++)o[t]=Ev.create(e.data,s);const c={fieldCount:l,tokenCount:0,tokenizer:e,tokens:o};if(await Pv(e.runtimeCtx,1e6,c,jv,Wv),c.tokenCount%l!=0)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`The number of values for loop starting at line ${n} is not a multiple of the number of columns.`};const u=c.tokenCount/l|0;if(i)for(let e=0;e<l;e++){const n={"":iv.ofTokens(o[e])};$v(t,a[e].substr(1),u,[""],n)}else{const e=Object.create(null);for(let t=0;t<l;t++)e[a[t]]=iv.ofTokens(o[t]);$v(t,r.substr(1),u,a,e)}return{hasError:!1,errorLine:0,errorMessage:""}}function Xv(e,t){return Cv.error(t,e)}function Yv(e){return Sv.create("Parse CIF",(async t=>await async function(e,t){const n=[],r=function(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}(e,t);let i="",a=Bv(),s=[],o=Bv();const l=function(e,t,n){return{categoryNames:e,header:"",categories:t}}(o.categoryNames,zv(o.categoryNames,o.categoryData));let c="";for(t.update({message:"Parsing...",current:0,max:e.length}),Uv(r);6!==r.tokenType;){const t=r.tokenType;if(0===t){if(r.inSaveFrame)return Xv(r.lineNumber,"Unexpected data block inside a save frame.");a.categoryNames.length>0&&n.push(Vv(a,i,s)),i=e.substring(r.tokenStart+5,r.tokenEnd),a=Bv(),s=[],Uv(r)}else if(1===t){if(r.tokenEnd-r.tokenStart==5)o.categoryNames.length>0&&(s[s.length]=Hv(o,c)),r.inSaveFrame=!1;else{if(r.inSaveFrame)return Xv(r.lineNumber,"Save frames cannot be nested.");r.inSaveFrame=!0,c=e.substring(r.tokenStart+5,r.tokenEnd),o=Bv()}Uv(r)}else if(2===t){const e=await qv(r,r.inSaveFrame?o:a);if(e.hasError)return Xv(e.errorLine,e.errorMessage)}else{if(4!==t)return console.log(r.tokenType,Iv.getTokenString(r)),Xv(r.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const e=Gv(r,r.inSaveFrame?o:a);if(e.hasError)return Xv(e.errorLine,e.errorMessage)}}}return r.inSaveFrame?Xv(r.lineNumber,`Unfinished save frame (${l.header}).`):((a.categoryNames.length>0||s.length>0)&&n.push(Vv(a,i,s)),function(e){return Cv.success(e)}(sv(n)))}(e,t)))}!function(e){class t{run(e,t=250){return e?function(e,t,n=250){const r=function(e,t,n){const r={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:n,lastNotified:qy(),observer:t,abortToken:r,taskId:e.id,root:{progress:fv(e),children:[]},tryAbort:pv(r)}}(e,t,n);return _v(e,new xv(r,r.root))}(this,e,t):this.f(wv)}runAsChild(e,t){return e.isSynchronous?this.f(wv):function(e,t,n){return e.runChild(t,n)}(e,this,t)}runInContext(e){return e.isSynchronous?this.f(wv):function(e,t){return _v(t,e)}(e,this)}constructor(e,t,n){this.name=e,this.f=t,this.onAbort=n,this.id=i()}}function n(e){const t=e;return!!e&&"number"==typeof t.id&&"string"==typeof t.name&&!!t.run}function r(e,n,r){return new t(e,n,r)}e.is=n,e.isAbort=function(e){return!!e&&!!e.isAborted},e.Aborted=function(e){return{isAborted:!0,reason:e,toString:()=>"Aborted"+(e?": "+e:"")}},e.create=r,e.constant=function(e,t){return r(e,(async e=>t))},e.empty=function(){return r("",(async e=>{}))},e.fail=function(e,t){return r(e,(async e=>{throw new Error(t)}))},e.resolveInContext=function(e,t){return n(e)?t?e.runInContext(t):e.run():e};const i=Qy(0,1073741823)}(Sv||(Sv={})),function(e){e.Synchronous=wv}(Av||(Av={})),function(e){function t(e,n=""){const r=e.progress;if(!e.children.length)return r.isIndeterminate?`${n}${r.taskName}: ${r.message}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}`;const i=n+"  |_ ",a=e.children.map((e=>t(e,i)));return r.isIndeterminate?`${n}${r.taskName}: ${r.message}\n${a.join("\n")}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}\n${a.join("\n")}`}e.format=function(e){return t(e.root)}}(Mv||(Mv={})),function(e){function t(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function n(e){const{data:t}=e;for(;e.position<e.length;)switch(t.charCodeAt(e.position)){case 10:return e.tokenEnd=e.position,++e.position,++e.lineNumber,!0;case 13:return e.tokenEnd=e.position,++e.position,++e.lineNumber,10===t.charCodeAt(e.position)&&++e.position,!0;default:++e.position}return e.tokenEnd=e.position,e.tokenStart!==e.tokenEnd}function r(e){return e.tokenStart=e.position,n(e)}function i(e,t,n){let i=0;for(let a=0;a<t;a++){if(!r(e))return i;Ev.addUnchecked(n,e.tokenStart,e.tokenEnd),i++}return i}function a(e,t,n){const{data:r}=e;let i=t,a=n-1,s=r.charCodeAt(i);for(;(9===s||32===s)&&i<=a;)s=r.charCodeAt(++i);for(s=r.charCodeAt(a);(9===s||32===s)&&a>=i;)s=r.charCodeAt(--a);return e.tokenStart=i,e.tokenEnd=a+1,e.position=n,e}e.getTokenString=t,e.reset=function(e){e.position=0,e.lineNumber=1,e.tokenStart=0,e.tokenEnd=0},e.eatLine=n,e.markStart=function(e){e.tokenStart=e.position},e.markLine=r,e.readLine=function(e){return r(e),t(e)},e.readLineTrim=function(e){r(e);const n=e.position;return a(e,e.tokenStart,e.tokenEnd),e.position=n,t(e)},e.markLines=function(e,t){const n=Ev.create(e.data,2*t);return i(e,t,n),n},e.readLines=function(t,n){const r=[];for(let i=0;i<n;i++)r.push(e.readLine(t));return r},e.readLinesAsync=async function(e,t,n,r=1e5){const a=Ev.create(e.data,2*t);let s=0;return await Pv(n,r,e,((e,n)=>{const r=Math.min(t-s,e);return i(n,r,a),s+=r,r}),((e,t)=>e.update({message:"Parsing...",current:t.position,max:t.length}))),a},e.readAllLines=function(t){const n=e(t),i=Ev.create(n.data,Math.max(t.length/80,2));for(;r(n);)Ev.add(i,n.tokenStart,n.tokenEnd);return i},e.readAllLinesAsync=async function(t,n,i=1e5){const a=e(t),s=Ev.create(a.data,Math.max(t.length/80,2));return await Pv(n,i,a,((e,t)=>(function(e,t,n){let i=0;for(let a=0;a<t;a++){if(!r(e))return i;Ev.add(n,e.tokenStart,e.tokenEnd),i++}}(t,e,s),t.position<t.length?e:0)),((e,t)=>e.update({message:"Parsing...",current:t.position,max:t.length}))),s},e.eatValue=function(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position},e.skipWhitespace=function(e){let t=-1;for(;e.position<e.length;){const n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:13!==t&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t},e.trim=a}(Iv||(Iv={})),function(e){function t(e,t,n){const r=e;r.offset>r.indicesLenMinus2&&function(e){const t=new Uint32Array(1.61*e.indices.length|0);t.set(e.indices),e.indices=t,e.indicesLenMinus2=t.length-2|0}(r),r.indices[r.offset++]=t,r.indices[r.offset++]=n,e.count++}e.add=t,e.addToken=function(e,n){t(e,n.tokenStart,n.tokenEnd)},e.addUnchecked=function(e,t,n){e.indices[e.offset++]=t,e.indices[e.offset++]=n,e.count++},e.create=function(e,t){return{data:e,indicesLenMinus2:(t=Math.max(10,t))-2|0,count:0,offset:0,indices:new Uint32Array(t)}}}(Ev||(Ev={})),function(e){e.error=function(e,n=-1){return new t(e,n)},e.success=function(e,t=[]){return new n(e,t)};class t{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(e,t){this.message=e,this.line=t,this.isError=!0}}e.Error=t;class n{constructor(e,t){this.result=e,this.warnings=t,this.isError=!1}}e.Success=n}(Cv||(Cv={})),function(e){var t,n;(t=e.IntDataType||(e.IntDataType={}))[t.Int8=1]="Int8",t[t.Int16=2]="Int16",t[t.Int32=3]="Int32",t[t.Uint8=4]="Uint8",t[t.Uint16=5]="Uint16",t[t.Uint32=6]="Uint32",(n=e.FloatDataType||(e.FloatDataType={}))[n.Float32=32]="Float32",n[n.Float64=33]="Float64",e.getDataType=function(t){let n;return n=t instanceof Int8Array?e.IntDataType.Int8:t instanceof Int16Array?e.IntDataType.Int16:t instanceof Int32Array?e.IntDataType.Int32:t instanceof Uint8Array?e.IntDataType.Uint8:t instanceof Uint16Array?e.IntDataType.Uint16:t instanceof Uint32Array?e.IntDataType.Uint32:t instanceof Float32Array?e.FloatDataType.Float32:t instanceof Float64Array?e.FloatDataType.Float64:e.IntDataType.Int32,n},e.isSignedIntegerDataType=function(e){if(e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array)return!0;for(let t=0,n=e.length;t<n;t++)if(t<0)return!1;return!0}}(Tv||(Tv={}));const Kv=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0];function Zv(e){let t=e.data;for(let n=e.encoding.length-1;n>=0;n--)t=Qv(t,e.encoding[n]);return t}function Qv(e,t){switch(t.kind){case"ByteArray":switch(t.type){case Tv.IntDataType.Uint8:return e;case Tv.IntDataType.Int8:return function(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case Tv.IntDataType.Int16:return function(e){return tb(e,2,Int16Array)}(e);case Tv.IntDataType.Uint16:return function(e){return tb(e,2,Uint16Array)}(e);case Tv.IntDataType.Int32:return function(e){return tb(e,4,Int32Array)}(e);case Tv.IntDataType.Uint32:return function(e){return tb(e,4,Uint32Array)}(e);case Tv.FloatDataType.Float32:return function(e){return tb(e,4,Float32Array)}(e);case Tv.FloatDataType.Float64:return function(e){return tb(e,8,Float64Array)}(e);default:My(t.type)}case"FixedPoint":return function(e,t){const n=e.length,r=eb(t.srcType,n),i=1/t.factor;for(let t=0;t<n;t++)r[t]=i*e[t];return r}(e,t);case"IntervalQuantization":return function(e,t){const n=e.length,r=eb(t.srcType,n),i=(t.max-t.min)/(t.numSteps-1),a=t.min;for(let t=0;t<n;t++)r[t]=a+i*e[t];return r}(e,t);case"RunLength":return function(e,t){const n=Jv(t.srcType,t.srcSize);let r=0;for(let t=0,i=e.length;t<i;t+=2){const i=e[t],a=e[t+1];for(let e=0;e<a;++e)n[r++]=i}return n}(e,t);case"Delta":return function(e,t){const n=e.length,r=Jv(t.srcType,n);if(!n)return e;r[0]=e[0]+(0|t.origin);for(let t=1;t<n;++t)r[t]=e[t]+r[t-1];return r}(e,t);case"IntegerPacking":return function(e,t){return e.length===t.srcSize?e:t.isUnsigned?function(e,t){const n=1===t.byteCount?255:65535,r=e.length,i=new Int32Array(t.srcSize);let a=0,s=0;for(;a<r;){let t=0,r=e[a];for(;r===n;)t+=r,a++,r=e[a];t+=r,i[s]=t,a++,s++}return i}(e,t):function(e,t){const n=1===t.byteCount?127:32767,r=-n-1,i=e.length,a=new Int32Array(t.srcSize);let s=0,o=0;for(;s<i;){let t=0,i=e[s];for(;i===n||i===r;)t+=i,s++,i=e[s];t+=i,a[o]=t,s++,o++}return a}(e,t)}(e,t);case"StringArray":return function(e,t){const n=Zv({encoding:t.offsetEncoding,data:t.offsets}),r=Zv({encoding:t.dataEncoding,data:e}),i=t.stringData,a=new Array(n.length);a[0]="";for(let e=1,t=n.length;e<t;e++)a[e]=i.substring(n[e-1],n[e]);let s=0;const o=new Array(r.length);for(let e=0,t=r.length;e<t;e++)o[s++]=a[r[e]+1];return o}(e,t)}}function Jv(e,t){switch(e){case Tv.IntDataType.Int8:return new Int8Array(t);case Tv.IntDataType.Int16:return new Int16Array(t);case Tv.IntDataType.Int32:return new Int32Array(t);case Tv.IntDataType.Uint8:return new Uint8Array(t);case Tv.IntDataType.Uint16:return new Uint16Array(t);case Tv.IntDataType.Uint32:return new Uint32Array(t);default:return new Int32Array(t)}}function eb(e,t){switch(e){case Tv.FloatDataType.Float32:return new Float32Array(t);case Tv.FloatDataType.Float64:default:return new Float64Array(t)}}function tb(e,t,n){return new n(Kv?e.buffer:function(e,t){const n=new ArrayBuffer(e.length),r=new Uint8Array(n);for(let n=0,i=e.length;n<i;n+=t)for(let i=0;i<t;i++)r[n+t-i-1]=e[n+i];return n}(e,t))}var nb,rb,ib,ab,sb;function ob(e,t,n){let r,i=1;for(r=0;r<t;r++){const t=i*e;if(Math.abs(Math.round(t)-t)<=n)return r;i*=10}return-1}function lb(e){return rb.classify(e)}!function(e){function t(e){const t=e.growBy*e.elementSize;e.currentSize=t,e.currentIndex=0,e.currentChunk=new e.ctor(t),e.allocatedSize+=t,e.chunks[e.chunks.length]=e.currentChunk}function n(e,t){const{ctor:n,chunks:r,currentIndex:i}=e;if(!r.length)return new n(0);if(1===r.length&&(t||i===e.allocatedSize))return r[0];let a=0;for(let e=0,t=r.length-1;e<t;e++)a+=r[e].length;a+=e.currentIndex;const s=new n(a);let o=0;if(s.buffer)for(let e=0,t=r.length-1;e<t;e++)s.set(r[e],o),o+=r[e].length;else for(let e=0,t=r.length-1;e<t;e++){const t=r[e];for(let e=0,n=t.length;e<n;e++)s[o+e]=t[e];o+=t.length}const l=r[r.length-1];if(s.buffer&&i>=e.currentSize)s.set(l,o);else for(let e=0,t=l.length;e<t;e++)s[o+e]=l[e];return s}e.is=function(e){return e.creator&&e.chunkSize},e.add4=function(e,n,r,i,a){e.currentIndex>=e.currentSize&&t(e);const s=e.currentChunk,o=e.currentIndex;return s[o]=n,s[o+1]=r,s[o+2]=i,s[o+3]=a,e.currentIndex+=4,e.elementCount++},e.add3=function(e,n,r,i){e.currentIndex>=e.currentSize&&t(e);const a=e.currentChunk,s=e.currentIndex;return a[s]=n,a[s+1]=r,a[s+2]=i,e.currentIndex+=3,e.elementCount++},e.add2=function(e,n,r){e.currentIndex>=e.currentSize&&t(e);const i=e.currentChunk,a=e.currentIndex;return i[a]=n,i[a+1]=r,e.currentIndex+=2,e.elementCount++},e.add=function(e,n){return e.currentIndex>=e.currentSize&&t(e),e.currentChunk[e.currentIndex]=n,e.currentIndex+=1,e.elementCount++},e.addRepeat=function(e,n,r){for(let i=0;i<n;i++)e.currentIndex>=e.currentSize&&t(e),e.currentChunk[e.currentIndex++]=r,e.elementCount++;return e.elementCount},e.addMany=function(e,n){const{elementSize:r}=e;for(let i=0,a=n.length;i<a;i+=r){e.currentIndex>=e.currentSize&&t(e);const{currentChunk:a}=e;for(let t=0;t<r;t++)a[e.currentIndex++]=n[i+t];e.elementCount++}return e.elementCount},e.compact=function(e,t=!1){return n(e,t)},e._compact=n,e.create=function(e,t,n,r){const i={ctor:e,elementSize:t,growBy:Math.max(1,Math.ceil(n)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(void 0===r)return i;if("number"==typeof r)return i.currentChunk=new e(r*t),i.allocatedSize=r*t,i.currentSize=i.currentChunk.length,i.chunks[0]=i.currentChunk,i;const a=r;if(a.length%t!=0)throw new Error("initialChunk length must be a multiple of the element size.");return i.currentChunk=a,i.allocatedSize=a.length,i.currentSize=a.length,i.chunks[0]=a,i}}(nb||(nb={})),function(e){function t(e,t){return e>=0?Math.ceil((e+1)/t):Math.ceil((e+1)/(-t-1))}function n({limit8:e,limit16:n},r,i){r.pack8+=t(i,e),r.pack16+=t(i,n),r.count+=1}function r(e,n){e.pack8+=t(n,127),e.pack16+=t(n,32767),e.count+=1}function i(e){return 4*e.count<2*e.pack16?{length:4*e.count,elem:4}:2*e.pack16<e.pack8?{length:2*e.pack16,elem:2}:{length:e.pack8,elem:1}}function a(e,t){const r={pack8:0,pack16:0,count:0};for(let i=0,a=e.length;i<a;i++)n(t,r,e[i]);return{...i(r),kind:"pack"}}function s(e,t){const n={pack8:0,pack16:0,count:0};let a=e[0];for(let t=1,i=e.length;t<i;t++)r(n,e[t]-a),a=e[t];return{...i(n),kind:"delta"}}function o(e,t){const r={pack8:0,pack16:0,count:0};let a=1;for(let i=1,s=e.length;i<s;i++)e[i-1]!==e[i]?(n(t,r,e[i-1]),n(t,r,a),a=1):a++;return n(t,r,e[e.length-1]),n(t,r,a),{...i(r),kind:"rle"}}function l(e,t){const n={pack8:0,pack16:0,count:0};let a=1,s=0,o=0;for(let t=1,i=e.length;t<i;t++){const i=e[t]-s;o!==i?(r(n,o),r(n,a),a=1):a++,o=i,s=e[t]}return r(n,o),r(n,a),{...i(n),kind:"delta-rle"}}function c(e){const t=function(e){let t=!1;for(let n=0,r=e.length;n<r;n++)if(e[n]<0){t=!0;break}return t?{signed:t,limit8:127,limit16:32767}:{signed:t,limit8:255,limit16:65535}}(e),n=[a(e,t),o(e,t),s(e),l(e)];return n.sort(((e,t)=>e.length-t.length)),n}e.getSize=c,e.classify=function(e){if(e.length<2)return sb.by(sb.byteArray);switch(c(e)[0].kind){case"pack":return sb.by(sb.integerPacking);case"rle":return sb.by(sb.runLength).and(sb.integerPacking);case"delta":return sb.by(sb.delta).and(sb.integerPacking);case"delta-rle":return sb.by(sb.delta).and(sb.runLength).and(sb.integerPacking);default:My()}}}(rb||(rb={})),function(e){e.classify=function(e){const{mantissaDigits:t,integerDigits:n}=function(e,t,n){let r=1,i=0;for(let t=0,a=e.length;t<a;t++){if(r>=0){const i=ob(e[t],4,n);i<0?r=-1:i>r&&(r=i)}const a=Math.abs(e[t]);if(a>n){const e=Math.floor(Math.log10(Math.abs(a)))+1;e>i&&(i=e)}}return{mantissaDigits:r,integerDigits:i}}(e,0,1e-6);if(t<0||t+n>10)return sb.by(sb.byteArray);if(0===t)return rb.classify(e);const r=function(e){let t=1;for(let n=0;n<e;n++)t*=10;return t}(t),i=new Int32Array(e.length);for(let t=0,n=e.length;t<n;t++)i[t]=Math.round(r*e[t]);const a=rb.getSize(i)[0],s=sb.by(sb.fixedPoint(r));switch(a.kind){case"pack":return s.and(sb.integerPacking);case"rle":return s.and(sb.runLength).and(sb.integerPacking);case"delta":return s.and(sb.delta).and(sb.integerPacking);case"delta-rle":return s.and(sb.delta).and(sb.runLength).and(sb.integerPacking);default:My()}}}(ib||(ib={}));class cb{and(e){return new cb(this.providers.concat([e]))}encode(e){const t=[];for(const n of this.providers){const r=n(e);if(!r.encodings.length)throw new Error("Encodings must be non-empty.");e=r.data;for(const e of r.encodings)t.push(e)}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:t,data:e}}constructor(e){this.providers=e}}!function(e){function t(e){return new cb([e])}function n(e){switch(e.kind){case"ByteArray":return sb.byteArray;case"FixedPoint":return sb.fixedPoint(e.factor);case"IntervalQuantization":return sb.intervalQuantizaiton(e.min,e.max,e.numSteps);case"RunLength":return sb.runLength;case"Delta":return sb.delta;case"IntegerPacking":return sb.integerPacking;case"StringArray":return sb.stringArray}}e.by=t,e.fromEncoding=function(e){let r=t(n(e[0]));for(let t=1;t<e.length&&"IntegerPacking"!==e[t-1].kind;t++)r=r.and(n(e[t]));return r}}(ab||(ab={})),function(e){e.by=function(e){return new cb([e])};const t={[Tv.IntDataType.Int16]:function(e,t,n){e.setInt16(2*t,n,!0)},[Tv.IntDataType.Uint16]:function(e,t,n){e.setUint16(2*t,n,!0)},[Tv.IntDataType.Int32]:function(e,t,n){e.setInt32(4*t,n,!0)},[Tv.IntDataType.Uint32]:function(e,t,n){e.setUint32(4*t,n,!0)},[Tv.FloatDataType.Float32]:function(e,t,n){e.setFloat32(4*t,n,!0)},[Tv.FloatDataType.Float64]:function(e,t,n){e.setFloat64(8*t,n,!0)}},n={[Tv.IntDataType.Int16]:2,[Tv.IntDataType.Uint16]:2,[Tv.IntDataType.Int32]:4,[Tv.IntDataType.Uint32]:4,[Tv.FloatDataType.Float32]:4,[Tv.FloatDataType.Float64]:8};function r(e){const r=Tv.getDataType(e);if(r===Tv.IntDataType.Int8)return function(e){return{encodings:[{kind:"ByteArray",type:Tv.IntDataType.Int8}],data:new Uint8Array(e.buffer,e.byteOffset)}}(e);if(r===Tv.IntDataType.Uint8)return function(e){return{encodings:[{kind:"ByteArray",type:Tv.IntDataType.Uint8}],data:e}}(e);const i=new Uint8Array(e.length*n[r]),a=t[r],s=new DataView(i.buffer);for(let t=0,n=e.length;t<n;t++)a(s,t,e[t]);return{encodings:[{kind:"ByteArray",type:r}],data:i}}function i(e,t){let n=0;for(let r=0,i=e.length;r<i;r++)n+=e[r]/t|0;return n+=e.length,n}function a(e,t){const n=-t-1;let r=0;for(let i=0,a=e.length;i<a;i++){const a=e[i];r+=a>=0?a/t|0:a/n|0}return r+=e.length,r}e.byteArray=r,e.fixedPoint=function(e){return t=>function(e,t){const n=Tv.getDataType(e),r=new Int32Array(e.length);for(let n=0,i=e.length;n<i;n++)r[n]=Math.round(e[n]*t);return{encodings:[{kind:"FixedPoint",factor:t,srcType:n}],data:r}}(t,e)},e.intervalQuantizaiton=function(e,t,n,r=Int32Array){return i=>function(e,t,n,r,i){const a=Tv.getDataType(e);if(!e.length)return{encodings:[{kind:"IntervalQuantization",min:t,max:n,numSteps:r,srcType:a}],data:new Int32Array(0)};if(n<t){const e=t;t=n,n=e}const s=(n-t)/(r-1),o=new i(e.length);for(let i=0,a=e.length;i<a;i++){const a=e[i];o[i]=a<=t?0:a>=n?r-1:0|Math.round((a-t)/s)}return{encodings:[{kind:"IntervalQuantization",min:t,max:n,numSteps:r,srcType:a}],data:o}}(i,e,t,n,r)},e.runLength=function(e){let t=Tv.getDataType(e);if(void 0===t&&(e=new Int32Array(e),t=Tv.IntDataType.Int32),!e.length)return{encodings:[{kind:"RunLength",srcType:t,srcSize:0}],data:new Int32Array(0)};let n=2;for(let t=1,r=e.length;t<r;t++)e[t-1]!==e[t]&&(n+=2);const r=new Int32Array(n);let i=0,a=1;for(let t=1,n=e.length;t<n;t++)e[t-1]!==e[t]?(r[i]=e[t-1],r[i+1]=a,a=1,i+=2):++a;return r[i]=e[e.length-1],r[i+1]=a,{encodings:[{kind:"RunLength",srcType:t,srcSize:e.length}],data:r}},e.delta=function(e){if(!Tv.isSignedIntegerDataType(e))throw new Error("Only signed integer types can be encoded using delta encoding.");let t=Tv.getDataType(e);if(void 0===t&&(e=new Int32Array(e),t=Tv.IntDataType.Int32),!e.length)return{encodings:[{kind:"Delta",origin:0,srcType:t}],data:new e.constructor(0)};const n=new e.constructor(e.length),r=e[0];n[0]=e[0];for(let t=1,r=e.length;t<r;t++)n[t]=e[t]-e[t-1];return n[0]=0,{encodings:[{kind:"Delta",origin:r,srcType:t}],data:n}},e.integerPacking=function(e){const t=function(e){const t=function(e){for(let t=0,n=e.length;t<n;t++)if(e[t]<0)return!0;return!1}(e),n=t?a(e,127):i(e,255),r=t?a(e,32767):i(e,65535);return 4*e.length<2*r?{isSigned:t,size:e.length,bytesPerElement:4}:2*r<n?{isSigned:t,size:r,bytesPerElement:2}:{isSigned:t,size:n,bytesPerElement:1}}(e);return 4===t.bytesPerElement?r(e):function(e,t){const n=t.isSigned?1===t.bytesPerElement?127:32767:1===t.bytesPerElement?255:65535,i=-n-1,a=e.length,s=t.isSigned?1===t.bytesPerElement?new Int8Array(t.size):new Int16Array(t.size):1===t.bytesPerElement?new Uint8Array(t.size):new Uint16Array(t.size);let o=0;for(let t=0;t<a;t++){let r=e[t];if(r>=0)for(;r>=n;)s[o]=n,++o,r-=n;else for(;r<=i;)s[o]=i,++o,r-=i;s[o]=r,++o}const l=r(s);return{encodings:[{kind:"IntegerPacking",byteCount:t.bytesPerElement,isUnsigned:!t.isSigned,srcSize:a},l.encodings[0]],data:l.data}}(e,t)},e.stringArray=function(e){const t=Object.create(null),n=[],r=new Int32Array(e.length),i=nb.create(Int32Array,1,Math.min(1024,e.length<32?e.length+1:Math.round(e.length/8)+1));nb.add(i,0);let a=0,s=0;for(const o of e){if(null==o){r[s++]=-1;continue}let e=t[o];void 0===e&&(a+=o.length,e=n.length,n[e]=o,t[o]=e,nb.add(i,a)),r[s++]=e}const o=nb.compact(i),l=lb(o).encode(o),c=lb(r).encode(r);return{encodings:[{kind:"StringArray",dataEncoding:c.encoding,stringData:n.join(""),offsetEncoding:l.encoding,offsets:l.data}],data:c.data}}}(sb||(sb={}));const ub=function(){const e=[];for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function db(e){throw new Error(e)}const hb="undefined"!=typeof TextDecoder?new TextDecoder:void 0;function fb(e,t){const n={};for(let r=0;r<t;r++)n[_b(e)]=_b(e);return n}function pb(e,t){const n=new Uint8Array(t),r=e.offset;for(let i=0;i<t;i++)n[i]=e.buffer[i+r];return e.offset+=t,n}function mb(e,t){const n=function(e,t,n){if(hb){const r=t||n!==e.length?e.subarray(t,t+n):e;return hb.decode(r)}return function(e,t,n){const r=ub;let i,a=0;const s=[];for(let o=t,l=t+n;o<l;o++){const t=e[o];128&t?192==(224&t)?s[a++]=r[(15&t)<<6|63&e[++o]]:224==(240&t)?s[a++]=String.fromCharCode((15&t)<<12|(63&e[++o])<<6|63&e[++o]):240==(248&t)?s[a++]=String.fromCharCode((7&t)<<18|(63&e[++o])<<12|(63&e[++o])<<6|63&e[++o]):db("Invalid byte "+t.toString(16)):s[a++]=r[t],512===a&&(i=i||[],i[i.length]=s.join(""),a=0)}return i?(a>0&&(i[i.length]=s.slice(0,a).join("")),i.join("")):s.slice(0,a).join("")}(e,t,n)}(e.buffer,e.offset,t);return e.offset+=t,n}function gb(e,t){const n=new Array(t);for(let r=0;r<t;r++)n[r]=_b(e);return n}function _b(e){const t=e.buffer[e.offset];let n,r;if(!(128&t))return e.offset++,t;if(128==(240&t))return r=15&t,e.offset++,fb(e,r);if(144==(240&t))return r=15&t,e.offset++,gb(e,r);if(160==(224&t))return r=31&t,e.offset++,mb(e,r);if(!(224&~t))return n=e.dataView.getInt8(e.offset),e.offset++,n;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return r=e.dataView.getUint8(e.offset+1),e.offset+=2,pb(e,r);case 197:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,pb(e,r);case 198:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,pb(e,r);case 202:return n=e.dataView.getFloat32(e.offset+1),e.offset+=5,n;case 203:return n=e.dataView.getFloat64(e.offset+1),e.offset+=9,n;case 204:return n=e.buffer[e.offset+1],e.offset+=2,n;case 205:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,n;case 206:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,n;case 208:return n=e.dataView.getInt8(e.offset+1),e.offset+=2,n;case 209:return n=e.dataView.getInt16(e.offset+1),e.offset+=3,n;case 210:return n=e.dataView.getInt32(e.offset+1),e.offset+=5,n;case 217:return r=e.dataView.getUint8(e.offset+1),e.offset+=2,mb(e,r);case 218:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,mb(e,r);case 219:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,mb(e,r);case 220:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,gb(e,r);case 221:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,gb(e,r);case 222:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,fb(e,r);case 223:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,fb(e,r)}throw new Error("Unknown type 0x"+t.toString(16))}function yb(e){const t=Object.create(null),n=Object.create(null);for(const n of e.columns)t[n.name]=n;return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map((e=>e.name)),getField(e){const r=t[e];if(r)return n[e]||(n[e]=function(e){const t=e.mask?Zv(e.mask):void 0,n=Zv(e.data),r=uy(n),i=r?t?e=>0===t[e]?""+n[e]:"":e=>""+n[e]:t?e=>0===t[e]?n[e]:"":e=>n[e],a=r?e=>n[e]:e=>{const t=n[e];return Ry(t,0,t.length)},s=r?e=>n[e]:e=>{const t=n[e];return Dy(t,0,t.length)},o=t?e=>t[e]:e=>0,l=n.length;return{__array:n,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:l,str:i,int:a,float:s,valueKind:o,areValuesEqual:(e,t)=>n[e]===n[t],toStringArray:e=>cy(l,i,e),toIntArray:r?e=>dy(n,e):e=>cy(l,a,e),toFloatArray:r?e=>dy(n,e):e=>cy(l,s,e)}}(r)),n[e]}}}function vb(e){return Sv.create("Parse BinaryCIF",(async t=>{const n=[0,3];try{const t=_b({buffer:r=e,offset:0,dataView:new DataView(r.buffer)});if(!function(e,t){for(let n=0;n<2;n++)if(e[n]>t[n])return!1;return!0}(n,t.version.match(/(\d)\.(\d)\.\d/).slice(1).map((e=>+e))))return Cv.error(`Unsupported format version. Current ${t.version}, required ${n.join(".")}.`);const i=sv(t.dataBlocks.map((e=>{const t=Object.create(null);for(const n of e.categories)t[n.name.substr(1)]=yb(n);return ov(e.categories.map((e=>e.name.substr(1))),t,e.header)})));return Cv.success(i)}catch(e){return Cv.error(""+e)}var r}))}var bb;function xb(e,t,n){return function(e,t,n){const r=Object.create(null);for(const i of Object.keys(e))r[i]=Tb(i,e[i],t,n);return rv.ofTables(t.header,e,r)}(e,t,n)}function wb(e){switch(e.valueType){case"str":return(t,n,r)=>function(e,t,n,r){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:"lowercase"===e.transform?e=>n(e).toLowerCase():"uppercase"===e.transform?e=>n(e).toUpperCase():n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:"lowercase"===e.transform?e=>Array.from(r(e)).map((e=>e.toLowerCase())):"uppercase"===e.transform?e=>Array.from(r(e)).map((e=>e.toUpperCase())):r}}(e,t,t.str,t.toStringArray);case"int":return(t,n,r)=>Sb(e,t,t.int,t.toIntArray);case"float":return(t,n,r)=>Sb(e,t,t.float,t.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function Sb(e,t,n,r){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:r}}function Ab(e,t,n){const r=e.separator,i=e.itemParse,a=t.getField(n),s=a?e=>a.str(e).split(r).map((e=>i(e.trim()))).filter((e=>!!e)):e=>[];return{schema:e,__array:void 0,isDefined:!!a,rowCount:t.rowCount,value:s,valueKind:a?a.valueKind:()=>1,areValuesEqual:(e,t)=>function(e,t){const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}(s(e),s(t)),toArray:e=>cy(t.rowCount,s,e)}}function Mb(e,t,n){const r=e.space,i=t.fieldNames.includes(`${n}[0]`)||t.fieldNames.includes(`${n}[0][0]`)||t.fieldNames.includes(`${n}[0][0][0]`),a=i?0:1,s=t.fieldNames.includes(`${n}_1`)||t.fieldNames.includes(`${n}_11`)||t.fieldNames.includes(`${n}_111`)?"underscore":"brackets",o=function(e,t,n,r){const i=n?0:1;switch(t){case 1:return"brackets"===r?t=>`${e}[${t+i}]`:t=>`${e}_${t+i}`;case 2:return"brackets"===r?(t,n)=>`${e}[${t+i}][${n+i}]`:(t,n)=>`${e}_${t+i}${n+i}`;case 3:return"brackets"===r?(t,n,r)=>`${e}[${t+i}][${n+i}][${r+i}]`:(t,n,r)=>`${e}_${t+i}${n+i}${r+i}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(n,r.rank,i,s),l=t.getField(o(a,a,a))||Ty.Undefined(t.rowCount,e),c=e=>function(e,t,n,r){const i=t.create();if(1===t.rank){const a=t.dimensions[0];for(let s=0;s<a;s++){const a=e.getField(r(s));t.set(i,s,a?a.float(n):0)}}else if(2===t.rank){const a=t.dimensions[0],s=t.dimensions[1];for(let o=0;o<a;o++)for(let a=0;a<s;a++){const s=e.getField(r(o,a));t.set(i,o,a,s?s.float(n):0)}}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const a=t.dimensions[0],s=t.dimensions[1],o=t.dimensions[2];for(let l=0;l<a;l++)for(let a=0;a<s;a++)for(let s=0;s<o;s++){const o=e.getField(r(l,a,s));t.set(i,l,a,s,o?o.float(n):0)}}}return i}(t,r,e,o);return{schema:e,__array:void 0,isDefined:l.isDefined,rowCount:t.rowCount,value:c,valueKind:l.valueKind,areValuesEqual:(e,t)=>Cy.areEqualExact(c(e),c(t)),toArray:e=>cy(t.rowCount,c,e)}}!function(e){function t(e){return e.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t,e.equal=function(e,n){return t(e)===t(n)},e.create=function(e,n,r=!1){const i=`${e}${n?`.${n}`:""}`;return r?t(i):i}}(bb||(bb={}));class Eb{constructor(e,t,n){this._isDefined=n;const r=Object.keys(t);this._rowCount=e.rowCount,this._columns=r,this._schema=t;const i=Object.create(null);for(const n of r)Object.defineProperty(this,n,{get:function(){if(i[n])return i[n];const r=t[n];if("list"===r.valueType)i[n]=Ab(r,e,n);else if("tensor"===r.valueType)i[n]=Mb(r,e,n);else{const t=wb(r),a=e.getField(n);i[n]=a?t(a,e,n):Ty.Undefined(e.rowCount,r)}return i[n]},enumerable:!0,configurable:!1})}}function Cb(e,t,n,r){const i=bb.create(t,e),a=bb.canonical(i);if(a in n)return n[a];if(r&&i in r)for(const e of r[i]){const t=bb.canonical(e);if(t in n)return n[t]}}function Tb(e,t,n,r){let i=n.categories[e];if(r){const a=function(e){const t=Object.create(null);for(const n of Object.keys(e.categories))for(const r of e.categories[n].fieldNames)t[bb.create(n,r,!0)]=e.categories[n].getField(r);return t}(n),s=Object.create(null),o=[];let l=0;for(const n of Object.keys(t)){const t=Cb(n,e,a,r);t&&(s[n]=t,o.push(n),l=t.rowCount)}i={rowCount:l,name:e,fieldNames:[...o],getField:e=>s[e]}}return new Eb(i||lv.empty(e),t,!!i)}var Pb=Ty.Schema;const Ib=Pb.str,Rb=Pb.int,kb=Pb.float,Db=Pb.coord,Lb=Pb.Aliased,Nb=Pb.Matrix,Ob=Pb.Vector,Fb=Pb.lstr,Ub=Pb.List,Bb={atom_site:{auth_asym_id:Ib,auth_atom_id:Ib,auth_comp_id:Ib,auth_seq_id:Rb,B_iso_or_equiv:kb,Cartn_x:Db,Cartn_y:Db,Cartn_z:Db,group_PDB:Lb(Ib),id:Rb,label_alt_id:Ib,label_asym_id:Ib,label_atom_id:Ib,label_comp_id:Ib,label_entity_id:Ib,label_seq_id:Rb,occupancy:kb,type_symbol:Ib,pdbx_PDB_ins_code:Ib,pdbx_PDB_model_num:Rb,pdbx_formal_charge:Rb,pdbx_label_index:Rb,pdbx_sifts_xref_db_name:Ib,pdbx_sifts_xref_db_acc:Ib,pdbx_sifts_xref_db_num:Ib,pdbx_sifts_xref_db_res:Ib,ihm_model_id:Rb},atom_site_anisotrop:{id:Rb,type_symbol:Ib,U:Nb(3,3),U_esd:Nb(3,3),pdbx_auth_seq_id:Ib,pdbx_auth_asym_id:Ib,pdbx_auth_atom_id:Ib,pdbx_auth_comp_id:Ib,pdbx_label_seq_id:Rb,pdbx_label_alt_id:Ib,pdbx_label_asym_id:Ib,pdbx_label_atom_id:Ib,pdbx_label_comp_id:Ib,pdbx_PDB_ins_code:Ib},atom_sites:{entry_id:Ib,fract_transf_matrix:Nb(3,3),fract_transf_vector:Ob(3)},audit_author:{name:Ib,pdbx_ordinal:Rb,identifier_ORCID:Ib},audit_conform:{dict_location:Ib,dict_name:Ib,dict_version:Ib},cell:{angle_alpha:kb,angle_beta:kb,angle_gamma:kb,entry_id:Ib,length_a:kb,length_b:kb,length_c:kb,Z_PDB:Rb,pdbx_unique_axis:Ib},chem_comp:{formula:Ib,formula_weight:kb,id:Ib,mon_nstd_flag:Lb(Fb),name:Ib,type:Lb(Fb),pdbx_synonyms:Ub(";",(e=>e))},chem_comp_bond:{atom_id_1:Ib,atom_id_2:Ib,comp_id:Ib,value_order:Lb(Fb),pdbx_ordinal:Rb,pdbx_stereo_config:Lb(Fb),pdbx_aromatic_flag:Lb(Fb)},citation:{book_publisher:Ib,country:Ib,id:Ib,journal_abbrev:Ib,journal_id_ASTM:Ib,journal_id_CSD:Ib,journal_id_ISSN:Ib,journal_volume:Ib,page_first:Ib,page_last:Ib,title:Ib,year:Rb,pdbx_database_id_DOI:Ib,pdbx_database_id_PubMed:Rb},citation_author:{citation_id:Ib,name:Ib,ordinal:Rb},database_2:{database_id:Lb(Fb),database_code:Ib},entity:{details:Ib,formula_weight:kb,id:Ib,src_method:Lb(Fb),type:Lb(Fb),pdbx_description:Ub(",",(e=>e)),pdbx_number_of_molecules:Rb,pdbx_mutation:Ib,pdbx_fragment:Ib,pdbx_ec:Ub(",",(e=>e))},entity_poly:{entity_id:Ib,nstd_linkage:Lb(Fb),nstd_monomer:Lb(Fb),type:Lb(Ib),pdbx_strand_id:Ub(",",(e=>e)),pdbx_seq_one_letter_code:Ib,pdbx_seq_one_letter_code_can:Ib,pdbx_target_identifier:Ib},entity_poly_seq:{entity_id:Ib,hetero:Lb(Fb),mon_id:Ib,num:Rb},entry:{id:Ib},exptl:{entry_id:Ib,method:Lb(Ib)},software:{classification:Ib,date:Ib,description:Ib,name:Ib,type:Lb(Fb),version:Ib,pdbx_ordinal:Rb},struct:{entry_id:Ib,title:Ib,pdbx_descriptor:Ib},struct_asym:{details:Ib,entity_id:Ib,id:Ib,pdbx_modified:Ib,pdbx_blank_PDB_chainid_flag:Lb(Ib)},struct_conf:{beg_label_asym_id:Ib,beg_label_comp_id:Ib,beg_label_seq_id:Rb,beg_auth_asym_id:Ib,beg_auth_comp_id:Ib,beg_auth_seq_id:Rb,conf_type_id:Lb(Fb),details:Ib,end_label_asym_id:Ib,end_label_comp_id:Ib,end_label_seq_id:Rb,end_auth_asym_id:Ib,end_auth_comp_id:Ib,end_auth_seq_id:Rb,id:Ib,pdbx_beg_PDB_ins_code:Ib,pdbx_end_PDB_ins_code:Ib,pdbx_PDB_helix_class:Ib,pdbx_PDB_helix_length:Rb,pdbx_PDB_helix_id:Ib},struct_conn:{conn_type_id:Lb(Fb),details:Ib,id:Ib,ptnr1_label_asym_id:Ib,ptnr1_label_atom_id:Ib,ptnr1_label_comp_id:Ib,ptnr1_label_seq_id:Rb,ptnr1_auth_asym_id:Ib,ptnr1_auth_comp_id:Ib,ptnr1_auth_seq_id:Rb,ptnr1_symmetry:Ib,ptnr2_label_asym_id:Ib,ptnr2_label_atom_id:Ib,ptnr2_label_comp_id:Ib,ptnr2_label_seq_id:Rb,ptnr2_auth_asym_id:Ib,ptnr2_auth_comp_id:Ib,ptnr2_auth_seq_id:Rb,ptnr2_symmetry:Ib,pdbx_ptnr1_PDB_ins_code:Ib,pdbx_ptnr1_label_alt_id:Ib,pdbx_ptnr1_standard_comp_id:Ib,pdbx_ptnr2_PDB_ins_code:Ib,pdbx_ptnr2_label_alt_id:Ib,pdbx_ptnr3_PDB_ins_code:Ib,pdbx_ptnr3_label_alt_id:Ib,pdbx_ptnr3_label_asym_id:Ib,pdbx_ptnr3_label_atom_id:Ib,pdbx_ptnr3_label_comp_id:Ib,pdbx_ptnr3_label_seq_id:Rb,pdbx_PDB_id:Ib,pdbx_dist_value:kb,pdbx_value_order:Lb(Fb)},struct_conn_type:{criteria:Ib,id:Lb(Fb),reference:Ib},struct_keywords:{entry_id:Ib,text:Ub(",",(e=>e)),pdbx_keywords:Ib},struct_ncs_oper:{code:Lb(Ib),details:Ib,id:Rb,matrix:Nb(3,3),vector:Ob(3)},struct_sheet_range:{beg_label_asym_id:Ib,beg_label_comp_id:Ib,beg_label_seq_id:Rb,end_label_asym_id:Ib,end_label_comp_id:Ib,end_label_seq_id:Rb,beg_auth_asym_id:Ib,beg_auth_comp_id:Ib,beg_auth_seq_id:Rb,end_auth_asym_id:Ib,end_auth_comp_id:Ib,end_auth_seq_id:Rb,id:Ib,sheet_id:Ib,pdbx_beg_PDB_ins_code:Ib,pdbx_end_PDB_ins_code:Ib},struct_site:{details:Ib,id:Ib,pdbx_num_residues:Rb,pdbx_evidence_code:Ib,pdbx_auth_asym_id:Ib,pdbx_auth_comp_id:Ib,pdbx_auth_seq_id:Ib,pdbx_auth_ins_code:Ib},struct_site_gen:{details:Ib,id:Ib,label_alt_id:Ib,label_asym_id:Ib,label_atom_id:Ib,label_comp_id:Ib,label_seq_id:Rb,auth_asym_id:Ib,auth_comp_id:Ib,auth_seq_id:Ib,site_id:Ib,symmetry:Ib,pdbx_auth_ins_code:Ib,pdbx_num_res:Rb},symmetry:{entry_id:Ib,cell_setting:Lb(Fb),Int_Tables_number:Rb,space_group_name_Hall:Ib,"space_group_name_H-M":Ib},pdbx_database_status:{status_code:Lb(Ib),status_code_sf:Lb(Ib),status_code_mr:Lb(Ib),entry_id:Ib,recvd_initial_deposition_date:Ib,SG_entry:Lb(Fb),deposit_site:Lb(Ib),process_site:Lb(Ib),status_code_cs:Lb(Ib),methods_development_category:Lb(Ib),pdb_format_compatible:Lb(Fb)},pdbx_nonpoly_scheme:{asym_id:Ib,entity_id:Ib,mon_id:Ib,pdb_strand_id:Ib,ndb_seq_num:Ib,pdb_seq_num:Ib,auth_seq_num:Ib,pdb_mon_id:Ib,auth_mon_id:Ib,pdb_ins_code:Ib},pdbx_database_related:{db_name:Ib,details:Ib,db_id:Ib,content_type:Lb(Ib)},pdbx_entity_nonpoly:{entity_id:Ib,comp_id:Ib,name:Ib},pdbx_chem_comp_synonyms:{name:Ib,comp_id:Ib,provenance:Lb(Ib)},pdbx_chem_comp_identifier:{comp_id:Ib,identifier:Ib,type:Lb(Ib),program:Ib,program_version:Ib},pdbx_unobs_or_zero_occ_residues:{id:Rb,polymer_flag:Lb(Fb),occupancy_flag:Lb(Rb),PDB_model_num:Rb,auth_asym_id:Ib,auth_comp_id:Ib,auth_seq_id:Ib,PDB_ins_code:Ib,label_asym_id:Ib,label_comp_id:Ib,label_seq_id:Rb},pdbx_struct_mod_residue:{id:Rb,auth_asym_id:Ib,auth_comp_id:Ib,auth_seq_id:Rb,PDB_ins_code:Ib,label_asym_id:Ib,label_comp_id:Ib,label_seq_id:Rb,parent_comp_id:Ib,details:Ib},pdbx_struct_oper_list:{id:Ib,type:Lb(Ib),name:Ib,symmetry_operation:Ib,matrix:Nb(3,3),vector:Ob(3)},pdbx_struct_assembly:{method_details:Ib,oligomeric_details:Ib,oligomeric_count:Rb,details:Ib,id:Ib},pdbx_struct_assembly_gen:{asym_id_list:Ub(",",(e=>e)),assembly_id:Ib,oper_expression:Ib},pdbx_reference_entity_list:{prd_id:Ib,ref_entity_id:Ib,type:Lb(Fb),details:Ib,component_id:Rb},pdbx_reference_entity_link:{link_id:Rb,prd_id:Ib,details:Ib,ref_entity_id_1:Ib,ref_entity_id_2:Ib,entity_seq_num_1:Rb,entity_seq_num_2:Rb,comp_id_1:Ib,comp_id_2:Ib,atom_id_1:Ib,atom_id_2:Ib,value_order:Lb(Fb),component_1:Rb,component_2:Rb,link_class:Lb(Ib)},pdbx_reference_entity_poly_link:{link_id:Rb,prd_id:Ib,ref_entity_id:Ib,component_id:Rb,entity_seq_num_1:Rb,entity_seq_num_2:Rb,comp_id_1:Ib,comp_id_2:Ib,atom_id_1:Ib,atom_id_2:Ib,value_order:Lb(Fb)},pdbx_molecule:{prd_id:Ib,instance_id:Rb,asym_id:Ib},pdbx_molecule_features:{prd_id:Ib,class:Lb(Fb),type:Lb(Fb),name:Ib,details:Ib},entity_src_nat:{entity_id:Ib,pdbx_organism_scientific:Ib,pdbx_plasmid_name:Ib,pdbx_src_id:Rb,pdbx_beg_seq_num:Rb,pdbx_end_seq_num:Rb},entity_src_gen:{entity_id:Ib,pdbx_gene_src_gene:Ub(",",(e=>e)),pdbx_gene_src_scientific_name:Ib,plasmid_name:Ib,pdbx_src_id:Rb,pdbx_beg_seq_num:Rb,pdbx_end_seq_num:Rb},pdbx_entity_src_syn:{organism_scientific:Ib,entity_id:Ib,pdbx_src_id:Rb,pdbx_beg_seq_num:Rb,pdbx_end_seq_num:Rb},pdbx_entity_branch_descriptor:{entity_id:Ib,descriptor:Ib,type:Lb(Fb),program:Ib,program_version:Ib,ordinal:Rb},pdbx_entity_instance_feature:{details:Ib,feature_type:Lb(Ib),auth_asym_id:Ib,asym_id:Ib,auth_seq_num:Ib,seq_num:Rb,comp_id:Ib,auth_comp_id:Ib,ordinal:Rb},pdbx_entity_branch_list:{entity_id:Ib,hetero:Lb(Fb),comp_id:Ib,num:Rb},pdbx_entity_branch_link:{link_id:Rb,details:Ib,entity_id:Ib,entity_branch_list_num_1:Rb,entity_branch_list_num_2:Rb,comp_id_1:Ib,comp_id_2:Ib,atom_id_1:Ib,leaving_atom_id_1:Ib,atom_stereo_config_1:Lb(Fb),atom_id_2:Ib,leaving_atom_id_2:Ib,atom_stereo_config_2:Lb(Fb),value_order:Lb(Fb)},pdbx_entity_branch:{entity_id:Ib,type:Lb(Ib)},pdbx_branch_scheme:{entity_id:Ib,hetero:Lb(Fb),asym_id:Ib,mon_id:Ib,num:Rb,pdb_asym_id:Ib,pdb_seq_num:Ib,pdb_mon_id:Ib,auth_asym_id:Ib,auth_seq_num:Ib,auth_mon_id:Ib},pdbx_chem_comp_related:{comp_id:Ib,related_comp_id:Ib,relationship_type:Lb(Ib),details:Ib},ihm_starting_model_details:{starting_model_id:Ib,entity_id:Ib,entity_description:Ib,asym_id:Ib,entity_poly_segment_id:Rb,starting_model_source:Lb(Ib),starting_model_auth_asym_id:Ib,starting_model_sequence_offset:Rb,dataset_list_id:Rb},ihm_starting_comparative_models:{id:Rb,starting_model_id:Ib,starting_model_auth_asym_id:Ib,starting_model_seq_id_begin:Rb,starting_model_seq_id_end:Rb,template_auth_asym_id:Ib,template_seq_id_begin:Rb,template_seq_id_end:Rb,template_sequence_identity:kb,template_sequence_identity_denominator:Lb(Rb),template_dataset_list_id:Rb,alignment_file_id:Rb},ihm_starting_model_seq_dif:{id:Rb,entity_id:Ib,asym_id:Ib,seq_id:Rb,comp_id:Ib,starting_model_id:Ib,db_asym_id:Ib,db_seq_id:Rb,db_comp_id:Ib,details:Ib},ihm_model_representation:{id:Rb,name:Ib,details:Ib},ihm_model_representation_details:{id:Rb,representation_id:Rb,entity_poly_segment_id:Rb,entity_id:Ib,entity_description:Ib,entity_asym_id:Ib,model_object_primitive:Lb(Ib),starting_model_id:Ib,model_mode:Lb(Ib),model_granularity:Lb(Ib),model_object_count:Rb},ihm_struct_assembly_details:{id:Rb,assembly_id:Rb,parent_assembly_id:Rb,entity_description:Ib,entity_id:Ib,asym_id:Ib,entity_poly_segment_id:Rb},ihm_struct_assembly:{id:Rb,name:Ib,description:Ib},ihm_modeling_protocol:{id:Rb,num_steps:Rb,protocol_name:Ib},ihm_modeling_protocol_details:{id:Rb,protocol_id:Rb,step_id:Rb,struct_assembly_id:Rb,dataset_group_id:Rb,struct_assembly_description:Ib,step_name:Ib,step_method:Ib,num_models_begin:Rb,num_models_end:Rb,multi_scale_flag:Lb(Fb),multi_state_flag:Lb(Fb),ordered_flag:Lb(Fb),script_file_id:Rb,software_id:Rb},ihm_multi_state_modeling:{state_id:Rb,state_group_id:Rb,population_fraction:kb,population_fraction_sd:kb,state_type:Ib,state_name:Ib,experiment_type:Lb(Ib),details:Ib},ihm_modeling_post_process:{id:Rb,protocol_id:Rb,analysis_id:Rb,step_id:Rb,type:Lb(Ib),feature:Lb(Ib),num_models_begin:Rb,num_models_end:Rb},ihm_ensemble_info:{ensemble_id:Rb,ensemble_name:Ib,post_process_id:Rb,model_group_id:Rb,ensemble_clustering_method:Lb(Ib),ensemble_clustering_feature:Lb(Ib),num_ensemble_models:Rb,num_ensemble_models_deposited:Rb,ensemble_precision_value:kb,ensemble_file_id:Rb},ihm_model_list:{model_id:Rb,model_name:Ib,assembly_id:Rb,protocol_id:Rb,representation_id:Rb},ihm_model_group:{id:Rb,name:Ib,details:Ib},ihm_model_group_link:{model_id:Rb,group_id:Rb},ihm_model_representative:{id:Rb,model_group_id:Rb,model_id:Rb,selection_criteria:Lb(Ib)},ihm_dataset_list:{id:Rb,data_type:Lb(Ib),database_hosted:Lb(Fb)},ihm_dataset_group:{id:Rb,name:Ib,application:Lb(Ib),details:Ib},ihm_dataset_group_link:{dataset_list_id:Rb,group_id:Rb},ihm_related_datasets:{dataset_list_id_derived:Rb,dataset_list_id_primary:Rb},ihm_dataset_related_db_reference:{id:Rb,dataset_list_id:Rb,db_name:Lb(Ib),accession_code:Ib,version:Ib,details:Ib},ihm_external_reference_info:{reference_id:Rb,reference_provider:Ib,reference_type:Lb(Ib),reference:Ib,refers_to:Lb(Ib),associated_url:Ib},ihm_external_files:{id:Rb,reference_id:Rb,file_path:Ib,content_type:Lb(Ib),file_size_bytes:kb,details:Ib},ihm_dataset_external_reference:{id:Rb,dataset_list_id:Rb,file_id:Rb},ihm_localization_density_files:{id:Rb,file_id:Rb,ensemble_id:Rb,entity_id:Ib,entity_poly_segment_id:Rb,asym_id:Ib},ihm_predicted_contact_restraint:{id:Rb,group_id:Rb,entity_id_1:Ib,entity_id_2:Ib,asym_id_1:Ib,asym_id_2:Ib,comp_id_1:Ib,comp_id_2:Ib,seq_id_1:Rb,seq_id_2:Rb,rep_atom_1:Lb(Ib),rep_atom_2:Lb(Ib),distance_lower_limit:kb,distance_upper_limit:kb,probability:kb,restraint_type:Lb(Ib),model_granularity:Lb(Ib),dataset_list_id:Rb,software_id:Rb},ihm_cross_link_list:{id:Rb,group_id:Rb,entity_description_1:Ib,entity_description_2:Ib,entity_id_1:Ib,entity_id_2:Ib,comp_id_1:Ib,comp_id_2:Ib,seq_id_1:Rb,seq_id_2:Rb,linker_type:Lb(Ib),dataset_list_id:Rb},ihm_cross_link_restraint:{id:Rb,group_id:Rb,entity_id_1:Ib,entity_id_2:Ib,asym_id_1:Ib,asym_id_2:Ib,comp_id_1:Ib,comp_id_2:Ib,seq_id_1:Rb,seq_id_2:Rb,atom_id_1:Ib,atom_id_2:Ib,restraint_type:Lb(Ib),conditional_crosslink_flag:Lb(Ib),model_granularity:Lb(Ib),distance_threshold:kb,psi:kb,sigma_1:kb,sigma_2:kb},ihm_cross_link_result_parameters:{id:Rb,restraint_id:Rb,model_id:Rb,psi:kb,sigma_1:kb,sigma_2:kb},ihm_2dem_class_average_restraint:{id:Rb,dataset_list_id:Rb,number_raw_micrographs:Rb,pixel_size_width:kb,pixel_size_height:kb,image_resolution:kb,image_segment_flag:Lb(Fb),number_of_projections:Rb,struct_assembly_id:Rb,details:Ib},ihm_2dem_class_average_fitting:{id:Rb,restraint_id:Rb,model_id:Rb,cross_correlation_coefficient:kb,rot_matrix:Nb(3,3),tr_vector:Ob(3)},ihm_3dem_restraint:{id:Rb,dataset_list_id:Rb,model_id:Rb,struct_assembly_id:Rb,fitting_method:Ib,number_of_gaussians:Rb,cross_correlation_coefficient:kb},ihm_sas_restraint:{id:Rb,dataset_list_id:Rb,model_id:Rb,struct_assembly_id:Rb,profile_segment_flag:Lb(Fb),fitting_atom_type:Ib,fitting_method:Ib,fitting_state:Lb(Ib),radius_of_gyration:kb,chi_value:kb,details:Ib},ihm_starting_model_coord:{ordinal_id:Rb,starting_model_id:Ib,group_PDB:Lb(Ib),id:Rb,type_symbol:Ib,entity_id:Ib,atom_id:Ib,comp_id:Ib,seq_id:Rb,asym_id:Ib,Cartn_x:kb,Cartn_y:kb,Cartn_z:kb,B_iso_or_equiv:kb},ihm_sphere_obj_site:{id:Rb,entity_id:Ib,seq_id_begin:Rb,seq_id_end:Rb,asym_id:Ib,Cartn_x:kb,Cartn_y:kb,Cartn_z:kb,object_radius:kb,rmsf:kb,model_id:Rb},ihm_gaussian_obj_site:{id:Rb,entity_id:Ib,seq_id_begin:Rb,seq_id_end:Rb,asym_id:Ib,mean_Cartn_x:kb,mean_Cartn_y:kb,mean_Cartn_z:kb,weight:kb,covariance_matrix:Nb(3,3),model_id:Rb},ihm_gaussian_obj_ensemble:{id:Rb,entity_id:Ib,seq_id_begin:Rb,seq_id_end:Rb,asym_id:Ib,mean_Cartn_x:kb,mean_Cartn_y:kb,mean_Cartn_z:kb,weight:kb,covariance_matrix:Nb(3,3),ensemble_id:Rb},ihm_feature_list:{feature_id:Rb,feature_type:Lb(Ib),entity_type:Lb(Ib)},ihm_poly_residue_feature:{ordinal_id:Rb,feature_id:Rb,entity_id:Ib,asym_id:Ib,comp_id_begin:Ib,comp_id_end:Ib,seq_id_begin:Rb,seq_id_end:Rb},ihm_derived_distance_restraint:{id:Rb,group_id:Rb,feature_id_1:Rb,feature_id_2:Rb,group_conditionality:Lb(Ib),random_exclusion_fraction:kb,distance_upper_limit:kb,restraint_type:Lb(Ib),dataset_list_id:Rb},ma_model_list:{ordinal_id:Rb,model_id:Rb,model_group_id:Rb,model_name:Ib,model_group_name:Ib,model_type:Lb(Ib),data_id:Rb},ma_target_entity:{entity_id:Ib,data_id:Rb,origin:Lb(Ib)},ma_target_entity_instance:{asym_id:Ib,entity_id:Ib,details:Ib},ma_target_ref_db_details:{target_entity_id:Ib,db_name:Lb(Ib),db_code:Ib,db_accession:Ib,seq_db_isoform:Ib,seq_db_align_begin:Ib,seq_db_align_end:Ib,ncbi_taxonomy_id:Ib,organism_scientific:Ib},ma_data:{id:Rb,content_type:Lb(Ib),content_type_other_details:Ib,name:Ib},ma_software_group:{ordinal_id:Rb,group_id:Rb,software_id:Rb},ma_qa_metric:{id:Rb,name:Ib,type:Lb(Ib),mode:Lb(Ib),software_group_id:Rb},ma_qa_metric_global:{ordinal_id:Rb,model_id:Rb,metric_id:Rb,metric_value:kb},ma_qa_metric_local:{ordinal_id:Rb,model_id:Rb,label_asym_id:Ib,label_seq_id:Rb,label_comp_id:Ib,metric_id:Rb,metric_value:kb}};var zb=Ty.Schema;const Vb=zb.str,Hb=zb.float,$b=zb.List,Gb=zb.lstr,jb=zb.Aliased,Wb=zb.int,qb=zb.coord,Xb={chem_comp:{formula:Vb,formula_weight:Hb,id:Vb,mon_nstd_parent_comp_id:$b(",",(e=>e)),name:Vb,one_letter_code:Vb,three_letter_code:Vb,type:jb(Gb),pdbx_synonyms:$b(";",(e=>e)),pdbx_type:Vb,pdbx_ambiguous_flag:Vb,pdbx_replaced_by:Vb,pdbx_replaces:Vb,pdbx_formal_charge:Wb,pdbx_model_coordinates_details:Vb,pdbx_model_coordinates_db_code:Vb,pdbx_ideal_coordinates_details:Vb,pdbx_ideal_coordinates_missing_flag:jb(Gb),pdbx_model_coordinates_missing_flag:jb(Gb),pdbx_initial_date:Vb,pdbx_modified_date:Vb,pdbx_release_status:jb(Vb),pdbx_processing_site:jb(Vb)},chem_comp_atom:{alt_atom_id:Vb,atom_id:Vb,charge:Wb,model_Cartn_x:qb,model_Cartn_y:qb,model_Cartn_z:qb,comp_id:Vb,type_symbol:Vb,pdbx_align:Wb,pdbx_ordinal:Wb,pdbx_model_Cartn_x_ideal:qb,pdbx_model_Cartn_y_ideal:qb,pdbx_model_Cartn_z_ideal:qb,pdbx_stereo_config:jb(Gb),pdbx_aromatic_flag:jb(Gb),pdbx_leaving_atom_flag:jb(Gb)},chem_comp_bond:{atom_id_1:Vb,atom_id_2:Vb,comp_id:Vb,value_order:jb(Gb),pdbx_ordinal:Wb,pdbx_stereo_config:jb(Gb),pdbx_aromatic_flag:jb(Gb)},pdbx_chem_comp_descriptor:{comp_id:Vb,descriptor:Vb,type:jb(Gb),program:Vb,program_version:Vb},pdbx_chem_comp_identifier:{comp_id:Vb,identifier:Vb,type:jb(Vb),program:Vb,program_version:Vb}};var Yb=Ty.Schema;const Kb=Yb.str,Zb=Yb.float,Qb=Yb.lstr,Jb=Yb.Aliased,ex=Yb.int,tx={pdbx_reference_molecule:{prd_id:Kb,formula_weight:Zb,formula:Kb,type:Jb(Qb),type_evidence_code:Kb,class:Jb(Qb),class_evidence_code:Kb,name:Kb,represent_as:Jb(Qb),chem_comp_id:Kb,compound_details:Kb,description:Kb,representative_PDB_id_code:Kb,release_status:Jb(Qb),replaces:Kb,replaced_by:Kb},pdbx_reference_entity_list:{prd_id:Kb,ref_entity_id:Kb,type:Jb(Qb),details:Kb,component_id:ex},pdbx_reference_entity_nonpoly:{prd_id:Kb,ref_entity_id:Kb,name:Kb,chem_comp_id:Kb},pdbx_reference_entity_link:{link_id:ex,prd_id:Kb,details:Kb,ref_entity_id_1:Kb,ref_entity_id_2:Kb,entity_seq_num_1:ex,entity_seq_num_2:ex,comp_id_1:Kb,comp_id_2:Kb,atom_id_1:Kb,atom_id_2:Kb,value_order:Jb(Qb),component_1:ex,component_2:ex,link_class:Jb(Kb)},pdbx_reference_entity_poly_link:{link_id:ex,prd_id:Kb,ref_entity_id:Kb,component_id:ex,entity_seq_num_1:ex,entity_seq_num_2:ex,comp_id_1:Kb,comp_id_2:Kb,atom_id_1:Kb,atom_id_2:Kb,value_order:Jb(Qb)},pdbx_reference_entity_poly:{prd_id:Kb,ref_entity_id:Kb,type:Jb(Kb),db_code:Kb,db_name:Kb},pdbx_reference_entity_poly_seq:{prd_id:Kb,ref_entity_id:Kb,mon_id:Kb,parent_mon_id:Kb,num:ex,observed:Jb(Qb),hetero:Jb(Qb)},pdbx_reference_entity_sequence:{prd_id:Kb,ref_entity_id:Kb,type:Jb(Kb),NRP_flag:Jb(Kb),one_letter_codes:Kb},pdbx_reference_entity_src_nat:{prd_id:Kb,ref_entity_id:Kb,ordinal:ex,organism_scientific:Kb,taxid:Kb,db_code:Kb,db_name:Kb},pdbx_prd_audit:{prd_id:Kb,date:Kb,processing_site:Jb(Kb),action_type:Jb(Kb)}};var nx=Ty.Schema;const rx=nx.str,ix={datablock:{id:rx,description:rx},dictionary:{title:rx,datablock_id:rx,version:rx},dictionary_history:{version:rx,update:rx,revision:rx},sub_category:{id:rx,description:rx},category_group_list:{id:rx,parent_id:rx,description:rx},item_type_list:{code:rx,primitive_code:rx,construct:rx,detail:rx},item_units_list:{code:rx,detail:rx},item_units_conversion:{from_code:rx,to_code:rx,operator:rx,factor:nx.float}};var ax=Ty.Schema;const sx=ax.str,ox=ax.int,lx=ax.float,cx=ax.Aliased,ux=ax.Vector;cx(sx),cx(sx),cx(sx),cx(sx),ux(3),ux(3);const dx={volume_data_3d_info:{name:sx,axis_order:ux(3,ox),origin:ux(3),dimensions:ux(3),sample_rate:ox,sample_count:ux(3,ox),spacegroup_number:ox,spacegroup_cell_size:ux(3),spacegroup_cell_angles:ux(3),mean_source:lx,mean_sampled:lx,sigma_source:lx,sigma_sampled:lx,min_source:lx,min_sampled:lx,max_source:lx,max_sampled:lx},volume_data_3d:{values:lx}};var hx=Ty.Schema;const fx=hx.float,px=hx.int,mx=hx.str,gx={cell:{angle_alpha:fx,angle_beta:fx,angle_gamma:fx,formula_units_z:px,length_a:fx,length_b:fx,length_c:fx,volume:fx},chemical:{melting_point:fx,name_common:mx,name_systematic:mx},chemical_formula:{moiety:mx,sum:mx,weight:fx},space_group:{crystal_system:mx,it_number:px,"name_h-m_full":mx},space_group_symop:{operation_xyz:mx},geom_bond:{atom_site_label_1:mx,atom_site_label_2:mx,distance:fx,publ_flag:mx,site_symmetry_1:mx,site_symmetry_2:mx,valence:fx},audit:{block_doi:mx},database_code:{cod:mx,csd:mx,depnum_ccdc_archive:mx,depnum_ccdc_fiz:mx,icsd:mx,mdf:mx,nbs:mx},atom_site:{adp_type:mx,calc_flag:mx,disorder_assembly:mx,disorder_group:mx,fract_x:fx,fract_y:fx,fract_z:fx,label:mx,occupancy:fx,refinement_flags:mx,site_symmetry_multiplicity:px,type_symbol:mx,u_iso_or_equiv:fx},atom_site_aniso:{label:mx,u_11:fx,u:(0,hx.Matrix)(3,3),u_12:fx,u_13:fx,u_22:fx,u_23:fx,u_33:fx},atom_type:{description:mx,symbol:mx},atom_type_scat:{dispersion_imag:fx,dispersion_real:fx,source:mx}},_x={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},yx=Ty.Schema.int,vx={volume_data_3d_info:dx.volume_data_3d_info,segmentation_data_table:{set_id:yx,segment_id:yx},segmentation_data_3d:{values:yx}},bx={parse:e=>"string"==typeof e?Yv(e):vb(e),parseText:Yv,parseBinary:vb,toDatabaseCollection:function(e,t,n){const r={};for(const i of t.blocks)r[i.header]=xb(e,i,n);return r},toDatabase:xb,schema:{mmCIF:e=>xb(Bb,e),CCD:e=>xb(Xb,e),BIRD:e=>xb(tx,e),dic:e=>xb(ix,e),cifCore:e=>xb(gx,e,_x),densityServer:e=>xb(dx,e),segmentation:e=>xb(vx,e)}};class xx{constructor(e,t){var n=t||{};this.streamer=e,this.name=Ol(n.name,""),this.path=Ol(n.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then((()=>tg(this,void 0,void 0,(function*(){return yield this._beforeParse(),yield this._parse(),yield this._afterParse(),this[this.__objName]}))))}_parse(){}_beforeParse(){}_afterParse(){Xc&&Wc.log(this[this.__objName])}}class wx extends xx{constructor(e,t){var n=t||{};super(e,n),this.firstModelOnly=Ol(n.firstModelOnly,!1),this.asTrajectory=Ol(n.asTrajectory,!1),this.cAlphaOnly=Ol(n.cAlphaOnly,!1),this.structure=new Zp(this.name,this.path),this.structureBuilder=new fp(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}class Sx{constructor(e,t,n="",r,i=[]){this.structure=e,this.index=t,this.description=n,this.entityType=function(e){switch(e=e.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}}(r||""),this.chainIndexList=i,i.forEach((function(n){e.chainStore.entityIndex[n]=t}))}get type(){return function(e){switch(e){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}}(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return 1===this.entityType}isNonPolymer(){return 2===this.entityType}isMacrolide(){return 3===this.entityType}isWater(){return 4===this.entityType}eachChain(e){const t=this.structure.getChainProxy();this.chainIndexList.forEach((function(n){t.index=n,e(t)}))}}const Ax={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class Mx{constructor(e=Ax){this.cartToFrac=new _r,this.fracToCart=new _r,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;const t=Kl(this.alpha),n=Kl(this.beta),r=Kl(this.gamma),i=Math.cos(t),a=Math.cos(n),s=Math.cos(r),o=Math.sin(n),l=Math.sin(r);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-i*i-a*a-s*s+2*i*a*s),void 0===e.cartToFrac){const e=this.a*this.b*l/this.volume,t=(a*s-i)/(o*l);this.fracToCart.set(this.a,0,0,0,this.b*s,this.b*l,0,0,this.c*a,-this.c*o*t,1/e,0,0,0,0,1).transpose(),this.cartToFrac.copy(this.fracToCart).invert()}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.copy(this.cartToFrac).invert()}getPosition(e){const t=new Float32Array(24);if(e.unitcell){const n=e.unitcell,r=e.center.clone().applyMatrix4(n.cartToFrac).floor(),i=new Vn;let a=0;const s=function(e,s,o){i.set(e,s,o).add(r).applyMatrix4(n.fracToCart).toArray(t,a),a+=3};s(0,0,0),s(1,0,0),s(0,1,0),s(0,0,1),s(1,1,0),s(1,0,1),s(0,1,1),s(1,1,1)}return t}getCenter(e){return function(e,t=new Vn){const n=e.length;for(let r=0;r<n;r+=3)t.x+=e[r],t.y+=e[r+1],t.z+=e[r+2];return t.divideScalar(n/3),t}(this.getPosition(e))}getData(e,t={}){const n=Ol(t.colorValue,"orange"),r=Ol(t.radius,Math.cbrt(this.volume)/200),i=new ai(n),a=new Vn,s=this.getPosition(e),o=vu(8,i.r,i.g,i.b),l=yu(8,r),c=new Float32Array(36),u=new Float32Array(36),d=vu(12,i.r,i.g,i.b),h=yu(12,r);let f=0;function p(e,t){a.fromArray(s,3*e).toArray(c,f),a.fromArray(s,3*t).toArray(u,f),f+=3}p(0,1),p(0,2),p(0,3),p(1,4),p(1,5),p(2,6),p(3,5),p(4,7),p(5,7),p(2,4),p(7,6),p(3,6);const m=new $h(this,e);return{vertex:{position:s,color:o,radius:l,picking:m},edge:{position1:c,position2:u,color:d,color2:d,radius:h,picking:m}}}}const Ex={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},Cx=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],Tx=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],Px=/\s+/;function Ix(e,t,n){let r=`${e}`;return t&&(r+=`:${t}`),n&&(r+=`^${n}`),r}class Rx extends wx{constructor(e,t){const n=t||{};super(e,n),this.hex=Ol(n.hex,!1),this.inferBonds=Ol(n.inferBonds,"all")}get type(){return"pdb"}_parse(){Xc&&Wc.time("PdbParser._parse "+this.name);let e=!1;const t=this.streamer.peekLines(1)[0],n=t.substr(62,4),r=t.substr(72,4);n===r&&r.trim()&&(e=!0);const i="pqr"===this.type,a="pdbqt"===this.type,s=this.structure,o=this.structureBuilder,l=this.hex;let c=10,u=10;const d=this.firstModelOnly,h=this.asTrajectory,f=this.cAlphaOnly,p=s.frames,m=s.boxes;let g,_,y=!1;const v=s.biomolDict;let b,x,w,S,A,M,E,C,T,P,I,R,k,D,L,N,O,F,U,B,z,V,H={};const $={},G={},j=[];let W,q;const X={},Y={},K={};let Z,Q,J,ee,te,ne,re;const ie={};let ae;const se={helices:[],sheets:[]},oe=se.helices,le=se.sheets,ce=s.atomMap,ue=s.atomStore;ue.resize(Math.round(this.streamer.data.length/80)),(i||a)&&ue.addField("partialCharge",1,"float32"),i&&ue.addField("radius",1,"float32");const de=s.getAtomProxy(),he=s.getAtomProxy();let fe=0,pe=0,me=!0;this.streamer.eachChunkOfLines((function(t){!function(t,n,r){for(let t=0;t<n;++t)if(S=r[t],A=S.substr(0,6),"ATOM  "===A||"HETATM"===A){if(me&&(h?(y?(g=new Float32Array(3*ue.count),p.push(g)):g=[],_=0):d||(H={}),Z=1,Q=Z.toString(),J=!0,me=!1),d&&pe>0)continue;let t,n,r,s,m,v=0;if(i){if(s=S.split(Px),v=10===s.length?1:0,R=s[2],f&&"CA"!==R)continue;t=parseFloat(s[6-v]),n=parseFloat(s[7-v]),r=parseFloat(s[8-v])}else{if(R=S.substr(12,4).trim(),f&&"CA"!==R)continue;t=parseFloat(S.substr(30,8)),n=parseFloat(S.substr(38,8)),r=parseFloat(S.substr(46,8))}if(h){const e=3*_;if(g[e+0]=t,g[e+1]=n,g[e+2]=r,_+=1,y)continue}i?(M=parseInt(s[1]),m="",k="H"===S[0],E=v?"":s[4],C=parseInt(s[5-v]),I="",T=s[3],L="",P=1):(M=parseInt(S.substr(6,5),c),l&&99999===M&&(c=16),k="H"===S[0],E=S[21].trim(),C=parseInt(S.substr(22,4),u),l&&9999===C&&(u=16),I=S[26].trim(),T=S.substr(17,4).trim()||"MOL",D=parseFloat(S.substr(60,6)),L=S[16].trim(),P=parseFloat(S.substr(54,6)),e||(a?(m=S.substr(76,3).trim(),m in rh&&(m=rh[m])):(m=S.substr(76,2).trim(),E||(E=S.substr(72,4).trim())),N=parseInt((S.substr(79,1)+S.substr(78,1)).trim()))),ue.growIfFull(),ue.atomTypeId[fe]=ce.add(R,m),ue.x[fe]=t,ue.y[fe]=n,ue.z[fe]=r,ue.serial[fe]=M,ue.altloc[fe]=L.charCodeAt(0),ue.occupancy[fe]=isNaN(P)?0:P,i?(ue.partialCharge[fe]=parseFloat(s[9-v]),ue.radius[fe]=parseFloat(s[10-v])):(ue.bfactor[fe]=isNaN(D)?0:D,a&&(ue.partialCharge[fe]=parseFloat(S.substr(70,6))),isFinite(N)&&(ue.formalCharge||ue.addField("formalCharge",1,"int8"),ue.formalCharge[fe]=N));const b=Ix(C,E,I);!k||Y[b]||Cx.includes(T)?J||ee===E||(Z+=1,Q=Z.toString()):ee===E&&ne===T&&(Zd.includes(T)||te===C&&re===I)||(Z+=1,Q=Z.toString(),te=C,ne=T,re=I),o.addAtom(pe,E,Q,T,C,k,void 0,I),H[M]=fe,fe+=1,J=!1,ee=E}else if("CONECT"===A){const e=H[parseInt(S.substr(6,5))],t=[11,16,21,26],n={};if(void 0===e)continue;for(let r=0;r<4;++r){let i=parseInt(S.substr(t[r],5));if(!Number.isNaN(i)&&(i=H[i],void 0!==i))if(e<i?(de.index=e,he.index=i):(de.index=i,he.index=e),void 0!==n[i])s.bondStore.bondOrder[n[i]]+=1;else{const e=de.index+"|"+he.index;void 0===G[e]&&(G[e]=!0,n[i]=s.bondStore.count,s.bondStore.addBond(de,he,1))}}}else if("HELIX "===A){O=S[19].trim(),F=parseInt(S.substr(21,4)),U=S[25].trim(),B=S[31].trim(),z=parseInt(S.substr(33,4)),V=S[37].trim();let e=parseInt(S.substr(39,1));e=(Ex[e]||Ex[0]).charCodeAt(0),oe.push([O,F,U,B,z,V,e])}else if("SHEET "===A)O=S[21].trim(),F=parseInt(S.substr(22,4)),U=S[26].trim(),B=S[32].trim(),z=parseInt(S.substr(33,4)),V=S[37].trim(),le.push([O,F,U,B,z,V]);else if("HETNAM"===A)X[S.substr(11,3)]=S.substr(15).trim();else if("SEQRES"===A){const e=S[11].trim();e!==ae&&(ie[e]=[],ae=e),ie[e].push(...S.substr(19).trim().split(Px))}else if("MODRES"===A){const e=S.substr(12,3).trim(),t=S[16].trim(),n=S[22].trim(),r=parseInt(S.substr(18,4).trim()),i=Ix(r,t,n);Y[i]={resname:e,chainname:t,inscode:n,resno:r}}else if("COMPND"===A){const e=S.substr(10,70).trim(),t=e.indexOf(":"),n=e.substring(0,t);let r;Tx.includes(n)?(q=n,r=e.substring(t+2)):r=e,r=r.replace(/;$/,""),"MOL_ID"===q?(W={chainList:[],name:""},j.push(W)):"MOLECULE"===q?(W.name&&(W.name+=" "),W.name+=r):"CHAIN"===q&&Array.prototype.push.apply(W.chainList,r.split(/\s*,\s*/))}else if(S.startsWith("TER")){const e=s.getChainProxy(s.chainStore.count-1);K[e.chainname]=e.index,Z+=1,Q=Z.toString(),J=!0}else if("REMARK"===A&&"350"===S.substr(7,3)){if("BIOMOLECULE:"===S.substr(11,12)){let e=S.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(e)&&(e="BU"+e),b=new dp(e),v[e]=b}else if("BIOMT"===S.substr(13,5)){const e=S.split(/\s+/),t=parseInt(S[18])-1;0===t&&(w=new _r,x.matrixList.push(w));const n=w.elements;n[0+t]=parseFloat(e[4]),n[4+t]=parseFloat(e[5]),n[8+t]=parseFloat(e[6]),n[12+t]=parseFloat(e[7])}else if("APPLY THE FOLLOWING TO CHAINS:"===S.substr(11,30)||"                   AND CHAINS:"===S.substr(11,30)){"APPLY"===S.substr(11,5)&&(x=b.addPart());const e=S.substr(41,30).split(",");for(let t=0,n=e.length;t<n;++t){const n=e[t].trim();n&&x.chainList.push(n)}}}else if("HEADER"===A)s.id=S.substr(62,4);else if("TITLE "===A)s.title+=(s.title?" ":"")+S.substr(10,70).trim();else if("MODEL "===A)me=!0;else if("ENDMDL"===A||"END"===S.trim()){if(me)continue;h&&!y&&(p.push(new Float32Array(g)),y=!0),pe+=1,me=!0}else if("MTRIX"===S.substr(0,5)){if("1"===S[59])continue;if(!b||"NCS"!==b.name){const e="NCS";b=new dp(e),v[e]=b,x=b.addPart()}const e=S.split(/\s+/),t=parseInt(S[5])-1;0===t&&(w=new _r,x.matrixList.push(w));const n=w.elements;n[0+t]=parseFloat(e[2]),n[4+t]=parseFloat(e[3]),n[8+t]=parseFloat(e[4]),n[12+t]=parseFloat(e[5])}else if("ORIGX"===S.substr(0,5)){$.origx||($.origx=new _r);const e=S.split(/\s+/),t=parseInt(S[5])-1,n=$.origx.elements;n[0+t]=parseFloat(e[1]),n[4+t]=parseFloat(e[2]),n[8+t]=parseFloat(e[3]),n[12+t]=parseFloat(e[4])}else if("SCALE"===S.substr(0,5)){$.scale||($.scale=new _r);const e=S.split(/\s+/),t=parseInt(S[5])-1,n=$.scale.elements;n[0+t]=parseFloat(e[1]),n[4+t]=parseFloat(e[2]),n[8+t]=parseFloat(e[3]),n[12+t]=parseFloat(e[4])}else if("CRYST1"===A){const e=parseFloat(S.substr(6,9)),t=parseFloat(S.substr(15,9)),n=parseFloat(S.substr(24,9)),r=parseFloat(S.substr(33,7)),i=parseFloat(S.substr(40,7)),a=parseFloat(S.substr(47,7)),s=S.substr(55,11).trim(),o=new Float32Array(9);o[0]=e,o[4]=t,o[8]=n,m.push(o),0===pe&&($.a=e,$.b=t,$.c=n,$.alpha=r,$.beta=i,$.gamma=a,$.spacegroup=s)}}(0,t.length,t)})),o.finalize();const ge=j.length;if(ge){s.eachChain((function(e){e.entityIndex=ge})),j.forEach((function(e,t){const n=e.chainList.map((function(e){return K[e]}));s.entityList.push(new Sx(s,t,e.name,"polymer",n))}));let e=j.length;const t=s.getResidueProxy(),n={};s.eachChain((function(e){e.entityIndex===ge&&(t.index=e.residueOffset,n[t.resname]||(n[t.resname]=[]),n[t.resname].push(e.index))})),Object.keys(n).forEach((function(t){const r=n[t];let i="non-polymer",a=X[t]||t;Zd.includes(t)&&(a="water",i="water"),s.entityList.push(new Sx(s,e,a,i,r)),e+=1}))}void 0!==$.a?s.unitcell=new Mx($):s.unitcell=void 0,(oe.length||le.length)&&pp(s,se),s.finalizeAtoms(),e||yp(s),vp(s,this.inferBonds),s.finalizeBonds(),oe.length||le.length||mp(s),Ap(s),Xc&&Wc.timeEnd("PdbParser._parse "+this.name)}}eu.add("pdb",Rx),eu.add("pdb1",Rx),eu.add("ent",Rx);class kx{constructor(e){this.structure=e,this.dict={},this.structure=e}add(e,t,n){this.dict[e]={chemCompType:t},n&&(this.dict[e].bonds=n)}addBond(e,t,n,r){const i=this.dict[e];if(!i)return;i.bonds||(i.bonds={atom1:[],atom2:[],bondOrders:[]});const a=i.bonds;a.atom1.push(t),a.atom2.push(n),a.bondOrders.push(r)}getBonds(e,t){var n;const r=null===(n=this.dict[e])||void 0===n?void 0:n.bonds;if(!r)return;const i=this.structure.atomMap,a=new Map(t.map(((e,t)=>{var n;return[null===(n=i.get(e))||void 0===n?void 0:n.atomname,t]}))),s=[],o=[],l=[];let c,u;for(let e=0;e<r.atom1.length;e++)void 0!==(c=a.get(r.atom1[e]))&&void 0!==(u=a.get(r.atom2[e]))&&(s.push(c),o.push(u),l.push(r.bondOrders[e]));return{atomIndices1:s,atomIndices2:o,bondOrders:l}}}const Dx=/^\D{1,2}/,Lx={HELX_RH_AL_P:"h",STRN:"e",HELX_RH_3T_P:"g",HELX_RH_PI_P:"i",HELX_LH_PP_P:"e",TURN_TY1_P:"t",BEND:"s",OTHER:" "},Nx={AROM:1,DELO:2,DIRECTED:0,DOUB:2,PI:0,POLY:0,QUAD:4,SING:1,TRIP:3};function Ox(e){switch(e.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}class Fx extends wx{get type(){return"cif"}get isBinary(){return!1}_parse(){var e,t,n,r,i,a,s,o,l,c,u,d,h,f,p,m,g,_,y,v,b;return tg(this,void 0,void 0,(function*(){Wc.time("CifParser._parse "+this.name);const x=this.structure,w=this.structureBuilder,S=this.firstModelOnly,A=this.asTrajectory,M=x.frames;let E,C;const T=this.isBinary?bx.parseBinary(this.streamer.data):bx.parseText(this.streamer.compressed?Hl(this.streamer.data):this.streamer.data),P=yield T.run();if(P.isError)throw P;const I=P.result.blocks[0];if("chem_comp"in I.categories&&"chem_comp_atom"in I.categories&&!("struct"in I.categories))!function(e,t,n){const r=t.atomStore,i=t.atomMap;let a,s;const o=e.chem_comp,l=e.chem_comp_atom,c=e.chem_comp_bond;let u;o&&((u=o.getField("name"))&&(t.title=u.str(0)),(u=o.getField("id"))&&(t.id=u.str(0)));const d={};if(l){let e,t,a,o;s=l.rowCount,r.resize(2*s);const c=l.getField("atom_id"),u=l.getField("type_symbol"),h=l.getField("pdbx_component_comp_id"),f=l.getField("pdbx_residue_numbering");[["model_Cartn_x","model_Cartn_y","model_Cartn_z"],["pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal"]].forEach((([p,m,g],_)=>{var y;const v=l.getField(p),b=l.getField(m),x=l.getField(g),w=_*s;for(let l=0;l<s;++l){const s=l+w;r.growIfFull(),e=null==c?void 0:c.str(l),t=null==u?void 0:u.str(l),d[e]=l,r.atomTypeId[s]=i.add(e,t),r.x[s]=v.float(l),r.y[s]=b.float(l),r.z[s]=x.float(l),r.serial[s]=l,a=h.str(l),o=null!==(y=null==f?void 0:f.int(l))&&void 0!==y?y:1,n.addAtom(_,"","",a,o,!0)}}))}if(l&&c){let e,n,r;s=c.rowCount;const i=l.rowCount,o=t.getAtomProxy(),u=t.getAtomProxy(),h=c.getField("atom_id_1"),f=c.getField("atom_id_2"),p=c.getField("value_order");for(a=0;a<s;++a)e=h.str(a),n=f.str(a),r=Ox(p.str(a)),o.index=d[e],u.index=d[n],t.bondStore.growIfFull(),t.bondStore.addBond(o,u,r),o.index+=i,u.index+=i,t.bondStore.growIfFull(),t.bondStore.addBond(o,u,r)}}(I.categories,x,w),w.finalize(),x.finalizeAtoms(),x.finalizeBonds(),Tp(x);else if("atom_site_type_symbol"in I.categories&&"atom_site_label"in I.categories&&"atom_site_fract_x"in I.categories)!function(e,t,n){var r,i,a=t.atomStore,s=t.atomMap;e.header&&(t.id=e.header,t.name=e.header),t.unitcell=new Mx({a:e.getField("cell_length_a").float(0),b:e.getField("cell_length_b").float(0),c:e.getField("cell_length_c").float(0),alpha:e.getField("cell_angle_alpha").float(0),beta:e.getField("cell_angle_beta").float(0),gamma:e.getField("cell_angle_gamma").float(0),spacegroup:e.getField("symmetry_space_group_name_H-M").str(0)});const o=new Vn,l=new Vn,c=e.getField("atom_site_type_symbol");if(!c)return;const u=null!==(r=c.rowCount)&&void 0!==r?r:0,d=e.getField("atom_site_type_symbol"),h=e.getField("atom_site_fract_x"),f=e.getField("atom_site_fract_y"),p=e.getField("atom_site_fract_z"),m=e.getField("atom_site_occupancy"),g={};for(let e=0;e<u;++e){a.growIfFull();const r=d.str(e),u=c.str(e);let _=g[u];if(!_){const e=u.match(Dx);g[u]=_=null!==(i=null==e?void 0:e[0])&&void 0!==i?i:u}a.atomTypeId[e]=s.add(r,_),o.set(h.float(e),f.float(e),p.float(e)),o.applyMatrix4(t.unitcell.fracToCart),l.add(o),a.x[e]=o.x,a.y[e]=o.y,a.z[e]=o.z,m&&(a.occupancy[e]=m.float(e)),a.serial[e]=e,n.addAtom(0,"","","HET",1,!0)}l.divideScalar(u),t.center=l,Ap(t);const _=new Vn,y=new Vn,v=t.biomolDict.SUPERCELL.partList[0].matrixList;let b=u;function x(e){return s.get(a.atomTypeId[e]).covalent}const w=new _r;for(let e=0;e<u;++e){const t=x(e);o.set(a.x[e],a.y[e],a.z[e]),v.forEach((function(r){if(!w.equals(r)){_.copy(o),_.applyMatrix4(r);for(let r=0;r<u;++r){y.set(a.x[r],a.y[r],a.z[r]);const i=_.distanceToSquared(y),s=x(r)+t,o=s+.3,l=s-.5;if(i<o*o&&i>l*l)return a.growIfFull(),a.atomTypeId[b]=a.atomTypeId[e],a.x[b]=_.x,a.y[b]=_.y,a.z[b]=_.z,a.occupancy[b]=a.occupancy[e],a.serial[b]=b,a.altloc[b]="A".charCodeAt(0),n.addAtom(0,"","","HET",1,!0),void(b+=1)}}}))}}(I,x,w),w.finalize(),x.finalizeAtoms(),vp(x),x.finalizeBonds();else{const T={},P={},R=x.atomMap,k=x.atomStore,D=I.categories.atom_site;let L=D.rowCount;const N=D.getField("pdbx_PDB_model_num");if(null!==(e=null==N?void 0:N.areValuesEqual(0,L-1))&&void 0!==e&&!e&&(A||S)){const e=N.int(0);for(let t=0;t<L;t++)if(N.int(t)>e){L=t;break}}x.chemCompMap=new kx(x);const O=I.categories.chem_comp;let F=O.getField("id");const U=O.getField("type");for(let e=0;e<O.rowCount;e++)x.chemCompMap.add(F.str(e),U.str(e).toUpperCase());if(I.categoryNames.includes("chem_comp_bond")){const e=I.categories.chem_comp_bond;F=e.getField("comp_id");const t=e.getField("atom_id_1"),n=e.getField("atom_id_2"),r=e.getField("value_order");for(let i=0;i<e.rowCount;i++){const e=Nx[r.str(i)];e&&x.chemCompMap.addBond(F.str(i),t.str(i),n.str(i),e)}}const B=(e,t,n)=>{const r=e.getField(t);return r?r.toFloatArray({array:Float32Array,start:0,end:n}):new Float32Array(n)};k.resize(L),k.x=B(D,"Cartn_x",L),k.y=B(D,"Cartn_y",L),k.z=B(D,"Cartn_z",L),k.serial=D.getField("id").toIntArray({start:0,end:L}),k.bfactor=B(D,"B_iso_or_equiv",L),k.occupancy=B(D,"occupancy",L);const z=D.getField("label_alt_id");(null==z?void 0:z.isDefined)&&(k.altloc=Uint8Array.from(z.toStringArray(),(e=>e.charCodeAt(0))));const V=D.getField("label_atom_id"),H=D.getField("type_symbol");F=D.getField("label_comp_id");const $=null!==(t=D.getField("auth_seq_id"))&&void 0!==t?t:D.getField("label_seq_id"),G=D.getField("pdbx_PDB_ins_code"),j=D.getField("auth_asym_id"),W=D.getField("label_asym_id"),q=D.getField("group_PDB"),X=D.getField("label_entity_id");for(let e=0;e<L;e++){const t=null!==(n=null==N?void 0:N.int(e))&&void 0!==n?n:1,c=null!==(r=null==j?void 0:j.str(e))&&void 0!==r?r:"",u=null!==(i=null==W?void 0:W.str(e))&&void 0!==i?i:"",d=null!==(a=null==F?void 0:F.str(e))&&void 0!==a?a:"",h=null!==(s=null==$?void 0:$.int(e))&&void 0!==s?s:0,f="H"===(null==q?void 0:q.str(e)[0]),p=null!==(o=null==G?void 0:G.str(e))&&void 0!==o?o:"",m=null!==(l=null==X?void 0:X.int(e))&&void 0!==l?l:1;k.atomTypeId[e]=R.add((null==V?void 0:V.str(e))||"",null==H?void 0:H.str(e)),w.addAtom(t-1,c,u,d,h,f,void 0,p),T[u]=c,P[m]||(P[m]=new Set),P[m].add(x.chainStore.count-1)}if(A){const e=D.rowCount/L|0,t=D.getField("Cartn_x"),n=D.getField("Cartn_y"),r=D.getField("Cartn_z");for(let i=0;i<e;i++){E=new Float32Array(3*L);const e=i*L,a=e+L;C=0;for(let i=e;i<a;i++)E[C+0]=t.float(i),E[C+1]=n.float(i),E[C+2]=r.float(i),C+=3;M.push(E)}}const Y=function(e,t,n){var r,i,a,s,o,l;const c=[],u=[];let d,h,f,p;const m=e.struct_conf;if(null==m?void 0:m.fieldNames.includes("pdbx_PDB_helix_class")){const e=m.getField("pdbx_beg_PDB_ins_code"),t=m.getField("pdbx_end_PDB_ins_code"),a=m.getField("pdbx_PDB_helix_class"),s=m.getField("beg_label_asym_id"),o=m.getField("end_label_asym_id"),l=m.getField("beg_auth_seq_id"),u=m.getField("end_auth_seq_id");for(d=0,h=m.rowCount;d<h;++d){const h=null==a?void 0:a.int(d);Number.isFinite(h)&&(f=null!==(r=null==e?void 0:e.str(d))&&void 0!==r?r:"",p=null!==(i=null==t?void 0:t.str(d))&&void 0!==i?i:"",c.push([n[s.str(d)],l.int(d),f,n[o.str(d)],u.int(d),p,(Ex[h]||Ex[0]).charCodeAt(0)]))}}else if(null==m?void 0:m.fieldNames.includes("conf_type_id")){const e=m.getField("conf_type_id"),t=m.getField("pdbx_beg_PDB_ins_code"),r=m.getField("pdbx_end_PDB_ins_code"),i=m.getField("beg_label_asym_id"),o=m.getField("end_label_asym_id"),l=m.getField("beg_auth_seq_id"),g=m.getField("end_auth_seq_id");let _;for(d=0,h=m.rowCount;d<h;++d){const h=e.str(d);(_=Lx[h])&&(f=null!==(a=null==t?void 0:t.str(d))&&void 0!==a?a:"",p=null!==(s=null==r?void 0:r.str(d))&&void 0!==s?s:"","h"===_||"g"===_||"i"===_?c.push([n[i.str(d)],l.int(d),f,n[o.str(d)],g.int(d),p,_.charCodeAt(0)]):"e"===_&&u.push([n[i.str(d)],l.int(d),f,n[o.str(d)],g.int(d),p]))}}const g=e.struct_sheet_range;if(g&&0===u.length){const e=g.getField("pdbx_beg_PDB_ins_code"),t=g.getField("pdbx_end_PDB_ins_code"),r=g.getField("beg_label_asym_id"),i=g.getField("end_label_asym_id"),a=g.getField("beg_auth_seq_id"),s=g.getField("end_auth_seq_id");for(d=0,h=g.rowCount;d<h;++d)f=null!==(o=null==e?void 0:e.str(d))&&void 0!==o?o:"",p=null!==(l=null==t?void 0:t.str(d))&&void 0!==l?l:"",u.push([n[r.str(d)],a.int(d),f,n[i.str(d)],s.int(d),p])}return!(!m&&!g)&&{helices:c,sheets:u}}(I.categories,0,T);let K,Z;if(function(e,t,n){const r={},i=t.biomolDict;if(e.pdbx_struct_oper_list){const t=e.pdbx_struct_oper_list,n=t.getField("id"),i=t.getField("matrix[1][1]"),a=t.getField("matrix[1][2]"),s=t.getField("matrix[1][3]"),o=t.getField("matrix[2][1]"),l=t.getField("matrix[2][2]"),c=t.getField("matrix[2][3]"),u=t.getField("matrix[3][1]"),d=t.getField("matrix[3][2]"),h=t.getField("matrix[3][3]"),f=t.getField("vector[1]"),p=t.getField("vector[2]"),m=t.getField("vector[3]");for(let e=0;e<t.rowCount;e++){const t=new _r,g=t.elements;g[0]=i.float(e),g[1]=a.float(e),g[2]=s.float(e),g[4]=o.float(e),g[5]=l.float(e),g[6]=c.float(e),g[8]=u.float(e),g[9]=d.float(e),g[10]=h.float(e),g[3]=f.float(e),g[7]=p.float(e),g[11]=m.float(e),t.transpose(),r[n.str(e)]=t}}if(e.pdbx_struct_assembly_gen){const t=e.pdbx_struct_assembly_gen,a=function(e){const t={};return e.replace(/[()']/g,"").split(",").forEach((function(e){if(e.includes("-"))for(var n=e.split("-"),i=parseInt(n[0]),a=parseInt(n[1]);i<=a;++i)t[i]=r[i];else t[e]=r[e]})),t},s=t.getField("assembly_id"),o=t.getField("oper_expression"),l=t.getField("asym_id_list");for(let e=0;e<t.rowCount;e++){const t=s.int(e);let r={},c=o.str(e).replace(/['"]\(|['"]/g,"");if(c.includes(")(")||c.indexOf("(")>0){const[e,t]=c.split("(").filter((e=>!!e)),n=a(e),i=a(t);Object.keys(n).forEach((function(e){Object.keys(i).forEach((function(t){const a=new _r;a.multiplyMatrices(n[e],i[t]),r[e+"x"+t]=a}))}))}else r=a(c);const u=[];for(let e in r)u.push(r[e]);let d=""+t;/^(0|[1-9][0-9]*)$/.test(d)&&(d="BU"+d);const h=l.str(e).split(",").map((e=>n[e]));void 0===i[d]&&(i[d]=new dp(d)),i[d].addPart(u,h)}}if(e.struct_ncs_oper){const t=e.struct_ncs_oper,n="NCS";i[n]=new dp(n);const r=i[n].addPart(),a=t.getField("code"),s=t.getField("matrix[1][1]"),o=t.getField("matrix[1][2]"),l=t.getField("matrix[1][3]"),c=t.getField("matrix[2][1]"),u=t.getField("matrix[2][2]"),d=t.getField("matrix[2][3]"),h=t.getField("matrix[3][1]"),f=t.getField("matrix[3][2]"),p=t.getField("matrix[3][3]"),m=t.getField("vector[1]"),g=t.getField("vector[2]"),_=t.getField("vector[3]");for(let e=0;e<t.rowCount;e++){if("given"===a.str(e))return;const t=new _r,n=t.elements;n[0]=s.float(e),n[1]=o.float(e),n[2]=l.float(e),n[4]=c.float(e),n[5]=u.float(e),n[6]=d.float(e),n[8]=h.float(e),n[9]=f.float(e),n[10]=p.float(e),n[3]=m.float(e),n[7]=g.float(e),n[11]=_.float(e),t.transpose(),r.matrixList.push(t)}0===r.matrixList.length&&delete i[n]}const a={};if(e.cell){const n=e.cell,r=n.getField("length_a").float(0),i=n.getField("length_b").float(0),s=n.getField("length_c").float(0),o=new Float32Array(9);o[0]=r,o[4]=i,o[8]=s,t.boxes.push(o),a.a=r,a.b=i,a.c=s,a.alpha=n.getField("angle_alpha").float(0),a.beta=n.getField("angle_beta").float(0),a.gamma=n.getField("angle_gamma").float(0)}e.symmetry&&(a.spacegroup=e.symmetry.getField("space_group_name_H-M").str(0));const s=new _r;if(e.database_PDB_matrix){const t=e.database_PDB_matrix,n=s.elements,r=t.getField("origx[1][1]"),i=t.getField("origx[1][2]"),o=t.getField("origx[1][3]"),l=t.getField("origx[2][1]"),c=t.getField("origx[2][2]"),u=t.getField("origx[2][3]"),d=t.getField("origx[3][1]"),h=t.getField("origx[3][2]"),f=t.getField("origx[3][3]"),p=t.getField("origx_vector[1]"),m=t.getField("origx_vector[2]"),g=t.getField("origx_vector[3]");n[0]=r.float(0),n[1]=i.float(0),n[2]=o.float(0),n[4]=l.float(0),n[5]=c.float(0),n[6]=u.float(0),n[8]=d.float(0),n[9]=h.float(0),n[10]=f.float(0),n[3]=p.float(0),n[7]=m.float(0),n[11]=g.float(0),s.transpose(),a.origx=s}const o=new _r;if(e.atom_sites){const t=e.atom_sites,n=o.elements,r=t.getField("fract_transf_matrix[1][1]"),i=t.getField("fract_transf_matrix[1][2]"),s=t.getField("fract_transf_matrix[1][3]"),l=t.getField("fract_transf_matrix[2][1]"),c=t.getField("fract_transf_matrix[2][2]"),u=t.getField("fract_transf_matrix[2][3]"),d=t.getField("fract_transf_matrix[3][1]"),h=t.getField("fract_transf_matrix[3][2]"),f=t.getField("fract_transf_matrix[3][3]"),p=t.getField("fract_transf_vector[1]"),m=t.getField("fract_transf_vector[2]"),g=t.getField("fract_transf_vector[3]");n[0]=r.float(0),n[1]=i.float(0),n[2]=s.float(0),n[4]=l.float(0),n[5]=c.float(0),n[6]=u.float(0),n[8]=d.float(0),n[9]=h.float(0),n[10]=f.float(0),n[3]=p.float(0),n[7]=m.float(0),n[11]=g.float(0),o.transpose(),a.scale=o}void 0!==a.a?t.unitcell=new Mx(a):t.unitcell=void 0}(I.categories,x,T),function(e,t,n){const r=e.struct_conn;if(r){const e=t.getAtomProxy(),s=t.getAtomProxy(),o={},l=r.getField("conn_type_id"),c=r.getField("ptnr1_symmetry"),u=r.getField("pdbx_ptnr1_PDB_ins_code"),d=r.getField("pdbx_ptnr1_label_alt_id"),h=r.getField("ptnr1_auth_seq_id"),f=r.getField("ptnr1_label_asym_id"),p=r.getField("ptnr1_label_atom_id"),m=r.getField("ptnr2_symmetry"),g=r.getField("pdbx_ptnr2_PDB_ins_code"),_=r.getField("pdbx_ptnr2_label_alt_id"),y=r.getField("ptnr2_auth_seq_id"),v=r.getField("ptnr2_label_asym_id"),b=r.getField("ptnr2_label_atom_id"),x=r.getField("pdbx_value_order");for(let w=0,S=r.rowCount;w<S;++w){const r=l.str(w);if("hydrog"===r||"mismat"===r||"saltbr"===r)continue;if("1_555"!==c.str(w)||"1_555"!==m.str(w))continue;const S=u.str(w),A=d.str(w),M=h.str(w)+(S?"^"+S:"")+":"+n[f.str(w)]+"."+p.str(w)+(A?"%"+A:"");let E=o[M];if(!E){const e=new Nc(M);if(e.selection.error){Xc&&Wc.warn("invalid selection for connection",M);continue}E=t.getAtomIndices(e),o[M]=E}const C=g.str(w),T=_.str(w),P=y.str(w)+(C?"^"+C:"")+":"+n[v.str(w)]+"."+b.str(w)+(T?"%"+T:"");let I=o[P];if(!I){const e=new Nc(P);if(e.selection.error){Xc&&Wc.warn("invalid selection for connection",P);continue}I=t.getAtomIndices(e),o[P]=I}var i=E.length,a=I.length;if(i>a&&([i,a]=[a,i],[E,I]=[I,E]),0!==i&&0!==a)for(let n=0;n<a;++n)e.index=E[n%i],s.index=I[n],e&&s?t.bondStore.addBond(e,s,Ox(x.str(w))):Wc.log("atoms for connection not found");else Xc&&Wc.warn("no atoms found for",M,P)}}}(I.categories,x,T),function(e,t,n){var r;if(e.entity){const i=e.entity,a=i.getField("id"),s=i.getField("pdbx_description"),o=i.getField("type"),l=i.rowCount;for(let e=0;e<l;++e){const i=Array.from(null!==(r=n[a.int(e)])&&void 0!==r?r:[]);t.entityList[e]=new Sx(t,e,null==s?void 0:s.str(e),o.str(e),i)}}}(I.categories,x,P),(K=null===(c=I.categories.struct)||void 0===c?void 0:c.getField("title"))&&(Z=K.str(0))&&(x.title=Z),(K=null===(u=I.categories.entry)||void 0===u?void 0:u.getField("id"))&&(Z=K.str(0))&&(x.id=Z),I.categories.pdbx_audit_revision_history){if(K=null===(d=I.categories.pdbx_audit_revision_history)||void 0===d?void 0:d.getField("revision_date"))for(let e=0;e<K.rowCount;e++)if(Z=K.str(e)){x.header.releaseDate=Z;break}if(K=null===(h=I.categories.pdbx_database_status)||void 0===h?void 0:h.getField("recvd_initial_deposition_date"))for(let e=0;e<K.rowCount;e++)if(Z=K.str(e)){x.header.depositionDate=Z;break}}else if(I.categories.database_PDB_rev){if(K=null===(f=I.categories.database_PDB_rev)||void 0===f?void 0:f.getField("date"))for(let e=0;e<K.rowCount;e++)if(Z=K.str(e)){x.header.releaseDate=Z;break}if(K=null===(p=I.categories.database_PDB_rev)||void 0===p?void 0:p.getField("date_original"))for(let e=0;e<K.rowCount;e++)if(Z=K.str(e)){x.header.depositionDate=Z;break}}(K=null!==(g=null===(m=I.categories.reflns)||void 0===m?void 0:m.getField("d_resolution_high"))&&void 0!==g?g:null===(_=I.categories.refine)||void 0===_?void 0:_.getField("ls_d_res_high"))&&0===K.valueKind(0)&&(x.header.resolution=K.float(0)),(K=null===(y=I.categories.refine)||void 0===y?void 0:y.getField("ls_R_factor_R_free"))&&0===K.valueKind(0)&&(x.header.rFree=K.float(0)),(K=null===(v=I.categories.refine)||void 0===v?void 0:v.getField("ls_R_factor_R_work"))&&0===K.valueKind(0)&&(x.header.rFree=K.float(0)),(K=null===(b=I.categories.exptl)||void 0===b?void 0:b.getField("method"))&&(x.header.experimentalMethods=K.toStringArray().slice()),w.finalize(),x.finalizeAtoms(),vp(x),x.finalizeBonds(),Y?pp(x,Y):mp(x),Ap(x),x.extraData.cif=I}Xc&&Wc.timeEnd("CifParser._parse "+this.name)}))}}eu.add("bcif",class extends Fx{get type(){return"bcif"}get isBinary(){return!0}}),eu.add("cif",Fx),eu.add("mcif",Fx),eu.add("mmcif",Fx),eu.add("gro",class extends wx{get type(){return"gro"}_parse(){Xc&&Wc.time("GroParser._parse "+this.name);var e,t,n=this.structure,r=this.structureBuilder,i=this.firstModelOnly,a=this.asTrajectory,s=this.cAlphaOnly,o=n.frames,l=n.boxes,c=this.streamer.peekLines(3);n.title=c[0].trim();var u,d,h,f,p=c[2].length-c[2].lastIndexOf(".")-1+5,m=20+p,g=20+2*p,_=parseInt(c[1]),y=_+3,v=n.atomMap,b=n.atomStore;b.resize(_);var x=0,w=0,S=0;this.streamer.eachChunkOfLines((function(n){!function(n,c,A){for(var M=0;M<c;++M){var E=++S-1,C=A[M];if(C)if(E%y==0)a&&(e=new Float32Array(3*_),o.push(e),t=0);else if(E%y==1);else if(E%y==y-1){var T=C.trim().split(/\s+/),P=new Float32Array(9);if(P[0]=10*parseFloat(T[0]),P[4]=10*parseFloat(T[1]),P[8]=10*parseFloat(T[2]),l.push(P),i)return!0;w+=1}else{if(u=C.substr(10,5).trim(),s&&"CA"!==u)continue;var I=10*parseFloat(C.substr(20,p)),R=10*parseFloat(C.substr(m,p)),k=10*parseFloat(C.substr(g,p));if(a){var D=3*t;if(e[D+0]=I,e[D+1]=R,e[D+2]=k,t+=1,E>y)continue}d=C.substr(5,5).trim(),h=parseInt(C.substr(0,5)),f=parseInt(C.substr(15,5)),b.growIfFull(),b.atomTypeId[x]=v.add(u),b.x[x]=I,b.y[x]=R,b.z[x]=k,b.serial[x]=f,r.addAtom(w,"","",d,h,!1,"l"),x+=1}}}(0,n.length,n)})),r.finalize(),n.finalizeAtoms(),yp(n),vp(n),n.finalizeBonds(),mp(n),Xc&&Wc.timeEnd("GroParser._parse "+this.name)}});var Ux=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function Bx(e,t,n){return t?new e(t.buffer,t.byteOffset,t.byteLength/(n||1)):void 0}function zx(e){return Bx(DataView,e)}function Vx(e){return Bx(Int8Array,e)}function Hx(e){return Bx(Int32Array,e,4)}function $x(e,t){var n=e.length/2;t||(t=new Int16Array(n));for(var r=0,i=0;r<n;++r,i+=2)t[r]=e[i]<<8^e[i+1];return t}function Gx(e,t){var n=e.length/4;t||(t=new Int32Array(n));for(var r=0,i=0;r<n;++r,i+=4)t[r]=e[i]<<24^e[i+1]<<16^e[i+2]<<8^e[i+3];return t}function jx(e,t,n){var r=e.length,i=1/t;n||(n=new Float32Array(r));for(var a=0;a<r;++a)n[a]=e[a]*i;return n}function Wx(e,t){var n,r;if(!t){var i=0;for(n=0,r=e.length;n<r;n+=2)i+=e[n+1];t=new e.constructor(i)}var a=0;for(n=0,r=e.length;n<r;n+=2)for(var s=e[n],o=e[n+1],l=0;l<o;++l)t[a]=s,++a;return t}function qx(e,t){var n=e.length;t||(t=new e.constructor(n)),n&&(t[0]=e[0]);for(var r=1;r<n;++r)t[r]=e[r]+t[r-1];return t}function Xx(e,t){var n,r,i=e instanceof Int8Array?127:32767,a=-i-1,s=e.length;if(!t){var o=0;for(n=0;n<s;++n)e[n]<i&&e[n]>a&&++o;t=new Int32Array(o)}for(n=0,r=0;n<s;){for(var l=0;e[n]===i||e[n]===a;)l+=e[n],++n;l+=e[n],++n,t[r]=l,++r}return t}function Yx(e,t,n){return jx(Xx(e,Hx(n)),t,n)}function Kx(e){var t=0,n=new DataView(e.buffer);function r(e){for(var t={},n=0;n<e;n++)t[o()]=o();return t}function i(n){var r=e.subarray(t,t+n);return t+=n,r}function a(n){var r=e.subarray(t,t+n);t+=n;var i=65535;if(n>i){for(var a=[],s=0;s<r.length;s+=i)a.push(String.fromCharCode.apply(null,r.subarray(s,s+i)));return a.join("")}return String.fromCharCode.apply(null,r)}function s(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=o();return t}function o(){var o,l,c=e[t];if(!(128&c))return t++,c;if(128==(240&c))return t++,r(l=15&c);if(144==(240&c))return t++,s(l=15&c);if(160==(224&c))return t++,a(l=31&c);if(!(224&~c))return o=n.getInt8(t),t++,o;switch(c){case 192:return t++,null;case 194:return t++,!1;case 195:return t++,!0;case 196:return l=n.getUint8(t+1),t+=2,i(l);case 197:return l=n.getUint16(t+1),t+=3,i(l);case 198:return l=n.getUint32(t+1),t+=5,i(l);case 202:return o=n.getFloat32(t+1),t+=5,o;case 203:return o=n.getFloat64(t+1),t+=9,o;case 204:return o=e[t+1],t+=2,o;case 205:return o=n.getUint16(t+1),t+=3,o;case 206:return o=n.getUint32(t+1),t+=5,o;case 208:return o=n.getInt8(t+1),t+=2,o;case 209:return o=n.getInt16(t+1),t+=3,o;case 210:return o=n.getInt32(t+1),t+=5,o;case 217:return l=n.getUint8(t+1),t+=2,a(l);case 218:return l=n.getUint16(t+1),t+=3,a(l);case 219:return l=n.getUint32(t+1),t+=5,a(l);case 220:return l=n.getUint16(t+1),t+=3,s(l);case 221:return l=n.getUint32(t+1),t+=5,s(l);case 222:return l=n.getUint16(t+1),t+=3,r(l);case 223:return l=n.getUint32(t+1),t+=5,r(l)}throw new Error("Unknown type 0x"+c.toString(16))}return o()}function Zx(e,t,n,r){switch(e){case 1:return function(e,t){var n=e.length;t||(t=new Float32Array(n/4));for(var r=zx(t),i=zx(e),a=0,s=0,o=n/4;a<o;++a,s+=4)r.setFloat32(s,i.getFloat32(s),!0);return t}(t);case 2:return Vx(t);case 3:return $x(t);case 4:return Gx(t);case 5:return Bx(Uint8Array,t);case 6:return Wx(Gx(t),new Uint8Array(n));case 7:return Wx(Gx(t));case 8:return function(e,t){return qx(Wx(e),void 0)}(Gx(t));case 9:return i=Gx(t),a=Gx(r)[0],jx(Wx(i,Hx(s)),a,s);case 10:return function(e,t,n){var r=Xx(e,Hx(void 0));return function(e,t,n){return jx(qx(e,Hx(n)),t,n)}(r,t,Bx(Float32Array,r,4))}($x(t),Gx(r)[0]);case 11:return jx($x(t),Gx(r)[0]);case 12:return Yx($x(t),Gx(r)[0]);case 13:return Yx(Vx(t),Gx(r)[0]);case 14:return Xx($x(t));case 15:return Xx(Vx(t))}var i,a,s}const Qx={0:"i".charCodeAt(0),1:"s".charCodeAt(0),2:"h".charCodeAt(0),3:"e".charCodeAt(0),4:"g".charCodeAt(0),5:"b".charCodeAt(0),6:"t".charCodeAt(0),7:"l".charCodeAt(0),"-1":"".charCodeAt(0)};eu.add("mmtf",class extends wx{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let e,t,n,r,i;Xc&&Wc.time("MmtfParser._parse "+this.name);const a=this.structure,s=function(e,t){var n=(t=t||{}).ignoreFields,r={};return Ux.forEach((function(t){var i,a,s,o,l,c=!!n&&-1!==n.indexOf(t),u=e[t];c||void 0===u||(u instanceof Uint8Array?r[t]=Zx.apply(null,(s=(a=zx(i=u)).getInt32(0),o=a.getInt32(4),l=i.subarray(8,12),[s,i=i.subarray(12),o,l])):r[t]=u)})),r}(Kx(this.streamer.data));let o,l,c,u,d,h;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach((function(e){void 0!==s[e]&&(a.header[e]=s[e])})),a.id=s.structureId,a.title=s.title,a.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(d=1,u=s.chainsPerModel[0],c=0,e=0,t=u;e<t;++e)c+=s.groupsPerChain[e];for(l=0,e=0,t=c;e<t;++e)i=s.groupList[s.groupTypeList[e]],l+=i.atomNameList.length;o=s.numBonds,h=[u]}else o=s.numBonds,l=s.numAtoms,c=s.numGroups,u=s.numChains,d=s.numModels,h=s.chainsPerModel;if(o+=c,this.asTrajectory)for(e=0,t=s.numModels;e<t;++e){const t=new Float32Array(3*l),r=l*e;for(n=0;n<l;++n){const e=3*n,i=n+r;t[e]=s.xCoordList[i],t[e+1]=s.yCoordList[i],t[e+2]=s.zCoordList[i]}a.frames.push(t)}const f=new Uint32Array(o),p=new Uint32Array(o),m=new Uint8Array(o),g=new Uint32Array(l),_=new Int8Array(l),y=new Uint32Array(c),v=new Uint32Array(c),b=new Uint32Array(c),x=new Uint16Array(u),w=new Uint32Array(u),S=new Uint32Array(u),A=new Uint32Array(d),M=new Uint32Array(d);let E=0;for(e=0,t=d;e<t;++e){const t=h[e];for(A[e]=E,M[e]=t,n=0;n<t;++n)x[n+E]=e;E+=t}const C=s.groupsPerChain;let T=0;for(e=0,t=u;e<t;++e){const t=C[e];for(w[e]=T,S[e]=t,n=0;n<t;++n)y[n+T]=e;T+=t}let P=0,I=0;for(e=0,t=c;e<t;++e){i=s.groupList[s.groupTypeList[e]];const t=i.atomNameList.length,a=i.formalChargeList,o=i.bondAtomList,l=i.bondOrderList;for(n=0,r=l.length;n<r;++n)f[I]=P+o[2*n],p[I]=P+o[2*n+1],m[I]=l[n],I+=1;for(v[e]=P,b[e]=t,n=0;n<t;++n)g[P]=e,_[P]=a[n],P+=1}const R=s.bondAtomList;if(R)for(s.bondOrderList&&m.set(s.bondOrderList,I),e=0,t=R.length;e<t;e+=2){const t=R[e],n=R[e+1];t<l&&n<l&&(f[I]=t,p[I]=n,I+=1)}a.bondStore.length=m.length,a.bondStore.count=I,a.bondStore.atomIndex1=f,a.bondStore.atomIndex2=p,a.bondStore.bondOrder=m,a.atomStore.length=l,a.atomStore.count=l,a.atomStore.residueIndex=g,a.atomStore.atomTypeId=new Uint16Array(l),a.atomStore.x=s.xCoordList.subarray(0,l),a.atomStore.y=s.yCoordList.subarray(0,l),a.atomStore.z=s.zCoordList.subarray(0,l),a.atomStore.serial=s.atomIdList.subarray(0,l),a.atomStore.bfactor=s.bFactorList.subarray(0,l),a.atomStore.altloc=s.altLocList.subarray(0,l),a.atomStore.occupancy=s.occupancyList.subarray(0,l),a.atomStore.formalCharge=_,a.residueStore.length=c,a.residueStore.count=c,a.residueStore.chainIndex=y,a.residueStore.residueTypeId=s.groupTypeList,a.residueStore.atomOffset=v,a.residueStore.atomCount=b,a.residueStore.resno=s.groupIdList.subarray(0,c),a.residueStore.sstruc=s.secStructList.subarray(0,c),a.residueStore.inscode=s.insCodeList.subarray(0,c),a.chainStore.length=u,a.chainStore.count=u,a.chainStore.entityIndex=new Uint16Array(u),a.chainStore.modelIndex=x,a.chainStore.residueOffset=w,a.chainStore.residueCount=S,a.chainStore.chainname=s.chainNameList.subarray(0,4*u),a.chainStore.chainid=s.chainIdList.subarray(0,4*u),a.modelStore.length=d,a.modelStore.count=d,a.modelStore.chainOffset=A,a.modelStore.chainCount=M;let k={};for(e=0,t=s.groupList.length;e<t;++e){const t=s.groupList[e],i=[];for(n=0,r=t.atomNameList.length;n<r;++n){const e=t.elementList[n].toUpperCase(),r=t.atomNameList[n];i.push(a.atomMap.add(r,e))}const o=t.chemCompType.toUpperCase(),l=Ld.includes(o),c=t.bondOrderList.length,u=new Array(c),d=new Array(c);for(n=0;n<c;++n)u[n]=t.bondAtomList[2*n],d[n]=t.bondAtomList[2*n+1];const h={atomIndices1:u,atomIndices2:d,bondOrders:t.bondOrderList};k[e]=a.residueMap.add(t.groupName,i,l,o,h)}for(e=0,t=c;e<t;++e)a.residueStore.residueTypeId[e]=k[a.residueStore.residueTypeId[e]];for(e=0,t=a.atomStore.count;e<t;++e){const t=a.atomStore.residueIndex[e],n=a.residueMap.list[a.residueStore.residueTypeId[t]],r=a.residueStore.atomOffset[t];a.atomStore.atomTypeId[e]=n.atomTypeIdList[e-r]}if(s.secStructList){const n=s.secStructList.length;for(e=0,t=a.residueStore.count;e<t;++e){const t=Qx[a.residueStore.sstruc[e%n]];void 0!==t&&(a.residueStore.sstruc[e]=t)}}if(s.entityList&&s.entityList.forEach((function(e,t){a.entityList[t]=new Sx(a,t,e.description,e.type,e.chainIndexList)})),s.bioAssemblyList&&s.bioAssemblyList.forEach((function(e,t){const n=t+1,r=new dp(""+n);a.biomolDict["BU"+n]=r;let i={};e.transformList.forEach((function(e){const t=(new _r).fromArray(e.matrix).transpose(),n=e.chainIndexList.map((function(e){let t="";for(let n=0;n<4;++n){const r=s.chainNameList[4*e+n];if(!r)break;t+=String.fromCharCode(r)}return t})),a=i[n.toString()];a?a.matrixList.push(t):i[n.toString()]=r.addPart([t],n)}))})),s.ncsOperatorList){const e="NCS",t=new dp(e),n=t.addPart();s.ncsOperatorList.forEach((function(e){const t=(new _r).fromArray(e).transpose();n.matrixList.push(t)})),n.matrixList.length>0&&(a.biomolDict[e]=t)}const D=s.unitCell;D&&Array.isArray(D)&&D[0]?a.unitcell=new Mx({a:D[0],b:D[1],c:D[2],alpha:D[3],beta:D[4],gamma:D[5],spacegroup:s.spaceGroup}):a.unitcell=void 0,Sp(a,!0),wp(a,!0),a.finalizeAtoms(),a.finalizeBonds(),Ap(a),Xc&&Wc.timeEnd("MmtfParser._parse "+this.name)}});const Jx=/\s+/,ew={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};eu.add("mol2",class extends wx{get type(){return"mol2"}_parse(){Xc&&Wc.time("Mol2Parser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=this.firstModelOnly,r=this.asTrajectory,i=e.frames;let a,s,o=!1;const l=e.atomMap,c=e.atomStore;c.resize(Math.round(this.streamer.data.length/60)),c.addField("partialCharge",1,"float32");let u=0,d=0,h=0,f=-1,p=0,m=0;const g=e.getAtomProxy(),_=e.getAtomProxy();this.streamer.eachChunkOfLines((function(y){!function(y,v,b){for(let y=0;y<v;++y){const v=b[y].trim();if(""!==v&&"#"!==v[0])if("@"===v[0])"@<TRIPOS>MOLECULE"===v?(m=1,d=0,++f):"@<TRIPOS>ATOM"===v?(m=2,h=c.count,r&&(s=0,a=new Float32Array(3*p),i.push(a),f>0&&(o=!0))):m="@<TRIPOS>BOND"===v?3:0;else if(1===m){if(0===d)e.title=v,e.id=v;else if(1===d){const e=v.split(Jx);p=parseInt(e[0])}++d}else if(2===m){const e=v.split(Jx);if(n&&f>0)continue;const i=parseFloat(e[2]),d=parseFloat(e[3]),h=parseFloat(e[4]);if(r){const e=3*s;if(a[e+0]=i,a[e+1]=d,a[e+2]=h,s+=1,o)continue}const p=e[0],m=e[1],g=e[5].split(".")[0],_=e[6]?parseInt(e[6]):1,y=e[7]?e[7]:"",b=e[8]?parseFloat(e[8]):0;c.growIfFull(),c.atomTypeId[u]=l.add(m,g),c.x[u]=i,c.y[u]=d,c.z[u]=h,c.serial[u]=+p,c.partialCharge[u]=b,t.addAtom(f,"","",y,_,!0),u+=1}else if(3===m){if(n&&f>0)continue;if(r&&f>0)continue;const t=v.split(Jx);g.index=parseInt(t[1])-1+h,_.index=parseInt(t[2])-1+h;const i=ew[t[3]];e.bondStore.addBond(g,_,i)}}}(0,y.length,y)})),t.finalize(),e.finalizeAtoms(),yp(e),wp(e,!0),Sp(e,!0),e.finalizeBonds(),Tp(e),mp(e),Xc&&Wc.timeEnd("Mol2Parser._parse "+this.name)}}),eu.add("pdbqt",class extends Rx{get type(){return"pdbqt"}}),eu.add("pqr",class extends Rx{get type(){return"pqr"}});const tw=/> +<(.+)>/;class nw extends wx{get type(){return"sdf"}_parse(){Xc&&Wc.time("SdfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=this.firstModelOnly,r=this.asTrajectory,i=this.streamer.peekLines(2);e.id=i[0].trim(),e.title=i[1].trim();const a=e.frames;let s,o,l=!1;const c=e.atomMap,u=e.atomStore;u.resize(Math.round(this.streamer.data.length/50)),u.addField("formalCharge",1,"int8");const d=e.getAtomProxy(),h=e.getAtomProxy();let f=0,p=0,m=0,g=0;const _=[];let y,v,b,x,w,S,A,M,E,C,T,P,I,R,k=!1,D={};e.extraData.sdf=_;let L=!1,N=!1,O=!1,F=[],U=[];const B=new Map;this.streamer.eachChunkOfLines((function(i){!function(i,z,V){for(let i=0;i<z;++i){const z=V[i];if(L&&z&&(F=z.substring(7).split(" "),U.length&&(F=[...U,...F],U=[]),"-"===F[F.length-1]))F.pop(),U=F;else{if("$$$$"===z.substr(0,4))p=-1,++m,g=u.count,_.push(D),D={},k=!1,L=!1;else if(3===p)L=z.indexOf(" V3000")>-1,L?B.clear():(v=parseInt(z.substr(0,3)),b=parseInt(z.substr(3,3)),x=4,w=x+v,S=w,A=S+b,r&&(o=0,s=new Float32Array(3*v),a.push(s),m>0&&(l=!0)));else if(L&&"COUNTS"===F[0])v=parseInt(F[1]),r&&(o=0,s=new Float32Array(3*v),a.push(s),m>0&&(l=!0));else if(L&&2==F.length)"ATOM"===F[1]?"BEGIN"===F[0]?N=!0:"END"===F[0]&&(N=!1):"BOND"===F[1]&&("BEGIN"===F[0]?O=!0:"END"===F[0]&&(O=!1));else if(N||!L&&p>=x&&p<w){if(n&&m>0)continue;let e=0;if(L){if(M=parseFloat(F[2]),E=parseFloat(F[3]),C=parseFloat(F[4]),P=F[1],I=parseInt(F[0]),B.set(I,f),T=P+I,F.length>6){let t=F.slice(6).find((e=>0===e.indexOf("CHG=")));t&&(e=parseInt(t.substring(4)))}}else M=parseFloat(z.substr(0,10)),E=parseFloat(z.substr(10,10)),C=parseFloat(z.substr(20,10)),P=z.substr(31,3).trim(),T=P+(f-g+1);if(r){const e=3*o;if(s[e+0]=M,s[e+1]=E,s[e+2]=C,o+=1,l)continue}u.growIfFull(),u.atomTypeId[f]=c.add(T,P),u.x[f]=M,u.y[f]=E,u.z[f]=C,u.serial[f]=L?I:f,u.formalCharge[f]=e,t.addAtom(m,"","","HET",1,!0),f+=1}else if(O||!L&&p>=S&&p<A){if(n&&m>0)continue;if(r&&m>0)continue;L?(d.index=B.get(parseInt(F[2])),h.index=B.get(parseInt(F[3])),R=parseInt(F[1])):(d.index=parseInt(z.substr(0,3))-1+g,h.index=parseInt(z.substr(3,3))-1+g,R=parseInt(z.substr(6,3))),e.bondStore.addBond(d,h,R)}else if("M  CHG"===z.substr(0,6)){const e=parseInt(z.substr(6,3));for(let t=0,n=10;t<e;++t,n+=8){const e=parseInt(z.substr(n,3))-1+g,t=parseInt(z.substr(n+4,3));u.formalCharge[e]=t}}else">"===z.charAt(0)&&(y=z.match(tw))?(k=y[1],D[k]=[]):!1!==k&&z&&D[k].push(z);++p}}}(0,i.length,i)})),t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),Tp(e),Xc&&Wc.timeEnd("SdfParser._parse "+this.name)}_postProcess(){Tp(this.structure)}}function rw(e,t,n){return parseInt(e.substr(t,n).trim())}eu.add("sdf",nw),eu.add("sd",nw),eu.add("mol",nw);class iw extends wx{get type(){return"prmtop"}_parse(){Xc&&Wc.time("PrmtopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,r=e.atomStore;r.addField("partialCharge",1,"float32"),r.addField("radius",1,"float32");const i=[],a={},s=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let o,l,c,u,d;s.forEach((e=>{a[e]=0}));let h,f,p,m,g,_=new Uint8Array(0);this.streamer.eachChunkOfLines((function(e){!function(e,t,n){for(let e=0;e<t;++e){const t=n[e],y=t.trim();if(y)if(t.startsWith("%FORMAT"));else if(t.startsWith("%FLAG")){const e=t.substr(5).trim();m=0,"TITLE"===e?p=0:"POINTERS"===e?p=1:"ATOM_NAME"===e?p=2:"CHARGE"===e?p=3:"MASS"===e?p=4:"RESIDUE_LABEL"===e?p=5:"RESIDUE_POINTER"===e?p=6:"BONDS_INC_HYDROGEN"===e?(g=0,p=7):"BONDS_WITHOUT_HYDROGEN"===e?(g=a.NBONH,p=8):p="RADII"===e?9:void 0}else if(0===p)i.push(y);else if(1===p){const e=Math.min(m+10,32);for(let n=0;m<e;++n,++m)a[s[m]]=parseInt(t.substr(8*n,8).trim());o=new Array(a.NATOM),l=new Float32Array(a.NATOM),c=new Float32Array(a.NATOM),r.resize(a.NATOM);const n=a.NBONH+a.MBONA;u=new Uint32Array(n),d=new Uint32Array(n),_=new Uint8Array(n),h=new Array(a.NRES),f=new Uint32Array(a.NRES)}else if(2===p){const e=Math.min(m+20,a.NATOM);for(let n=0;m<e;++n,++m)o[m]=t.substr(4*n,4).trim()}else if(3===p){const e=Math.min(m+5,a.NATOM);for(let n=0;m<e;++n,++m)l[m]=parseFloat(t.substr(16*n,16))/18.2223}else if(4===p);else if(5===p){const e=Math.min(m+20,a.NRES);for(let n=0;m<e;++n,++m)h[m]=t.substr(4*n,4).trim()}else if(6===p){const e=Math.min(m+10,a.NRES);for(let n=0;m<e;++n,++m)f[m]=rw(t,8*n,8)}else if(7===p){const e=Math.min(m+10,3*a.NBONH);for(let n=0;m<e;++n,++m){const e=m%3;0===e&&(u[g]=rw(t,8*n,8)/3),1===e&&(d[g]=rw(t,8*n,8)/3,_[g]=1,++g)}}else if(8===p){const e=Math.min(m+10,3*a.MBONA);for(let n=0;m<e;++n,++m){const e=m%3;0===e&&(u[g]=rw(t,8*n,8)/3),1===e&&(d[g]=rw(t,8*n,8)/3,_[g]=1,++g)}}else if(9===p){const e=Math.min(m+5,a.NATOM);for(let n=0;m<e;++n,++m)c[m]=parseFloat(t.substr(16*n,16))}}}(0,e.length,e)})),e.title=i.join(" ");const y=a.NATOM;let v=0,b=h[0],x=1;for(let e=0;e<y;++e)e+1===f[v+1]&&(++v,b=h[v],x=v+1),r.atomTypeId[e]=n.add(o[e]),r.serial[e]=e+1,t.addAtom(0,"","",b,x,!1);r.partialCharge.set(l),r.radius.set(c),e.bondStore.length=_.length,e.bondStore.count=_.length,e.bondStore.atomIndex1=u,e.bondStore.atomIndex2=d,e.bondStore.bondOrder=_,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),wp(e,!0),Sp(e,!0,!0),yp(e,!0),Tp(e),Xc&&Wc.timeEnd("PrmtopParser._parse "+this.name)}}eu.add("prmtop",iw),eu.add("parm7",iw);const aw=/\s+/,sw=/(^\*|REMARK)*/;eu.add("psf",class extends wx{get type(){return"psf"}_parse(){Xc&&Wc.time("PsfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,r=e.atomStore;r.addField("partialCharge",1,"float32");const i=[];let a,s,o,l,c,u,d=0,h=0,f=0;this.streamer.eachChunkOfLines((function(e){!function(e,p,m){for(let e=0;e<p;++e){const p=m[e].trim();if(p)if(2===a){const e=p.split(aw),i=parseInt(e[0]),a=e[1],l=parseInt(e[2]),c=e[3],u=e[4],f=parseFloat(e[6]);a!==o&&(s=_p(h),++h),r.growIfFull(),r.atomTypeId[d]=n.add(u),r.serial[d]=i,r.partialCharge[d]=f,t.addAtom(0,s,s,c,l,!1),d+=1,o=a}else if(3===a){const e=p.split(aw);for(let t=0,n=e.length;t<n;t+=2)l[f]=parseInt(e[t])-1,c[f]=parseInt(e[t+1])-1,u[f]=1,f+=1}else if(1===a)i.push(p.replace(sw,"").trim());else if(4===a);else if(5===a);else if(6===a);else if(p.includes("!NATOM")){a=2;const e=parseInt(p.split(aw)[0]);r.resize(e)}else if(p.includes("!NBOND")){a=3;const e=parseInt(p.split(aw)[0]);l=new Uint32Array(e),c=new Uint32Array(e),u=new Uint8Array(e)}else p.includes("!NTITLE")?a=1:p.includes("!NTHETA")?a=4:p.includes("!NPHI")?a=5:p.includes("!NIMPHI")&&(a=6);else a=void 0}}(0,e.length,e)})),e.title=i.join(" "),e.bondStore.length=u.length,e.bondStore.count=f,e.bondStore.atomIndex1=l,e.bondStore.atomIndex2=c,e.bondStore.bondOrder=u,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),wp(e,!0),Sp(e,!0,!0),Tp(e),Xc&&Wc.timeEnd("PsfParser._parse "+this.name)}});const ow=/\[ (.+) \]/,lw=/\s+/;eu.add("top",class extends wx{get type(){return"top"}_parse(){Xc&&Wc.time("TopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,r=e.bondStore,i=e.atomStore;i.addField("partialCharge",1,"float32");const a=[],s={};let o,l;this.streamer.eachChunkOfLines((function(t){!function(t,n,r){for(let t=0;t<n;++t){const n=r[t];let i=n.trim();if(!i||"*"===i[0]||";"===i[0])continue;if(i.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const c=n.match(ow);if(null!==c){const e=c[1];"moleculetype"===e?(l=2,o={atoms:[],bonds:[]}):l="atoms"===e?3:"bonds"===e?4:"system"===e?0:"molecules"===e?1:void 0;continue}const u=i.indexOf(";");if(-1!==u&&(i=i.substring(0,u).trim()),2===l){const e=i.split(lw)[0];s[e]=o}else if(3===l){const e=i.split(lw);o.atoms.push([parseInt(e[2]),e[3],e[4],parseFloat(e[6])])}else if(4===l){const e=i.split(lw);o.bonds.push([parseInt(e[0]),parseInt(e[1])])}else if(0===l)e.title=i;else if(1===l){const e=i.split(lw);a.push([e[0],parseInt(e[1])])}}}(0,t.length,t)}));let c=0,u=0;a.forEach((function(e){const[t,n]=e,r=s[t];c+=n*r.atoms.length,u+=n*r.bonds.length})),i.resize(c),r.resize(u);let d,h=0,f=0,p=0,m=0,g=0,_=0;a.forEach((function(e){const[a,o]=e,l=s[a],c=_p(m);for(let e=0;e<o;++e){d=-1;const e=Zd.includes(a)?c:_p(p);l.atoms.forEach((function(r){const[a,s,o,l]=r;a!==d&&++f,i.atomTypeId[h]=n.add(o),i.serial[h]=h+1,i.partialCharge[h]=l,t.addAtom(0,c,e,s,f+1,!1),++h,d=a})),l.bonds.forEach((function(e){r.atomIndex1[g]=_+e[0]-1,r.atomIndex2[g]=_+e[1]-1,++g})),++p,_+=l.atoms.length}++m})),r.count=u,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),wp(e,!0),Sp(e,!0,!0),Tp(e),Xc&&Wc.timeEnd("TopParser._parse "+this.name)}});class cw extends xx{constructor(e,t){super(e,t),this.frames=new Bm(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}function uw(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function dw(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function hw(e){const t=e.readUint32(),n=e.readChars(t);return dw(e),n}eu.add("dcd",class extends cw{get type(){return"dcd"}get isBinary(){return!0}_parse(){Xc&&Wc.time("DcdParser._parse "+this.name);const e=jl(this.streamer.data),t=new DataView(e),n=this.frames,r=n.coordinates,i=n.boxes,a={};let s=0;const o=new Int32Array(e,0,23),l=o[0]!==t.getInt32(0);if(84!==o[0]){const n=e.byteLength;for(let e=0;e<n;e+=4)t.setFloat32(e,t.getFloat32(e),!0)}84!==o[0]&&Wc.error("dcd bad format, header block start"),"CORD"!==String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7))&&Wc.error("dcd bad format, format string");let c=!1,u=!1,d=!1;0!==o[22]&&(c=!0,0!==o[12]&&(u=!0),1===o[13]&&(d=!0)),a.NSET=o[2],a.ISTART=o[3],a.NSAVC=o[4],a.NAMNF=o[10],a.DELTA=c?t.getFloat32(44,l):t.getFloat64(44,l),84!==o[22]&&Wc.error("dcd bad format, header block end"),s=s+84+8;const h=t.getInt32(s,l),f=s+1;if((h-4)%80!=0&&Wc.error("dcd bad format, title block start"),a.TITLE=Hl(new Uint8Array(e,f,h)),t.getInt32(f+h+4-1,l)!==h&&Wc.error("dcd bad format, title block end"),s=s+h+8,4!==t.getInt32(s,l)&&Wc.error("dcd bad format, natom block start"),a.NATOM=t.getInt32(s+4,l),4!==t.getInt32(s+8,l)&&Wc.error("dcd bad format, natom block end"),s=s+4+8,a.NAMNF>0)return void Wc.error("dcd format with fixed atoms unsupported, aborting");const p=a.NATOM,m=4*p;for(let n=0,o=a.NSET;n<o;++n){if(u){s+=4;const e=new Float32Array(9);e[0]=t.getFloat64(s,l),e[4]=t.getFloat64(s+16,l),e[8]=t.getFloat64(s+40,l),i.push(e),s+=48,s+=4}const a=new Float32Array(3*p);for(let r=0;r<3;++r){t.getInt32(s,l)!==m&&Wc.error("dcd bad format, coord block start",n,r),s+=4;const i=new Float32Array(e,s,p);for(let e=0;e<p;++e)a[3*e+r]=i[e];s+=m,t.getInt32(s,l)!==m&&Wc.error("dcd bad format, coord block end",n,r),s+=4}r.push(a),d&&(s+=4+t.getInt32(s,l)+4)}a.DELTA&&(n.deltaTime=20.45482949774598*a.DELTA),a.ISTART>=1&&(n.timeOffset=(a.ISTART-1)*n.deltaTime),Xc&&Wc.timeEnd("DcdParser._parse "+this.name)}});const fw={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function pw(e){switch(Number(e)){case fw.BYTE:return"byte";case fw.CHAR:return"char";case fw.SHORT:return"short";case fw.INT:return"int";case fw.FLOAT:return"float";case fw.DOUBLE:return"double";default:return"undefined"}}function mw(e){switch(Number(e)){case fw.BYTE:case fw.CHAR:return 1;case fw.SHORT:return 2;case fw.INT:case fw.FLOAT:return 4;case fw.DOUBLE:return 8;default:return-1}}function gw(e){switch(String(e)){case"byte":return fw.BYTE;case"char":return fw.CHAR;case"short":return fw.SHORT;case"int":return fw.INT;case"float":return fw.FLOAT;case"double":return fw.DOUBLE;default:return-1}}function _w(e,t){if(1!==e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=t();return n}return t()}function yw(e,t,n){switch(t){case fw.BYTE:return e.readBytes(n);case fw.CHAR:return function(e){return 0===e.charCodeAt(e.length-1)?e.substring(0,e.length-1):e}(e.readChars(n));case fw.SHORT:return _w(n,e.readInt16.bind(e));case fw.INT:return _w(n,e.readInt32.bind(e));case fw.FLOAT:return _w(n,e.readFloat32.bind(e));case fw.DOUBLE:return _w(n,e.readFloat64.bind(e));default:return void uw(!0,"non valid type "+t)}}function vw(e){let t;const n=e.readUint32();if(0===n)return uw(0!==e.readUint32(),"wrong empty tag for list of attributes"),[];{uw(12!==n,"wrong tag for list of attributes");const r=e.readUint32();t=new Array(r);for(let n=0;n<r;n++){const r=hw(e),i=e.readUint32();uw(i<1||i>6,"non valid type "+i);const a=e.readUint32(),s=yw(e,i,a);dw(e),t[n]={name:r,type:pw(i),value:s}}}return t}class bw{constructor(e){const t=new cu(e);t.setBigEndian(),uw("CDF"!==t.readChars(3),"should start with CDF");const n=t.readByte();uw(n>2,"unknown version"),this.header=function(e,t){const n={recordDimension:{length:e.readUint32()}};n.version=t;const r=function(e){let t,n,r;const i=e.readUint32();if(0===i)return uw(0!==e.readUint32(),"wrong empty tag for list of dimensions"),[];{uw(10!==i,"wrong tag for list of dimensions");const a=e.readUint32();t=new Array(a);for(let i=0;i<a;i++){const a=hw(e),s=e.readUint32();0===s&&(n=i,r=a),t[i]={name:a,size:s}}return{dimensions:t,recordId:n,recordName:r}}}(e);n.recordDimension.id=r.recordId,n.recordDimension.name=r.recordName,n.dimensions=r.dimensions,n.globalAttributes=vw(e);const i=function(e,t,n){const r=e.readUint32();let i,a=0;if(0===r)return uw(0!==e.readUint32(),"wrong empty tag for list of variables"),[];{uw(11!==r,"wrong tag for list of variables");const s=e.readUint32();i=new Array(s);for(let r=0;r<s;r++){const s=hw(e),o=e.readUint32(),l=new Array(o);for(let t=0;t<o;t++)l[t]=e.readUint32();const c=vw(e),u=e.readUint32();uw(u<1&&u>6,"non valid type "+u);const d=e.readUint32();let h=e.readUint32();2===n&&(uw(h>0,"offsets larger than 4GB not supported"),h=e.readUint32()),l[0]===t&&(a+=d),i[r]={name:s,dimensions:l,attributes:c,type:pw(u),size:d,offset:h,record:l[0]===t}}}return{variables:i,recordStep:a}}(e,r.recordId,t);return n.variables=i.variables,n.recordDimension.recordStep=i.recordStep,n}(t,n),this.buffer=t}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return-1!==this.header.variables.findIndex((function(t){return t.name===e}))}getDataVariable(e){let t;return t="string"==typeof e?this.header.variables.find((function(t){return t.name===e})):e,uw(void 0===t,"variable not found"),this.buffer.seek(t.offset),t.record?function(e,t,n){const r=gw(t.type),i=t.size?t.size/mw(r):1,a=n.length,s=new Array(a),o=n.recordStep;for(let t=0;t<a;t++){const n=e.offset;s[t]=yw(e,r,i),e.seek(n+o)}return s}(this.buffer,t,this.header.recordDimension):function(e,t){const n=gw(t.type),r=t.size/mw(n),i=new Array(r);for(let t=0;t<r;t++)i[t]=yw(e,n,1);return i}(this.buffer,t)}}class xw extends cw{get type(){return"nctraj"}get isBinary(){return!0}_parse(){Xc&&Wc.time("NctrajParser._parse "+this.name);const e=new bw(this.streamer.data),t=this.frames,n=t.coordinates,r=t.boxes,i=t.times;e.getDataVariable("coordinates").forEach((function(e){n.push(new Float32Array(e))})),e.hasDataVariable("cell_lengths")&&e.getDataVariable("cell_lengths").forEach((function(e){r.push(new Float32Array(e))})),e.hasDataVariable("time")&&e.getDataVariable("time").forEach((function(e){i.push(e)})),i.length>=1&&(t.timeOffset=i[0]),i.length>=2&&(t.deltaTime=i[1]-i[0]),Xc&&Wc.timeEnd("NctrajParser._parse "+this.name)}}eu.add("nctraj",xw),eu.add("ncdf",xw),eu.add("nc",xw),eu.add("trr",class extends cw{get type(){return"trr"}get isBinary(){return!0}_parse(){Xc&&Wc.time("TrrParser._parse "+this.name);const e=jl(this.streamer.data),t=new DataView(e),n=this.frames,r=n.coordinates,i=n.boxes,a=n.times;let s=0;for(;;){s+=8;const n=t.getInt32(s);s+=4,s+=n;const o=t.getInt32(s+8),l=t.getInt32(s+12),c=t.getInt32(s+16),u=t.getInt32(s+28),d=t.getInt32(s+32),h=t.getInt32(s+36),f=t.getInt32(s+40);s+=52;const p=o/9,m=3*f;if(8===p?a.push(t.getFloat64(s)):a.push(t.getFloat32(s)),s+=2*p,o){const e=new Float32Array(9);if(8===p)for(let n=0;n<9;++n)e[n]=10*t.getFloat64(s),s+=8;else for(let n=0;n<9;++n)e[n]=10*t.getFloat32(s),s+=4;i.push(e)}if(s+=l,s+=c,u){let n;if(8===p){n=new Float32Array(m);for(let e=0;e<m;++e)n[e]=10*t.getFloat64(s),s+=8}else{const t=new Uint32Array(e,s,m);for(let e=0;e<m;++e){const n=t[e];t[e]=(255&n)<<24|(65280&n)<<8|n>>8&65280|n>>24&255}n=new Float32Array(e,s,m);for(let e=0;e<m;++e)n[e]*=10,s+=4}r.push(n)}if(s+=d,s+=h,s>=e.byteLength)break}a.length>=1&&(n.timeOffset=a[0]),a.length>=2&&(n.deltaTime=a[1]-a[0]),Xc&&Wc.timeEnd("TrrParser._parse "+this.name)}});const ww=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function Sw(e){let t=1,n=0;for(;e>=t&&n<32;)n++,t<<=1;return n}const Aw=new Uint8Array(32);function Mw(e,t){let n=1,r=0;Aw[0]=1;for(let r=0;r<e;r++){let e,i=0;for(e=0;e<n;e++)i+=Aw[e]*t[r],Aw[e]=255&i,i>>=8;for(;0!==i;)Aw[e++]=255&i,i>>=8;n=e}let i=1;for(n--;Aw[n]>=i;)r++,i*=2;return r+8*n}function Ew(e,t,n,r){const i=(1<<n)-1;let a=r[1],s=r[2],o=e[0],l=0;for(;n>=8;)s=s<<8|t[o++],l|=s>>a<<n-8,n-=8;return n>0&&(a<n&&(a+=8,s=s<<8|t[o++]),a-=n,l|=s>>a&(1<<n)-1),l&=i,e[0]=o,e[1]=a,e[2]=s,l}const Cw=new Int32Array(32);function Tw(e,t,n,r,i,a,s){let o=0;for(Cw[1]=0,Cw[2]=0,Cw[3]=0;r>8;)Cw[o++]=Ew(e,t,8,s),r-=8;r>0&&(Cw[o++]=Ew(e,t,r,s));for(let e=n-1;e>0;e--){let t=0;for(let n=o-1;n>=0;n--){t=t<<8|Cw[n];const r=t/i[e]|0;Cw[n]=r,t-=r*i[e]}a[e]=t}a[0]=Cw[0]|Cw[1]<<8|Cw[2]<<16|Cw[3]<<24}eu.add("xtc",class extends cw{get type(){return"xtc"}get isBinary(){return!0}_parse(){Xc&&Wc.time("XtcParser._parse "+this.name);const e=jl(this.streamer.data),t=new DataView(e),n=this.frames,r=n.coordinates,i=n.boxes,a=n.times,s=new Int32Array(6),o=new Int32Array(3),l=new Int32Array(3),c=new Uint32Array(3),u=new Float32Array(3),d=new Float32Array(3);let h=0;const f=new Int32Array(3),p=new Uint32Array(f.buffer);for(;;){let n;const m=t.getInt32(h+4);h+=12;const g=3*m;a.push(t.getFloat32(h)),h+=4;const _=new Float32Array(9);for(let e=0;e<9;++e)_[e]=10*t.getFloat32(h),h+=4;if(i.push(_),m<=9){n=new Float32Array(m);for(let e=0;e<m;++e)n[e]=t.getFloat32(h),h+=4}else{f[0]=f[1]=f[2]=0,o[0]=o[1]=o[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,d[0]=d[1]=d[2]=0,n=new Float32Array(g);let r=0;const i=t.getInt32(h);h+=4;const a=t.getFloat32(h);let m;h+=4,s[0]=t.getInt32(h),s[1]=t.getInt32(h+4),s[2]=t.getInt32(h+8),s[3]=t.getInt32(h+12),s[4]=t.getInt32(h+16),s[5]=t.getInt32(h+20),o[0]=s[3]-s[0]+1,o[1]=s[4]-s[1]+1,o[2]=s[5]-s[2]+1,h+=24,(o[0]|o[1]|o[2])>16777215?(l[0]=Sw(o[0]),l[1]=Sw(o[1]),l[2]=Sw(o[2]),m=0):m=Mw(3,o);let _=t.getInt32(h);h+=4;let y=_-1;y=9>y?9:y;let v=ww[y]/2|0,b=ww[_]/2|0;c[0]=c[1]=c[2]=ww[_];let x=4*Math.ceil(t.getInt32(h)/4);h+=4;const w=1/a;let S=0,A=0;const M=new Uint8Array(e,h);for(u[0]=u[1]=u[2]=0;A<i;){0===m?(u[0]=Ew(f,M,l[0],p),u[1]=Ew(f,M,l[1],p),u[2]=Ew(f,M,l[2],p)):Tw(f,M,3,m,o,u,p),A++,u[0]+=s[0],u[1]+=s[1],u[2]+=s[2],d[0]=u[0],d[1]=u[1],d[2]=u[2];let e=0;if(1===Ew(f,M,1,p)&&(S=Ew(f,M,5,p),e=S%3,S-=e,e--),S>0){u[0]=u[1]=u[2]=0;for(let e=0;e<S;e+=3){if(Tw(f,M,3,_,c,u,p),A++,u[0]+=d[0]-b,u[1]+=d[1]-b,u[2]+=d[2]-b,0===e){let e=u[0];u[0]=d[0],d[0]=e,e=u[1],u[1]=d[1],d[1]=e,e=u[2],u[2]=d[2],d[2]=e,n[r++]=d[0]*w,n[r++]=d[1]*w,n[r++]=d[2]*w}else d[0]=u[0],d[1]=u[1],d[2]=u[2];n[r++]=u[0]*w,n[r++]=u[1]*w,n[r++]=u[2]*w}}else n[r++]=u[0]*w,n[r++]=u[1]*w,n[r++]=u[2]*w;if(_+=e,e<0?(b=v,v=_>9?ww[_-1]/2|0:0):e>0&&(v=b,b=ww[_]/2|0),c[0]=c[1]=c[2]=ww[_],0===c[0]||0===c[1]||0===c[2])return void console.error("(xdrfile error) Undefined error.")}h+=x}for(let e=0;e<g;e++)n[e]*=10;if(r.push(n),h>=e.byteLength)break}a.length>=1&&(n.timeOffset=a[0]),a.length>=2&&(n.deltaTime=a[1]-a[0]),Xc&&Wc.timeEnd("XtcParser._parse "+this.name)}});class Pw extends xx{constructor(e,t){const n=t||{};super(e,n),this.volume=new vf(this.name,this.path),this.voxelSize=Ol(n.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new _r}}const Iw=/\s+/,Rw=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,kw=.529177210859;class Dw extends Pw{get type(){return"cube"}_parse(){Xc&&Wc.time("CubeParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(6),n={},r=kw*this.voxelSize;function i(e,n){var r=t[e].trim().split(Iw)[n];return parseFloat(r)}n.atomCount=Math.abs(i(2,0)),n.originX=i(2,1)*kw,n.originY=i(2,2)*kw,n.originZ=i(2,3)*kw,n.NVX=i(3,0),n.NVY=i(4,0),n.NVZ=i(5,0),n.basisX=new Vn(i(3,1),i(3,2),i(3,3)).multiplyScalar(r),n.basisY=new Vn(i(4,1),i(4,2),i(4,3)).multiplyScalar(r),n.basisZ=new Vn(i(5,1),i(5,2),i(5,3)).multiplyScalar(r);const a=new Float32Array(n.NVX*n.NVY*n.NVZ);let s=0,o=0;const l=i(2,0)>0?0:1;this.streamer.eachChunkOfLines((function(e){!function(e,t,r){for(let e=0;e<t;++e){const t=r[e].trim();if(""!==t&&o>=n.atomCount+6+l){const e=t.match(Rw);for(let t=0,n=e.length;t<n;++t)a[s]=parseFloat(e[t]),++s}++o}}(0,e.length,e)})),e.header=n,e.setData(a,n.NVZ,n.NVY,n.NVX),Xc&&Wc.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=new _r;return t.multiply((new _r).makeTranslation(e.originX,e.originY,e.originZ)),t.multiply((new _r).makeBasis(e.basisZ,e.basisY,e.basisX)),t}}eu.add("cub",Dw),eu.add("cube",Dw);class Lw extends Pw{get type(){return"dsn6"}get isBinary(){return!0}_parse(){Xc&&Wc.time("Dsn6Parser._parse "+this.name);const e=this.volume,t={};let n,r;const i=jl(this.streamer.data),a=new Int16Array(i),s=new Uint8Array(i),o=String.fromCharCode.apply(null,s.subarray(0,512));if(o.startsWith(":-)"))t.xStart=parseInt(o.substr(10,5)),t.yStart=parseInt(o.substr(15,5)),t.zStart=parseInt(o.substr(20,5)),t.xExtent=parseInt(o.substr(32,5)),t.yExtent=parseInt(o.substr(38,5)),t.zExtent=parseInt(o.substr(42,5)),t.xRate=parseInt(o.substr(52,5)),t.yRate=parseInt(o.substr(58,5)),t.zRate=parseInt(o.substr(62,5)),t.xlen=parseFloat(o.substr(73,10))*this.voxelSize,t.ylen=parseFloat(o.substr(83,10))*this.voxelSize,t.zlen=parseFloat(o.substr(93,10))*this.voxelSize,t.alpha=parseFloat(o.substr(103,10)),t.beta=parseFloat(o.substr(113,10)),t.gamma=parseFloat(o.substr(123,10)),n=parseFloat(o.substr(138,12))/100,r=parseInt(o.substr(155,8)),t.sigma=100*parseFloat(o.substr(170,12));else{if(100!==a[18])for(let e=0,t=a.length;e<t;++e){const t=a[e];a[e]=(255&t)<<8|t>>8&255}t.xStart=a[0],t.yStart=a[1],t.zStart=a[2],t.xExtent=a[3],t.yExtent=a[4],t.zExtent=a[5],t.xRate=a[6],t.yRate=a[7],t.zRate=a[8];const e=1/a[17],i=e*this.voxelSize;t.xlen=a[9]*i,t.ylen=a[10]*i,t.zlen=a[11]*i,t.alpha=a[12]*e,t.beta=a[13]*e,t.gamma=a[14]*e,n=a[15]/100,r=a[16],t.gamma=a[14]*e}e.header=t,Xc&&Wc.log(t,n,r);const l=new Float32Array(t.xExtent*t.yExtent*t.zExtent);let c=512;const u=Math.ceil(t.xExtent/8),d=Math.ceil(t.yExtent/8),h=Math.ceil(t.zExtent/8);for(var f=0;f<h;++f)for(var p=0;p<d;++p)for(var m=0;m<u;++m)for(var g=0;g<8;++g)for(var _=8*f+g,y=0;y<8;++y)for(var v=8*p+y,b=0;b<8;++b){var x=8*m+b;if(!(x<t.xExtent&&v<t.yExtent&&_<t.zExtent)){c+=8-b;break}l[(x*t.yExtent+v)*t.zExtent+_]=(s[c]-r)/n,++c}e.setData(l,t.zExtent,t.yExtent,t.xExtent),t.sigma&&e.setStats(void 0,void 0,void 0,t.sigma),Xc&&Wc.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],r=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const i=[[],t,n,r],a=[0,e.xRate,e.yRate,e.zRate],s=[0,1,2,3],o=new _r;return o.set(i[s[1]][0]/a[s[1]],i[s[2]][0]/a[s[2]],i[s[3]][0]/a[s[3]],0,i[s[1]][1]/a[s[1]],i[s[2]][1]/a[s[2]],i[s[3]][1]/a[s[3]],0,i[s[1]][2]/a[s[1]],i[s[2]][2]/a[s[2]],i[s[3]][2]/a[s[3]],0,0,0,0,1),o.multiply((new _r).makeRotationY(Kl(90))),o.multiply((new _r).makeTranslation(-e.zStart,e.yStart,e.xStart)),o.multiply((new _r).makeScale(-1,1,1)),o}}eu.add("dsn6",Lw),eu.add("brix",Lw);const Nw=/\s+/;class Ow extends Pw{get type(){return"dx"}_parse(){Xc&&Wc.time("DxParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(30),n=this.parseHeaderLines(t),r=this.volume.header,i=n.dataLineStart,a=r.nx*r.ny*r.nz,s=new Float32Array(a);let o=0,l=0;this.streamer.eachChunkOfLines((function(e){!function(e,t,n){for(let e=0;e<t;++e){if(o<a&&l>i){const t=n[e].trim();if(""!==t){const e=t.split(Nw);for(let t=0,n=e.length;t<n;++t)s[o]=parseFloat(e[t]),++o}}++l}}(0,e.length,e)})),e.setData(s,r.nz,r.ny,r.nx),Xc&&Wc.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(e){const t={},n=e.length;let r=0,i=0,a=0;for(let s=0;s<n;++s){let n;const o=e[s];if(o.startsWith("object 1"))n=o.split(Nw),t.nx=parseInt(n[5]),t.ny=parseInt(n[6]),t.nz=parseInt(n[7]);else if(o.startsWith("origin"))n=o.split(Nw),t.xmin=parseFloat(n[1]),t.ymin=parseFloat(n[2]),t.zmin=parseFloat(n[3]);else if(o.startsWith("delta"))n=o.split(Nw),0===a?t.hx=parseFloat(n[1])*this.voxelSize:1===a?t.hy=parseFloat(n[2])*this.voxelSize:2===a&&(t.hz=parseFloat(n[3])*this.voxelSize),a+=1;else if(o.startsWith("object 3")){r=s,i+=o.length+1;break}i+=o.length+1}return this.volume.header=t,{dataLineStart:r,headerByteCount:i}}getMatrix(){const e=this.volume.header,t=new _r;return t.multiply((new _r).makeRotationY(Kl(90))),t.multiply((new _r).makeTranslation(-e.zmin,e.ymin,e.xmin)),t.multiply((new _r).makeScale(-e.hz,e.hy,e.hx)),t}}eu.add("dx",Ow),eu.add("dxbin",class extends Ow{get type(){return"dxbin"}get isBinary(){return!0}_parse(){Xc&&Wc.time("DxbinParser._parse "+this.name);const e=jl(this.streamer.data),t=function(e,t=10485760,n="\n"){let r="",i=[];for(let a=0;a<e.length;a+=t){const s=Hl(e.subarray(a,a+t)),o=s.lastIndexOf(n);if(-1===o)r+=s;else{const e=r+s.substr(0,o);i=i.concat(e.split(n)),r=o===s.length-n.length?"":s.substr(o+n.length)}}return""!==r&&i.push(r),i}(new Uint8Array(e,0,1e3)),n=this.parseHeaderLines(t),r=this.volume.header,i=n.headerByteCount,a=r.nx*r.ny*r.nz,s=new DataView(e),o=new Float32Array(a);for(let e=0;e<a;++e)o[e]=s.getFloat64(8*e+i,!0);this.volume.setData(o,r.nz,r.ny,r.nx),Xc&&Wc.timeEnd("DxbinParser._parse "+this.name)}});class Fw extends Pw{get type(){return"mrc"}get isBinary(){return!0}_parse(){Xc&&Wc.time("MrcParser._parse "+this.name);const e=this.volume,t={},n=jl(this.streamer.data),r=new Int32Array(n,0,56),i=new Float32Array(n,0,56),a=new DataView(n);if(t.MAP=String.fromCharCode(a.getUint8(208),a.getUint8(209),a.getUint8(210),a.getUint8(211)),t.MACHST=[a.getUint8(212),a.getUint8(213)],17===t.MACHST[0]&&17===t.MACHST[1]){const e=n.byteLength;for(let t=0;t<e;t+=4)a.setFloat32(t,a.getFloat32(t),!0)}let s;if(t.NX=r[0],t.NY=r[1],t.NZ=r[2],t.MODE=r[3],t.NXSTART=r[4],t.NYSTART=r[5],t.NZSTART=r[6],t.MX=r[7],t.MY=r[8],t.MZ=r[9],t.xlen=i[10]*this.voxelSize,t.ylen=i[11]*this.voxelSize,t.zlen=i[12]*this.voxelSize,t.alpha=i[13],t.beta=i[14],t.gamma=i[15],t.MAPC=r[16],t.MAPR=r[17],t.MAPS=r[18],t.DMIN=i[19],t.DMAX=i[20],t.DMEAN=i[21],t.ISPG=r[22],t.NSYMBT=r[23],t.LSKFLG=r[24],t.originX=i[49],t.originY=i[50],t.originZ=i[51],t.ARMS=i[54],e.header=t,2===t.MODE)s=new Float32Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ);else if(0===t.MODE){if(s=new Float32Array(new Int8Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ)),-128===r[39]&&127===r[40]){const e=(t.DMAX-t.DMIN)/255,n=.5*(t.DMIN+t.DMAX+e);for(let t=0,r=s.length;t<r;++t)s[t]=e*s[t]+n}}else Wc.error("MrcParser unknown mode",t.MODE);e.setData(s,t.NX,t.NY,t.NZ),0!==t.ARMS&&e.setStats(t.DMIN,t.DMAX,t.DMEAN,t.ARMS),Xc&&Wc.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],r=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const i=[[],t,n,r],a=[0,e.MX,e.MY,e.MZ],s=[0,e.MAPC,e.MAPR,e.MAPS],o=new _r;return o.set(i[s[1]][0]/a[s[1]],i[s[2]][0]/a[s[2]],i[s[3]][0]/a[s[3]],0,i[s[1]][1]/a[s[1]],i[s[2]][1]/a[s[2]],i[s[3]][1]/a[s[3]],0,i[s[1]][2]/a[s[1]],i[s[2]][2]/a[s[2]],i[s[3]][2]/a[s[3]],0,0,0,0,1),o.setPosition(new Vn(e.originX,e.originY,e.originZ)),o.multiply((new _r).makeTranslation(e.NXSTART,e.NYSTART,e.NZSTART)),o}}eu.add("mrc",Fw),eu.add("ccp4",Fw),eu.add("map",Fw);const Uw=/\s+/;function Bw(e){return e.trim().split(Uw).map(parseFloat)}class zw extends Pw{get type(){return"xplor"}_parse(){Xc&&Wc.time("XplorParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(8),n={};let r;r=t[2].startsWith("REMARKS")?parseInt(t[1].substring(0,8))+2:5;const i=r+3,a=Bw(t[r]);n.NA=a[0],n.AMIN=a[1],n.AMAX=a[2],n.NB=a[3],n.BMIN=a[4],n.BMAX=a[5],n.NC=a[6],n.CMIN=a[7],n.CMAX=a[8];const s=Bw(t[r+1]);n.a=s[0]*this.voxelSize,n.b=s[1]*this.voxelSize,n.c=s[2]*this.voxelSize,n.alpha=s[3],n.beta=s[4],n.gamma=s[5];const o=n.AMAX-n.AMIN+1,l=n.BMAX-n.BMIN+1,c=n.CMAX-n.CMIN+1,u=o*l*c,d=new Float32Array(u),h=Math.ceil(1+o*l/6);let f=0,p=0;this.streamer.eachChunkOfLines((function(e){!function(e,t,r){for(let e=0;e<t;++e){const t=r[e];if(p>=i&&(p-i)%h!=0&&f<u)for(let e=0,n=6;e<n;++e){const n=parseFloat(t.substr(12*e,12));if(isNaN(n))break;d[f++]=n}else if(f===u){const e=t.trim();if(e&&"-9999"!==e){const e=Bw(t);n.RAVE=e[0],n.RSIGMA=e[1]}}++p}}(0,e.length,e)})),e.header=n,e.setData(d,o,l,c),0!==n.RAVE&&1!==n.RSIGMA&&e.setStats(void 0,void 0,n.RAVE,n.RSIGMA),Xc&&Wc.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.a,0,0],n=[e.b*Math.cos(Math.PI/180*e.gamma),e.b*Math.sin(Math.PI/180*e.gamma),0],r=[e.c*Math.cos(Math.PI/180*e.beta),e.c*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.c*e.c*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const i=[[],t,n,r],a=[0,e.NA,e.NB,e.NC],s=[0,1,2,3],o=new _r;return o.set(i[s[1]][0]/a[s[1]],i[s[2]][0]/a[s[2]],i[s[3]][0]/a[s[3]],0,i[s[1]][1]/a[s[1]],i[s[2]][1]/a[s[2]],i[s[3]][1]/a[s[3]],0,i[s[1]][2]/a[s[1]],i[s[2]][2]/a[s[2]],i[s[3]][2]/a[s[3]],0,0,0,0,1),o.multiply((new _r).makeTranslation(e.AMIN,e.BMIN,e.CMIN)),o}}function Vw(e,t,n){let r,i,a;e/=360,t/=100,n/=100;const s=Math.floor(6*e),o=6*e-s,l=n*(1-t),c=n*(1-o*t),u=n*(1-(1-o)*t);switch(s%6){case 0:r=n,i=u,a=l;break;case 1:r=c,i=n,a=l;break;case 2:r=l,i=n,a=u;break;case 3:r=l,i=c,a=n;break;case 4:r=u,i=l,a=n;break;case 5:r=n,i=l,a=c}return[r,i,a]}eu.add("xplor",zw),eu.add("cns",zw);const Hw={red:Vw(0,100,100),orange:Vw(20,100,100),gold:Vw(40,100,100),yellow:Vw(60,100,100),lime:Vw(80,100,100),green:Vw(120,80,100),sea:Vw(150,100,100),cyan:Vw(180,100,85),sky:Vw(210,75,95),blue:Vw(240,70,100),purple:Vw(275,75,100),magenta:Vw(300,95,100),hotpink:Vw(335,100,100),pink:Vw(350,55,100),peach:Vw(25,75,100),lilac:Vw(275,55,100),pinktint:Vw(340,30,100),peachtint:Vw(25,50,100),yellowtint:Vw(60,50,100),greentint:Vw(135,40,100),bluetint:Vw(220,40,100),lilactint:Vw(275,35,100),white:Vw(0,0,100),gray:Vw(0,0,50),brown:Vw(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},$w=/[\s,]+/,Gw=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,jw=/^{+|}+$/g,Ww=/^['"]+|['"]+$/g,qw=/\s*=\s*/g;function Xw(e){let t,n,r,i=[];const a=(e=e.replace(qw,"=")).match(Gw);for(let e=1;e<a.length;++e){const s=a[e];if("{"===s[0])t=s.substring(1,s.length-1);else{const e=s.split("=");2===e.length&&("color"===e[0]?n=Hw[e[1]]:"width"===e[0]?r=parseInt(e[1]):"master"===e[0]&&i.push(e[1].replace(jw,"")))}}return{listName:t,listColor:n,listMasters:i,listWidth:r}}function Yw(e){const t=(e=e.trim()).indexOf("{"),n=e.indexOf("}"),r=e.substr(n+1).split($w),i=e.substr(t+1,n-1),a=[parseFloat(r[r.length-3]),parseFloat(r[r.length-2]),parseFloat(r[r.length-1])];let s,o,l,c=!1,u=!1;for(let e=4;e<=r.length;e++){const t=r[r.length-e];t in Hw&&(s=Hw[r[r.length-e]]),t.startsWith("width")&&(o=parseInt(t.substring(5))),t.startsWith("r=")&&(l=parseFloat(t.split("=")[1])),t.startsWith("P")&&(c=!0),t.startsWith("X")&&(u=!0)}return{label:i,position:a,color:s,radius:l,width:o,isLineBreak:c,isTriangleBreak:u}}function Kw(e){const t=e.indexOf("{"),n=e.indexOf("}");return e.substring(-1!==t?t+1:0,-1!==n?n:void 0).trim()}function Zw(e){const t=e.indexOf("}");return-1===t?void 0:e.substr(t+1).trim()}function Qw(e){let t="",n=[],r={};const i=(e=e.replace(qw,"=")).match(Gw);for(let e=1;e<i.length;++e){const a=i[e];if("{"===a[0])t=a.substring(1,a.length-1);else{const e=a.split("=");2===e.length?"master"===e[0]?n.push(e[1].replace(jw,"")):r[e[0]]=e[1].replace(jw,""):r[e[0]]=!0}}return{groupName:t,groupFlags:r,groupMasters:n}}eu.add("kin",class extends xx{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){Xc&&Wc.time(`KinParser._parse ${this.name}`);const e={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let t,n;this.kinemage=e;let r,i,a,s,o,l,c,u,d,h,f,p,m,g,_,y,v,b,x,w,S,A,M=!1,E="",C=!1,T="",P=null,I=null,R=!1,k="",D=!1,L="",N=!1,O=!1;if(this.streamer.eachChunkOfLines((function(F){!function(F,U,B){for(let F=0;F<U;++F){const U=B[F];if("@"===U[0]&&(M=!1,C=!1,R=!1,D=!1,N=!1,O=!1),U)if(U.startsWith("@dotlist")){let{listColor:o,listName:l,listMasters:c}=Xw(U);M=!0,E="",i=[],a=[],s=[],r=o,t&&(c=c.concat(t)),n&&(c=c.concat(n)),e.dotLists.push({name:l,masterArray:c,labelArray:i,positionArray:a,colorArray:s})}else if(U.startsWith("@vectorlist")){let{listMasters:r,listName:i,listWidth:a,listColor:s}=Xw(U);r&&r.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})})),C=!0,T="",P=null,I=null,c=[],u=[],d=[],h=[],f=[],p=[],o=s,l=[],a&&l.push(a),t&&(r=r.concat(t)),n&&(r=r.concat(n)),e.vectorLists.push({name:i,masterArray:r,label1Array:c,label2Array:u,position1Array:d,position2Array:h,color1Array:f,color2Array:p,width:l})}else if(U.startsWith("@balllist")){let{listName:r,listColor:i,listMasters:a}=Xw(U);a&&a.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})})),R=!0,k="",_=[],m=[],y=[],v=[],g=i,t&&(a=a.concat(t)),n&&(a=a.concat(n)),e.ballLists.push({name:r,masterArray:a,labelArray:_,radiusArray:m,positionArray:y,colorArray:v})}else if(U.startsWith("@ribbonlist")||U.startsWith("@trianglelist")){let{listMasters:r,listName:i,listColor:a}=Xw(U);r&&r.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})})),D=!0,L="",x=[],w=[],S=[],A=[],b=a,t&&(r=r.concat(t)),n&&(r=r.concat(n)),e.ribbonLists.push({name:i,masterArray:r,labelArray:x,positionArray:w,breakArray:S,colorArray:A})}else if(U.startsWith("@text"))N=!0,e.texts.push(U.substr(5));else if(U.startsWith("@caption"))O=!0,e.captions.push(U.substr(8));else if(M){let{label:e,color:t,position:n}=Yw(U);'"'===e?e=E:E=e,void 0===t&&(t=r),i.push(e),a.push(...n),s.push(...t)}else if(C){let e=U.replace(/(?!^){/g,"\n{").split(/\n/);for(var z=0;z<e.length;z++){let t=e[z],{label:n,color:r,width:i,position:a,isLineBreak:s}=Yw(t);'"'===n?n=T:T=n,void 0===r&&(r=o),s||null!==P&&(i&&l.push(i),c.push(T),d.push(...P),f.push(...I),u.push(n),h.push(...a),p.push(...r)),T=n,P=a,I=r}}else if(R){let{label:e,radius:t,color:n,position:r}=Yw(U);'"'===e?e=k:k=e,void 0===t&&(t=1),void 0===n&&(n=g),_.push(e),m.push(t),y.push(...r),v.push(...n)}else if(D){let{label:e,color:t,position:n,isTriangleBreak:r}=Yw(U);'"'===e?e=L:L=e,void 0===t&&(t=b),x.push(e),w.push(...n),S.push(r),A.push(...t)}else if(N)e.texts.push(U);else if(O)e.captions.push(U);else if(U.startsWith("@kinemage"))e.kinemage=parseInt(U.substr(9).trim());else if(U.startsWith("@onewidth"))e.onewidth=!0;else if(U.startsWith("@1viewid"))e["1viewid"]=Kw(U);else if(U.startsWith("@pdbfile"))e.pdbfile=Kw(U);else if(U.startsWith("@group")){let{groupName:n,groupFlags:r,groupMasters:i}=Qw(U);e.groupDict[n]||(e.groupDict[n]={dominant:!1,animate:!1},t=i),t&&t.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})}));for(let t in r)e.groupDict[n][t]=r[t]}else if(U.startsWith("@subgroup")){const{groupName:t,groupFlags:r,groupMasters:i}=Qw(U);e.subgroupDict[t]||(e.subgroupDict[t]={dominant:!1,animate:!1},n=i),n&&n.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})}));for(let n in r)e.subgroupDict[t][n]=r[n]}else if(U.startsWith("@master")){const t=Kw(U),n=Zw(U);e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1}),"on"===n?e.masterDict[t].visible=!0:"off"===n?e.masterDict[t].visible=!1:"indent"===n&&(e.masterDict[t].indent=!0)}else if(U.startsWith("@pointmaster")){const{groupName:t,groupFlags:n}=Qw(U);e.pointmasterDict[t]={id:Object.keys(n)[0].replace(Ww,"")}}else console.log(U);else M=!1,C=!1,R=!1,D=!1}}(0,F.length,F)})),e.text=e.texts.join("\n").trim(),e.caption=e.captions.join("\n").trim(),e.ribbonLists){let t=[];e.ribbonLists.forEach((function(e){t.push(function(e){let{labelArray:t,positionArray:n,colorArray:r,breakArray:i}=e,a=[],s=[],o=[],l=[];for(let e=0;e<i.length/3;e++){let c=3*e,u=9*e;i[c+1]||i[c+2]||(a.push(t[c]),a.push(t[c+1]),a.push(t[c+2]),l.push(i[c]),l.push(i[c+1]),l.push(i[c+2]),s.push(n[u]),s.push(n[u+1]),s.push(n[u+2]),s.push(n[u+3]),s.push(n[u+4]),s.push(n[u+5]),s.push(n[u+6]),s.push(n[u+7]),s.push(n[u+8]),o.push(r[u]),o.push(r[u+1]),o.push(r[u+2]),o.push(r[u+3]),o.push(r[u+4]),o.push(r[u+5]),o.push(r[u+6]),o.push(r[u+7]),o.push(r[u+8]))}return{name:e.name,masterArray:e.masterArray,labelArray:a,positionArray:s,breakArray:l,colorArray:o}}(function(e){let{labelArray:t,positionArray:n,colorArray:r,breakArray:i}=e,a=[];for(let e=0;e<3*(t.length-2);++e)a[e]=t[e-2*Math.floor(e/3)];let s=[];for(let e=0;e<3*(i.length-2);++e)s[e]=i[e-2*Math.floor(e/3)];let o=[];for(let e=0;e<9*(n.length/3-2);++e)o[e]=n[e-6*Math.floor(e/9)];let l=[];for(let e=0;e<9*(r.length/3-2);++e)l[e]=r[e-6*Math.floor(e/9)];let c=[];for(let e=0;e<o.length/3;++e)c.push(new Vn(o[3*e],o[3*e]+1,o[3*e]+2));return{name:e.name,masterArray:e.masterArray,labelArray:a,positionArray:o,breakArray:s,colorArray:l}}(e)))})),e.ribbonLists=t}Xc&&Wc.timeEnd(`KinParser._parse ${this.name}`)}});class Jw extends xx{constructor(e,t){super(e,t),this.loader=this.getLoader(),this.surface=new _f(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var e=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(e)}}const eS=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};eS.prototype={constructor:eS,setPath:function(e){this.path=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);this.object={name:e||"",geometry:{vertices:[],normals:[]},fromDeclaration:!1!==t},this.objects.push(this.object)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},addVertex:function(e,t,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0]),i.push(r[e+1]),i.push(r[e+2]),i.push(r[t+0]),i.push(r[t+1]),i.push(r[t+2]),i.push(r[n+0]),i.push(r[n+1]),i.push(r[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[e+0]),i.push(r[e+1]),i.push(r[e+2]),i.push(r[t+0]),i.push(r[t+1]),i.push(r[t+2]),i.push(r[n+0]),i.push(r[n+1]),i.push(r[n+2])},addFace:function(e,t,n,r,i,a,s,o){var l,c=this.vertices.length,u=this.parseVertexIndex(e,c),d=this.parseVertexIndex(t,c),h=this.parseVertexIndex(n,c);if(void 0===r?this.addVertex(u,d,h):(l=this.parseVertexIndex(r,c),this.addVertex(u,d,l),this.addVertex(d,h,l)),void 0!==i){var f=this.normals.length;u=this.parseNormalIndex(i,f),d=i===a?u:this.parseNormalIndex(a,f),h=i===s?u:this.parseNormalIndex(s,f),void 0===r?this.addNormal(u,d,h):(l=this.parseNormalIndex(o,f),this.addNormal(u,d,l),this.addNormal(d,h,l))}},addLineGeometry:function(e){this.object.geometry.type="Line";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++)this.addVertexLine(this.parseVertexIndex(e[n],t))}};return e.startObject("",!1),e},parse:function(e){var t,n,r=this._createParserState();-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));var i=e.split("\n"),a="",s="",o="",l=[],c="function"==typeof"".trimLeft;for(t=0,n=i.length;t<n;t++)if(a=i[t],0!==(a=c?a.trimLeft():a.trim()).length&&"#"!==(s=a.charAt(0)))if("v"===s){if(" "===(o=a.charAt(1))&&null!==(l=this.regexp.vertex_pattern.exec(a)))r.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("n"===o&&null!==(l=this.regexp.normal_pattern.exec(a)))r.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("t"!==o||null===this.regexp.uv_pattern.exec(a))throw new Error("Unexpected vertex/normal/uv line: '"+a+"'")}else if("f"===s)if(null!==(l=this.regexp.face_vertex_uv_normal.exec(a)))r.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(null!==this.regexp.face_vertex_uv.exec(a));else if(null!==(l=this.regexp.face_vertex_normal.exec(a)))r.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if(null===(l=this.regexp.face_vertex.exec(a)))throw new Error("Unexpected face line: '"+a+"'");r.addFace(l[1],l[2],l[3],l[4])}else if("l"===s){var u=a.substring(1).trim().split(" "),d=[],h=[];if(-1===a.indexOf("/"))d=u;else for(var f=0,p=u.length;f<p;f++){var m=u[f].split("/");""!==m[0]&&d.push(m[0]),""!==m[1]&&h.push(m[1])}r.addLineGeometry(d,h)}else if(null!==(l=this.regexp.object_pattern.exec(a))){var g=l[0].substr(1).trim();r.startObject(g)}else if(this.regexp.material_use_pattern.test(a));else if(this.regexp.material_library_pattern.test(a));else if(null===this.regexp.smoothing_pattern.exec(a)){if("\0"===a)continue;throw new Error("Unexpected line: '"+a+"'")}var _=[];for(t=0,n=r.objects.length;t<n;t++){var y=r.objects[t].geometry;if(0!==y.vertices.length){var v=new Si;v.setAttribute("position",new hi(new Float32Array(y.vertices),3)),y.normals.length>0?v.setAttribute("normal",new hi(new Float32Array(y.normals),3)):v.computeVertexNormals(),_.push(v)}}return _}},eu.add("obj",class extends Jw{get type(){return"obj"}getLoader(){return new eS}}),eu.add("csv",class extends xx{constructor(e,t){const n=t||{};super(e,n),this.delimiter=Ol(n.delimiter,","),this.comment=Ol(n.comment,"#"),this.columnNames=Ol(n.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const e=this.table.data,t=new RegExp("\\s*"+this.delimiter+"\\s*");let n=0;this.streamer.eachChunkOfLines((r=>{const i=r.length;for(let a=0;a<i;++a){const i=r[a].trim();if(i.startsWith(this.comment))continue;const s=i.split(t);0===n?this.table.columnNames=s:i&&e.push(s),++n}}))}}),eu.add("json",class extends xx{constructor(e,t){const n=t||{};super(e,n),this.string=Ol(n.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}}),eu.add("msgpack",class extends xx{constructor(e,t){super(e,t||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){Xc&&Wc.time("MsgpackParser._parse "+this.name),this.msgpack.data=Kx(this.streamer.data),Xc&&Wc.timeEnd("MsgpackParser._parse "+this.name)}}),eu.add("netcdf",class extends xx{constructor(e,t){super(e,t||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){Xc&&Wc.time("NetcdfParser._parse "+this.name),this.netcdf.data=new bw(this.streamer.data),Xc&&Wc.timeEnd("NetcdfParser._parse "+this.name)}});class tS extends xx{constructor(e,t){super(e,t),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}eu.add("txt",tS),eu.add("text",tS);const nS=/^['"]|['"]$/g,rS=/^<([\w-:.]+)\s*/,iS=/^([^<]*)/,aS=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;class sS extends xx{constructor(e,t){const n=t||{};super(e,n),this.useDomParser=Ol(n.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(e){return function(e){return e=e.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:function(){if(!n(/^<\?xml\s*/))return;const e={attributes:{}};for(;!r()&&!i("?>");){const n=t();if(!n)return e;e.attributes[n.name]=n.value}return n(/\?>\s*/),e}(),root:function e(){const a=n(rS);if(!a)return;const s={name:a[1],attributes:{},children:[]};for(;!(r()||i(">")||i("?>")||i("/>"));){const e=t();if(!e)return s;s.attributes[e.name]=e.value}if(n(/^\s*\/>\s*/))return s;let o;for(n(/\??>\s*/),s.content=function(){const e=n(iS);return e?e[1]:""}();o=e();)s.children.push(o);return n(/^<\/[\w-:.]+>\s*/),s}()};function t(){const e=n(aS);var t;if(e)return{name:e[1],value:(t=e[2],t.replace(nS,""))}}function n(t){const n=e.match(t);if(n)return e=e.slice(n[0].length),n}function r(){return 0===e.length}function i(t){return 0===e.indexOf(t)}}(e)}__domParser(e){return(new window.DOMParser).parseFromString(e,"text/xml")}_parse(){Xc&&Wc.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),Xc&&Wc.timeEnd("XmlParser._parse "+this.name)}}function oS(e,t){const n=e.getNamedItem(t);return null!==n?n.value:""}function lS(e,t,n=!1){const r=oS(e,"icode").trim(),i=oS(e,"chain").trim(),a=oS(e,"altcode");let s=oS(e,"resnum");return r&&(s+="^"+r),i&&(s+=":"+i),t&&(s+="."+t),n&&a.trim()&&(s+="%"+a),s+="/"+(parseInt(oS(e,"model"))-1),s}function cS(e){const t=oS(e,"chain").trim();let n=`[${oS(e,"rescode")}]${oS(e,"resnum")}`;return t&&(n+=`:${t}`),n}function uS(e,t,n){void 0===e[t]?e[t]=n:e[t]|=n}function dS(e,t){return null!==e&&e.value===t}function hS(e,t,n){let r=0;const i=t.getElementsByTagName("clash");for(let t=0,n=i.length;t<n;++t)if(e[oS(i[t].attributes,"cid")]){r+=1;break}return t.getElementsByTagName("angle-outlier").length>0&&(r+=1),t.getElementsByTagName("bond-outlier").length>0&&(r+=1),t.getElementsByTagName("plane-outlier").length>0&&(r+=1),dS(n.getNamedItem("rota"),"OUTLIER")&&(r+=1),dS(n.getNamedItem("rama"),"OUTLIER")&&(r+=1),dS(n.getNamedItem("RNApucker"),"outlier")&&(r+=1),r}eu.add("xml",sS);class fS{constructor(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(e){Xc&&Wc.time("Validation.fromXml");const t=this.rsrzDict,n=this.rsccDict,r=this.rciDict,i=this.clashDict,a=this.clashArray,s=this.geoDict,o=this.geoAtomDict,l=this.atomDict,c=e.getElementsByTagName("Entry");if(1===c.length){const e=c[0].getElementsByTagName("chemical_shift_list");if(1===e.length){const t=e[0].getElementsByTagName("random_coil_index");for(let e=0,n=t.length;e<n;++e){const n=t[e].attributes;r[cS(n)]=parseFloat(oS(n,"value"))}}}const u=e.getElementsByTagName("ModelledSubgroup"),d={},h=[];Xc&&Wc.time("Validation.fromXml#clashDict");for(let r=0,s=u.length;r<s;++r){const s=u[r],o=s.attributes,c=lS(o);null!==o.getNamedItem("rsrz")&&(t[c]=parseFloat(oS(o,"rsrz"))),null!==o.getNamedItem("rscc")&&(n[c]=parseFloat(oS(o,"rscc")));const f=e.createAttribute("sele");f.value=c,o.setNamedItem(f);const p=s.getElementsByTagName("clash");for(let e=0,t=p.length;e<t;++e){const t=p[e].attributes,n=oS(t,"atom");if("H"!==Cp(n)){const e=oS(t,"cid"),r=lS(o,n,!0);if(l[r]=!0,void 0===d[e])d[e]={sele1:r,res1:c};else{const t=d[e];t.res1!==c&&(t.sele2=r,t.res2=c,h.push(t.res1,c),i[e]=t,a.push(t))}}}}Xc&&Wc.timeEnd("Validation.fromXml#clashDict");for(let e=0,t=u.length;e<t;++e){const t=u[e],n=t.attributes,r=oS(n,"sele");if("."!==oS(n,"seq")){const e=hS(i,t,n);e>0&&(s[r]=e)}else{const e=t.getElementsByTagName("clash"),n=t.getElementsByTagName("mog-bond-outlier"),a=t.getElementsByTagName("mog-angle-outlier");if(n.length>0||a.length>0||e.length>0){const t={};o[r]=t;for(let n=0,r=e.length;n<r;++n){const r=e[n].attributes;i[oS(r,"cid")]&&uS(t,oS(r,"atom"),1)}for(let e=0,r=n.length;e<r;++e)oS(n[e].attributes,"atoms").split(",").forEach((function(e){uS(t,e,2)}));for(let e=0,n=a.length;e<n;++e)oS(a[e].attributes,"atoms").split(",").forEach((function(e){uS(t,e,4)}))}}}this.clashSele=h.length?h.join(" OR "):"NONE",Xc&&Wc.timeEnd("Validation.fromXml")}getClashData(e){Xc&&Wc.time("Validation.getClashData");const t=e||{},n=t.structure,r=n.atomSet,i=new ai(Ol(t.color,"#f0027f")),a=n.getAtomProxy(),s=n.getAtomProxy(),o=new Vn,l=new Vn,c=new Vn,u=this.clashArray,d=u.length,h=new Float32Array(3*d),f=new Float32Array(3*d),p=vu(d,i.r,i.g,i.b),m=new Float32Array(d),g=new Float32Array(d);Xc&&Wc.time("Validation.getClashData#atomDict");const _=this.atomDict;n.eachAtom((function(e){const t=function(e){const t=e.inscode,n=e.chainname,r=e.atomname,i=e.altloc;let a=e.resno+"";return t&&(a+="^"+t),n&&(a+=":"+n),r&&(a+="."+r),i&&(a+="%"+i),a+="/"+e.modelIndex,a}(e);!0===_[t]&&(_[t]=e.index)})),Xc&&Wc.timeEnd("Validation.getClashData#atomDict");let y=0;return u.forEach((function(e,t){if(a.index=_[e.sele1],s.index=_[e.sele2],void 0===a.index||void 0===s.index||!r.isSet(a.index,s.index))return;o.subVectors(s,a).setLength(a.vdw),l.copy(a).add(o),o.subVectors(a,s).setLength(s.vdw),c.copy(s).add(o);const n=a.distanceTo(s)/2,i=Math.sqrt(a.vdw*a.vdw-n*n),u=Math.sqrt(s.vdw*s.vdw-n*n);l.toArray(h,3*y),c.toArray(f,3*y),m[y]=(i+u)/2,g[y]=t,++y})),Xc&&Wc.timeEnd("Validation.getClashData"),{position1:h.subarray(0,3*y),position2:f.subarray(0,3*y),color:p.subarray(0,3*y),color2:p.subarray(0,3*y),radius:m.subarray(0,y),picking:new Uh(g.subarray(0,y),this,n)}}}function pS(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}function mS(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]}function gS(e,t,n,r){for(var i=65535&e,a=e>>>16&65535,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--s);i%=65521,a%=65521}return i|a<<16}eu.add("validation",class extends sS{constructor(e,t){super(e,t||{}),this.useDomParser=!0,this.validation=new fS(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),Xc&&Wc.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),Xc&&Wc.timeEnd("ValidationParser._parse "+this.name)}});var _S=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function yS(e,t,n,r){var i=_S,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^i[255&(e^t[s])];return~e}var vS=30,bS=12;function xS(e,t){var n,r,i,a,s,o,l,c,u,d,h,f,p,m,g,_,y,v,b,x,w,S,A,M,E;n=e.state,r=e.next_in,M=e.input,i=r+(e.avail_in-5),a=e.next_out,E=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,_=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=M[r++]<<p,p+=8,f+=M[r++]<<p,p+=8),v=m[f&_];t:for(;;){if(f>>>=b=v>>>24,p-=b,0==(b=v>>>16&255))E[a++]=65535&v;else{if(!(16&b)){if(64&b){if(32&b){n.mode=bS;break e}e.msg="invalid literal/length code",n.mode=vS;break e}v=m[(65535&v)+(f&(1<<b)-1)];continue t}for(x=65535&v,(b&=15)&&(p<b&&(f+=M[r++]<<p,p+=8),x+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=M[r++]<<p,p+=8,f+=M[r++]<<p,p+=8),v=g[f&y];;){if(f>>>=b=v>>>24,p-=b,16&(b=v>>>16&255)){if(w=65535&v,p<(b&=15)&&(f+=M[r++]<<p,(p+=8)<b&&(f+=M[r++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=vS;break e}if(f>>>=b,p-=b,w>(b=a-s)){if((b=w-b)>u&&n.sane){e.msg="invalid distance too far back",n.mode=vS;break e}if(S=0,A=h,0===d){if(S+=c-b,b<x){x-=b;do{E[a++]=h[S++]}while(--b);S=a-w,A=E}}else if(d<b){if(S+=c+d-b,(b-=d)<x){x-=b;do{E[a++]=h[S++]}while(--b);if(S=0,d<x){x-=b=d;do{E[a++]=h[S++]}while(--b);S=a-w,A=E}}}else if(S+=d-b,b<x){x-=b;do{E[a++]=h[S++]}while(--b);S=a-w,A=E}for(;x>2;)E[a++]=A[S++],E[a++]=A[S++],E[a++]=A[S++],x-=3;x&&(E[a++]=A[S++],x>1&&(E[a++]=A[S++]))}else{S=a-w;do{E[a++]=E[S++],E[a++]=E[S++],E[a++]=E[S++],x-=3}while(x>2);x&&(E[a++]=E[S++],x>1&&(E[a++]=E[S++]))}break}if(64&b){e.msg="invalid distance code",n.mode=vS;break e}v=g[(65535&v)+(f&(1<<b)-1)]}}break}}while(r<i&&a<o);r-=x=p>>3,f&=(1<<(p-=x<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<o?o-a+257:257-(a-o),n.hold=f,n.bits=p}var wS=15,SS=852,AS=592,MS=0,ES=1,CS=2,TS=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],PS=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],IS=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],RS=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function kS(e,t,n,r,i,a,s,o){var l,c,u,d,h,f,p,m,g,_=o.bits,y=0,v=0,b=0,x=0,w=0,S=0,A=0,M=0,E=0,C=0,T=null,P=0,I=new Uint16Array(wS+1),R=new Uint16Array(wS+1),k=null,D=0;for(y=0;y<=wS;y++)I[y]=0;for(v=0;v<r;v++)I[t[n+v]]++;for(w=_,x=wS;x>=1&&0===I[x];x--);if(w>x&&(w=x),0===x)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(b=1;b<x&&0===I[b];b++);for(w<b&&(w=b),M=1,y=1;y<=wS;y++)if(M<<=1,(M-=I[y])<0)return-1;if(M>0&&(e===MS||1!==x))return-1;for(R[1]=0,y=1;y<wS;y++)R[y+1]=R[y]+I[y];for(v=0;v<r;v++)0!==t[n+v]&&(s[R[t[n+v]]++]=v);if(e===MS?(T=k=s,f=19):e===ES?(T=TS,P-=257,k=PS,D-=257,f=256):(T=IS,k=RS,f=-1),C=0,v=0,y=b,h=a,S=w,A=0,u=-1,d=(E=1<<w)-1,e===ES&&E>SS||e===CS&&E>AS)return 1;for(;;){p=y-A,s[v]<f?(m=0,g=s[v]):s[v]>f?(m=k[D+s[v]],g=T[P+s[v]]):(m=96,g=0),l=1<<y-A,b=c=1<<S;do{i[h+(C>>A)+(c-=l)]=p<<24|m<<16|g}while(0!==c);for(l=1<<y-1;C&l;)l>>=1;if(0!==l?(C&=l-1,C+=l):C=0,v++,0==--I[y]){if(y===x)break;y=t[n+s[v]]}if(y>w&&(C&d)!==u){for(0===A&&(A=w),h+=b,M=1<<(S=y-A);S+A<x&&!((M-=I[S+A])<=0);)S++,M<<=1;if(E+=1<<S,e===ES&&E>SS||e===CS&&E>AS)return 1;i[u=C&d]=w<<24|S<<16|h-a}}return 0!==C&&(i[h+C]=y-A<<24|64<<16),o.bits=w,0}var DS=1,LS=2,NS=0,OS=-2,FS=1,US=12,BS=30,zS=852,VS=592;function HS(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function $S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var GS,jS,WS=!0;function qS(e){if(WS){var t;for(GS=new Int32Array(512),jS=new Int32Array(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(kS(DS,e.lens,0,288,GS,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;kS(LS,e.lens,0,32,jS,0,e.work,{bits:5}),WS=!1}e.lencode=GS,e.lenbits=9,e.distcode=jS,e.distbits=5}function XS(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(mS(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),mS(a.window,t,n-r,i,a.wnext),(r-=i)?(mS(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}function YS(e,t){var n,r,i,a,s,o,l,c,u,d,h,f,p,m,g,_,y,v,b,x,w,S,A,M,E=0,C=new Uint8Array(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return OS;(n=e.state).mode===US&&(n.mode=13),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,o=e.avail_in,c=n.hold,u=n.bits,d=o,h=l,S=NS;e:for(;;)switch(n.mode){case FS:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(2&n.wrap&&35615===c){n.check=0,C[0]=255&c,C[1]=c>>>8&255,n.check=yS(n.check,C,2,0),c=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=BS;break}if(8!=(15&c)){e.msg="unknown compression method",n.mode=BS;break}if(u-=4,w=8+(15&(c>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){e.msg="invalid window size",n.mode=BS;break}n.dmax=1<<w,e.adler=n.check=1,n.mode=512&c?10:US,c=0,u=0;break;case 2:for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(n.flags=c,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=BS;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=BS;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(C[0]=255&c,C[1]=c>>>8&255,n.check=yS(n.check,C,2,0)),c=0,u=0,n.mode=3;case 3:for(;u<32;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,n.check=yS(n.check,C,4,0)),c=0,u=0,n.mode=4;case 4:for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(C[0]=255&c,C[1]=c>>>8&255,n.check=yS(n.check,C,2,0)),c=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(C[0]=255&c,C[1]=c>>>8&255,n.check=yS(n.check,C,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((f=n.length)>o&&(f=o),f&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),mS(n.head.extra,r,a,f,w)),512&n.flags&&(n.check=yS(n.check,r,f,a)),o-=f,a+=f,n.length-=f),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===o)break e;f=0;do{w=r[a+f++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&f<o);if(512&n.flags&&(n.check=yS(n.check,r,f,a)),o-=f,a+=f,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===o)break e;f=0;do{w=r[a+f++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&f<o);if(512&n.flags&&(n.check=yS(n.check,r,f,a)),o-=f,a+=f,w)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=BS;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=US;break;case 10:for(;u<32;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}e.adler=n.check=HS(c),c=0,u=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=c,n.bits=u,2;e.adler=n.check=1,n.mode=US;case US:if(5===t||6===t)break e;case 13:if(n.last){c>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}switch(n.last=1&c,u-=1,3&(c>>>=1)){case 0:n.mode=14;break;case 1:if(qS(n),n.mode=20,6===t){c>>>=2,u-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=BS}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=BS;break}if(n.length=65535&c,c=0,u=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(f=n.length){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;mS(i,r,a,f,s),o-=f,a+=f,l-=f,s+=f,n.length-=f;break}n.mode=US;break;case 17:for(;u<14;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=BS;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.lens[T[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[T[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},S=kS(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,S){e.msg="invalid code lengths set",n.mode=BS;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;_=(E=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,y=65535&E,!((g=E>>>24)<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(y<16)c>>>=g,u-=g,n.lens[n.have++]=y;else{if(16===y){for(M=g+2;u<M;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=BS;break}w=n.lens[n.have-1],f=3+(3&c),c>>>=2,u-=2}else if(17===y){for(M=g+3;u<M;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}u-=g,w=0,f=3+(7&(c>>>=g)),c>>>=3,u-=3}else{for(M=g+7;u<M;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}u-=g,w=0,f=11+(127&(c>>>=g)),c>>>=7,u-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=BS;break}for(;f--;)n.lens[n.have++]=w}}if(n.mode===BS)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=BS;break}if(n.lenbits=9,A={bits:n.lenbits},S=kS(DS,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,S){e.msg="invalid literal/lengths set",n.mode=BS;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},S=kS(LS,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,S){e.msg="invalid distances set",n.mode=BS;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=c,n.bits=u,xS(e,h),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,o=e.avail_in,c=n.hold,u=n.bits,n.mode===US&&(n.back=-1);break}for(n.back=0;_=(E=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,y=65535&E,!((g=E>>>24)<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(_&&!(240&_)){for(v=g,b=_,x=y;_=(E=n.lencode[x+((c&(1<<v+b)-1)>>v)])>>>16&255,y=65535&E,!(v+(g=E>>>24)<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}c>>>=v,u-=v,n.back+=v}if(c>>>=g,u-=g,n.back+=g,n.length=y,0===_){n.mode=26;break}if(32&_){n.back=-1,n.mode=US;break}if(64&_){e.msg="invalid literal/length code",n.mode=BS;break}n.extra=15&_,n.mode=22;case 22:if(n.extra){for(M=n.extra;u<M;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;_=(E=n.distcode[c&(1<<n.distbits)-1])>>>16&255,y=65535&E,!((g=E>>>24)<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(!(240&_)){for(v=g,b=_,x=y;_=(E=n.distcode[x+((c&(1<<v+b)-1)>>v)])>>>16&255,y=65535&E,!(v+(g=E>>>24)<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}c>>>=v,u-=v,n.back+=v}if(c>>>=g,u-=g,n.back+=g,64&_){e.msg="invalid distance code",n.mode=BS;break}n.offset=y,n.extra=15&_,n.mode=24;case 24:if(n.extra){for(M=n.extra;u<M;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=BS;break}n.mode=25;case 25:if(0===l)break e;if(f=h-l,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=BS;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),m=n.window}else m=i,p=s-n.offset,f=n.length;f>l&&(f=l),l-=f,n.length-=f;do{i[s++]=m[p++]}while(--f);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;i[s++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===o)break e;o--,c|=r[a++]<<u,u+=8}if(h-=l,e.total_out+=h,n.total+=h,h&&(e.adler=n.check=n.flags?yS(n.check,i,h,s-h):gS(n.check,i,h,s-h)),h=l,(n.flags?c:HS(c))!==n.check){e.msg="incorrect data check",n.mode=BS;break}c=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=BS;break}c=0,u=0}n.mode=29;case 29:S=1;break e;case BS:S=-3;break e;case 31:return-4;default:return OS}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=c,n.bits=u,(n.wsize||h!==e.avail_out&&n.mode<BS&&(n.mode<27||4!==t))&&XS(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,n.wrap&&h&&(e.adler=n.check=n.flags?yS(n.check,i,h,e.next_out-h):gS(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===US?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===h||4===t)&&S===NS&&(S=-5),S}function KS(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?OS:11===n.mode&&gS(1,t,r,0)!==n.check?-3:XS(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,NS):OS}var ZS=!0,QS=!0;try{String.fromCharCode.apply(null,[0])}catch(lc){ZS=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(lc){QS=!1}for(var JS=new Uint8Array(256),eA=0;eA<256;eA++)JS[eA]=eA>=252?6:eA>=248?5:eA>=240?4:eA>=224?3:eA>=192?2:1;function tA(e){var t,n,r,i,a,s=e.length,o=0;for(i=0;i<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),a=0,i=0;a<o;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t}function nA(e,t){var n,r,i,a,s=t||e.length,o=new Array(2*s);for(r=0,n=0;n<s;)if((i=e[n++])<128)o[r++]=i;else if((a=JS[i])>4)o[r++]=65533,n+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&n<s;)i=i<<6|63&e[n++],a--;a>1?o[r++]=65533:i<65536?o[r++]=i:(i-=65536,o[r++]=55296|i>>10&1023,o[r++]=56320|1023&i)}return function(e,t){if(t<65537&&(e.subarray&&QS||!e.subarray&&ZS))return String.fromCharCode.apply(null,pS(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}(o,r)}function rA(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+JS[e[n]]>t?n:t}JS[254]=JS[254]=1;var iA={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function aA(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function sA(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var oA=Object.prototype.toString;function lA(e){if(!(this instanceof lA))return new lA(e);this.options=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e}({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new aA,this.strm.avail_out=0;var n,r,i,a=function(e,t){var n,r;return e?(r=new $S,e.state=r,r.window=null,n=function(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?OS:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,function(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,function(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=FS,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(zS),t.distcode=t.distdyn=new Int32Array(VS),t.sane=1,t.back=-1,NS):OS}(e)):OS}(e))):OS}(e,t),n!==NS&&(e.state=null),n):OS}(this.strm,t.windowBits);if(0!==a)throw new Error(iA[a]);this.header=new sA,n=this.strm,r=this.header,n&&n.state&&2&(i=n.state).wrap&&(i.head=r,r.done=!1)}lA.prototype.push=function(e,t){var n,r,i,a,s,o,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,d=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,"string"==typeof e?l.input=function(e){for(var t=new Uint8Array(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t}(e):"[object ArrayBuffer]"===oA.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new Uint8Array(c),l.next_out=0,l.avail_out=c),2===(n=YS(l,0))&&u&&(o="string"==typeof u?tA(u):"[object ArrayBuffer]"===oA.call(u)?new Uint8Array(u):u,n=KS(this.strm,o)),-5===n&&!0===d&&(n=0,d=!1),1!==n&&0!==n)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&1!==n&&(0!==l.avail_in||4!==r&&2!==r)||("string"===this.options.to?(i=rA(l.output,l.next_out),a=l.next_out-i,s=nA(l.output,i),l.next_out=a,l.avail_out=c-a,a&&mS(l.output,l.output,i,a,0),this.onData(s)):this.onData(pS(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(d=!0)}while((l.avail_in>0||0===l.avail_out)&&1!==n);return 1===n&&(r=4),4===r?(n=function(e){if(!e||!e.state)return OS;var t=e.state;return t.window&&(t.window=null),e.state=null,NS}(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==r||(this.onEnd(0),l.avail_out=0,!0)},lA.prototype.onData=function(e){this.chunks.push(e)},lA.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=function(e){var t,n,r,i,a,s;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(s=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],s.set(a,i),i+=a.length;return s}(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},nu.add("gz",(function(e){let t;e instanceof ArrayBuffer&&(e=new Uint8Array(e));try{t=function(e,t){var n=new lA(void 0);if(n.push(e,!0),n.err)throw n.msg;return n.result}(e)}catch(n){t=e}return t}));class cA{}const uA="https:";Qc.add("rcsb",new class extends cA{getUrl(e){const t=ou(e),n=t.name.indexOf("_")>-1?t.name:t.name.substring(0,4);return!["pdb","cif"].includes(t.ext)||!1!==t.compressed&&"gz"!==t.compressed?("mmtf"===t.ext&&(Wc.warn("MMTF files distribution has been discontinued by RCSB PDB as of July 2024.\n Defaulting to bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice"),t.base.endsWith(".bb")&&Wc.warn("Backbone only files are not available from RCSB PDB anymore."),t.ext=""),t.ext?Wc.warn("unsupported ext",t.ext):Wc.warn('mmCif files available from RCSB PDB lack connectivity information.\n Consider using PDBe as the data provider for using "Updated mmCif files" that contain residues connectivity records.'),uA+"//models.rcsb.org/"+n+".bcif.gz"):uA+"//files.rcsb.org/download/"+t.path}getExt(e){return ou(e).ext||"bcif"}});const dA="//www.ebi.ac.uk/pdbe/entry-files/download/";Qc.add("pdbe",new class extends cA{getUrl(e){const t=ou(e);let n,r=t.name.indexOf("_")>-1?t.name:t.name.substring(0,4);switch(t.ext){case"cif":n=dA+r+"_updated.cif";break;case"pdb":case"ent":r.startsWith("pdb")||(r="pdb"+r),n=dA+r+".ent";break;case"bcif":n=dA+t.path;break;case"":n=dA+r+".bcif";break;default:Wc.warn("unsupported ext",t.ext),n=dA+r+".bcif"}return"https://"+n}getExt(e){return ou(e).ext||"bcif"}});const hA="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",fA="/SDF?record_type=3d";Qc.add("pubchem",new class extends cA{getUrl(e){const t=ou(e),n=t.name;let r;return t.ext&&"sdf"!==t.ext?(Wc.warn("unsupported ext",t.ext),r=hA+n+fA):r=hA+n+fA,function(){const e=window.location.protocol;return null===e.match(/http(s)?:/gi)?"http:":e}()+r}getExt(e){return ou(e).ext||"sdf"}});class pA extends cA{getUrl(e){return e}getExt(e){return ou(e).ext}}Qc.add("ftp",new pA),Qc.add("http",new pA),Qc.add("https",new pA);const mA="//alphafold.ebi.ac.uk/files/AF-",gA="-F1-model_v4.pdb";function _A(e,t){return{type:"integer",max:e,min:t}}function yA(e,t,n){return{type:"number",precision:e,max:t,min:n}}function vA(e,t,n){return{type:"range",step:e,max:t,min:n}}function bA(...e){return{type:"select",options:e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:t})),{})}}Qc.add("alphafold",new class extends cA{getUrl(e){const t=ou(e),n=t.name;let r;return t.ext&&"pdb"!==t.ext?(Wc.warn("unsupported AF ext",t.ext),r=mA+n+gA):r=mA+n+gA,"https://"+r}getExt(e){return ou(e).ext||"pdb"}}),bA("auto","low","medium","high"),vA(1,5,-1),yA(1,10,0),yA(1,10,0),yA(1,10,0),vA(1,100,0),vA(1,100,0),_A(200,0),bA("scene","camera"),bA("relative","absolute"),vA(1,100,0),vA(1,100,0),bA("perspective","orthographic","stereo"),yA(3,1,.01),vA(1,120,15),yA(2,10,0),yA(2,10,0),_A(1e4,-1),bA(...Object.keys(Lf));var xA=function(e){(0,t.useEffect)((function(){var t=document.querySelector("body");return t.style.backgroundColor=e,function(){t.style.backgroundColor="initial"}}),[e])};const wA=function(){return xA("rgb(36,46,52)"),t.createElement("div",{className:"bio-container"},t.createElement("p",null,"I aim to drive innovation in ",t.createElement("strong",null,"biotech"),"  using ",t.createElement("strong",null,"computational biology")),t.createElement("p",null,"I'm a recent ",t.createElement("strong",null,"Northwestern University Biotech MS grad"),", where I:"),t.createElement("ul",{className:"no-bullet"},t.createElement("li",null," Deployed ",t.createElement("strong",null,"ML-driven")," approaches for strain engineering projects"),t.createElement("li",null," Built ",t.createElement("strong",null,"bioinformatics")," tools to help synbio startups turn ideas into reality."),t.createElement("li",null," Studied ",t.createElement("strong",null,"biology, Machine Learning, and entrepreneurship")," - because in biotech, you've got to wear many hats!")),t.createElement("p",null,"Passionate about  developing software tools to empower scientists and commercial stakeholders to efficiently reach their goals and  continously learning to keep up with the technological innovations occuring around us."),t.createElement("div",null))},SA=function(){return xA("rgb(36, 46, 52)"),t.createElement("div",{className:"about-me-container"},t.createElement("h2",{className:"about-me-heading"},"About Me"),t.createElement("div",{className:"about-me-content"},t.createElement("p",null,"I am a computational biologist and recent graduate of the Master's in Biotechnology Program at Northwestern University, with graduate minors in Entrepreneurship and Synthetic Biology. My interests lie at the intersection of biology and computer science, particularly in the field of machine learning-driven protein engineering."),t.createElement("p",null,"I am passionate about transforming data into actionable insights. During my internships with LanzaTech and Bluestem Biosciences, I developed tools and models to guide downstream experimentation."),t.createElement("p",null,"After years in the wet lab, my time at Tempus inspired me to learn how to code. I saw that the data we generated in the lab was being used to develop AI to connect patients with treatments, and I decided I wanted to be part of using the data, not just generating it. That was in 2020. Over the past four years, I have taught myself to program, worked on front-end development for HealthPhi, a mobile health tech startup, served as a full stack developer for Bluestem Biosciences, a synthetic biology startup in the climate space, and held a data science role developing and deploying mathematical models at LanzaTech. During this time, I also deepened my understanding of bio-processing as well as the business and regulatory aspects of the biotech space by completing my master's degree at Northwestern."),t.createElement("p",null,"My years of bench experience, combined with my software skills and training from Northwestern, provide unique insights into the needs of diverse collaborators, from scientists and commercial professionals to fellow technologists.")))};function AA(){}function MA(e){return null==e?AA:function(){return this.querySelector(e)}}function EA(){return[]}function CA(e){return null==e?EA:function(){return this.querySelectorAll(e)}}function TA(e){return function(){return this.matches(e)}}function PA(e){return function(t){return t.matches(e)}}var IA=Array.prototype.find;function RA(){return this.firstElementChild}var kA=Array.prototype.filter;function DA(){return Array.from(this.children)}function LA(e){return new Array(e.length)}function NA(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function OA(e,t,n,r,i,a){for(var s,o=0,l=t.length,c=a.length;o<c;++o)(s=t[o])?(s.__data__=a[o],r[o]=s):n[o]=new NA(e,a[o]);for(;o<l;++o)(s=t[o])&&(i[o]=s)}function FA(e,t,n,r,i,a,s){var o,l,c,u=new Map,d=t.length,h=a.length,f=new Array(d);for(o=0;o<d;++o)(l=t[o])&&(f[o]=c=s.call(l,l.__data__,o,t)+"",u.has(c)?i[o]=l:u.set(c,l));for(o=0;o<h;++o)c=s.call(e,a[o],o,a)+"",(l=u.get(c))?(r[o]=l,l.__data__=a[o],u.delete(c)):n[o]=new NA(e,a[o]);for(o=0;o<d;++o)(l=t[o])&&u.get(f[o])===l&&(i[o]=l)}function UA(e){return e.__data__}function BA(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function zA(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}NA.prototype={constructor:NA,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var VA="http://www.w3.org/1999/xhtml";const HA={svg:"http://www.w3.org/2000/svg",xhtml:VA,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function $A(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),HA.hasOwnProperty(t)?{space:HA[t],local:e}:e}function GA(e){return function(){this.removeAttribute(e)}}function jA(e){return function(){this.removeAttributeNS(e.space,e.local)}}function WA(e,t){return function(){this.setAttribute(e,t)}}function qA(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function XA(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function YA(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function KA(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ZA(e){return function(){this.style.removeProperty(e)}}function QA(e,t,n){return function(){this.style.setProperty(e,t,n)}}function JA(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function eM(e,t){return e.style.getPropertyValue(t)||KA(e).getComputedStyle(e,null).getPropertyValue(t)}function tM(e){return function(){delete this[e]}}function nM(e,t){return function(){this[e]=t}}function rM(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function iM(e){return e.trim().split(/^|\s+/)}function aM(e){return e.classList||new sM(e)}function sM(e){this._node=e,this._names=iM(e.getAttribute("class")||"")}function oM(e,t){for(var n=aM(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function lM(e,t){for(var n=aM(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function cM(e){return function(){oM(this,e)}}function uM(e){return function(){lM(this,e)}}function dM(e,t){return function(){(t.apply(this,arguments)?oM:lM)(this,e)}}function hM(){this.textContent=""}function fM(e){return function(){this.textContent=e}}function pM(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function mM(){this.innerHTML=""}function gM(e){return function(){this.innerHTML=e}}function _M(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function yM(){this.nextSibling&&this.parentNode.appendChild(this)}function vM(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function bM(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===VA&&t.documentElement.namespaceURI===VA?t.createElement(e):t.createElementNS(n,e)}}function xM(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function wM(e){var t=$A(e);return(t.local?xM:bM)(t)}function SM(){return null}function AM(){var e=this.parentNode;e&&e.removeChild(this)}function MM(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function EM(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function CM(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function TM(e,t,n){return function(){var r,i=this.__on,a=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var s=0,o=i.length;s<o;++s)if((r=i[s]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=a,r.options=n),void(r.value=t);this.addEventListener(e.type,a,n),r={type:e.type,name:e.name,value:t,listener:a,options:n},i?i.push(r):this.__on=[r]}}function PM(e,t,n){var r=KA(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function IM(e,t){return function(){return PM(this,e,t)}}function RM(e,t){return function(){return PM(this,e,t.apply(this,arguments))}}sM.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var kM=[null];function DM(e,t){this._groups=e,this._parents=t}function LM(){return new DM([[document.documentElement]],kM)}DM.prototype=LM.prototype={constructor:DM,select:function(e){"function"!=typeof e&&(e=MA(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,s,o=t[i],l=o.length,c=r[i]=new Array(l),u=0;u<l;++u)(a=o[u])&&(s=e.call(a,a.__data__,u,o))&&("__data__"in a&&(s.__data__=a.__data__),c[u]=s);return new DM(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return null==(t=e.apply(this,arguments))?[]:Array.isArray(t)?t:Array.from(t);var t}}(e):CA(e);for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var s,o=t[a],l=o.length,c=0;c<l;++c)(s=o[c])&&(r.push(e.call(s,s.__data__,c,o)),i.push(s));return new DM(r,i)},selectChild:function(e){return this.select(null==e?RA:function(e){return function(){return IA.call(this.children,e)}}("function"==typeof e?e:PA(e)))},selectChildren:function(e){return this.selectAll(null==e?DA:function(e){return function(){return kA.call(this.children,e)}}("function"==typeof e?e:PA(e)))},filter:function(e){"function"!=typeof e&&(e=TA(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,s=t[i],o=s.length,l=r[i]=[],c=0;c<o;++c)(a=s[c])&&e.call(a,a.__data__,c,s)&&l.push(a);return new DM(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,UA);var n,r=t?FA:OA,i=this._parents,a=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var s=a.length,o=new Array(s),l=new Array(s),c=new Array(s),u=0;u<s;++u){var d=i[u],h=a[u],f=h.length,p=BA(e.call(d,d&&d.__data__,u,i)),m=p.length,g=l[u]=new Array(m),_=o[u]=new Array(m);r(d,h,g,_,c[u]=new Array(f),p,t);for(var y,v,b=0,x=0;b<m;++b)if(y=g[b]){for(b>=x&&(x=b+1);!(v=_[x])&&++x<m;);y._next=v||null}}return(o=new DM(o,i))._enter=l,o._exit=c,o},enter:function(){return new DM(this._enter||this._groups.map(LA),this._parents)},exit:function(){return new DM(this._exit||this._groups.map(LA),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,a=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?a.remove():n(a),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,a=r.length,s=Math.min(i,a),o=new Array(i),l=0;l<s;++l)for(var c,u=n[l],d=r[l],h=u.length,f=o[l]=new Array(h),p=0;p<h;++p)(c=u[p]||d[p])&&(f[p]=c);for(;l<i;++l)o[l]=n[l];return new DM(o,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,s=i[a];--a>=0;)(r=i[a])&&(s&&4^r.compareDocumentPosition(s)&&s.parentNode.insertBefore(r,s),s=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=zA);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var s,o=n[a],l=o.length,c=i[a]=new Array(l),u=0;u<l;++u)(s=o[u])&&(c[u]=s);c.sort(t)}return new DM(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var s=r[i];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],s=0,o=a.length;s<o;++s)(i=a[s])&&e.call(i,i.__data__,s,a);return this},attr:function(e,t){var n=$A(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?jA:GA:"function"==typeof t?n.local?YA:XA:n.local?qA:WA)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?ZA:"function"==typeof t?JA:QA)(e,t,null==n?"":n)):eM(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?tM:"function"==typeof t?rM:nM)(e,t)):this.node()[e]},classed:function(e,t){var n=iM(e+"");if(arguments.length<2){for(var r=aM(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?dM:t?cM:uM)(n,t))},text:function(e){return arguments.length?this.each(null==e?hM:("function"==typeof e?pM:fM)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?mM:("function"==typeof e?_M:gM)(e)):this.node().innerHTML},raise:function(){return this.each(yM)},lower:function(){return this.each(vM)},append:function(e){var t="function"==typeof e?e:wM(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:wM(e),r=null==t?SM:"function"==typeof t?t:MA(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(AM)},clone:function(e){return this.select(e?EM:MM)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=function(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}(e+""),s=a.length;if(!(arguments.length<2)){for(o=t?TM:CM,r=0;r<s;++r)this.each(o(a[r],t,n));return this}var o=this.node().__on;if(o)for(var l,c=0,u=o.length;c<u;++c)for(r=0,l=o[c];r<s;++r)if((i=a[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?RM:IM)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],a=0,s=i.length;a<s;++a)(r=i[a])&&(yield r)}};const NM=LM;var OM={value:()=>{}};function FM(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new UM(r)}function UM(e){this._=e}function BM(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function zM(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=OM,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}UM.prototype=FM.prototype={constructor:UM,on:function(e,t){var n,r,i=this._,a=(r=i,(e+"").trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!r.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}}))),s=-1,o=a.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<o;)if(n=(e=a[s]).type)i[n]=zM(i[n],e.name,t);else if(null==t)for(n in i)i[n]=zM(i[n],e.name,null);return this}for(;++s<o;)if((n=(e=a[s]).type)&&(n=BM(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new UM(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};const VM=FM;var HM,$M,GM=0,jM=0,WM=0,qM=1e3,XM=0,YM=0,KM=0,ZM="object"==typeof performance&&performance.now?performance:Date,QM="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function JM(){return YM||(QM(eE),YM=ZM.now()+KM)}function eE(){YM=0}function tE(){this._call=this._time=this._next=null}function nE(e,t,n){var r=new tE;return r.restart(e,t,n),r}function rE(){YM=(XM=ZM.now())+KM,GM=jM=0;try{!function(){JM(),++GM;for(var e,t=HM;t;)(e=YM-t._time)>=0&&t._call.call(void 0,e),t=t._next;--GM}()}finally{GM=0,function(){for(var e,t,n=HM,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:HM=t);$M=e,aE(r)}(),YM=0}}function iE(){var e=ZM.now(),t=e-XM;t>qM&&(KM-=t,XM=e)}function aE(e){GM||(jM&&(jM=clearTimeout(jM)),e-YM>24?(e<1/0&&(jM=setTimeout(rE,e-ZM.now()-KM)),WM&&(WM=clearInterval(WM))):(WM||(XM=ZM.now(),WM=setInterval(iE,qM)),GM=1,QM(rE)))}function sE(e,t,n){var r=new tE;return t=null==t?0:+t,r.restart((n=>{r.stop(),e(n+t)}),t,n),r}tE.prototype=nE.prototype={constructor:tE,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?JM():+n)+(null==t?0:+t),this._next||$M===this||($M?$M._next=this:HM=this,$M=this),this._call=e,this._time=n,aE()},stop:function(){this._call&&(this._call=null,this._time=1/0,aE())}};var oE=VM("start","end","cancel","interrupt"),lE=[],cE=0,uE=3;function dE(e,t,n,r,i,a){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var r,i=e.__transition;function a(l){var c,u,d,h;if(1!==n.state)return o();for(c in i)if((h=i[c]).name===n.name){if(h.state===uE)return sE(a);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete i[c]):+c<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete i[c])}if(sE((function(){n.state===uE&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(l))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=uE,r=new Array(d=n.tween.length),c=0,u=-1;c<d;++c)(h=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++u]=h);r.length=u+1}}function s(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(o),n.state=5,1),a=-1,s=r.length;++a<s;)r[a].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),o())}function o(){for(var r in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=nE((function(e){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=e&&a(e-n.delay)}),0,n.time)}(e,n,{name:t,index:r,group:i,on:oE,tween:lE,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:cE})}function hE(e,t){var n=pE(e,t);if(n.state>cE)throw new Error("too late; already scheduled");return n}function fE(e,t){var n=pE(e,t);if(n.state>uE)throw new Error("too late; already running");return n}function pE(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function mE(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var gE,_E=180/Math.PI,yE={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function vE(e,t,n,r,i,a){var s,o,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,l/=o),e*r<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*_E,skewX:Math.atan(l)*_E,scaleX:s,scaleY:o}}function bE(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,s){var o=[],l=[];return a=e(a),s=e(s),function(e,r,i,a,s,o){if(e!==i||r!==a){var l=s.push("translate(",null,t,null,n);o.push({i:l-4,x:mE(e,i)},{i:l-2,x:mE(r,a)})}else(i||a)&&s.push("translate("+i+t+a+n)}(a.translateX,a.translateY,s.translateX,s.translateY,o,l),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:mE(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,s.rotate,o,l),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:mE(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,s.skewX,o,l),function(e,t,n,r,a,s){if(e!==n||t!==r){var o=a.push(i(a)+"scale(",null,",",null,")");s.push({i:o-4,x:mE(e,n)},{i:o-2,x:mE(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,s.scaleX,s.scaleY,o,l),a=s=null,function(e){for(var t,n=-1,r=l.length;++n<r;)o[(t=l[n]).i]=t.x(e);return o.join("")}}}var xE=bE((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?yE:vE(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),wE=bE((function(e){return null==e?yE:(gE||(gE=document.createElementNS("http://www.w3.org/2000/svg","g")),gE.setAttribute("transform",e),(e=gE.transform.baseVal.consolidate())?vE((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):yE)}),", ",")",")");function SE(e,t){var n,r;return function(){var i=fE(this,e),a=i.tween;if(a!==n)for(var s=0,o=(r=n=a).length;s<o;++s)if(r[s].name===t){(r=r.slice()).splice(s,1);break}i.tween=r}}function AE(e,t,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var a=fE(this,e),s=a.tween;if(s!==r){i=(r=s).slice();for(var o={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=o;break}l===c&&i.push(o)}a.tween=i}}function ME(e,t,n){var r=e._id;return e.each((function(){var e=fE(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return pE(e,r).value[t]}}function EE(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function CE(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function TE(){}var PE=.7,IE=1/PE,RE="\\s*([+-]?\\d+)\\s*",kE="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",DE="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",LE=/^#([0-9a-f]{3,8})$/,NE=new RegExp(`^rgb\\(${RE},${RE},${RE}\\)$`),OE=new RegExp(`^rgb\\(${DE},${DE},${DE}\\)$`),FE=new RegExp(`^rgba\\(${RE},${RE},${RE},${kE}\\)$`),UE=new RegExp(`^rgba\\(${DE},${DE},${DE},${kE}\\)$`),BE=new RegExp(`^hsl\\(${kE},${DE},${DE}\\)$`),zE=new RegExp(`^hsla\\(${kE},${DE},${DE},${kE}\\)$`),VE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function HE(){return this.rgb().formatHex()}function $E(){return this.rgb().formatRgb()}function GE(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=LE.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?jE(t):3===n?new XE(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?WE(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?WE(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=NE.exec(e))?new XE(t[1],t[2],t[3],1):(t=OE.exec(e))?new XE(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=FE.exec(e))?WE(t[1],t[2],t[3],t[4]):(t=UE.exec(e))?WE(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=BE.exec(e))?eC(t[1],t[2]/100,t[3]/100,1):(t=zE.exec(e))?eC(t[1],t[2]/100,t[3]/100,t[4]):VE.hasOwnProperty(e)?jE(VE[e]):"transparent"===e?new XE(NaN,NaN,NaN,0):null}function jE(e){return new XE(e>>16&255,e>>8&255,255&e,1)}function WE(e,t,n,r){return r<=0&&(e=t=n=NaN),new XE(e,t,n,r)}function qE(e,t,n,r){return 1===arguments.length?((i=e)instanceof TE||(i=GE(i)),i?new XE((i=i.rgb()).r,i.g,i.b,i.opacity):new XE):new XE(e,t,n,null==r?1:r);var i}function XE(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function YE(){return`#${JE(this.r)}${JE(this.g)}${JE(this.b)}`}function KE(){const e=ZE(this.opacity);return`${1===e?"rgb(":"rgba("}${QE(this.r)}, ${QE(this.g)}, ${QE(this.b)}${1===e?")":`, ${e})`}`}function ZE(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function QE(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function JE(e){return((e=QE(e))<16?"0":"")+e.toString(16)}function eC(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new nC(e,t,n,r)}function tC(e){if(e instanceof nC)return new nC(e.h,e.s,e.l,e.opacity);if(e instanceof TE||(e=GE(e)),!e)return new nC;if(e instanceof nC)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=NaN,o=a-i,l=(a+i)/2;return o?(s=t===a?(n-r)/o+6*(n<r):n===a?(r-t)/o+2:(t-n)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new nC(s,o,l,e.opacity)}function nC(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function rC(e){return(e=(e||0)%360)<0?e+360:e}function iC(e){return Math.max(0,Math.min(1,e||0))}function aC(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function sC(e,t,n,r,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*n+(1+3*e+3*a-3*s)*r+s*i)/6}EE(TE,GE,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:HE,formatHex:HE,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return tC(this).formatHsl()},formatRgb:$E,toString:$E}),EE(XE,qE,CE(TE,{brighter(e){return e=null==e?IE:Math.pow(IE,e),new XE(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?PE:Math.pow(PE,e),new XE(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new XE(QE(this.r),QE(this.g),QE(this.b),ZE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:YE,formatHex:YE,formatHex8:function(){return`#${JE(this.r)}${JE(this.g)}${JE(this.b)}${JE(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:KE,toString:KE})),EE(nC,(function(e,t,n,r){return 1===arguments.length?tC(e):new nC(e,t,n,null==r?1:r)}),CE(TE,{brighter(e){return e=null==e?IE:Math.pow(IE,e),new nC(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?PE:Math.pow(PE,e),new nC(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new XE(aC(e>=240?e-240:e+120,i,r),aC(e,i,r),aC(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new nC(rC(this.h),iC(this.s),iC(this.l),ZE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ZE(this.opacity);return`${1===e?"hsl(":"hsla("}${rC(this.h)}, ${100*iC(this.s)}%, ${100*iC(this.l)}%${1===e?")":`, ${e})`}`}}));const oC=e=>()=>e;function lC(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):oC(isNaN(e)?t:e)}const cC=function e(t){var n=function(e){return 1==(e=+e)?lC:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):oC(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=qE(e)).r,(t=qE(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),s=lC(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=s(t),e+""}}return r.gamma=e,r}(1);function uC(e){return function(t){var n,r,i=t.length,a=new Array(i),s=new Array(i),o=new Array(i);for(n=0;n<i;++n)r=qE(t[n]),a[n]=r.r||0,s[n]=r.g||0,o[n]=r.b||0;return a=e(a),s=e(s),o=e(o),r.opacity=1,function(e){return r.r=a(e),r.g=s(e),r.b=o(e),r+""}}}uC((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],s=r>0?e[r-1]:2*i-a,o=r<t-1?e[r+2]:2*a-i;return sC((n-r/t)*t,s,i,a,o)}})),uC((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],s=e[(r+1)%t],o=e[(r+2)%t];return sC((n-r/t)*t,i,a,s,o)}}));var dC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,hC=new RegExp(dC.source,"g");function fC(e,t){var n,r,i,a=dC.lastIndex=hC.lastIndex=0,s=-1,o=[],l=[];for(e+="",t+="";(n=dC.exec(e))&&(r=hC.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),o[s]?o[s]+=i:o[++s]=i),(n=n[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:mE(n,r)})),a=hC.lastIndex;return a<t.length&&(i=t.slice(a),o[s]?o[s]+=i:o[++s]=i),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)o[(n=l[r]).i]=n.x(e);return o.join("")})}function pC(e,t){var n;return("number"==typeof t?mE:t instanceof GE?cC:(n=GE(t))?(t=n,cC):fC)(e,t)}function mC(e){return function(){this.removeAttribute(e)}}function gC(e){return function(){this.removeAttributeNS(e.space,e.local)}}function _C(e,t,n){var r,i,a=n+"";return function(){var s=this.getAttribute(e);return s===a?null:s===r?i:i=t(r=s,n)}}function yC(e,t,n){var r,i,a=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===a?null:s===r?i:i=t(r=s,n)}}function vC(e,t,n){var r,i,a;return function(){var s,o,l=n(this);if(null!=l)return(s=this.getAttribute(e))===(o=l+"")?null:s===r&&o===i?a:(i=o,a=t(r=s,l));this.removeAttribute(e)}}function bC(e,t,n){var r,i,a;return function(){var s,o,l=n(this);if(null!=l)return(s=this.getAttributeNS(e.space,e.local))===(o=l+"")?null:s===r&&o===i?a:(i=o,a=t(r=s,l));this.removeAttributeNS(e.space,e.local)}}function xC(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,i)),n}return i._value=t,i}function wC(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,i)),n}return i._value=t,i}function SC(e,t){return function(){hE(this,e).delay=+t.apply(this,arguments)}}function AC(e,t){return t=+t,function(){hE(this,e).delay=t}}function MC(e,t){return function(){fE(this,e).duration=+t.apply(this,arguments)}}function EC(e,t){return t=+t,function(){fE(this,e).duration=t}}var CC=NM.prototype.constructor;function TC(e){return function(){this.style.removeProperty(e)}}var PC=0;function IC(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function RC(){return++PC}var kC=NM.prototype;IC.prototype=function(e){return NM().transition(e)}.prototype={constructor:IC,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=MA(e));for(var r=this._groups,i=r.length,a=new Array(i),s=0;s<i;++s)for(var o,l,c=r[s],u=c.length,d=a[s]=new Array(u),h=0;h<u;++h)(o=c[h])&&(l=e.call(o,o.__data__,h,c))&&("__data__"in o&&(l.__data__=o.__data__),d[h]=l,dE(d[h],t,n,h,d,pE(o,n)));return new IC(a,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=CA(e));for(var r=this._groups,i=r.length,a=[],s=[],o=0;o<i;++o)for(var l,c=r[o],u=c.length,d=0;d<u;++d)if(l=c[d]){for(var h,f=e.call(l,l.__data__,d,c),p=pE(l,n),m=0,g=f.length;m<g;++m)(h=f[m])&&dE(h,t,n,m,f,p);a.push(f),s.push(l)}return new IC(a,s,t,n)},selectChild:kC.selectChild,selectChildren:kC.selectChildren,filter:function(e){"function"!=typeof e&&(e=TA(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,s=t[i],o=s.length,l=r[i]=[],c=0;c<o;++c)(a=s[c])&&e.call(a,a.__data__,c,s)&&l.push(a);return new IC(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),s=new Array(r),o=0;o<a;++o)for(var l,c=t[o],u=n[o],d=c.length,h=s[o]=new Array(d),f=0;f<d;++f)(l=c[f]||u[f])&&(h[f]=l);for(;o<r;++o)s[o]=t[o];return new IC(s,this._parents,this._name,this._id)},selection:function(){return new CC(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=RC(),r=this._groups,i=r.length,a=0;a<i;++a)for(var s,o=r[a],l=o.length,c=0;c<l;++c)if(s=o[c]){var u=pE(s,t);dE(s,e,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new IC(r,this._parents,e,n)},call:kC.call,nodes:kC.nodes,node:kC.node,size:kC.size,empty:kC.empty,each:kC.each,on:function(e,t){var n=this._id;return arguments.length<2?pE(this.node(),n).on.on(e):this.each(function(e,t,n){var r,i,a=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?hE:fE;return function(){var s=a(this,e),o=s.on;o!==r&&(i=(r=o).copy()).on(t,n),s.on=i}}(n,e,t))},attr:function(e,t){var n=$A(e),r="transform"===n?wE:pC;return this.attrTween(e,"function"==typeof t?(n.local?bC:vC)(n,r,ME(this,"attr."+e,t)):null==t?(n.local?gC:mC)(n):(n.local?yC:_C)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=$A(e);return this.tween(n,(r.local?xC:wC)(r,t))},style:function(e,t,n){var r="transform"==(e+="")?xE:pC;return null==t?this.styleTween(e,function(e,t){var n,r,i;return function(){var a=eM(this,e),s=(this.style.removeProperty(e),eM(this,e));return a===s?null:a===n&&s===r?i:i=t(n=a,r=s)}}(e,r)).on("end.style."+e,TC(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var r,i,a;return function(){var s=eM(this,e),o=n(this),l=o+"";return null==o&&(this.style.removeProperty(e),l=o=eM(this,e)),s===l?null:s===r&&l===i?a:(i=l,a=t(r=s,o))}}(e,r,ME(this,"style."+e,t))).each(function(e,t){var n,r,i,a,s="style."+t,o="end."+s;return function(){var l=fE(this,e),c=l.on,u=null==l.value[s]?a||(a=TC(t)):void 0;c===n&&i===u||(r=(n=c).copy()).on(o,i=u),l.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,i,a=n+"";return function(){var s=eM(this,e);return s===a?null:s===r?i:i=t(r=s,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,function(e,t,n){var r,i;function a(){var a=t.apply(this,arguments);return a!==i&&(r=(i=a)&&function(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}(e,a,n)),r}return a._value=t,a}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(ME(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&function(e){return function(t){this.textContent=e.call(this,t)}}(r)),t}return r._value=e,r}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=pE(this.node(),n).tween,a=0,s=i.length;a<s;++a)if((r=i[a]).name===e)return r.value;return null}return this.each((null==t?SE:AE)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?SC:AC)(t,e)):pE(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?MC:EC)(t,e)):pE(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){fE(this,e).ease=t}}(t,e)):pE(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;fE(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise((function(a,s){var o={value:s},l={value:function(){0==--i&&a()}};n.each((function(){var n=fE(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(o),t._.interrupt.push(o),t._.end.push(l)),n.on=t})),0===i&&a()}))},[Symbol.iterator]:kC[Symbol.iterator]};var DC={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function LC(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}NM.prototype.interrupt=function(e){return this.each((function(){!function(e,t){var n,r,i,a=e.__transition,s=!0;if(a){for(i in t=null==t?null:t+"",a)(n=a[i]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete a[i]):s=!1;s&&delete e.__transition}}(this,e)}))},NM.prototype.transition=function(e){var t,n;e instanceof IC?(t=e._id,e=e._name):(t=RC(),(n=DC).time=JM(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var s,o=r[a],l=o.length,c=0;c<l;++c)(s=o[c])&&dE(s,e,t,c,o,n||LC(s,t));return new IC(r,this._parents,e,t)};const{abs:NC,max:OC,min:FC}=Math;function UC(e){return{type:e}}function BC(e){return"string"==typeof e?new DM([[document.querySelector(e)]],[document.documentElement]):new DM([[e]],kM)}function zC(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}["w","e"].map(UC),["n","s"].map(UC),["n","w","e","s","nw","ne","sw","se"].map(UC);const VC={passive:!1},HC={capture:!0,passive:!1};function $C(e){e.stopImmediatePropagation()}function GC(e){e.preventDefault(),e.stopImmediatePropagation()}const jC=e=>()=>e;function WC(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:a,x:s,y:o,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function qC(e){return!e.ctrlKey&&!e.button}function XC(){return this.parentNode}function YC(e,t){return null==t?{x:e.x,y:e.y}:t}function KC(){return navigator.maxTouchPoints||"ontouchstart"in this}function ZC(e){return function(){return e}}function QC(e){return 1e-6*(e()-.5)}function JC(e){return e.index}function eT(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function tT(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,s,o,l,c,u,d,h,f=e._root,p={data:r},m=e._x0,g=e._y0,_=e._x1,y=e._y1;if(!f)return e._root=p,e;for(;f.length;)if((c=t>=(a=(m+_)/2))?m=a:_=a,(u=n>=(s=(g+y)/2))?g=s:y=s,i=f,!(f=f[d=u<<1|c]))return i[d]=p,e;if(o=+e._x.call(null,f.data),l=+e._y.call(null,f.data),t===o&&n===l)return p.next=f,i?i[d]=p:e._root=p,e;do{i=i?i[d]=new Array(4):e._root=new Array(4),(c=t>=(a=(m+_)/2))?m=a:_=a,(u=n>=(s=(g+y)/2))?g=s:y=s}while((d=u<<1|c)==(h=(l>=s)<<1|o>=a));return i[h]=f,i[d]=p,e}function nT(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function rT(e){return e[0]}function iT(e){return e[1]}function aT(e,t,n){var r=new sT(null==t?rT:t,null==n?iT:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function sT(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function oT(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}WC.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var lT=aT.prototype=sT.prototype;lT.copy=function(){var e,t,n=new sT(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=oT(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=oT(t));return n},lT.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return tT(this.cover(t,n),t,n,e)},lT.addAll=function(e){var t,n,r,i,a=e.length,s=new Array(a),o=new Array(a),l=1/0,c=1/0,u=-1/0,d=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(s[n]=r,o[n]=i,r<l&&(l=r),r>u&&(u=r),i<c&&(c=i),i>d&&(d=i));if(l>u||c>d)return this;for(this.cover(l,c).cover(u,d),n=0;n<a;++n)tT(this,s[n],o[n],e[n]);return this},lT.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var s,o,l=i-n||1,c=this._root;n>e||e>=i||r>t||t>=a;)switch(o=(t<r)<<1|e<n,(s=new Array(4))[o]=c,c=s,l*=2,o){case 0:i=n+l,a=r+l;break;case 1:n=i-l,a=r+l;break;case 2:i=n+l,r=a-l;break;case 3:n=i-l,r=a-l}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},lT.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},lT.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},lT.find=function(e,t,n){var r,i,a,s,o,l,c,u=this._x0,d=this._y0,h=this._x1,f=this._y1,p=[],m=this._root;for(m&&p.push(new nT(m,u,d,h,f)),null==n?n=1/0:(u=e-n,d=t-n,h=e+n,f=t+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(i=l.x0)>h||(a=l.y0)>f||(s=l.x1)<u||(o=l.y1)<d))if(m.length){var g=(i+s)/2,_=(a+o)/2;p.push(new nT(m[3],g,_,s,o),new nT(m[2],i,_,g,o),new nT(m[1],g,a,s,_),new nT(m[0],i,a,g,_)),(c=(t>=_)<<1|e>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=l)}else{var y=e-+this._x.call(null,m.data),v=t-+this._y.call(null,m.data),b=y*y+v*v;if(b<n){var x=Math.sqrt(n=b);u=e-x,d=t-x,h=e+x,f=t+x,r=m.data}}return r},lT.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(s=+this._y.call(null,e)))return this;var t,n,r,i,a,s,o,l,c,u,d,h,f=this._root,p=this._x0,m=this._y0,g=this._x1,_=this._y1;if(!f)return this;if(f.length)for(;;){if((c=a>=(o=(p+g)/2))?p=o:g=o,(u=s>=(l=(m+_)/2))?m=l:_=l,t=f,!(f=f[d=u<<1|c]))return this;if(!f.length)break;(t[d+1&3]||t[d+2&3]||t[d+3&3])&&(n=t,h=d)}for(;f.data!==e;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):t?(i?t[d]=i:delete t[d],(f=t[0]||t[1]||t[2]||t[3])&&f===(t[3]||t[2]||t[1]||t[0])&&!f.length&&(n?n[h]=f:this._root=f),this):(this._root=i,this)},lT.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},lT.root=function(){return this._root},lT.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},lT.visit=function(e){var t,n,r,i,a,s,o=[],l=this._root;for(l&&o.push(new nT(l,this._x0,this._y0,this._x1,this._y1));t=o.pop();)if(!e(l=t.node,r=t.x0,i=t.y0,a=t.x1,s=t.y1)&&l.length){var c=(r+a)/2,u=(i+s)/2;(n=l[3])&&o.push(new nT(n,c,u,a,s)),(n=l[2])&&o.push(new nT(n,r,u,c,s)),(n=l[1])&&o.push(new nT(n,c,i,a,u)),(n=l[0])&&o.push(new nT(n,r,i,c,u))}return this},lT.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new nT(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,s=t.x0,o=t.y0,l=t.x1,c=t.y1,u=(s+l)/2,d=(o+c)/2;(a=i[0])&&n.push(new nT(a,s,o,u,d)),(a=i[1])&&n.push(new nT(a,u,o,l,d)),(a=i[2])&&n.push(new nT(a,s,d,u,c)),(a=i[3])&&n.push(new nT(a,u,d,l,c))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},lT.x=function(e){return arguments.length?(this._x=e,this):this._x},lT.y=function(e){return arguments.length?(this._y=e,this):this._y};const cT=4294967296;function uT(e){return e.x}function dT(e){return e.y}var hT=Math.PI*(3-Math.sqrt(5));const fT=function(e){for(var t=new Array(10),n=0;n<10;)t[n]="#"+e.slice(6*n,6*++n);return t}("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function pT(e,t,n){this.k=e,this.x=t,this.y=n}pT.prototype={constructor:pT,scale:function(e){return 1===e?this:new pT(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new pT(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new pT(1,0,0),pT.prototype;const mT=function(){var e=(0,t.useRef)();return xA("rgb(36, 46, 52)"),(0,t.useEffect)((function(){var t=[{id:"Song 1",group:1},{id:"Song 2",group:1},{id:"Song 3",group:2},{id:"Song 4",group:2},{id:"Song 5",group:3}],n=[{source:"Song 1",target:"Song 2"},{source:"Song 2",target:"Song 3"},{source:"Song 3",target:"Song 4"},{source:"Song 4",target:"Song 5"}],r=BC(e.current).attr("width",400).attr("height",200),i=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,s=.6,o=new Map,l=nE(d),c=VM("tick","end"),u=function(){let e=1;return()=>(e=(1664525*e+1013904223)%cT)/cT}();function d(){h(),c.call("tick",t),n<r&&(l.stop(),c.call("end",t))}function h(r){var l,c,u=e.length;void 0===r&&(r=1);for(var d=0;d<r;++d)for(n+=(a-n)*i,o.forEach((function(e){e(n)})),l=0;l<u;++l)null==(c=e[l]).fx?c.x+=c.vx*=s:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=s:(c.y=c.fy,c.vy=0);return t}function f(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*hT;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,u),t}return null==e&&(e=[]),f(),t={tick:h,restart:function(){return l.restart(d),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,f(),o.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(s=1-e,t):1-s},randomSource:function(e){return arguments.length?(u=e,o.forEach(p),t):u},force:function(e,n){return arguments.length>1?(null==n?o.delete(e):o.set(e,p(n)),t):o.get(e)},find:function(t,n,r){var i,a,s,o,l,c=0,u=e.length;for(null==r?r=1/0:r*=r,c=0;c<u;++c)(s=(i=t-(o=e[c]).x)*i+(a=n-o.y)*a)<r&&(l=o,r=s);return l},on:function(e,n){return arguments.length>1?(c.on(e,n),t):c.on(e)}}}(t).force("link",function(e){var t,n,r,i,a,s,o=JC,l=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},c=ZC(30),u=1;function d(r){for(var i=0,o=e.length;i<u;++i)for(var l,c,d,h,f,p,m,g=0;g<o;++g)c=(l=e[g]).source,h=(d=l.target).x+d.vx-c.x-c.vx||QC(s),f=d.y+d.vy-c.y-c.vy||QC(s),h*=p=((p=Math.sqrt(h*h+f*f))-n[g])/p*r*t[g],f*=p,d.vx-=h*(m=a[g]),d.vy-=f*m,c.vx+=h*(m=1-m),c.vy+=f*m}function h(){if(r){var s,l,c=r.length,u=e.length,d=new Map(r.map(((e,t)=>[o(e,t,r),e])));for(s=0,i=new Array(c);s<u;++s)(l=e[s]).index=s,"object"!=typeof l.source&&(l.source=eT(d,l.source)),"object"!=typeof l.target&&(l.target=eT(d,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(s=0,a=new Array(u);s<u;++s)l=e[s],a[s]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);t=new Array(u),f(),n=new Array(u),p()}}function f(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+l(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+c(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e,t){r=e,s=t,h()},d.links=function(t){return arguments.length?(e=t,h(),d):e},d.id=function(e){return arguments.length?(o=e,d):o},d.iterations=function(e){return arguments.length?(u=+e,d):u},d.strength=function(e){return arguments.length?(l="function"==typeof e?e:ZC(+e),f(),d):l},d.distance=function(e){return arguments.length?(c="function"==typeof e?e:ZC(+e),p(),d):c},d}(n).id((function(e){return e.id}))).force("charge",function(){var e,t,n,r,i,a=ZC(-30),s=1,o=1/0,l=.81;function c(n){var i,a=e.length,s=aT(e,uT,dT).visitAfter(d);for(r=n,i=0;i<a;++i)t=e[i],s.visit(h)}function u(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+a(n,t,e)}}function d(e){var t,n,r,a,s,o=0,l=0;if(e.length){for(r=a=s=0;s<4;++s)(t=e[s])&&(n=Math.abs(t.value))&&(o+=t.value,l+=n,r+=n*t.x,a+=n*t.y);e.x=r/l,e.y=a/l}else{(t=e).x=t.data.x,t.y=t.data.y;do{o+=i[t.data.index]}while(t=t.next)}e.value=o}function h(e,a,c,u){if(!e.value)return!0;var d=e.x-t.x,h=e.y-t.y,f=u-a,p=d*d+h*h;if(f*f/l<p)return p<o&&(0===d&&(p+=(d=QC(n))*d),0===h&&(p+=(h=QC(n))*h),p<s&&(p=Math.sqrt(s*p)),t.vx+=d*e.value*r/p,t.vy+=h*e.value*r/p),!0;if(!(e.length||p>=o)){(e.data!==t||e.next)&&(0===d&&(p+=(d=QC(n))*d),0===h&&(p+=(h=QC(n))*h),p<s&&(p=Math.sqrt(s*p)));do{e.data!==t&&(f=i[e.data.index]*r/p,t.vx+=d*f,t.vy+=h*f)}while(e=e.next)}}return c.initialize=function(t,r){e=t,n=r,u()},c.strength=function(e){return arguments.length?(a="function"==typeof e?e:ZC(+e),u(),c):a},c.distanceMin=function(e){return arguments.length?(s=e*e,c):Math.sqrt(s)},c.distanceMax=function(e){return arguments.length?(o=e*e,c):Math.sqrt(o)},c.theta=function(e){return arguments.length?(l=e*e,c):Math.sqrt(l)},c}().strength(-50)).force("center",function(e,t){var n,r=1;function i(){var i,a,s=n.length,o=0,l=0;for(i=0;i<s;++i)o+=(a=n[i]).x,l+=a.y;for(o=(o/s-e)*r,l=(l/s-t)*r,i=0;i<s;++i)(a=n[i]).x-=o,a.y-=l}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i}(200,100)),a=r.append("g").selectAll("line").data(n).join("line").attr("stroke","#999").attr("stroke-opacity",.6),s=r.append("g").selectAll("circle").data(t).join("circle").attr("r",5).attr("fill",(function(e){return fT[e.group]})).call(function(e){return function(){var e,t,n,r,i=qC,a=XC,s=YC,o=KC,l={},c=VM("start","drag","end"),u=0,d=0;function h(e){e.on("mousedown.drag",f).filter(o).on("touchstart.drag",g).on("touchmove.drag",_,VC).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(s,o){if(!r&&i.call(this,s,o)){var l=v(this,a.call(this,s,o),s,o,"mouse");l&&(BC(s.view).on("mousemove.drag",p,HC).on("mouseup.drag",m,HC),function(e){var t=e.document.documentElement,n=BC(e).on("dragstart.drag",GC,HC);"onselectstart"in t?n.on("selectstart.drag",GC,HC):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}(s.view),$C(s),n=!1,e=s.clientX,t=s.clientY,l("start",s))}}function p(r){if(GC(r),!n){var i=r.clientX-e,a=r.clientY-t;n=i*i+a*a>d}l.mouse("drag",r)}function m(e){BC(e.view).on("mousemove.drag mouseup.drag",null),function(e,t){var n=e.document.documentElement,r=BC(e).on("dragstart.drag",null);t&&(r.on("click.drag",GC,HC),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}(e.view,n),GC(e),l.mouse("end",e)}function g(e,t){if(i.call(this,e,t)){var n,r,s=e.changedTouches,o=a.call(this,e,t),l=s.length;for(n=0;n<l;++n)(r=v(this,o,e,t,s[n].identifier,s[n]))&&($C(e),r("start",e,s[n]))}}function _(e){var t,n,r=e.changedTouches,i=r.length;for(t=0;t<i;++t)(n=l[r[t].identifier])&&(GC(e),n("drag",e,r[t]))}function y(e){var t,n,i=e.changedTouches,a=i.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),t=0;t<a;++t)(n=l[i[t].identifier])&&($C(e),n("end",e,i[t]))}function v(e,t,n,r,i,a){var o,d,f,p=c.copy(),m=zC(a||n,t);if(null!=(f=s.call(e,new WC("beforestart",{sourceEvent:n,target:h,identifier:i,active:u,x:m[0],y:m[1],dx:0,dy:0,dispatch:p}),r)))return o=f.x-m[0]||0,d=f.y-m[1]||0,function n(a,s,c){var g,_=m;switch(a){case"start":l[i]=n,g=u++;break;case"end":delete l[i],--u;case"drag":m=zC(c||s,t),g=u}p.call(a,e,new WC(a,{sourceEvent:s,subject:f,target:h,identifier:i,active:g,x:m[0]+o,y:m[1]+d,dx:m[0]-_[0],dy:m[1]-_[1],dispatch:p}),r)}}return h.filter=function(e){return arguments.length?(i="function"==typeof e?e:jC(!!e),h):i},h.container=function(e){return arguments.length?(a="function"==typeof e?e:jC(e),h):a},h.subject=function(e){return arguments.length?(s="function"==typeof e?e:jC(e),h):s},h.touchable=function(e){return arguments.length?(o="function"==typeof e?e:jC(!!e),h):o},h.on=function(){var e=c.on.apply(c,arguments);return e===c?h:e},h.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,h):Math.sqrt(d)},h}().on("start",(function(t){t.active||e.alphaTarget(.3).restart(),t.subject.fx=t.subject.x,t.subject.fy=t.subject.y})).on("drag",(function(e){e.subject.fx=e.x,e.subject.fy=e.y})).on("end",(function(t){t.active||e.alphaTarget(0),t.subject.fx=null,t.subject.fy=null}))}(i));i.on("tick",(function(){a.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),s.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y}))}))}),[]),t.createElement("div",{className:"project-body"},t.createElement("div",{className:"song-visualizer"},t.createElement("h2",null,t.createElement("a",{href:"https://github.com/mwilliams619/Anther/"},"Anther"),": Song Similarity Visualization"),t.createElement("div",{className:"visualizer-container"},t.createElement("svg",{ref:e})),t.createElement("h3",null,"Project Overview"),t.createElement("p",null,"The Anther project was initiated to assist artists in evaluating the relationship between their songs and other content available on streaming platforms. The motivating question was whether there was a method to easily determine the similarity between songs. The ultimate goal was to develop a service that enables artists to efficiently assess the compatibility of their songs with playlists and subsequently apply for playlist placements."),t.createElement("h4",null,"Technical Stack"),t.createElement("h5",null,"The project utilized:"),t.createElement("ul",null,t.createElement("li",null,"Django for the web framework"),t.createElement("li",null,"jQuery, HTML, and CSS for the frontend"),t.createElement("li",null,"Python for the backend"),t.createElement("li",null,"PostgreSQL for the database")),t.createElement("h4",null,"Key Components"),t.createElement("h5",null,"The project involved the development of several key components:"),t.createElement("ol",null,t.createElement("li",null,"Implementation of search functionality to retrieve songs and playlists for the database."),t.createElement("li",null,"Processing songs to extract relevant data for analysis."),t.createElement("li",null,"Utilizing a comparison algorithm to cluster songs based on similarity."),t.createElement("li",null,"Displaying the song cluster with a D3 dashboard."))),t.createElement("div",{className:"rag-llm"},t.createElement("h2",null," ",t.createElement("a",{href:"https://github.com/mwilliams619/PDF-query"},"Retrieval-Augmented Generation Agent")),t.createElement("h3",null,"Project Overview"),t.createElement("p",null,"I developed this agent with the objective of enhancing information sharing between scientific and commercial teams. The initial use case focused on the ability to swiftly summarize and extract information from academic literature that scientists were sharing. Additionally, it was trained with writing samples from the company, significantly boosting the efficiency of drafting proposals and copy."),t.createElement("h3",null,"Technical Implementation"),t.createElement("p",null,"In this project, I created a Jupyter notebook designed to incorporate information from various documents into the AI's responses. This notebook processes documents from a specified folder into chunks for rapid retrieval. Upon querying the agent, it generates multiple questions related to your query and extracts pertinent information from the processed PDFs. Ultimately, the Agent produces a report that answers your query using the processed data.")))},gT=function(){return xA("rgb(36, 46, 52)"),t.createElement("div",{className:"press"},t.createElement("iframe",{src:"https://open.spotify.com/embed/episode/3vOq1aFxku2uhAtePVSQH4?utm_source=generator",width:"50%",height:"232",frameBorder:"0",allowtransparency:"true",allow:"encrypted-media",title:"Spotify Podcast Episode"}),t.createElement("div",{className:"symposium"},t.createElement("a",{href:"https://www.mccormick.northwestern.edu/biotechnology/inside-our-program/stories/2024/showing-research-impact.html"},"Symposium Poster Award")),t.createElement("div",{className:"lt-tour"},t.createElement("a",{href:"https://www.mccormick.northwestern.edu/biotechnology/inside-our-program/stories/2023/mbp-students-visit-lanzatech.html"},"Lanzatech Tour Story")))},_T=function(){return xA("rgb(36, 46, 52)"),t.createElement("div",null,t.createElement("div",{className:"summary"},t.createElement("h2",null,"Summary"),t.createElement("p",null,"I am a computational biologist and recent graduate of the Master's in Biotechnology Program at Northwestern University, with graduate minors in Entrepreneurship and Synthetic Biology. My interests lie at the intersection of biology and computer science, particularly in the field of machine learning-driven protein engineering."),t.createElement("p",null,"I am passionate about transforming data into actionable insights. During my internships with LanzaTech and Bluestem Biosciences, I developed tools and models to aid R&D efforts to engineer microbes to produce sustainable commodity chemicals."),t.createElement("p",null,"Python is my primary coding language with most of my development experience done working on django applications (with js,html,css front end). I am also comfortable working with react. I use tools git, docker, bash, and AWS to assist in development and deployment."),t.createElement("p",null,"I am passionate about continous learning and always excited to learn new technologies and apply them to practical needs."),t.createElement("p",null,"See below and check out my ",t.createElement("a",{href:"https://www.linkedin.com/in/mattwilliams19"},"Linkedin")," for more information")),t.createElement("div",null,t.createElement("h2",null,"My Toolkit")),t.createElement("div",{className:"row",style:{justifyContent:"center",paddingBottom:"50px"}},t.createElement("div",{className:"icon-wrapper"},t.createElement("div",{className:"tech-icons col-md-2 col-4"},t.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",version:"1.1",viewBox:"0 0 32 32",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",title:"Python"},t.createElement("path",{d:"M13.275 15.88h5.417c1.508 0 2.712-1.241 2.712-2.756v-5.164c0-1.47-1.24-2.574-2.712-2.819-0.932-0.155-1.898-0.226-2.825-0.221s-1.813 0.083-2.592 0.221c-2.295 0.405-2.712 1.254-2.712 2.819v2.067h5.423v0.689h-7.459c-1.576 0-2.956 0.947-3.388 2.75-0.498 2.066-0.52 3.355 0 5.512 0.385 1.606 1.306 2.75 2.882 2.75h1.865v-2.478c0-1.79 1.549-3.369 3.388-3.369zM12.933 8.649c-0.562 0-1.018-0.461-1.018-1.030 0-0.572 0.455-1.037 1.018-1.037 0.56 0 1.018 0.465 1.018 1.037 0 0.57-0.457 1.030-1.018 1.030zM26.826 13.465c-0.389-1.569-1.133-2.75-2.712-2.75h-2.035v2.408c0 1.867-1.583 3.439-3.388 3.439h-5.417c-1.484 0-2.712 1.27-2.712 2.756v5.164c0 1.47 1.278 2.334 2.712 2.756 1.717 0.505 3.363 0.596 5.417 0 1.365-0.395 2.712-1.191 2.712-2.756v-2.067h-5.417v-0.689h8.129c1.576 0 2.163-1.099 2.712-2.75 0.566-1.699 0.542-3.332 0-5.512zM19.033 23.794c0.562 0 1.018 0.461 1.018 1.030 0 0.572-0.456 1.037-1.018 1.037-0.56 0-1.018-0.465-1.018-1.037 0-0.57 0.457-1.030 1.018-1.030z"}))),t.createElement("span",{className:"icon-title"},"Python")),t.createElement("div",{className:"icon-wrapper"},t.createElement("div",{className:"tech-icons col-md-2 col-4"},t.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",version:"1.1",viewBox:"0 0 32 32",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",title:"JavaScript"},t.createElement("path",{d:"M9.633 7.968h3.751v10.514c0 4.738-2.271 6.392-5.899 6.392-0.888 0-2.024-0.148-2.764-0.395l0.42-3.036c0.518 0.173 1.185 0.296 1.925 0.296 1.58 0 2.567-0.716 2.567-3.282v-10.489zM16.641 20.753c0.987 0.518 2.567 1.037 4.171 1.037 1.728 0 2.641-0.716 2.641-1.826 0-1.012-0.79-1.629-2.789-2.32-2.764-0.987-4.59-2.517-4.59-4.961 0-2.838 2.394-4.985 6.293-4.985 1.9 0 3.258 0.37 4.245 0.839l-0.839 3.011c-0.642-0.321-1.851-0.79-3.455-0.79-1.629 0-2.419 0.765-2.419 1.604 0 1.061 0.913 1.53 3.085 2.369 2.937 1.086 4.294 2.616 4.294 4.985 0 2.789-2.122 5.158-6.688 5.158-1.9 0-3.776-0.518-4.714-1.037l0.765-3.085z"}))),t.createElement("span",{className:"icon-title"},"JavaScript")),t.createElement("div",{className:"icon-wrapper"},t.createElement("div",{className:"tech-icons col-md-2 col-4"},t.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",version:"1.1",viewBox:"0 0 34 32",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",title:"React"},t.createElement("path",{d:"M19.314 15.987c0 1.321-1.071 2.392-2.392 2.392s-2.392-1.071-2.392-2.392c0-1.321 1.071-2.392 2.392-2.392s2.392 1.071 2.392 2.392z"}),t.createElement("path",{d:"M16.922 24.783c1.878 1.826 3.729 2.906 5.221 2.906 0.489 0 0.952-0.103 1.337-0.334 1.337-0.772 1.826-2.701 1.363-5.453-0.077-0.489-0.18-0.977-0.309-1.492 0.514-0.154 0.977-0.309 1.44-0.463 2.598-1.003 4.038-2.392 4.038-3.909 0-1.543-1.44-2.932-4.038-3.909-0.463-0.18-0.926-0.334-1.44-0.463 0.129-0.514 0.232-1.003 0.309-1.492 0.437-2.803-0.051-4.758-1.389-5.53-0.386-0.231-0.849-0.334-1.337-0.334-1.466 0-3.344 1.080-5.221 2.906-1.852-1.826-3.704-2.906-5.195-2.906-0.489 0-0.952 0.103-1.337 0.334-1.337 0.772-1.826 2.701-1.363 5.453 0.077 0.489 0.18 0.977 0.309 1.492-0.514 0.154-0.977 0.309-1.44 0.463-2.598 1.003-4.038 2.392-4.038 3.909 0 1.543 1.44 2.932 4.038 3.909 0.463 0.18 0.926 0.334 1.44 0.463-0.129 0.514-0.232 1.003-0.309 1.492-0.437 2.752 0.051 4.707 1.363 5.453 0.386 0.232 0.849 0.334 1.337 0.334 1.492 0.051 3.344-1.029 5.221-2.829v0zM15.481 21.311c0.463 0.026 0.952 0.026 1.44 0.026s0.977 0 1.44-0.026c-0.463 0.617-0.952 1.183-1.44 1.723-0.489-0.54-0.977-1.106-1.44-1.723zM12.292 18.662c0.257 0.437 0.489 0.849 0.772 1.26-0.797-0.103-1.543-0.232-2.263-0.386 0.232-0.694 0.489-1.415 0.797-2.135 0.206 0.411 0.437 0.849 0.694 1.26zM10.8 12.463c0.72-0.154 1.466-0.283 2.263-0.386-0.257 0.412-0.514 0.823-0.772 1.26s-0.489 0.849-0.694 1.286c-0.334-0.746-0.592-1.466-0.797-2.161zM12.215 15.987c0.334-0.694 0.694-1.389 1.106-2.083 0.386-0.669 0.823-1.337 1.26-2.006 0.772-0.051 1.543-0.077 2.341-0.077 0.823 0 1.595 0.026 2.341 0.077 0.463 0.669 0.874 1.337 1.26 2.006 0.412 0.694 0.772 1.389 1.106 2.083-0.334 0.694-0.694 1.389-1.106 2.083-0.386 0.669-0.823 1.337-1.26 2.006-0.772 0.051-1.543 0.077-2.341 0.077-0.823 0-1.595-0.026-2.341-0.077-0.463-0.669-0.874-1.337-1.26-2.006-0.412-0.695-0.772-1.389-1.106-2.083v0zM22.272 14.598l-0.694-1.286c-0.257-0.437-0.489-0.849-0.772-1.26 0.797 0.103 1.543 0.232 2.263 0.386-0.231 0.72-0.489 1.44-0.797 2.161v0zM22.272 17.376c0.309 0.72 0.566 1.44 0.797 2.135-0.72 0.154-1.466 0.283-2.263 0.386 0.257-0.412 0.514-0.823 0.772-1.26 0.232-0.386 0.463-0.823 0.694-1.26v0zM22.863 26.301c-0.206 0.129-0.463 0.18-0.746 0.18-1.26 0-2.829-1.029-4.372-2.572 0.746-0.797 1.466-1.698 2.186-2.701 1.209-0.103 2.366-0.283 3.447-0.54 0.129 0.463 0.206 0.926 0.283 1.389 0.36 2.186 0.077 3.755-0.797 4.244zM24.201 12.746c2.881 0.823 4.604 2.083 4.604 3.241 0 1.003-1.183 2.006-3.266 2.804-0.412 0.154-0.874 0.309-1.337 0.437-0.334-1.055-0.746-2.135-1.26-3.241 0.514-1.106 0.952-2.186 1.26-3.241v0zM22.143 5.493c0.283 0 0.514 0.051 0.746 0.18 0.849 0.489 1.157 2.032 0.797 4.244-0.077 0.437-0.18 0.9-0.283 1.389-1.080-0.232-2.238-0.412-3.447-0.54-0.694-1.003-1.44-1.903-2.186-2.701 1.543-1.518 3.112-2.572 4.372-2.572zM18.362 10.663c-0.463-0.026-0.952-0.026-1.44-0.026s-0.977 0-1.44 0.026c0.463-0.617 0.952-1.183 1.44-1.723 0.489 0.54 0.977 1.132 1.44 1.723v0zM10.98 5.673c0.206-0.129 0.463-0.18 0.746-0.18 1.26 0 2.829 1.029 4.372 2.572-0.746 0.797-1.466 1.697-2.186 2.701-1.209 0.103-2.366 0.283-3.447 0.54-0.129-0.463-0.206-0.926-0.283-1.389-0.36-2.186-0.077-3.729 0.797-4.244v0zM9.643 19.228c-2.881-0.823-4.604-2.083-4.604-3.241 0-1.003 1.183-2.006 3.266-2.803 0.412-0.154 0.874-0.309 1.337-0.437 0.334 1.055 0.746 2.135 1.26 3.241-0.514 1.106-0.952 2.212-1.26 3.241zM10.183 22.057c0.077-0.437 0.18-0.9 0.283-1.389 1.080 0.232 2.238 0.412 3.447 0.54 0.694 1.003 1.44 1.903 2.186 2.701-1.543 1.517-3.112 2.572-4.372 2.572-0.283 0-0.514-0.051-0.746-0.18-0.875-0.489-1.157-2.058-0.797-4.244z"}))),t.createElement("span",{className:"icon-title"},"React")),t.createElement("div",{className:"icon-wrapper"},t.createElement("div",{className:"tech-icons col-md-2 col-4"},t.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",version:"1.1",viewBox:"0 0 32 32",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",title:"Git"},t.createElement("path",{d:"M26.852 15.281l-9.848-9.848c-0.567-0.567-1.487-0.567-2.054 0l-2.045 2.045 2.594 2.594c0.603-0.204 1.294-0.067 1.775 0.413 0.483 0.483 0.619 1.181 0.41 1.786l2.5 2.5c0.605-0.209 1.303-0.074 1.786 0.41 0.675 0.675 0.675 1.769 0 2.444s-1.769 0.675-2.445 0c-0.508-0.508-0.633-1.254-0.376-1.88l-2.332-2.332v6.136c0.164 0.082 0.32 0.19 0.457 0.327 0.675 0.675 0.675 1.769 0 2.445-0.675 0.675-1.77 0.675-2.444 0-0.675-0.676-0.675-1.77 0-2.445 0.167-0.167 0.36-0.293 0.566-0.377v-6.193c-0.206-0.084-0.399-0.209-0.566-0.377-0.511-0.511-0.634-1.262-0.372-1.889l-2.557-2.558-6.753 6.752c-0.567 0.568-0.567 1.488 0 2.055l9.849 9.848c0.567 0.567 1.486 0.567 2.054 0l9.802-9.802c0.567-0.567 0.567-1.488 0-2.055z"}))),t.createElement("span",{className:"icon-title"},"Git")),t.createElement("div",{className:"icon-wrapper"},t.createElement("div",{className:"tech-icons col-md-2 col-4"},t.createElement("svg",{width:"1em",height:"1em",viewBox:"0 -166.5 512 512",version:"1.1",xmlns:"http://www.w3.org/2000/svg",fill:"#000000",stroke:"#000000",title:"Django"},t.createElement("g",null,t.createElement("path",{d:"M386.891623,41.4228474 C398.893282,41.4228474 409.984729,42.6943288 423.439677,45.4214453 L413.851956,65.618529 C406.396664,64.1640668 413.254923,65.4238187 407.621228,64.8783954 L407.621228,67.7884927 L407.98367,79.6048247 L408.164305,94.8790231 C408.346113,98.6958133 408.346113,102.514949 408.529094,106.332913 L408.529094,113.970012 L408.529094,113.970012 C408.529094,137.970983 406.529208,149.243065 400.529552,158.515261 C391.801606,172.15319 376.710388,178.880077 355.255899,178.880077 C344.346259,178.880077 334.893428,177.243807 325.073463,173.424671 L325.073463,147.606795 L325.074636,147.606795 C334.894601,152.697412 344.712221,155.05974 355.075264,155.05974 C373.437848,155.05974 381.256755,147.606795 381.256755,129.787288 L381.256755,129.241864 L381.256755,129.241864 C375.802522,131.967808 370.347116,133.059827 363.075979,133.059827 C338.529584,133.059827 322.890597,116.877763 322.890597,91.2416948 C322.890597,59.4206435 345.983702,41.4228474 386.891623,41.4228474 Z M132.909689,43.2409251 L132.909689,108.149817 C132.909689,130.514519 131.27342,141.241177 126.36461,150.514546 C121.818243,159.425473 115.817413,165.060341 103.454485,171.242978 L77.4536283,158.878877 C89.8177295,153.061028 95.8173858,147.971583 99.635349,140.15033 C103.636293,132.150789 104.91012,122.87742 104.91012,98.5140056 L104.91012,43.2409251 L132.909689,43.2409251 Z M466.908155,40.8774241 C494.907724,40.8774241 512,58.5151235 512,87.0601161 C512,116.334686 494.182839,134.698443 465.817308,134.698443 C437.815393,134.698443 420.542482,117.060744 420.542482,88.697559 C420.543655,59.2400087 438.363162,40.8774241 466.908155,40.8774241 Z M186.914807,41.2422126 C201.278794,41.2422126 210.732798,45.0590028 214.91555,52.5142942 C217.277878,56.6958729 218.005109,62.150106 218.005109,73.788149 L218.005109,130.696327 C205.458027,132.514404 189.640751,133.788232 178.005054,133.788232 C154.550679,133.788232 144.003482,125.603363 144.003482,107.422586 C144.003482,87.7850013 158.003853,78.6946129 192.36904,75.7845156 L192.36904,69.6030515 C192.36904,64.512434 189.823732,62.6955293 182.732056,62.6955293 C172.369013,62.6955293 160.732143,65.6044536 149.821331,71.2416673 L149.821331,49.604197 L149.822504,49.604197 C162.187778,43.7875213 174.005283,41.2422126 186.914807,41.2422126 Z M88.3656132,0 L88.3656132,129.606653 C74.0016266,132.333769 63.455603,133.424616 52.0017136,133.424616 C17.8183343,133.424616 0,117.970956 0,88.3327705 C0,59.786605 18.9103538,41.2422126 48.1825775,41.2422126 C52.7277717,41.2422126 56.1821193,41.6046552 60.364871,42.6955018 L60.364871,0 L88.3656132,0 Z M275.642863,41.2422126 C290.00685,41.2422126 300.371066,44.5135795 306.554876,50.8780243 C312.372724,56.8765077 314.189629,63.4215874 314.189629,77.4243044 L314.189629,132.332596 L286.188887,132.332596 L286.188887,78.515151 C286.188887,67.7884927 282.552731,63.7863759 272.553304,63.7863759 C268.735341,63.7863759 265.280993,64.1499914 259.642607,65.7862613 L259.642607,132.332596 L231.643037,132.332596 L231.643037,47.6043115 C248.187544,43.2409251 261.8243,41.2422126 275.642863,41.2422126 Z M193.641695,94.1506191 C175.094957,95.9686968 169.0953,98.8787941 169.0953,106.151105 C169.0953,111.605338 172.550821,114.150647 180.186747,114.150647 C184.369499,114.150647 188.186289,113.788204 193.641695,112.879165 L193.641695,94.1506191 Z M466.545712,63.4227603 C455.453092,63.4227603 449.087474,72.3336869 449.087474,87.7861743 C449.088647,103.242181 455.453092,112.150761 466.360385,112.150761 C477.08939,112.150761 483.453834,103.241008 483.453834,87.7861743 C483.453834,72.5143217 477.271197,63.4227603 466.545712,63.4227603 Z M50.910867,63.7863759 C36.7286881,63.7863759 28.5461656,72.5143217 28.5461656,87.7861743 C28.5461656,102.696757 36.3650726,110.878107 50.7290592,110.878107 C53.8186183,110.878107 56.3651001,110.696299 60.364871,110.152049 L60.364871,65.2396651 C57.0923311,64.1499914 54.3652146,63.7863759 50.910867,63.7863759 Z M361.621516,67.9667816 C354.895802,71.7859177 351.439108,78.6957858 351.439108,88.5134053 C351.439108,102.514949 358.350149,110.514491 370.713078,110.514491 C374.531041,110.514491 377.622946,109.786087 381.257928,108.696414 L381.257928,99.0606018 C381.257928,95.788062 381.077294,92.1495607 381.077294,88.3327705 L380.896659,75.424419 L380.713678,66.1510498 L380.713678,63.9681836 L377.803581,63.9681836 C372.350521,63.7863759 365.987249,65.2396651 361.621516,67.9667816 Z M132.909689,0.148965075 L132.909689,28.8769384 L104.91012,28.8769384 L104.91012,0.148965075 L132.909689,0.148965075 Z",fill:"#000000"})))),t.createElement("span",{className:"icon-title"},"Django")),t.createElement("div",{className:"icon-wrapper"},t.createElement("div",{className:"tech-icons col-md-2 col-4"},t.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",role:"img",viewBox:"0 0 32 32",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",title:"Docker"},t.createElement("title",null),t.createElement("path",{d:"M30.679 13.367c-0.613-0.404-1.366-0.645-2.175-0.645-0.093 0-0.185 0.003-0.276 0.009l0.012-0.001c-0.446 0.001-0.882 0.041-1.306 0.115l0.046-0.007c-0.235-1.357-1.025-2.495-2.122-3.191l-0.019-0.011-0.429-0.248-0.282 0.408c-0.336 0.512-0.599 1.108-0.756 1.745l-0.008 0.039c-0.089 0.324-0.14 0.696-0.14 1.080 0 0.831 0.24 1.605 0.654 2.258l-0.010-0.017c-0.637 0.299-1.381 0.488-2.164 0.524l-0.013 0h-19.729c-0.516 0.001-0.934 0.418-0.936 0.933v0c-0.001 0.056-0.001 0.123-0.001 0.19 0 1.751 0.317 3.428 0.897 4.977l-0.032-0.098c0.558 1.633 1.612 2.975 2.98 3.881l0.028 0.017c1.744 0.903 3.808 1.432 5.995 1.432 0.207 0 0.412-0.005 0.617-0.014l-0.029 0.001c0.018 0 0.039 0 0.060 0 1.272 0 2.515-0.121 3.72-0.352l-0.123 0.020c1.795-0.336 3.395-0.939 4.845-1.773l-0.074 0.039c1.257-0.735 2.331-1.621 3.245-2.652l0.012-0.014c1.325-1.56 2.403-3.381 3.145-5.365l0.041-0.125h0.276c0.055 0.002 0.119 0.004 0.183 0.004 1.226 0 2.34-0.481 3.163-1.265l-0.002 0.002c0.377-0.358 0.676-0.793 0.873-1.281l0.009-0.024 0.122-0.359zM3.79 14.849h2.646c0.127-0.001 0.23-0.104 0.23-0.231 0 0 0 0 0 0v0-2.355c0-0 0-0.001 0-0.001 0-0.127-0.103-0.23-0.23-0.231h-2.646c-0.127 0.001-0.23 0.104-0.23 0.231v0 2.356c0 0 0 0 0 0.001 0 0.127 0.103 0.23 0.23 0.23 0 0 0 0 0.001 0h-0zM7.434 14.849h2.644c0.127 0 0.231-0.103 0.231-0.231 0 0 0 0 0-0v0-2.355c0-0 0-0.001 0-0.001 0-0.127-0.103-0.23-0.23-0.231h-2.646c-0 0-0 0-0 0-0.128 0-0.232 0.104-0.232 0.232 0 0 0 0 0 0v0 2.355c0.001 0.128 0.104 0.231 0.232 0.231v0zM11.132 14.849h2.646c0.127-0.001 0.23-0.104 0.23-0.231 0 0 0 0 0 0v0-2.355c0-0 0-0.001 0-0.001 0-0.127-0.103-0.23-0.23-0.231h-2.646c-0.127 0.001-0.23 0.104-0.23 0.231v0 2.356c0 0.127 0.103 0.231 0.231 0.231v0zM14.788 14.849h2.643c0 0 0 0 0 0 0.128 0 0.231-0.103 0.232-0.231v-2.355c0-0 0-0 0-0 0-0.128-0.104-0.232-0.232-0.232-0 0-0 0-0 0h-2.643c-0.127 0-0.231 0.103-0.231 0.231v0 2.356c0 0 0 0 0 0.001 0 0.127 0.103 0.23 0.23 0.23 0 0 0 0 0.001 0h-0zM7.434 11.461h2.644c0.128-0.001 0.231-0.104 0.231-0.232 0 0 0 0 0 0v0-2.355c0 0 0 0 0-0 0-0.127-0.103-0.231-0.231-0.231h-2.644c-0.128 0-0.231 0.103-0.232 0.231v2.355c0.001 0.128 0.104 0.231 0.232 0.232h0zM11.132 11.461h2.646c0.127-0.001 0.23-0.105 0.23-0.232v0-2.355c0 0 0 0 0-0 0-0.127-0.103-0.231-0.231-0.231h-2.643c-0.127 0-0.231 0.103-0.231 0.231 0 0 0 0 0 0v0 2.355c0.001 0.128 0.103 0.231 0.231 0.232h0zM14.788 11.461h2.643c0.128-0.001 0.231-0.104 0.232-0.232v-2.355c-0.001-0.128-0.104-0.231-0.232-0.231h-2.643c-0.127 0-0.231 0.103-0.231 0.231 0 0 0 0 0 0v0 2.355c0 0.128 0.103 0.231 0.231 0.232h0zM14.788 8.073h2.643c0 0 0 0 0 0 0.128 0 0.232-0.104 0.232-0.232 0-0 0-0 0-0v0-2.356c-0.001-0.128-0.104-0.231-0.232-0.231 0 0-0 0-0 0h-2.643c-0.127 0-0.231 0.103-0.231 0.231v0 2.356c0 0 0 0 0 0.001 0 0.127 0.103 0.23 0.23 0.23 0 0 0 0 0.001 0h-0zM18.475 14.849h2.644c0 0 0 0 0 0 0.128 0 0.231-0.103 0.232-0.231v-2.355c0-0 0-0 0-0 0-0.128-0.104-0.232-0.232-0.232-0 0-0 0-0 0h-2.644c0 0 0 0-0 0-0.128 0-0.231 0.103-0.231 0.231v2.356c0 0.127 0.103 0.231 0.231 0.231v0z"}))),t.createElement("span",{className:"icon-title"},"Docker")),t.createElement("div",{className:"icon-wrapper"},t.createElement("div",{className:"tech-icons col-md-2 col-4"},t.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",role:"img",viewBox:"0 0 24 24",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",title:"PostgreSQL"},t.createElement("title",null),t.createElement("path",{d:"M23.5594 14.7228a.5269.5269 0 0 0-.0563-.1191c-.139-.2632-.4768-.3418-1.0074-.2321-1.6533.3411-2.2935.1312-2.5256-.0191 1.342-2.0482 2.445-4.522 3.0411-6.8297.2714-1.0507.7982-3.5237.1222-4.7316a1.5641 1.5641 0 0 0-.1509-.235C21.6931.9086 19.8007.0248 17.5099.0005c-1.4947-.0158-2.7705.3461-3.1161.4794a9.449 9.449 0 0 0-.5159-.0816 8.044 8.044 0 0 0-1.3114-.1278c-1.1822-.0184-2.2038.2642-3.0498.8406-.8573-.3211-4.7888-1.645-7.2219.0788C.9359 2.1526.3086 3.8733.4302 6.3043c.0409.818.5069 3.334 1.2423 5.7436.4598 1.5065.9387 2.7019 1.4334 3.582.553.9942 1.1259 1.5933 1.7143 1.7895.4474.1491 1.1327.1441 1.8581-.7279.8012-.9635 1.5903-1.8258 1.9446-2.2069.4351.2355.9064.3625 1.39.3772a.0569.0569 0 0 0 .0004.0041 11.0312 11.0312 0 0 0-.2472.3054c-.3389.4302-.4094.5197-1.5002.7443-.3102.064-1.1344.2339-1.1464.8115-.0025.1224.0329.2309.0919.3268.2269.4231.9216.6097 1.015.6331 1.3345.3335 2.5044.092 3.3714-.6787-.017 2.231.0775 4.4174.3454 5.0874.2212.5529.7618 1.9045 2.4692 1.9043.2505 0 .5263-.0291.8296-.0941 1.7819-.3821 2.5557-1.1696 2.855-2.9059.1503-.8707.4016-2.8753.5388-4.1012.0169-.0703.0357-.1207.057-.1362.0007-.0005.0697-.0471.4272.0307a.3673.3673 0 0 0 .0443.0068l.2539.0223.0149.001c.8468.0384 1.9114-.1426 2.5312-.4308.6438-.2988 1.8057-1.0323 1.5951-1.6698zM2.371 11.8765c-.7435-2.4358-1.1779-4.8851-1.2123-5.5719-.1086-2.1714.4171-3.6829 1.5623-4.4927 1.8367-1.2986 4.8398-.5408 6.108-.13-.0032.0032-.0066.0061-.0098.0094-2.0238 2.044-1.9758 5.536-1.9708 5.7495-.0002.0823.0066.1989.0162.3593.0348.5873.0996 1.6804-.0735 2.9184-.1609 1.1504.1937 2.2764.9728 3.0892.0806.0841.1648.1631.2518.2374-.3468.3714-1.1004 1.1926-1.9025 2.1576-.5677.6825-.9597.5517-1.0886.5087-.3919-.1307-.813-.5871-1.2381-1.3223-.4796-.839-.9635-2.0317-1.4155-3.5126zm6.0072 5.0871c-.1711-.0428-.3271-.1132-.4322-.1772.0889-.0394.2374-.0902.4833-.1409 1.2833-.2641 1.4815-.4506 1.9143-1.0002.0992-.126.2116-.2687.3673-.4426a.3549.3549 0 0 0 .0737-.1298c.1708-.1513.2724-.1099.4369-.0417.156.0646.3078.26.3695.4752.0291.1016.0619.2945-.0452.4444-.9043 1.2658-2.2216 1.2494-3.1676 1.0128zm2.094-3.988-.0525.141c-.133.3566-.2567.6881-.3334 1.003-.6674-.0021-1.3168-.2872-1.8105-.8024-.6279-.6551-.9131-1.5664-.7825-2.5004.1828-1.3079.1153-2.4468.079-3.0586-.005-.0857-.0095-.1607-.0122-.2199.2957-.2621 1.6659-.9962 2.6429-.7724.4459.1022.7176.4057.8305.928.5846 2.7038.0774 3.8307-.3302 4.7363-.084.1866-.1633.3629-.2311.5454zm7.3637 4.5725c-.0169.1768-.0358.376-.0618.5959l-.146.4383a.3547.3547 0 0 0-.0182.1077c-.0059.4747-.054.6489-.115.8693-.0634.2292-.1353.4891-.1794 1.0575-.11 1.4143-.8782 2.2267-2.4172 2.5565-1.5155.3251-1.7843-.4968-2.0212-1.2217a6.5824 6.5824 0 0 0-.0769-.2266c-.2154-.5858-.1911-1.4119-.1574-2.5551.0165-.5612-.0249-1.9013-.3302-2.6462.0044-.2932.0106-.5909.019-.8918a.3529.3529 0 0 0-.0153-.1126 1.4927 1.4927 0 0 0-.0439-.208c-.1226-.4283-.4213-.7866-.7797-.9351-.1424-.059-.4038-.1672-.7178-.0869.067-.276.1831-.5875.309-.9249l.0529-.142c.0595-.16.134-.3257.213-.5012.4265-.9476 1.0106-2.2453.3766-5.1772-.2374-1.0981-1.0304-1.6343-2.2324-1.5098-.7207.0746-1.3799.3654-1.7088.5321a5.6716 5.6716 0 0 0-.1958.1041c.0918-1.1064.4386-3.1741 1.7357-4.4823a4.0306 4.0306 0 0 1 .3033-.276.3532.3532 0 0 0 .1447-.0644c.7524-.5706 1.6945-.8506 2.802-.8325.4091.0067.8017.0339 1.1742.081 1.939.3544 3.2439 1.4468 4.0359 2.3827.8143.9623 1.2552 1.9315 1.4312 2.4543-1.3232-.1346-2.2234.1268-2.6797.779-.9926 1.4189.543 4.1729 1.2811 5.4964.1353.2426.2522.4522.2889.5413.2403.5825.5515.9713.7787 1.2552.0696.087.1372.1714.1885.245-.4008.1155-1.1208.3825-1.0552 1.717-.0123.1563-.0423.4469-.0834.8148-.0461.2077-.0702.4603-.0994.7662zm.8905-1.6211c-.0405-.8316.2691-.9185.5967-1.0105a2.8566 2.8566 0 0 0 .135-.0406 1.202 1.202 0 0 0 .1342.103c.5703.3765 1.5823.4213 3.0068.1344-.2016.1769-.5189.3994-.9533.6011-.4098.1903-1.0957.333-1.7473.3636-.7197.0336-1.0859-.0807-1.1721-.151zm.5695-9.2712c-.0059.3508-.0542.6692-.1054 1.0017-.055.3576-.112.7274-.1264 1.1762-.0142.4368.0404.8909.0932 1.3301.1066.887.216 1.8003-.2075 2.7014a3.5272 3.5272 0 0 1-.1876-.3856c-.0527-.1276-.1669-.3326-.3251-.6162-.6156-1.1041-2.0574-3.6896-1.3193-4.7446.3795-.5427 1.3408-.5661 2.1781-.463zm.2284 7.0137a12.3762 12.3762 0 0 0-.0853-.1074l-.0355-.0444c.7262-1.1995.5842-2.3862.4578-3.4385-.0519-.4318-.1009-.8396-.0885-1.2226.0129-.4061.0666-.7543.1185-1.0911.0639-.415.1288-.8443.1109-1.3505.0134-.0531.0188-.1158.0118-.1902-.0457-.4855-.5999-1.938-1.7294-3.253-.6076-.7073-1.4896-1.4972-2.6889-2.0395.5251-.1066 1.2328-.2035 2.0244-.1859 2.0515.0456 3.6746.8135 4.8242 2.2824a.908.908 0 0 1 .0667.1002c.7231 1.3556-.2762 6.2751-2.9867 10.5405zm-8.8166-6.1162c-.025.1794-.3089.4225-.6211.4225a.5821.5821 0 0 1-.0809-.0056c-.1873-.026-.3765-.144-.5059-.3156-.0458-.0605-.1203-.178-.1055-.2844.0055-.0401.0261-.0985.0925-.1488.1182-.0894.3518-.1226.6096-.0867.3163.0441.6426.1938.6113.4186zm7.9305-.4114c.0111.0792-.049.201-.1531.3102-.0683.0717-.212.1961-.4079.2232a.5456.5456 0 0 1-.075.0052c-.2935 0-.5414-.2344-.5607-.3717-.024-.1765.2641-.3106.5611-.352.297-.0414.6111.0088.6356.1851z"}))),t.createElement("span",{className:"icon-title"},"PostgreSQL")),t.createElement("div",{className:"icon-wrapper"},t.createElement("div",{className:"tech-icons col-md-2 col-4"},t.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",version:"1.1",viewBox:"0 0 32 32",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",title:"TensorFlow"},t.createElement("path",{d:"M29.399 14.959l-0.017-6.636-12.806-7.319v29.991l5.117-2.972v-8.438l3.864 2.234-0.023-5.771-3.841-2.194v-3.35l7.708 4.454zM2.619 8.322l12.806-7.318v29.991l-5.117-2.972v-17.519l-7.708 4.454 0.019-6.636z"}))),t.createElement("span",{className:"icon-title"},"TensorFlow"))),t.createElement("div",{className:"resume"},t.createElement("a",{href:"/public/assets/MW_resume.pdf",target:"_blank",rel:"noopener noreferrer",download:!0},"Download Resume")),t.createElement("iframe",{src:"/public/assets/MW_resume.pdf#toolbar=0&navpanes=0&scrollbar=0",width:"100%",height:"1000px",style:{border:"none"}},t.createElement("p",null,"Your browser doesn't support pdf viewer.",t.createElement("a",{href:"/public/assets/MW_resume.pdf"},"Download the PDF")," instead.")))};var yT={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},vT=t.createContext&&t.createContext(yT),bT=["attr","size","title"];function xT(){return xT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},xT.apply(this,arguments)}function wT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ST(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wT(Object(n),!0).forEach((function(t){var r,i,a;r=e,i=t,a=n[t],(i=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(i))in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function AT(e){return e&&e.map(((e,n)=>t.createElement(e.tag,ST({key:n},e.attr),AT(e.child))))}function MT(e){return n=>t.createElement(ET,xT({attr:ST({},e.attr)},n),AT(e.child))}function ET(e){var n=n=>{var r,{attr:i,size:a,title:s}=e,o=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,bT),l=a||n.size||"1em";return n.className&&(r=n.className),e.className&&(r=(r?r+" ":"")+e.className),t.createElement("svg",xT({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,i,o,{className:r,style:ST(ST({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),s&&t.createElement("title",null,s),e.children)};return void 0!==vT?t.createElement(vT.Consumer,null,(e=>n(e))):n(yT)}function CT(e){return MT({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"},child:[]}]})(e)}function TT(e){return MT({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"},child:[]}]})(e)}function PT(e){return MT({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(e)}const IT=function(){return xA("rgb(36, 46, 52)"),t.createElement("footer",{className:"footer"},t.createElement("div",{className:"footer-divider"}),t.createElement("div",{className:"footer-container"},t.createElement("div",{className:"footer-icons"},t.createElement("a",{href:"https://www.linkedin.com/in/mattwilliams19",target:"_blank",rel:"noopener noreferrer","aria-label":"LinkedIn"},t.createElement(TT,null)),t.createElement("a",{href:"mailto:mattwilliams6198@gmail.com",target:"_blank",rel:"noopener noreferrer","aria-label":"Email"},t.createElement(PT,null)),t.createElement("a",{href:"https://github.com/mwilliams619",target:"_blank",rel:"noopener noreferrer","aria-label":"GitHub"},t.createElement(CT,null)))))},RT=function(){return t.createElement(pe,null,t.createElement("div",{className:"app-body"},t.createElement(be,null),t.createElement(ce,null,t.createElement(oe,{path:"/",element:t.createElement(wA,null)}),t.createElement(oe,{path:"/about",element:t.createElement(SA,null)}),t.createElement(oe,{path:"/projects",element:t.createElement(mT,null)}),t.createElement(oe,{path:"/CV",element:t.createElement(_T,null)}),t.createElement(oe,{path:"/press",element:t.createElement(gT,null)})),t.createElement(IT,null)))};var kT=document.getElementById("root");(0,r.H)(kT).render(t.createElement(RT,null))})()})();